{"ast":null,"code":"/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\n'use strict';\n\nimport _Constructor from './constructor';\nimport _Context from './context';\nimport _history from './history';\nimport _util from './util';\nimport _notice from '../plugins/modules/_notice';\n/**\r\n * @description SunEditor constuctor function.\r\n * create core object and event registration.\r\n * core, event, functions\r\n * @param {Object} context\r\n * @param {Object} pluginCallButtons\r\n * @param {Object} plugins \r\n * @param {Object} lang\r\n * @param {Object} options\r\n * @param {Object} _responsiveButtons\r\n * @returns {Object} functions Object\r\n */\n\nexport default function (context, pluginCallButtons, plugins, lang, options, _responsiveButtons) {\n  const _d = context.element.originElement.ownerDocument || document;\n\n  const _w = _d.defaultView || window;\n\n  const util = _util;\n  const icons = options.icons;\n  /**\r\n   * @description editor core object\r\n   * should always bind this object when registering an event in the plug-in.\r\n   */\n\n  const core = {\n    _d: _d,\n    _w: _w,\n    _parser: new _w.DOMParser(),\n\n    /**\r\n     * @description Document object of the iframe if created as an iframe || _d\r\n     * @private\r\n     */\n    _wd: null,\n\n    /**\r\n     * @description Window object of the iframe if created as an iframe || _w\r\n     * @private\r\n     */\n    _ww: null,\n\n    /**\r\n     * @description Closest ShadowRoot to editor if found\r\n     * @private\r\n     */\n    _shadowRoot: null,\n\n    /**\r\n     * @description Block controller mousedown events in \"shadowRoot\" environment\r\n     * @private\r\n     */\n    _shadowRootControllerEventTarget: null,\n\n    /**\r\n     * @description Util object\r\n     */\n    util: util,\n\n    /**\r\n     * @description Functions object\r\n     */\n    functions: null,\n\n    /**\r\n     * @description Editor options\r\n     */\n    options: null,\n\n    /**\r\n     * @description Computed style of the wysiwyg area (window.getComputedStyle(context.element.wysiwyg))\r\n     */\n    wwComputedStyle: _w.getComputedStyle(context.element.wysiwyg),\n\n    /**\r\n     * @description Notice object\r\n     */\n    notice: _notice,\n\n    /**\r\n     * @description Default icons object\r\n     */\n    icons: icons,\n\n    /**\r\n     * @description History object for undo, redo\r\n     */\n    history: null,\n\n    /**\r\n     * @description Elements and user options parameters of the suneditor\r\n     */\n    context: context,\n\n    /**\r\n     * @description Plugin buttons\r\n     */\n    pluginCallButtons: pluginCallButtons,\n\n    /**\r\n     * @description Loaded plugins\r\n     */\n    plugins: plugins || {},\n\n    /**\r\n     * @description Whether the plugin is initialized\r\n     */\n    initPlugins: {},\n\n    /**\r\n     * @description Object for managing submenu elements\r\n     * @private\r\n     */\n    _targetPlugins: {},\n\n    /**\r\n     * @description Save rendered submenus and containers\r\n     * @private\r\n     */\n    _menuTray: {},\n\n    /**\r\n     * @description loaded language\r\n     */\n    lang: lang,\n\n    /**\r\n     * @description The selection node (core.getSelectionNode()) to which the effect was last applied\r\n     */\n    effectNode: null,\n\n    /**\r\n     * @description submenu element\r\n     */\n    submenu: null,\n\n    /**\r\n     * @description container element\r\n     */\n    container: null,\n\n    /**\r\n     * @description current subment name\r\n     * @private\r\n     */\n    _submenuName: '',\n\n    /**\r\n     * @description binded submenuOff method\r\n     * @private\r\n     */\n    _bindedSubmenuOff: null,\n\n    /**\r\n     * @description binded containerOff method\r\n     * @private\r\n     */\n    _bindedContainerOff: null,\n\n    /**\r\n     * @description active button element in submenu\r\n     */\n    submenuActiveButton: null,\n\n    /**\r\n     * @description active button element in container\r\n     */\n    containerActiveButton: null,\n\n    /**\r\n     * @description The elements array to be processed unvisible when the controllersOff function is executed (resizing, link modified button, table controller)\r\n     */\n    controllerArray: [],\n\n    /**\r\n     * @description The name of the plugin that called the currently active controller\r\n     */\n    currentControllerName: '',\n\n    /**\r\n     * @description The target element of current controller\r\n     */\n    currentControllerTarget: null,\n\n    /**\r\n     * @description The file component object of current selected file tag (getFileComponent)\r\n     */\n    currentFileComponentInfo: null,\n\n    /**\r\n     * @description An array of buttons whose class name is not \"se-code-view-enabled\"\r\n     */\n    codeViewDisabledButtons: null,\n\n    /**\r\n     * @description An array of buttons whose class name is not \"se-resizing-enabled\"\r\n     */\n    resizingDisabledButtons: null,\n\n    /**\r\n     * @description active more layer element in submenu\r\n     * @private\r\n     */\n    _moreLayerActiveButton: null,\n\n    /**\r\n     * @description Tag whitelist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n     * ^(options._editorTagsWhitelist)$\r\n     * @private\r\n     */\n    _htmlCheckWhitelistRegExp: null,\n\n    /**\r\n     * @description RegExp when using check disallowd tags. (b, i, ins, strike, s)\r\n     * @private\r\n     */\n    _disallowedTextTagsRegExp: null,\n\n    /**\r\n     * @description Editor tags whitelist (RegExp object)\r\n     * util.createTagsWhitelist(options._editorTagsWhitelist)\r\n     */\n    editorTagsWhitelistRegExp: null,\n\n    /**\r\n     * @description Tag whitelist when pasting (RegExp object)\r\n     * util.createTagsWhitelist(options.pasteTagsWhitelist)\r\n     */\n    pasteTagsWhitelistRegExp: null,\n\n    /**\r\n     * @description Boolean value of whether the editor has focus\r\n     */\n    hasFocus: false,\n\n    /**\r\n     * @description Boolean value of whether the editor is disabled\r\n     */\n    isDisabled: false,\n\n    /**\r\n     * @description Attributes whitelist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesWhitelistRegExp: null,\n\n    /**\r\n     * @description Attributes of tags whitelist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesTagsWhitelist: null,\n\n    /**\r\n     * @description binded controllersOff method\r\n     * @private\r\n     */\n    _bindControllersOff: null,\n\n    /**\r\n     * @description Is inline mode?\r\n     * @private\r\n     */\n    _isInline: null,\n\n    /**\r\n     * @description Is balloon|balloon-always mode?\r\n     * @private\r\n     */\n    _isBalloon: null,\n\n    /**\r\n     * @description Is balloon-always mode?\r\n     * @private\r\n     */\n    _isBalloonAlways: null,\n\n    /**\r\n     * @description Required value when using inline mode to sticky toolbar\r\n     * @private\r\n     */\n    _inlineToolbarAttr: {\n      top: '',\n      width: '',\n      isShow: false\n    },\n\n    /**\r\n     * @description Variable that controls the \"blur\" event in the editor of inline or balloon mode when the focus is moved to submenu\r\n     * @private\r\n     */\n    _notHideToolbar: false,\n\n    /**\r\n     * @description Variable value that sticky toolbar mode\r\n     * @private\r\n     */\n    _sticky: false,\n\n    /**\r\n     * @description Variables for controlling focus and blur events\r\n     * @private\r\n     */\n    _antiBlur: false,\n\n    /**\r\n     * @description Component line breaker element\r\n     * @private\r\n     */\n    _lineBreaker: null,\n    _lineBreakerButton: null,\n\n    /**\r\n     * @description If true, (initialize, reset) all indexes of image, video information\r\n     * @private\r\n     */\n    _componentsInfoInit: true,\n    _componentsInfoReset: false,\n\n    /**\r\n     * @description Plugins array with \"active\" method.\r\n     * \"activePlugins\" runs the \"add\" method when creating the editor.\r\n     */\n    activePlugins: null,\n\n    /**\r\n     * @description Information of tags that should maintain HTML structure, style, class name, etc. (In use by \"math\" plugin)\r\n     * When inserting \"html\" such as paste, it is executed on the \"html\" to be inserted. (core.cleanHTML)\r\n     * Basic Editor Actions:\r\n     * 1. All classes not starting with \"__se__\" or \"se-\" in the editor are removed.\r\n     * 2. The style of all tags except the \"span\" tag is removed from the editor.\r\n     * \"managedTagsInfo\" structure ex:\r\n     * managedTagsInfo: {\r\n     *   query: '.__se__xxx, se-xxx'\r\n     *   map: {\r\n     *     '__se__xxx': method.bind(core),\r\n     *     'se-xxx': method.bind(core),\r\n     *   }\r\n     * }\r\n     * @example\r\n     * Define in the following return format in the \"managedTagInfo\" function of the plugin.\r\n     * managedTagInfo() => {\r\n     *  return {\r\n     *    className: 'string', // Class name to identify the tag. (\"__se__xxx\", \"se-xxx\")\r\n     *    // Change the html of the \"element\". (\"element\" is the element found with \"className\".)\r\n     *    // \"method\" is executed by binding \"core\".\r\n     *    method: function (element) {\r\n     *      // this === core\r\n     *      element.innerHTML = // (rendered html);\r\n     *    }\r\n     *  }\r\n     * }\r\n     */\n    managedTagsInfo: null,\n\n    /**\r\n     * @description cashing: options.charCounterType === 'byte-html'\r\n     * @private\r\n     */\n    _charTypeHTML: false,\n\n    /**\r\n     * @description Array of \"checkFileInfo\" functions with the core bound\r\n     * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n     * \"fileInfoPlugins\" runs the \"add\" method when creating the editor.\r\n     * \"checkFileInfo\" method is always call just before the \"change\" event.\r\n     * @private\r\n     */\n    _fileInfoPluginsCheck: null,\n\n    /**\r\n     * @description Array of \"resetFileInfo\" functions with the core bound\r\n     * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n     * \"checkFileInfo\" method is always call just before the \"functions.setOptions\" method.\r\n     * @private\r\n     */\n    _fileInfoPluginsReset: null,\n\n    /**\r\n     * @description Variables for file component management\r\n     * @private\r\n     */\n    _fileManager: {\n      tags: null,\n      regExp: null,\n      queryString: null,\n      pluginRegExp: null,\n      pluginMap: null\n    },\n\n    /**\r\n     * @description Elements that need to change text or className for each selection change\r\n     * After creating the editor, \"activePlugins\" are added.\r\n     * @property {Element} STRONG bold button\r\n     * @property {Element} U underline button\r\n     * @property {Element} EM italic button\r\n     * @property {Element} DEL strike button\r\n     * @property {Element} SUB subscript button\r\n     * @property {Element} SUP superscript button\r\n     * @property {Element} OUTDENT outdent button\r\n     * @property {Element} INDENT indent button\r\n     */\n    commandMap: null,\n\n    /**\r\n     * @description Style button related to edit area\r\n     * @property {Element} fullScreen fullScreen button element\r\n     * @property {Element} showBlocks showBlocks button element\r\n     * @property {Element} codeView codeView button element\r\n     * @private\r\n     */\n    _styleCommandMap: null,\n\n    /**\r\n     * @description Map of default command\r\n     * @private\r\n     */\n    _defaultCommand: {\n      bold: options.textTags.bold,\n      underline: options.textTags.underline,\n      italic: options.textTags.italic,\n      strike: options.textTags.strike,\n      subscript: options.textTags.sub,\n      superscript: options.textTags.sup\n    },\n\n    /**\r\n     * @description Variables used internally in editor operation\r\n     * @property {Boolean} isCodeView State of code view\r\n     * @property {Boolean} isFullScreen State of full screen\r\n     * @property {Number} innerHeight_fullScreen InnerHeight in editor when in full screen\r\n     * @property {Number} resizeClientY Remember the vertical size of the editor before resizing the editor (Used when calculating during resize operation)\r\n     * @property {Number} tabSize Indent size of tab (4)\r\n     * @property {Number} codeIndent Indent size of Code view mode (2)\r\n     * @property {Number} minResizingSize Minimum size of editing area when resized {Number} (.se-wrapper-inner {min-height: 65px;} || 65)\r\n     * @property {Array} currentNodes  An array of the current cursor's node structure\r\n     * @private\r\n     */\n    _variable: {\n      isChanged: false,\n      isCodeView: false,\n      isFullScreen: false,\n      innerHeight_fullScreen: 0,\n      resizeClientY: 0,\n      tabSize: 4,\n      codeIndent: 2,\n      minResizingSize: util.getNumber(context.element.wysiwygFrame.style.minHeight || '65', 0),\n      currentNodes: [],\n      currentNodesMap: [],\n      _range: null,\n      _selectionNode: null,\n      _originCssText: context.element.topArea.style.cssText,\n      _bodyOverflow: '',\n      _editorAreaOriginCssText: '',\n      _wysiwygOriginCssText: '',\n      _codeOriginCssText: '',\n      _fullScreenAttrs: {\n        sticky: false,\n        balloon: false,\n        inline: false\n      },\n      _lineBreakComp: null,\n      _lineBreakDir: ''\n    },\n\n    /**\r\n     * @description If the plugin is not added, add the plugin and call the 'add' function.\r\n     * If the plugin is added call callBack function.\r\n     * @param {String} pluginName The name of the plugin to call\r\n     * @param {function} callBackFunction Function to be executed immediately after module call\r\n     * @param {Element|null} _target Plugin target button (This is not necessary if you have a button list when creating the editor)\r\n     */\n    callPlugin: function (pluginName, callBackFunction, _target) {\n      _target = _target || pluginCallButtons[pluginName];\n\n      if (!this.plugins[pluginName]) {\n        throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:\"' + pluginName + '\")');\n      } else if (!this.initPlugins[pluginName]) {\n        this.plugins[pluginName].add(this, _target);\n        this.initPlugins[pluginName] = true;\n      } else if (typeof this._targetPlugins[pluginName] === 'object' && !!_target) {\n        this.initMenuTarget(pluginName, _target, this._targetPlugins[pluginName]);\n      }\n\n      if (this.plugins[pluginName].active && !this.commandMap[pluginName] && !!_target) {\n        this.commandMap[pluginName] = _target;\n        this.activePlugins.push(pluginName);\n      }\n\n      if (typeof callBackFunction === 'function') callBackFunction();\n    },\n\n    /**\r\n     * @description If the module is not added, add the module and call the 'add' function\r\n     * @param {Array} moduleArray module object's Array [dialog, resizing]\r\n     */\n    addModule: function (moduleArray) {\n      for (let i = 0, len = moduleArray.length, moduleName; i < len; i++) {\n        moduleName = moduleArray[i].name;\n\n        if (!this.plugins[moduleName]) {\n          this.plugins[moduleName] = moduleArray[i];\n        }\n\n        if (!this.initPlugins[moduleName]) {\n          this.initPlugins[moduleName] = true;\n          if (typeof this.plugins[moduleName].add === 'function') this.plugins[moduleName].add(this);\n        }\n      }\n    },\n\n    /**\r\n     * @description Gets the current editor-relative scroll offset.\r\n     * @returns {Object} {top, left}\r\n     */\n    getGlobalScrollOffset: function () {\n      let t = 0,\n          l = 0;\n      let el = context.element.topArea;\n\n      while (el) {\n        t += el.scrollTop;\n        l += el.scrollLeft;\n        el = el.parentElement;\n      }\n\n      el = this._shadowRoot ? this._shadowRoot.host : null;\n\n      while (el) {\n        t += el.scrollTop;\n        l += el.scrollLeft;\n        el = el.parentElement;\n      }\n\n      return {\n        top: t,\n        left: l\n      };\n    },\n\n    /**\r\n     * @description Method for managing submenu element.\r\n     * You must add the \"submenu\" element using the this method at custom plugin.\r\n     * @param {String} pluginName Plugin name\r\n     * @param {Element|null} target Target button\r\n     * @param {Element} menu Submenu element\r\n     */\n    initMenuTarget: function (pluginName, target, menu) {\n      if (!target) {\n        this._targetPlugins[pluginName] = menu;\n      } else {\n        context.element._menuTray.appendChild(menu);\n\n        this._targetPlugins[pluginName] = true;\n        this._menuTray[target.getAttribute('data-command')] = menu;\n      }\n    },\n\n    /**\r\n     * @description Enabled submenu\r\n     * @param {Element} element Submenu's button element to call\r\n     */\n    submenuOn: function (element) {\n      if (this._bindedSubmenuOff) this._bindedSubmenuOff();\n      if (this._bindControllersOff) this.controllersOff();\n      const submenuName = this._submenuName = element.getAttribute('data-command');\n      const menu = this.submenu = this._menuTray[submenuName];\n      this.submenuActiveButton = element;\n\n      this._setMenuPosition(element, menu);\n\n      this._bindedSubmenuOff = this.submenuOff.bind(this);\n      this.addDocEvent('mousedown', this._bindedSubmenuOff, false);\n      if (this.plugins[submenuName].on) this.plugins[submenuName].on.call(this);\n      this._antiBlur = true;\n    },\n\n    /**\r\n     * @description Disable submenu\r\n     */\n    submenuOff: function () {\n      this.removeDocEvent('mousedown', this._bindedSubmenuOff);\n      this._bindedSubmenuOff = null;\n\n      if (this.submenu) {\n        this._submenuName = '';\n        this.submenu.style.display = 'none';\n        this.submenu = null;\n        util.removeClass(this.submenuActiveButton, 'on');\n        this.submenuActiveButton = null;\n        this._notHideToolbar = false;\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Enabled container\r\n     * @param {Element} element Container's button element to call\r\n     */\n    containerOn: function (element) {\n      if (this._bindedContainerOff) this._bindedContainerOff();\n      const containerName = this._containerName = element.getAttribute('data-command');\n      const menu = this.container = this._menuTray[containerName];\n      this.containerActiveButton = element;\n\n      this._setMenuPosition(element, menu);\n\n      this._bindedContainerOff = this.containerOff.bind(this);\n      this.addDocEvent('mousedown', this._bindedContainerOff, false);\n      if (this.plugins[containerName].on) this.plugins[containerName].on.call(this);\n      this._antiBlur = true;\n    },\n\n    /**\r\n     * @description Disable container\r\n     */\n    containerOff: function () {\n      this.removeDocEvent('mousedown', this._bindedContainerOff);\n      this._bindedContainerOff = null;\n\n      if (this.container) {\n        this._containerName = '';\n        this.container.style.display = 'none';\n        this.container = null;\n        util.removeClass(this.containerActiveButton, 'on');\n        this.containerActiveButton = null;\n        this._notHideToolbar = false;\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Set the menu position. (submenu, container)\r\n     * @param {*} element Button element\r\n     * @param {*} menu Menu element\r\n     * @private\r\n     */\n    _setMenuPosition: function (element, menu) {\n      menu.style.visibility = 'hidden';\n      menu.style.display = 'block';\n      menu.style.height = '';\n      util.addClass(element, 'on');\n      const toolbar = this.context.element.toolbar;\n      const toolbarW = toolbar.offsetWidth;\n\n      const toolbarOffset = event._getEditorOffsets(context.element.toolbar);\n\n      const menuW = menu.offsetWidth;\n      const l = element.parentElement.offsetLeft + 3; // rtl\n\n      if (options.rtl) {\n        const elementW = element.offsetWidth;\n        const rtlW = menuW > elementW ? menuW - elementW : 0;\n        const rtlL = rtlW > 0 ? 0 : elementW - menuW;\n        menu.style.left = l - rtlW + rtlL + 'px';\n\n        if (toolbarOffset.left > event._getEditorOffsets(menu).left) {\n          menu.style.left = '0px';\n        }\n      } else {\n        const overLeft = toolbarW <= menuW ? 0 : toolbarW - (l + menuW);\n        if (overLeft < 0) menu.style.left = l + overLeft + 'px';else menu.style.left = l + 'px';\n      } // get element top\n\n\n      let t = 0;\n      let offsetEl = element;\n\n      while (offsetEl && offsetEl !== toolbar) {\n        t += offsetEl.offsetTop;\n        offsetEl = offsetEl.offsetParent;\n      }\n\n      const bt = t;\n\n      if (this._isBalloon) {\n        t += toolbar.offsetTop + element.offsetHeight;\n      } else {\n        t -= element.offsetHeight;\n      } // set menu position\n\n\n      const toolbarTop = toolbarOffset.top;\n      const menuHeight = menu.offsetHeight;\n      const scrollTop = this.getGlobalScrollOffset().top;\n      const menuHeight_bottom = _w.innerHeight - (toolbarTop - scrollTop + bt + element.parentElement.offsetHeight);\n\n      if (menuHeight_bottom < menuHeight) {\n        let menuTop = -1 * (menuHeight - bt + 3);\n        const insTop = toolbarTop - scrollTop + menuTop;\n        const menuHeight_top = menuHeight + (insTop < 0 ? insTop : 0);\n\n        if (menuHeight_top > menuHeight_bottom) {\n          menu.style.height = menuHeight_top + 'px';\n          menuTop = -1 * (menuHeight_top - bt + 3);\n        } else {\n          menu.style.height = menuHeight_bottom + 'px';\n          menuTop = bt + element.parentElement.offsetHeight;\n        }\n\n        menu.style.top = menuTop + 'px';\n      } else {\n        menu.style.top = bt + element.parentElement.offsetHeight + 'px';\n      }\n\n      menu.style.visibility = '';\n    },\n\n    /**\r\n     * @description Show controller at editor area (controller elements, function, \"controller target element(@Required)\", \"controller name(@Required)\", etc..)\r\n     * @param {*} arguments controller elements, functions..\r\n     */\n    controllersOn: function () {\n      if (this._bindControllersOff) this._bindControllersOff();\n      this.controllerArray = [];\n\n      for (let i = 0, arg; i < arguments.length; i++) {\n        arg = arguments[i];\n        if (!arg) continue;\n\n        if (typeof arg === 'string') {\n          this.currentControllerName = arg;\n          continue;\n        }\n\n        if (typeof arg === 'function') {\n          this.controllerArray.push(arg);\n          continue;\n        }\n\n        if (!util.hasClass(arg, 'se-controller')) {\n          this.currentControllerTarget = arg;\n          this.currentFileComponentInfo = this.getFileComponent(arg);\n          continue;\n        }\n\n        if (arg.style) {\n          arg.style.display = 'block';\n\n          if (this._shadowRoot && this._shadowRootControllerEventTarget.indexOf(arg) === -1) {\n            arg.addEventListener('mousedown', function (e) {\n              e.preventDefault();\n              e.stopPropagation();\n            });\n\n            this._shadowRootControllerEventTarget.push(arg);\n          }\n        }\n\n        this.controllerArray.push(arg);\n      }\n\n      this._bindControllersOff = this.controllersOff.bind(this);\n      this.addDocEvent('mousedown', this._bindControllersOff, false);\n      this.addDocEvent('keydown', this._bindControllersOff, false);\n      this._antiBlur = true;\n      if (typeof functions.showController === 'function') functions.showController(this.currentControllerName, this.controllerArray, this);\n    },\n\n    /**\r\n     * @description Hide controller at editor area (link button, image resize button..)\r\n     * @param {KeyboardEvent|MouseEvent|null} e Event object when called from mousedown and keydown events registered in \"core.controllersOn\"\r\n     */\n    controllersOff: function (e) {\n      this._lineBreaker.style.display = 'none';\n      const len = this.controllerArray.length;\n\n      if (e && e.target && len > 0) {\n        for (let i = 0; i < len; i++) {\n          if (typeof this.controllerArray[i].contains === 'function' && this.controllerArray[i].contains(e.target)) return;\n        }\n      }\n\n      if (this._fileManager.pluginRegExp.test(this.currentControllerName) && e && e.type === 'keydown' && e.keyCode !== 27) return;\n      context.element.lineBreaker_t.style.display = context.element.lineBreaker_b.style.display = 'none';\n      this._variable._lineBreakComp = null;\n      this.currentControllerName = '';\n      this.currentControllerTarget = null;\n      this.currentFileComponentInfo = null;\n      this.effectNode = null;\n      if (!this._bindControllersOff) return;\n      this.removeDocEvent('mousedown', this._bindControllersOff);\n      this.removeDocEvent('keydown', this._bindControllersOff);\n      this._bindControllersOff = null;\n\n      if (len > 0) {\n        for (let i = 0; i < len; i++) {\n          if (typeof this.controllerArray[i] === 'function') this.controllerArray[i]();else this.controllerArray[i].style.display = 'none';\n        }\n\n        this.controllerArray = [];\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Specify the position of the controller.\r\n     * @param {Element} controller Controller element.\r\n     * @param {Element} referEl Element that is the basis of the controller's position.\r\n     * @param {String} position Type of position (\"top\" | \"bottom\")\r\n     * When using the \"top\" position, there should not be an arrow on the controller.\r\n     * When using the \"bottom\" position there should be an arrow on the controller.\r\n     * @param {Object} addOffset These are the left and top values that need to be added specially. \r\n     * This argument is required. - {left: 0, top: 0}\r\n     * Please enter the value based on ltr mode.\r\n     * Calculated automatically in rtl mode.\r\n     */\n    setControllerPosition: function (controller, referEl, position, addOffset) {\n      if (options.rtl) addOffset.left *= -1;\n      const offset = util.getOffset(referEl, context.element.wysiwygFrame);\n      controller.style.visibility = 'hidden';\n      controller.style.display = 'block'; // Height value of the arrow element is 11px\n\n      const topMargin = position === 'top' ? -(controller.offsetHeight + 2) : referEl.offsetHeight + 12;\n      controller.style.top = offset.top + topMargin + addOffset.top + 'px';\n      const l = offset.left - context.element.wysiwygFrame.scrollLeft + addOffset.left;\n      const controllerW = controller.offsetWidth;\n      const referElW = referEl.offsetWidth;\n      const allow = util.hasClass(controller.firstElementChild, 'se-arrow') ? controller.firstElementChild : null; // rtl (Width value of the arrow element is 22px)\n\n      if (options.rtl) {\n        const rtlW = controllerW > referElW ? controllerW - referElW : 0;\n        const rtlL = rtlW > 0 ? 0 : referElW - controllerW;\n        controller.style.left = l - rtlW + rtlL + 'px';\n\n        if (rtlW > 0) {\n          if (allow) allow.style.left = (controllerW - 14 < 10 + rtlW ? controllerW - 14 : 10 + rtlW) + 'px';\n        }\n\n        const overSize = context.element.wysiwygFrame.offsetLeft - controller.offsetLeft;\n\n        if (overSize > 0) {\n          controller.style.left = '0px';\n          if (allow) allow.style.left = overSize + 'px';\n        }\n      } else {\n        controller.style.left = l + 'px';\n        const overSize = context.element.wysiwygFrame.offsetWidth - (controller.offsetLeft + controllerW);\n\n        if (overSize < 0) {\n          controller.style.left = controller.offsetLeft + overSize + 'px';\n          if (allow) allow.style.left = 20 - overSize + 'px';\n        } else {\n          if (allow) allow.style.left = '20px';\n        }\n      }\n\n      controller.style.visibility = '';\n    },\n\n    /**\r\n     * @description javascript execCommand\r\n     * @param {String} command javascript execCommand function property\r\n     * @param {Boolean|undefined} showDefaultUI javascript execCommand function property\r\n     * @param {String|undefined} value javascript execCommand function property\r\n     */\n    execCommand: function (command, showDefaultUI, value) {\n      this._wd.execCommand(command, showDefaultUI, command === 'formatBlock' ? '<' + value + '>' : value); // history stack\n\n\n      this.history.push(true);\n    },\n\n    /**\r\n     * @description Focus to wysiwyg area using \"native focus function\"\r\n     */\n    nativeFocus: function () {\n      const caption = util.getParentElement(this.getSelectionNode(), 'figcaption');\n\n      if (caption) {\n        caption.focus();\n      } else {\n        context.element.wysiwyg.focus();\n      }\n\n      this._editorRange();\n    },\n\n    /**\r\n     * @description Focus to wysiwyg area\r\n     */\n    focus: function () {\n      if (context.element.wysiwygFrame.style.display === 'none') return;\n\n      if (options.iframe) {\n        this.nativeFocus();\n      } else {\n        try {\n          const range = this.getRange();\n\n          if (range.startContainer === range.endContainer && util.isWysiwygDiv(range.startContainer)) {\n            const currentNode = range.commonAncestorContainer.children[range.startOffset];\n\n            if (!util.isFormatElement(currentNode) && !util.isComponent(currentNode)) {\n              const format = util.createElement(options.defaultTag);\n              const br = util.createElement('BR');\n              format.appendChild(br);\n              context.element.wysiwyg.insertBefore(format, currentNode);\n              this.setRange(br, 0, br, 0);\n              return;\n            }\n          }\n\n          this.setRange(range.startContainer, range.startOffset, range.endContainer, range.endOffset);\n        } catch (e) {\n          this.nativeFocus();\n        }\n      }\n\n      event._applyTagEffects();\n\n      if (this._isBalloon) event._toggleToolbarBalloon();\n    },\n\n    /**\r\n     * @description If \"focusEl\" is a component, then that component is selected; if it is a format element, the last text is selected\r\n     * If \"focusEdge\" is null, then selected last element\r\n     * @param {Element|null} focusEl Focus element\r\n     */\n    focusEdge: function (focusEl) {\n      if (!focusEl) focusEl = context.element.wysiwyg.lastElementChild;\n      const fileComponentInfo = this.getFileComponent(focusEl);\n\n      if (fileComponentInfo) {\n        this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n      } else if (focusEl) {\n        focusEl = util.getChildElement(focusEl, function (current) {\n          return current.childNodes.length === 0 || current.nodeType === 3;\n        }, true);\n        if (!focusEl) this.nativeFocus();else this.setRange(focusEl, focusEl.textContent.length, focusEl, focusEl.textContent.length);\n      } else {\n        this.focus();\n      }\n    },\n\n    /**\r\n     * @description Focusout to wysiwyg area (.blur())\r\n     */\n    blur: function () {\n      if (options.iframe) {\n        context.element.wysiwygFrame.blur();\n      } else {\n        context.element.wysiwyg.blur();\n      }\n    },\n\n    /**\r\n     * @description Set current editor's range object and return.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @returns {Object} Range object.\r\n     */\n    setRange: function (startCon, startOff, endCon, endOff) {\n      if (!startCon || !endCon) return;\n      if (startOff > startCon.textContent.length) startOff = startCon.textContent.length;\n      if (endOff > endCon.textContent.length) endOff = endCon.textContent.length;\n\n      if (util.isFormatElement(startCon)) {\n        startCon = startCon.childNodes[startOff] || startCon;\n        startOff = 0;\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon;\n        endOff = startOff > 1 ? startOff : 0;\n      }\n\n      const range = this._wd.createRange();\n\n      try {\n        range.setStart(startCon, startOff);\n        range.setEnd(endCon, endOff);\n      } catch (error) {\n        console.warn('[SUNEDITOR.core.focus.error] ' + error);\n        this.nativeFocus();\n        return;\n      }\n\n      const selection = this.getSelection();\n\n      if (selection.removeAllRanges) {\n        selection.removeAllRanges();\n      }\n\n      selection.addRange(range);\n\n      this._editorRange();\n\n      if (options.iframe) this.nativeFocus();\n      return range;\n    },\n\n    /**\r\n     * @description Remove range object and button effect\r\n     */\n    removeRange: function () {\n      this._variable._range = null;\n      this._variable._selectionNode = null;\n      if (this.hasFocus) this.getSelection().removeAllRanges();\n      const commandMap = this.commandMap;\n      const activePlugins = this.activePlugins;\n\n      for (let key in commandMap) {\n        if (!util.hasOwn(commandMap, key)) continue;\n\n        if (activePlugins.indexOf(key) > -1) {\n          plugins[key].active.call(this, null);\n        } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\n          commandMap.OUTDENT.setAttribute('disabled', true);\n        } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\n          commandMap.INDENT.removeAttribute('disabled');\n        } else {\n          util.removeClass(commandMap[key], 'active');\n        }\n      }\n    },\n\n    /**\r\n     * @description Get current editor's range object\r\n     * @returns {Object}\r\n     */\n    getRange: function () {\n      const range = this._variable._range || this._createDefaultRange();\n\n      const selection = this.getSelection();\n      if (range.collapsed === selection.isCollapsed || !context.element.wysiwyg.contains(selection.focusNode)) return range;\n\n      if (selection.rangeCount > 0) {\n        this._variable._range = selection.getRangeAt(0);\n        return this._variable._range;\n      } else {\n        const sc = selection.anchorNode,\n              ec = selection.focusNode,\n              so = selection.anchorOffset,\n              eo = selection.focusOffset;\n        const compareValue = util.compareElements(sc, ec);\n        const rightDir = compareValue.ancestor && (compareValue.result === 0 ? so <= eo : compareValue.result > 1 ? true : false);\n        return this.setRange(rightDir ? sc : ec, rightDir ? so : eo, rightDir ? ec : sc, rightDir ? eo : so);\n      }\n    },\n\n    /**\r\n     * @description If the \"range\" object is a non-editable area, add a line at the top of the editor and update the \"range\" object.\r\n     * Returns a new \"range\" or argument \"range\".\r\n     * @param {Object} range core.getRange()\r\n     * @param {Element|null} container If there is \"container\" argument, it creates a line in front of the container.\r\n     * @returns {Object} range\r\n     */\n    getRange_addLine: function (range, container) {\n      if (this._selectionVoid(range)) {\n        const wysiwyg = context.element.wysiwyg;\n        const op = util.createElement(options.defaultTag);\n        op.innerHTML = '<br>';\n        wysiwyg.insertBefore(op, container && container !== wysiwyg ? container.nextElementSibling : wysiwyg.firstElementChild);\n        this.setRange(op.firstElementChild, 0, op.firstElementChild, 1);\n        range = this._variable._range;\n      }\n\n      return range;\n    },\n\n    /**\r\n     * @description Get window selection obejct\r\n     * @returns {Object}\r\n     */\n    getSelection: function () {\n      return this._shadowRoot && this._shadowRoot.getSelection ? this._shadowRoot.getSelection() : this._ww.getSelection();\n    },\n\n    /**\r\n     * @description Get current select node\r\n     * @returns {Node}\r\n     */\n    getSelectionNode: function () {\n      if (!context.element.wysiwyg.contains(this._variable._selectionNode)) this._editorRange();\n\n      if (!this._variable._selectionNode) {\n        const selectionNode = util.getChildElement(context.element.wysiwyg.firstChild, function (current) {\n          return current.childNodes.length === 0 || current.nodeType === 3;\n        }, false);\n\n        if (!selectionNode) {\n          this._editorRange();\n        } else {\n          this._variable._selectionNode = selectionNode;\n          return selectionNode;\n        }\n      }\n\n      return this._variable._selectionNode;\n    },\n\n    /**\r\n     * @description Saving the range object and the currently selected node of editor\r\n     * @private\r\n     */\n    _editorRange: function () {\n      const selection = this.getSelection();\n      if (!selection) return null;\n      let range = null;\n      let selectionNode = null;\n\n      if (selection.rangeCount > 0) {\n        range = selection.getRangeAt(0);\n      } else {\n        range = this._createDefaultRange();\n      }\n\n      this._variable._range = range;\n\n      if (range.collapsed) {\n        if (util.isWysiwygDiv(range.commonAncestorContainer)) selectionNode = range.commonAncestorContainer.children[range.startOffset] || range.commonAncestorContainer;else selectionNode = range.commonAncestorContainer;\n      } else {\n        selectionNode = selection.extentNode || selection.anchorNode;\n      }\n\n      this._variable._selectionNode = selectionNode;\n    },\n\n    /**\r\n     * @description Return the range object of editor's first child node\r\n     * @returns {Object}\r\n     * @private\r\n     */\n    _createDefaultRange: function () {\n      const wysiwyg = context.element.wysiwyg;\n      wysiwyg.focus();\n\n      const range = this._wd.createRange();\n\n      let focusEl = wysiwyg.firstElementChild;\n\n      if (!focusEl) {\n        focusEl = util.createElement(options.defaultTag);\n        focusEl.innerHTML = '<br>';\n        wysiwyg.appendChild(focusEl);\n      }\n\n      range.setStart(focusEl, 0);\n      range.setEnd(focusEl, 0);\n      return range;\n    },\n\n    /**\r\n     * @description Returns true if there is no valid \"selection\".\r\n     * @param {Object} range core.getRange()\r\n     * @returns {Object} range\r\n     * @private\r\n     */\n    _selectionVoid: function (range) {\n      const comm = range.commonAncestorContainer;\n      return util.isWysiwygDiv(range.startContainer) && util.isWysiwygDiv(range.endContainer) || /FIGURE/i.test(comm.nodeName) || this._fileManager.regExp.test(comm.nodeName) || util.isMediaComponent(comm);\n    },\n\n    /**\r\n     * @description Reset range object to text node selected status.\r\n     * @returns {Boolean} Returns false if there is no valid selection.\r\n     * @private\r\n     */\n    _resetRangeToTextNode: function () {\n      const range = this.getRange();\n      if (this._selectionVoid(range)) return false;\n      let startCon = range.startContainer;\n      let startOff = range.startOffset;\n      let endCon = range.endContainer;\n      let endOff = range.endOffset;\n      let tempCon, tempOffset, tempChild;\n\n      if (util.isFormatElement(startCon)) {\n        startCon = startCon.childNodes[startOff] || startCon.lastChild;\n        startOff = startCon.textContent.length;\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.lastChild;\n        endOff = endCon.textContent.length;\n      } // startContainer\n\n\n      tempCon = util.isWysiwygDiv(startCon) ? context.element.wysiwyg.firstChild : startCon;\n      tempOffset = startOff;\n\n      if (util.isBreak(tempCon) || tempCon.nodeType === 1 && tempCon.childNodes.length > 0) {\n        const onlyBreak = util.isBreak(tempCon);\n\n        if (!onlyBreak) {\n          while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\n            tempCon = tempCon.childNodes[tempOffset] || tempCon.nextElementSibling || tempCon.nextSibling;\n            tempOffset = 0;\n          }\n\n          let format = util.getFormatElement(tempCon, null);\n\n          if (format === util.getRangeFormatElement(format, null)) {\n            format = util.createElement(util.getParentElement(tempCon, util.isCell) ? 'DIV' : options.defaultTag);\n            tempCon.parentNode.insertBefore(format, tempCon);\n            format.appendChild(tempCon);\n          }\n        }\n\n        if (util.isBreak(tempCon)) {\n          const emptyText = util.createTextNode(util.zeroWidthSpace);\n          tempCon.parentNode.insertBefore(emptyText, tempCon);\n          tempCon = emptyText;\n\n          if (onlyBreak) {\n            if (startCon === endCon) {\n              endCon = tempCon;\n              endOff = 1;\n            }\n          }\n        }\n      } // set startContainer\n\n\n      startCon = tempCon;\n      startOff = tempOffset; // endContainer\n\n      tempCon = util.isWysiwygDiv(endCon) ? context.element.wysiwyg.lastChild : endCon;\n      tempOffset = endOff;\n\n      if (util.isBreak(tempCon) || tempCon.nodeType === 1 && tempCon.childNodes.length > 0) {\n        const onlyBreak = util.isBreak(tempCon);\n\n        if (!onlyBreak) {\n          while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\n            tempChild = tempCon.childNodes;\n            if (tempChild.length === 0) break;\n            tempCon = tempChild[tempOffset > 0 ? tempOffset - 1 : tempOffset] || !/FIGURE/i.test(tempChild[0].nodeName) ? tempChild[0] : tempCon.previousElementSibling || tempCon.previousSibling || startCon;\n            tempOffset = tempOffset > 0 ? tempCon.textContent.length : tempOffset;\n          }\n\n          let format = util.getFormatElement(tempCon, null);\n\n          if (format === util.getRangeFormatElement(format, null)) {\n            format = util.createElement(util.isCell(format) ? 'DIV' : options.defaultTag);\n            tempCon.parentNode.insertBefore(format, tempCon);\n            format.appendChild(tempCon);\n          }\n        }\n\n        if (util.isBreak(tempCon)) {\n          const emptyText = util.createTextNode(util.zeroWidthSpace);\n          tempCon.parentNode.insertBefore(emptyText, tempCon);\n          tempCon = emptyText;\n          tempOffset = 1;\n\n          if (onlyBreak && !tempCon.previousSibling) {\n            util.removeItem(endCon);\n          }\n        }\n      } // set endContainer\n\n\n      endCon = tempCon;\n      endOff = tempOffset; // set Range\n\n      this.setRange(startCon, startOff, endCon, endOff);\n      return true;\n    },\n\n    /**\r\n     * @description Returns a \"formatElement\"(util.isFormatElement) array from the currently selected range.\r\n     * @param {Function|null} validation The validation function. (Replaces the default validation function-util.isFormatElement(current))\r\n     * @returns {Array}\r\n     */\n    getSelectedElements: function (validation) {\n      if (!this._resetRangeToTextNode()) return [];\n      let range = this.getRange();\n\n      if (util.isWysiwygDiv(range.startContainer)) {\n        const children = context.element.wysiwyg.children;\n        if (children.length === 0) return [];\n        this.setRange(children[0], 0, children[children.length - 1], children[children.length - 1].textContent.trim().length);\n        range = this.getRange();\n      }\n\n      const startCon = range.startContainer;\n      const endCon = range.endContainer;\n      const commonCon = range.commonAncestorContainer; // get line nodes\n\n      const lineNodes = util.getListChildren(commonCon, function (current) {\n        return validation ? validation(current) : util.isFormatElement(current);\n      });\n      if (!util.isWysiwygDiv(commonCon) && !util.isRangeFormatElement(commonCon)) lineNodes.unshift(util.getFormatElement(commonCon, null));\n      if (startCon === endCon || lineNodes.length === 1) return lineNodes;\n      let startLine = util.getFormatElement(startCon, null);\n      let endLine = util.getFormatElement(endCon, null);\n      let startIdx = null;\n      let endIdx = null;\n\n      const onlyTable = function (current) {\n        return util.isTable(current) ? /^TABLE$/i.test(current.nodeName) : true;\n      };\n\n      let startRangeEl = util.getRangeFormatElement(startLine, onlyTable);\n      let endRangeEl = util.getRangeFormatElement(endLine, onlyTable);\n      if (util.isTable(startRangeEl) && util.isListCell(startRangeEl.parentNode)) startRangeEl = startRangeEl.parentNode;\n      if (util.isTable(endRangeEl) && util.isListCell(endRangeEl.parentNode)) endRangeEl = endRangeEl.parentNode;\n      const sameRange = startRangeEl === endRangeEl;\n\n      for (let i = 0, len = lineNodes.length, line; i < len; i++) {\n        line = lineNodes[i];\n\n        if (startLine === line || !sameRange && line === startRangeEl) {\n          startIdx = i;\n          continue;\n        }\n\n        if (endLine === line || !sameRange && line === endRangeEl) {\n          endIdx = i;\n          break;\n        }\n      }\n\n      if (startIdx === null) startIdx = 0;\n      if (endIdx === null) endIdx = lineNodes.length - 1;\n      return lineNodes.slice(startIdx, endIdx + 1);\n    },\n\n    /**\r\n     * @description Get format elements and components from the selected area. (P, DIV, H[1-6], OL, UL, TABLE..)\r\n     * If some of the component are included in the selection, get the entire that component.\r\n     * @param {Boolean} removeDuplicate If true, if there is a parent and child tag among the selected elements, the child tag is excluded.\r\n     * @returns {Array}\r\n     */\n    getSelectedElementsAndComponents: function (removeDuplicate) {\n      const commonCon = this.getRange().commonAncestorContainer;\n      const myComponent = util.getParentElement(commonCon, util.isComponent);\n      const selectedLines = util.isTable(commonCon) ? this.getSelectedElements(null) : this.getSelectedElements(function (current) {\n        const component = this.getParentElement(current, this.isComponent);\n        return this.isFormatElement(current) && (!component || component === myComponent) || this.isComponent(current) && !this.getFormatElement(current);\n      }.bind(util));\n\n      if (removeDuplicate) {\n        for (let i = 0, len = selectedLines.length; i < len; i++) {\n          for (let j = i - 1; j >= 0; j--) {\n            if (selectedLines[j].contains(selectedLines[i])) {\n              selectedLines.splice(i, 1);\n              i--;\n              len--;\n              break;\n            }\n          }\n        }\n      }\n\n      return selectedLines;\n    },\n\n    /**\r\n     * @description Determine if this offset is the edge offset of container\r\n     * @param {Node} container The node of the selection object. (range.startContainer..)\r\n     * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n     * @param {String|undefined} dir Select check point - Both edge, Front edge or End edge. (\"front\": Front edge, \"end\": End edge, undefined: Both edge)\r\n     * @returns {Boolean}\r\n     */\n    isEdgePoint: function (container, offset, dir) {\n      return dir !== 'end' && offset === 0 || (!dir || dir !== 'front') && !container.nodeValue && offset === 1 || (!dir || dir === 'end') && !!container.nodeValue && offset === container.nodeValue.length;\n    },\n\n    /**\r\n     * @description Check if the container and offset values are the edges of the format tag\r\n     * @param {Node} container The node of the selection object. (range.startContainer..)\r\n     * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n     * @param {String} dir Select check point - \"front\": Front edge, \"end\": End edge, undefined: Both edge.\r\n     * @returns {Array|null}\r\n     * @private\r\n     */\n    _isEdgeFormat: function (node, offset, dir) {\n      if (!this.isEdgePoint(node, offset, dir)) return false;\n      const result = [];\n      dir = dir === 'front' ? 'previousSibling' : 'nextSibling';\n\n      while (node && !util.isFormatElement(node) && !util.isWysiwygDiv(node)) {\n        if (!node[dir] || util.isBreak(node[dir]) && !node[dir][dir]) {\n          if (node.nodeType === 1) result.push(node.cloneNode(false));\n          node = node.parentNode;\n        } else {\n          return null;\n        }\n      }\n\n      return result;\n    },\n\n    /**\r\n     * @description Show loading box\r\n     */\n    showLoading: function () {\n      context.element.loading.style.display = 'block';\n    },\n\n    /**\r\n     * @description Close loading box\r\n     */\n    closeLoading: function () {\n      context.element.loading.style.display = 'none';\n    },\n\n    /**\r\n     * @description Append format element to sibling node of argument element.\r\n     * If the \"formatNodeName\" argument value is present, the tag of that argument value is inserted,\r\n     * If not, the currently selected format tag is inserted.\r\n     * @param {Element} element Insert as siblings of that element\r\n     * @param {String|Element|null} formatNode Node name or node obejct to be inserted\r\n     * @returns {Element}\r\n     */\n    appendFormatTag: function (element, formatNode) {\n      const currentFormatEl = util.getFormatElement(this.getSelectionNode(), null);\n      const oFormatName = formatNode ? typeof formatNode === 'string' ? formatNode : formatNode.nodeName : util.isFormatElement(currentFormatEl) && !util.isFreeFormatElement(currentFormatEl) ? currentFormatEl.nodeName : options.defaultTag;\n      const oFormat = util.createElement(oFormatName);\n      oFormat.innerHTML = '<br>';\n\n      if (formatNode && typeof formatNode !== 'string' || !formatNode && util.isFormatElement(currentFormatEl)) {\n        util.copyTagAttributes(oFormat, formatNode || currentFormatEl);\n      }\n\n      if (util.isCell(element)) element.insertBefore(oFormat, element.nextElementSibling);else element.parentNode.insertBefore(oFormat, element.nextElementSibling);\n      return oFormat;\n    },\n\n    /**\r\n     * @description The method to insert a element and return. (used elements : table, hr, image, video)\r\n     * If \"element\" is \"HR\", insert and return the new line.\r\n     * @param {Element} element Element to be inserted\r\n     * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @param {Boolean} notSelect If true, Do not automatically select the inserted component.\r\n     * @returns {Element}\r\n     */\n    insertComponent: function (element, notHistoryPush, checkCharCount, notSelect) {\n      if (checkCharCount && !this.checkCharCount(element, null)) {\n        return null;\n      }\n\n      const r = this.removeNode();\n      this.getRange_addLine(this.getRange(), r.container);\n      let oNode = null;\n      let selectionNode = this.getSelectionNode();\n      let formatEl = util.getFormatElement(selectionNode, null);\n\n      if (util.isListCell(formatEl)) {\n        this.insertNode(element, selectionNode === formatEl ? null : r.container.nextSibling, false);\n        if (!element.nextSibling) element.parentNode.appendChild(util.createElement('BR'));\n      } else {\n        if (this.getRange().collapsed && (r.container.nodeType === 3 || util.isBreak(r.container))) {\n          const depthFormat = util.getParentElement(r.container, function (current) {\n            return this.isRangeFormatElement(current);\n          }.bind(util));\n          oNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n          if (oNode) formatEl = oNode.previousSibling;\n        }\n\n        this.insertNode(element, formatEl, false);\n        if (formatEl && util.onlyZeroWidthSpace(formatEl)) util.removeItem(formatEl);\n      }\n\n      this.setRange(element, 0, element, 0);\n\n      if (!notSelect) {\n        const fileComponentInfo = this.getFileComponent(element);\n\n        if (fileComponentInfo) {\n          this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n        } else if (oNode) {\n          oNode = util.getEdgeChildNodes(oNode, null).sc || oNode;\n          this.setRange(oNode, 0, oNode, 0);\n        }\n      } // history stack\n\n\n      if (!notHistoryPush) this.history.push(1);\n      return oNode || element;\n    },\n\n    /**\r\n     * @description Gets the file component and that plugin name\r\n     * return: {target, component, pluginName} | null\r\n     * @param {Element} element Target element (figure tag, component div, file tag)\r\n     * @returns {Object|null}\r\n     */\n    getFileComponent: function (element) {\n      if (!this._fileManager.queryString || !element) return null;\n      let target, pluginName;\n\n      if (/^FIGURE$/i.test(element.nodeName) || /se-component/.test(element.className)) {\n        target = element.querySelector(this._fileManager.queryString);\n      }\n\n      if (!target && element.nodeName && this._fileManager.regExp.test(element.nodeName)) {\n        target = element;\n      }\n\n      if (target) {\n        pluginName = this._fileManager.pluginMap[target.nodeName.toLowerCase()];\n\n        if (pluginName) {\n          return {\n            target: target,\n            component: util.getParentElement(target, util.isComponent),\n            pluginName: pluginName\n          };\n        }\n      }\n\n      return null;\n    },\n\n    /**\r\n     * @description The component(image, video) is selected and the resizing module is called.\r\n     * @param {Element} element Element tag (img, iframe, video)\r\n     * @param {String} pluginName Plugin name (image, video)\r\n     */\n    selectComponent: function (element, pluginName) {\n      if (util.isUneditableComponent(util.getParentElement(element, util.isComponent)) || util.isUneditableComponent(element)) return false;\n      if (!this.hasFocus) this.focus();\n      const plugin = this.plugins[pluginName];\n      if (!plugin) return;\n\n      _w.setTimeout(function () {\n        if (typeof plugin.select === 'function') this.callPlugin(pluginName, plugin.select.bind(this, element), null);\n\n        this._setComponentLineBreaker(element);\n      }.bind(this));\n    },\n\n    /**\r\n     * @description Set line breaker of component\r\n     * @param {Element} element Element tag (img, iframe, video)\r\n     * @private\r\n     */\n    _setComponentLineBreaker: function (element) {\n      // line breaker\n      this._lineBreaker.style.display = 'none';\n      const container = util.getParentElement(element, util.isComponent);\n      const t_style = context.element.lineBreaker_t.style;\n      const b_style = context.element.lineBreaker_b.style;\n      const target = this.context.resizing.resizeContainer.style.display === 'block' ? this.context.resizing.resizeContainer : element;\n      const isList = util.isListCell(container.parentNode);\n      let componentTop, wScroll, w; // top\n\n      if (isList ? !container.previousSibling : !util.isFormatElement(container.previousElementSibling)) {\n        this._variable._lineBreakComp = container;\n        wScroll = context.element.wysiwyg.scrollTop;\n        componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\n        w = target.offsetWidth / 2 / 2;\n        t_style.top = componentTop - wScroll - 12 + 'px';\n        t_style.left = util.getOffset(target).left + w + 'px';\n        t_style.display = 'block';\n      } else {\n        t_style.display = 'none';\n      } // bottom\n\n\n      if (isList ? !container.nextSibling : !util.isFormatElement(container.nextElementSibling)) {\n        if (!componentTop) {\n          this._variable._lineBreakComp = container;\n          wScroll = context.element.wysiwyg.scrollTop;\n          componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\n          w = target.offsetWidth / 2 / 2;\n        }\n\n        b_style.top = componentTop + target.offsetHeight - wScroll - 12 + 'px';\n        b_style.left = util.getOffset(target).left + target.offsetWidth - w - 24 + 'px';\n        b_style.display = 'block';\n      } else {\n        b_style.display = 'none';\n      }\n    },\n\n    /**\r\n     * @description Delete selected node and insert argument value node and return.\r\n     * If the \"afterNode\" exists, it is inserted after the \"afterNode\"\r\n     * Inserting a text node merges with both text nodes on both sides and returns a new \"{ container, startOffset, endOffset }\".\r\n     * @param {Node} oNode Element to be inserted\r\n     * @param {Node|null} afterNode If the node exists, it is inserted after the node\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @returns {Object|Node|null}\r\n     */\n    insertNode: function (oNode, afterNode, checkCharCount) {\n      if (checkCharCount && !this.checkCharCount(oNode, null)) {\n        return null;\n      }\n\n      const freeFormat = util.getFreeFormatElement(this.getSelectionNode(), null);\n      const isFormats = !freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) || util.isComponent(oNode);\n\n      if (!afterNode && (isFormats || util.isComponent(oNode) || util.isMedia(oNode))) {\n        const r = this.removeNode();\n\n        if (r.container.nodeType === 3 || util.isBreak(r.container)) {\n          const depthFormat = util.getParentElement(r.container, function (current) {\n            return this.isRangeFormatElement(current) || this.isListCell(current);\n          }.bind(util));\n          afterNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n          if (afterNode) afterNode = afterNode.previousSibling;\n        }\n      }\n\n      const range = !afterNode && !isFormats ? this.getRange_addLine(this.getRange(), null) : this.getRange();\n      const commonCon = range.commonAncestorContainer;\n      const startOff = range.startOffset;\n      const endOff = range.endOffset;\n      const formatRange = range.startContainer === commonCon && util.isFormatElement(commonCon);\n      const startCon = formatRange ? commonCon.childNodes[startOff] || commonCon.childNodes[0] : range.startContainer;\n      const endCon = formatRange ? commonCon.childNodes[endOff] || commonCon.childNodes[commonCon.childNodes.length - 1] : range.endContainer;\n      let parentNode,\n          originAfter = null;\n\n      if (!afterNode) {\n        parentNode = startCon;\n\n        if (startCon.nodeType === 3) {\n          parentNode = startCon.parentNode;\n        }\n        /** No Select range node */\n\n\n        if (range.collapsed) {\n          if (commonCon.nodeType === 3) {\n            if (commonCon.textContent.length > endOff) afterNode = commonCon.splitText(endOff);else afterNode = commonCon.nextSibling;\n          } else {\n            if (!util.isBreak(parentNode)) {\n              let c = parentNode.childNodes[startOff];\n              const focusNode = c && c.nodeType === 3 && util.onlyZeroWidthSpace(c) && util.isBreak(c.nextSibling) ? c.nextSibling : c;\n\n              if (focusNode) {\n                if (!focusNode.nextSibling) {\n                  parentNode.removeChild(focusNode);\n                  afterNode = null;\n                } else {\n                  afterNode = util.isBreak(focusNode) && !util.isBreak(oNode) ? focusNode : focusNode.nextSibling;\n                }\n              } else {\n                afterNode = null;\n              }\n            } else {\n              afterNode = parentNode;\n              parentNode = parentNode.parentNode;\n            }\n          }\n        } else {\n          /** Select range nodes */\n          const isSameContainer = startCon === endCon;\n\n          if (isSameContainer) {\n            if (this.isEdgePoint(endCon, endOff)) afterNode = endCon.nextSibling;else afterNode = endCon.splitText(endOff);\n            let removeNode = startCon;\n            if (!this.isEdgePoint(startCon, startOff)) removeNode = startCon.splitText(startOff);\n            parentNode.removeChild(removeNode);\n\n            if (parentNode.childNodes.length === 0 && isFormats) {\n              parentNode.innerHTML = '<br>';\n            }\n          } else {\n            const removedTag = this.removeNode();\n            const container = removedTag.container;\n            const prevContainer = removedTag.prevContainer;\n\n            if (container && container.childNodes.length === 0 && isFormats) {\n              if (util.isFormatElement(container)) {\n                container.innerHTML = '<br>';\n              } else if (util.isRangeFormatElement(container)) {\n                container.innerHTML = '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n              }\n            }\n\n            if (!isFormats && prevContainer) {\n              parentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\n\n              if (parentNode.contains(container)) {\n                let sameParent = true;\n                afterNode = container;\n\n                while (afterNode.parentNode !== parentNode) {\n                  afterNode = afterNode.parentNode;\n                  sameParent = false;\n                }\n\n                if (sameParent && container === prevContainer) afterNode = afterNode.nextSibling;\n              } else {\n                afterNode = null;\n              }\n            } else {\n              afterNode = isFormats ? endCon : container === prevContainer ? container.nextSibling : container;\n              parentNode = !afterNode || !afterNode.parentNode ? commonCon : afterNode.parentNode;\n            }\n\n            while (afterNode && !util.isFormatElement(afterNode) && afterNode.parentNode !== commonCon) {\n              afterNode = afterNode.parentNode;\n            }\n          }\n        }\n      } // has afterNode\n      else {\n          parentNode = afterNode.parentNode;\n          afterNode = afterNode.nextSibling;\n          originAfter = true;\n        } // --- insert node ---\n\n\n      try {\n        if (util.isWysiwygDiv(afterNode) || parentNode === context.element.wysiwyg.parentNode) {\n          parentNode = context.element.wysiwyg;\n          afterNode = null;\n        }\n\n        if (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode) || !util.isListCell(parentNode) && util.isComponent(oNode)) {\n          const oldParent = parentNode;\n\n          if (util.isList(afterNode)) {\n            parentNode = afterNode;\n            afterNode = null;\n          } else if (util.isListCell(afterNode)) {\n            parentNode = afterNode.previousElementSibling || afterNode;\n          } else if (!originAfter && !afterNode) {\n            const r = this.removeNode();\n            const container = r.container.nodeType === 3 ? util.isListCell(util.getFormatElement(r.container, null)) ? r.container : util.getFormatElement(r.container, null) || r.container.parentNode : r.container;\n            const rangeCon = util.isWysiwygDiv(container) || util.isRangeFormatElement(container);\n            parentNode = rangeCon ? container : container.parentNode;\n            afterNode = rangeCon ? null : container.nextSibling;\n          }\n\n          if (oldParent.childNodes.length === 0 && parentNode !== oldParent) util.removeItem(oldParent);\n        }\n\n        if (isFormats && !freeFormat && !util.isRangeFormatElement(parentNode) && !util.isListCell(parentNode) && !util.isWysiwygDiv(parentNode)) {\n          afterNode = parentNode.nextElementSibling;\n          parentNode = parentNode.parentNode;\n        }\n\n        if (util.isWysiwygDiv(parentNode) && (oNode.nodeType === 3 || util.isBreak(oNode))) {\n          const fNode = util.createElement(options.defaultTag);\n          fNode.appendChild(oNode);\n          oNode = fNode;\n        }\n\n        parentNode.insertBefore(oNode, parentNode === afterNode ? parentNode.lastChild : afterNode);\n      } catch (e) {\n        parentNode.appendChild(oNode);\n      } finally {\n        if ((util.isFormatElement(oNode) || util.isComponent(oNode)) && startCon === endCon) {\n          const cItem = util.getFormatElement(commonCon, null);\n\n          if (cItem && cItem.nodeType === 1 && util.isEmptyLine(cItem)) {\n            util.removeItem(cItem);\n          }\n        }\n\n        if (freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) {\n          oNode = this._setIntoFreeFormat(oNode);\n        }\n\n        if (!util.isComponent(oNode)) {\n          let offset = 1;\n\n          if (oNode.nodeType === 3) {\n            const previous = oNode.previousSibling;\n            const next = oNode.nextSibling;\n            const previousText = !previous || previous.nodeType === 1 || util.onlyZeroWidthSpace(previous) ? '' : previous.textContent;\n            const nextText = !next || next.nodeType === 1 || util.onlyZeroWidthSpace(next) ? '' : next.textContent;\n\n            if (previous && previousText.length > 0) {\n              oNode.textContent = previousText + oNode.textContent;\n              util.removeItem(previous);\n            }\n\n            if (next && next.length > 0) {\n              oNode.textContent += nextText;\n              util.removeItem(next);\n            }\n\n            const newRange = {\n              container: oNode,\n              startOffset: previousText.length,\n              endOffset: oNode.textContent.length - nextText.length\n            };\n            this.setRange(oNode, newRange.startOffset, oNode, newRange.endOffset);\n            return newRange;\n          } else if (!util.isBreak(oNode) && util.isFormatElement(parentNode)) {\n            let zeroWidth = null;\n\n            if (!oNode.previousSibling || util.isBreak(oNode.previousSibling)) {\n              zeroWidth = util.createTextNode(util.zeroWidthSpace);\n              oNode.parentNode.insertBefore(zeroWidth, oNode);\n            }\n\n            if (!oNode.nextSibling || util.isBreak(oNode.nextSibling)) {\n              zeroWidth = util.createTextNode(util.zeroWidthSpace);\n              oNode.parentNode.insertBefore(zeroWidth, oNode.nextSibling);\n            }\n\n            if (util._isIgnoreNodeChange(oNode)) {\n              oNode = oNode.nextSibling;\n              offset = 0;\n            }\n          }\n\n          this.setRange(oNode, offset, oNode, offset);\n        } // history stack\n\n\n        this.history.push(true);\n        return oNode;\n      }\n    },\n    _setIntoFreeFormat: function (oNode) {\n      const parentNode = oNode.parentNode;\n      let oNodeChildren, lastONode;\n\n      while (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) {\n        oNodeChildren = oNode.childNodes;\n        lastONode = null;\n\n        while (oNodeChildren[0]) {\n          lastONode = oNodeChildren[0];\n\n          if (util.isFormatElement(lastONode) || util.isRangeFormatElement(lastONode)) {\n            this._setIntoFreeFormat(lastONode);\n\n            if (!oNode.parentNode) break;\n            oNodeChildren = oNode.childNodes;\n            continue;\n          }\n\n          parentNode.insertBefore(lastONode, oNode);\n        }\n\n        if (oNode.childNodes.length === 0) util.removeItem(oNode);\n        oNode = util.createElement('BR');\n        parentNode.insertBefore(oNode, lastONode.nextSibling);\n      }\n\n      return oNode;\n    },\n\n    /**\r\n     * @description Delete the currently selected nodes and reset selection range\r\n     * Returns {container: \"the last element after deletion\", offset: \"offset\", prevContainer: \"previousElementSibling Of the deleted area\"}\r\n     * @returns {Object}\r\n     */\n    removeNode: function () {\n      this._resetRangeToTextNode();\n\n      const range = this.getRange();\n      let container,\n          offset = 0;\n      let startCon = range.startContainer;\n      let endCon = range.endContainer;\n      let startOff = range.startOffset;\n      let endOff = range.endOffset;\n      const commonCon = range.commonAncestorContainer.nodeType === 3 && range.commonAncestorContainer.parentNode === startCon.parentNode ? startCon.parentNode : range.commonAncestorContainer;\n\n      if (commonCon === startCon && commonCon === endCon) {\n        startCon = commonCon.children[startOff];\n        endCon = commonCon.children[endOff];\n        startOff = endOff = 0;\n      }\n\n      let beforeNode = null;\n      let afterNode = null;\n      const childNodes = util.getListChildNodes(commonCon, null);\n      let startIndex = util.getArrayIndex(childNodes, startCon);\n      let endIndex = util.getArrayIndex(childNodes, endCon);\n\n      if (childNodes.length > 0 && startIndex > -1 && endIndex > -1) {\n        for (let i = startIndex + 1, startNode = startCon; i >= 0; i--) {\n          if (childNodes[i] === startNode.parentNode && childNodes[i].firstChild === startNode && startOff === 0) {\n            startIndex = i;\n            startNode = startNode.parentNode;\n          }\n        }\n\n        for (let i = endIndex - 1, endNode = endCon; i > startIndex; i--) {\n          if (childNodes[i] === endNode.parentNode && childNodes[i].nodeType === 1) {\n            childNodes.splice(i, 1);\n            endNode = endNode.parentNode;\n            --endIndex;\n          }\n        }\n      } else {\n        if (childNodes.length === 0) {\n          if (util.isFormatElement(commonCon) || util.isRangeFormatElement(commonCon) || util.isWysiwygDiv(commonCon) || util.isBreak(commonCon) || util.isMedia(commonCon)) {\n            return {\n              container: commonCon,\n              offset: 0\n            };\n          } else if (commonCon.nodeType === 3) {\n            return {\n              container: commonCon,\n              offset: endOff\n            };\n          }\n\n          childNodes.push(commonCon);\n          startCon = endCon = commonCon;\n        } else {\n          startCon = endCon = childNodes[0];\n\n          if (util.isBreak(startCon) || util.onlyZeroWidthSpace(startCon)) {\n            return {\n              container: util.isMedia(commonCon) ? commonCon : startCon,\n              offset: 0\n            };\n          }\n        }\n\n        startIndex = endIndex = 0;\n      }\n\n      function remove(item) {\n        const format = util.getFormatElement(item, null);\n        util.removeItem(item);\n\n        if (util.isListCell(format)) {\n          const list = util.getArrayItem(format.children, util.isList, false);\n\n          if (list) {\n            const child = list.firstElementChild;\n            const children = child.childNodes;\n\n            while (children[0]) {\n              format.insertBefore(children[0], list);\n            }\n\n            util.removeItemAllParents(child, null, null);\n          }\n        }\n      }\n\n      for (let i = startIndex; i <= endIndex; i++) {\n        const item = childNodes[i];\n\n        if (item.length === 0 || item.nodeType === 3 && item.data === undefined) {\n          remove(item);\n          continue;\n        }\n\n        if (item === startCon) {\n          if (startCon.nodeType === 1) {\n            if (util.isComponent(startCon)) continue;else beforeNode = util.createTextNode(startCon.textContent);\n          } else {\n            if (item === endCon) {\n              beforeNode = util.createTextNode(startCon.substringData(0, startOff) + endCon.substringData(endOff, endCon.length - endOff));\n              offset = startOff;\n            } else {\n              beforeNode = util.createTextNode(startCon.substringData(0, startOff));\n            }\n          }\n\n          if (beforeNode.length > 0) {\n            startCon.data = beforeNode.data;\n          } else {\n            remove(startCon);\n          }\n\n          if (item === endCon) break;\n          continue;\n        }\n\n        if (item === endCon) {\n          if (endCon.nodeType === 1) {\n            if (util.isComponent(endCon)) continue;else afterNode = util.createTextNode(endCon.textContent);\n          } else {\n            afterNode = util.createTextNode(endCon.substringData(endOff, endCon.length - endOff));\n          }\n\n          if (afterNode.length > 0) {\n            endCon.data = afterNode.data;\n          } else {\n            remove(endCon);\n          }\n\n          continue;\n        }\n\n        remove(item);\n      }\n\n      container = endCon && endCon.parentNode ? endCon : startCon && startCon.parentNode ? startCon : range.endContainer || range.startContainer;\n\n      if (!util.isWysiwygDiv(container) && container.childNodes.length === 0) {\n        const rc = util.removeItemAllParents(container, function (current) {\n          if (this.isComponent(current)) return false;\n          const text = current.textContent;\n          return text.length === 0 || /^(\\n|\\u200B)+$/.test(text);\n        }.bind(util), null);\n        if (rc) container = rc.sc || rc.ec || context.element.wysiwyg;\n      } // set range\n\n\n      this.setRange(container, offset, container, offset); // history stack\n\n      this.history.push(true);\n      return {\n        container: container,\n        offset: offset,\n        prevContainer: startCon && startCon.parentNode ? startCon : null\n      };\n    },\n\n    /**\r\n     * @description Appended all selected format Element to the argument element and insert\r\n     * @param {Element} rangeElement Element of wrap the arguments (BLOCKQUOTE...)\r\n     */\n    applyRangeFormatElement: function (rangeElement) {\n      this.getRange_addLine(this.getRange(), null);\n      const rangeLines = this.getSelectedElementsAndComponents(false);\n      if (!rangeLines || rangeLines.length === 0) return;\n\n      linesLoop: for (let i = 0, len = rangeLines.length, line, nested, fEl, lEl, f, l; i < len; i++) {\n        line = rangeLines[i];\n        if (!util.isListCell(line)) continue;\n        nested = line.lastElementChild;\n\n        if (nested && util.isListCell(line.nextElementSibling) && rangeLines.indexOf(line.nextElementSibling) > -1) {\n          lEl = nested.lastElementChild;\n\n          if (rangeLines.indexOf(lEl) > -1) {\n            let list = null;\n\n            while (list = lEl.lastElementChild) {\n              if (util.isList(list)) {\n                if (rangeLines.indexOf(list.lastElementChild) > -1) {\n                  lEl = list.lastElementChild;\n                } else {\n                  continue linesLoop;\n                }\n              }\n            }\n\n            fEl = nested.firstElementChild;\n            f = rangeLines.indexOf(fEl);\n            l = rangeLines.indexOf(lEl);\n            rangeLines.splice(f, l - f + 1);\n            len = rangeLines.length;\n            continue;\n          }\n        }\n      }\n\n      let last = rangeLines[rangeLines.length - 1];\n      let standTag, beforeTag, pElement;\n\n      if (util.isRangeFormatElement(last) || util.isFormatElement(last)) {\n        standTag = last;\n      } else {\n        standTag = util.getRangeFormatElement(last, null) || util.getFormatElement(last, null);\n      }\n\n      if (util.isCell(standTag)) {\n        beforeTag = null;\n        pElement = standTag;\n      } else {\n        beforeTag = standTag.nextSibling;\n        pElement = standTag.parentNode;\n      }\n\n      let parentDepth = util.getElementDepth(standTag);\n      let listParent = null;\n      const lineArr = [];\n\n      const removeItems = function (parent, origin, before) {\n        let cc = null;\n\n        if (parent !== origin && !util.isTable(origin)) {\n          if (origin && util.getElementDepth(parent) === util.getElementDepth(origin)) return before;\n          cc = util.removeItemAllParents(origin, null, parent);\n        }\n\n        return cc ? cc.ec : before;\n      };\n\n      for (let i = 0, len = rangeLines.length, line, originParent, depth, before, nextLine, nextList, nested; i < len; i++) {\n        line = rangeLines[i];\n        originParent = line.parentNode;\n        if (!originParent || rangeElement.contains(originParent)) continue;\n        depth = util.getElementDepth(line);\n\n        if (util.isList(originParent)) {\n          if (listParent === null) {\n            if (nextList) {\n              listParent = nextList;\n              nested = true;\n              nextList = null;\n            } else {\n              listParent = originParent.cloneNode(false);\n            }\n          }\n\n          lineArr.push(line);\n          nextLine = rangeLines[i + 1];\n\n          if (i === len - 1 || nextLine && nextLine.parentNode !== originParent) {\n            // nested list\n            if (nextLine && line.contains(nextLine.parentNode)) {\n              nextList = nextLine.parentNode.cloneNode(false);\n            }\n\n            let list = originParent.parentNode,\n                p;\n\n            while (util.isList(list)) {\n              p = util.createElement(list.nodeName);\n              p.appendChild(listParent);\n              listParent = p;\n              list = list.parentNode;\n            }\n\n            const edge = this.detachRangeFormatElement(originParent, lineArr, null, true, true);\n\n            if (parentDepth >= depth) {\n              parentDepth = depth;\n              pElement = edge.cc;\n              beforeTag = removeItems(pElement, originParent, edge.ec);\n              if (beforeTag) pElement = beforeTag.parentNode;\n            } else if (pElement === edge.cc) {\n              beforeTag = edge.ec;\n            }\n\n            if (pElement !== edge.cc) {\n              before = removeItems(pElement, edge.cc, before);\n              if (before !== undefined) beforeTag = before;else beforeTag = edge.cc;\n            }\n\n            for (let c = 0, cLen = edge.removeArray.length; c < cLen; c++) {\n              listParent.appendChild(edge.removeArray[c]);\n            }\n\n            if (!nested) rangeElement.appendChild(listParent);\n            if (nextList) edge.removeArray[edge.removeArray.length - 1].appendChild(nextList);\n            listParent = null;\n            nested = false;\n          }\n        } else {\n          if (parentDepth >= depth) {\n            parentDepth = depth;\n            pElement = originParent;\n            beforeTag = line.nextSibling;\n          }\n\n          rangeElement.appendChild(line);\n\n          if (pElement !== originParent) {\n            before = removeItems(pElement, originParent);\n            if (before !== undefined) beforeTag = before;\n          }\n        }\n      }\n\n      this.effectNode = null;\n      util.mergeSameTags(rangeElement, null, false);\n      util.mergeNestedTags(rangeElement, function (current) {\n        return this.isList(current);\n      }.bind(util)); // Nested list\n\n      if (beforeTag && util.getElementDepth(beforeTag) > 0 && (util.isList(beforeTag.parentNode) || util.isList(beforeTag.parentNode.parentNode))) {\n        const depthFormat = util.getParentElement(beforeTag, function (current) {\n          return this.isRangeFormatElement(current) && !this.isList(current);\n        }.bind(util));\n        const splitRange = util.splitElement(beforeTag, null, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n        splitRange.parentNode.insertBefore(rangeElement, splitRange);\n      } else {\n        // basic\n        pElement.insertBefore(rangeElement, beforeTag);\n        removeItems(rangeElement, beforeTag);\n      }\n\n      const edge = util.getEdgeChildNodes(rangeElement.firstElementChild, rangeElement.lastElementChild);\n\n      if (rangeLines.length > 1) {\n        this.setRange(edge.sc, 0, edge.ec, edge.ec.textContent.length);\n      } else {\n        this.setRange(edge.ec, edge.ec.textContent.length, edge.ec, edge.ec.textContent.length);\n      } // history stack\n\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description The elements of the \"selectedFormats\" array are detached from the \"rangeElement\" element. (\"LI\" tags are converted to \"P\" tags)\r\n     * When \"selectedFormats\" is null, all elements are detached and return {cc: parentNode, sc: nextSibling, ec: previousSibling, removeArray: [Array of removed elements]}.\r\n     * @param {Element} rangeElement Range format element (PRE, BLOCKQUOTE, OL, UL...)\r\n     * @param {Array|null} selectedFormats Array of format elements (P, DIV, LI...) to remove.\r\n     * If null, Applies to all elements and return {cc: parentNode, sc: nextSibling, ec: previousSibling}\r\n     * @param {Element|null} newRangeElement The node(rangeElement) to replace the currently wrapped node.\r\n     * @param {Boolean} remove If true, deleted without detached.\r\n     * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n     * @returns {Object}\r\n     */\n    detachRangeFormatElement: function (rangeElement, selectedFormats, newRangeElement, remove, notHistoryPush) {\n      const range = this.getRange();\n      const so = range.startOffset;\n      const eo = range.endOffset;\n      let children = util.getListChildNodes(rangeElement, function (current) {\n        return current.parentNode === rangeElement;\n      });\n      let parent = rangeElement.parentNode;\n      let firstNode = null;\n      let lastNode = null;\n      let rangeEl = rangeElement.cloneNode(false);\n      const removeArray = [];\n      const newList = util.isList(newRangeElement);\n      let insertedNew = false;\n      let reset = false;\n      let moveComplete = false;\n\n      function appendNode(parent, insNode, sibling, originNode) {\n        if (util.onlyZeroWidthSpace(insNode)) insNode.innerHTML = util.zeroWidthSpace;\n\n        if (insNode.nodeType === 3) {\n          parent.insertBefore(insNode, sibling);\n          return insNode;\n        }\n\n        const insChildren = (moveComplete ? insNode : originNode).childNodes;\n        let format = insNode.cloneNode(false);\n        let first = null;\n        let c = null;\n\n        while (insChildren[0]) {\n          c = insChildren[0];\n\n          if (util._notTextNode(c) && !util.isBreak(c) && !util.isListCell(format)) {\n            if (format.childNodes.length > 0) {\n              if (!first) first = format;\n              parent.insertBefore(format, sibling);\n              format = insNode.cloneNode(false);\n            }\n\n            parent.insertBefore(c, sibling);\n            if (!first) first = c;\n          } else {\n            format.appendChild(c);\n          }\n        }\n\n        if (format.childNodes.length > 0) {\n          if (util.isListCell(parent) && util.isListCell(format) && util.isList(sibling)) {\n            if (newList) {\n              first = sibling;\n\n              while (sibling) {\n                format.appendChild(sibling);\n                sibling = sibling.nextSibling;\n              }\n\n              parent.parentNode.insertBefore(format, parent.nextElementSibling);\n            } else {\n              const originNext = originNode.nextElementSibling;\n              const detachRange = util.detachNestedList(originNode, false);\n\n              if (rangeElement !== detachRange || originNext !== originNode.nextElementSibling) {\n                const fChildren = format.childNodes;\n\n                while (fChildren[0]) {\n                  originNode.appendChild(fChildren[0]);\n                }\n\n                rangeElement = detachRange;\n                reset = true;\n              }\n            }\n          } else {\n            parent.insertBefore(format, sibling);\n          }\n\n          if (!first) first = format;\n        }\n\n        return first;\n      } // detach loop\n\n\n      for (let i = 0, len = children.length, insNode, lineIndex, next; i < len; i++) {\n        insNode = children[i];\n        if (insNode.nodeType === 3 && util.isList(rangeEl)) continue;\n        moveComplete = false;\n\n        if (remove && i === 0) {\n          if (!selectedFormats || selectedFormats.length === len || selectedFormats[0] === insNode) {\n            firstNode = rangeElement.previousSibling;\n          } else {\n            firstNode = rangeEl;\n          }\n        }\n\n        if (selectedFormats) lineIndex = selectedFormats.indexOf(insNode);\n\n        if (selectedFormats && lineIndex === -1) {\n          if (!rangeEl) rangeEl = rangeElement.cloneNode(false);\n          rangeEl.appendChild(insNode);\n        } else {\n          if (selectedFormats) next = selectedFormats[lineIndex + 1];\n\n          if (rangeEl && rangeEl.children.length > 0) {\n            parent.insertBefore(rangeEl, rangeElement);\n            rangeEl = null;\n          }\n\n          if (!newList && util.isListCell(insNode)) {\n            if (next && util.getElementDepth(insNode) !== util.getElementDepth(next) && (util.isListCell(parent) || util.getArrayItem(insNode.children, util.isList, false))) {\n              const insNext = insNode.nextElementSibling;\n              const detachRange = util.detachNestedList(insNode, false);\n\n              if (rangeElement !== detachRange || insNext !== insNode.nextElementSibling) {\n                rangeElement = detachRange;\n                reset = true;\n              }\n            } else {\n              const inner = insNode;\n              insNode = util.createElement(remove ? inner.nodeName : util.isList(rangeElement.parentNode) || util.isListCell(rangeElement.parentNode) ? 'LI' : util.isCell(rangeElement.parentNode) ? 'DIV' : options.defaultTag);\n              const isCell = util.isListCell(insNode);\n              const innerChildren = inner.childNodes;\n\n              while (innerChildren[0]) {\n                if (util.isList(innerChildren[0]) && !isCell) break;\n                insNode.appendChild(innerChildren[0]);\n              }\n\n              util.copyFormatAttributes(insNode, inner);\n              moveComplete = true;\n            }\n          } else {\n            insNode = insNode.cloneNode(false);\n          }\n\n          if (!reset) {\n            if (!remove) {\n              if (newRangeElement) {\n                if (!insertedNew) {\n                  parent.insertBefore(newRangeElement, rangeElement);\n                  insertedNew = true;\n                }\n\n                insNode = appendNode(newRangeElement, insNode, null, children[i]);\n              } else {\n                insNode = appendNode(parent, insNode, rangeElement, children[i]);\n              }\n\n              if (!reset) {\n                if (selectedFormats) {\n                  lastNode = insNode;\n\n                  if (!firstNode) {\n                    firstNode = insNode;\n                  }\n                } else if (!firstNode) {\n                  firstNode = lastNode = insNode;\n                }\n              }\n            } else {\n              removeArray.push(insNode);\n              util.removeItem(children[i]);\n            }\n\n            if (reset) {\n              reset = moveComplete = false;\n              children = util.getListChildNodes(rangeElement, function (current) {\n                return current.parentNode === rangeElement;\n              });\n              rangeEl = rangeElement.cloneNode(false);\n              parent = rangeElement.parentNode;\n              i = -1;\n              len = children.length;\n              continue;\n            }\n          }\n        }\n      }\n\n      const rangeParent = rangeElement.parentNode;\n      let rangeRight = rangeElement.nextSibling;\n\n      if (rangeEl && rangeEl.children.length > 0) {\n        rangeParent.insertBefore(rangeEl, rangeRight);\n      }\n\n      if (newRangeElement) firstNode = newRangeElement.previousSibling;else if (!firstNode) firstNode = rangeElement.previousSibling;\n      rangeRight = rangeElement.nextSibling;\n\n      if (rangeElement.children.length === 0 || rangeElement.textContent.length === 0) {\n        util.removeItem(rangeElement);\n      } else {\n        util.removeEmptyNode(rangeElement, null);\n      }\n\n      let edge = null;\n\n      if (remove) {\n        edge = {\n          cc: rangeParent,\n          sc: firstNode,\n          ec: rangeRight,\n          removeArray: removeArray\n        };\n      } else {\n        if (!firstNode) firstNode = lastNode;\n        if (!lastNode) lastNode = firstNode;\n        const childEdge = util.getEdgeChildNodes(firstNode, lastNode.parentNode ? firstNode : lastNode);\n        edge = {\n          cc: (childEdge.sc || childEdge.ec).parentNode,\n          sc: childEdge.sc,\n          ec: childEdge.ec\n        };\n      }\n\n      this.effectNode = null;\n      if (notHistoryPush) return edge;\n\n      if (!remove && edge) {\n        if (!selectedFormats) {\n          this.setRange(edge.sc, 0, edge.sc, 0);\n        } else {\n          this.setRange(edge.sc, so, edge.ec, eo);\n        }\n      } // history stack\n\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description \"selectedFormats\" array are detached from the list element.\r\n     * The return value is applied when the first and last lines of \"selectedFormats\" are \"LI\" respectively.\r\n     * @param {Array} selectedFormats Array of format elements (LI, P...) to remove.\r\n     * @param {Boolean} remove If true, deleted without detached.\r\n     * @returns {Object} {sc: <LI>, ec: <LI>}.\r\n     */\n    detachList: function (selectedFormats, remove) {\n      let rangeArr = {};\n      let listFirst = false;\n      let listLast = false;\n      let first = null;\n      let last = null;\n\n      const passComponent = function (current) {\n        return !this.isComponent(current);\n      }.bind(util);\n\n      for (let i = 0, len = selectedFormats.length, r, o, lastIndex, isList; i < len; i++) {\n        lastIndex = i === len - 1;\n        o = util.getRangeFormatElement(selectedFormats[i], passComponent);\n        isList = util.isList(o);\n\n        if (!r && isList) {\n          r = o;\n          rangeArr = {\n            r: r,\n            f: [util.getParentElement(selectedFormats[i], 'LI')]\n          };\n          if (i === 0) listFirst = true;\n        } else if (r && isList) {\n          if (r !== o) {\n            const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\n            o = selectedFormats[i].parentNode;\n\n            if (listFirst) {\n              first = edge.sc;\n              listFirst = false;\n            }\n\n            if (lastIndex) last = edge.ec;\n\n            if (isList) {\n              r = o;\n              rangeArr = {\n                r: r,\n                f: [util.getParentElement(selectedFormats[i], 'LI')]\n              };\n              if (lastIndex) listLast = true;\n            } else {\n              r = null;\n            }\n          } else {\n            rangeArr.f.push(util.getParentElement(selectedFormats[i], 'LI'));\n            if (lastIndex) listLast = true;\n          }\n        }\n\n        if (lastIndex && util.isList(r)) {\n          const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\n          if (listLast || len === 1) last = edge.ec;\n          if (listFirst) first = edge.sc || last;\n        }\n      }\n\n      return {\n        sc: first,\n        ec: last\n      };\n    },\n\n    /**\r\n     * @description Add, update, and delete nodes from selected text.\r\n     * 1. If there is a node in the \"appendNode\" argument, a node with the same tags and attributes as \"appendNode\" is added to the selection text.\r\n     * 2. If it is in the same tag, only the tag's attributes are changed without adding a tag.\r\n     * 3. If the \"appendNode\" argument is null, the node of the selection is update or remove without adding a new node.\r\n     * 4. The same style as the style attribute of the \"styleArray\" argument is deleted.\r\n     *    (Styles should be put with attribute names from css. [\"background-color\"])\r\n     * 5. The same class name as the class attribute of the \"styleArray\" argument is deleted.\r\n     *    (The class name is preceded by \".\" [\".className\"])\r\n     * 6. Use a list of styles and classes of \"appendNode\" in \"styleArray\" to avoid duplicate property values.\r\n     * 7. If a node with all styles and classes removed has the same tag name as \"appendNode\" or \"removeNodeArray\", or \"appendNode\" is null, that node is deleted.\r\n     * 8. Regardless of the style and class of the node, the tag with the same name as the \"removeNodeArray\" argument value is deleted.\r\n     * 9. If the \"strictRemove\" argument is true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n     *10. It won't work if the parent node has the same class and same value style.\r\n     *    However, if there is a value in \"removeNodeArray\", it works and the text node is separated even if there is no node to replace.\r\n     * @param {Element|null} appendNode The element to be added to the selection. If it is null, only delete the node.\r\n     * @param {Array|null} styleArray The style or className attribute name Array to check (['font-size'], ['.className'], ['font-family', 'color', '.className']...])\r\n     * @param {Array|null} removeNodeArray An array of node names to remove types from, remove all formats when \"appendNode\" is null and there is an empty array or null value. (['span'], ['strong', 'em'] ...])\r\n     * @param {Boolean|null} strictRemove If true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n     */\n    nodeChange: function (appendNode, styleArray, removeNodeArray, strictRemove) {\n      this._resetRangeToTextNode();\n\n      let range = this.getRange_addLine(this.getRange(), null);\n      styleArray = styleArray && styleArray.length > 0 ? styleArray : false;\n      removeNodeArray = removeNodeArray && removeNodeArray.length > 0 ? removeNodeArray : false;\n      const isRemoveNode = !appendNode;\n      const isRemoveFormat = isRemoveNode && !removeNodeArray && !styleArray;\n      let startCon = range.startContainer;\n      let startOff = range.startOffset;\n      let endCon = range.endContainer;\n      let endOff = range.endOffset;\n\n      if (isRemoveFormat && range.collapsed && util.isFormatElement(startCon.parentNode) && util.isFormatElement(endCon.parentNode) || startCon === endCon && startCon.nodeType === 1 && util.isNonEditable(startCon)) {\n        return;\n      }\n\n      if (range.collapsed && !isRemoveFormat) {\n        if (startCon.nodeType === 1 && !util.isBreak(startCon) && !util.isComponent(startCon)) {\n          let afterNode = null;\n          const focusNode = startCon.childNodes[startOff];\n\n          if (focusNode) {\n            if (!focusNode.nextSibling) {\n              afterNode = null;\n            } else {\n              afterNode = util.isBreak(focusNode) ? focusNode : focusNode.nextSibling;\n            }\n          }\n\n          const zeroWidth = util.createTextNode(util.zeroWidthSpace);\n          startCon.insertBefore(zeroWidth, afterNode);\n          this.setRange(zeroWidth, 1, zeroWidth, 1);\n          range = this.getRange();\n          startCon = range.startContainer;\n          startOff = range.startOffset;\n          endCon = range.endContainer;\n          endOff = range.endOffset;\n        }\n      }\n\n      if (util.isFormatElement(startCon)) {\n        startCon = startCon.childNodes[startOff] || startCon.firstChild;\n        startOff = 0;\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.lastChild;\n        endOff = endCon.textContent.length;\n      }\n\n      if (isRemoveNode) {\n        appendNode = util.createElement('DIV');\n      }\n\n      const wRegExp = _w.RegExp;\n      const newNodeName = appendNode.nodeName;\n      /* checked same style property */\n\n      if (!isRemoveFormat && startCon === endCon && !removeNodeArray && appendNode) {\n        let sNode = startCon;\n        let checkCnt = 0;\n        const checkAttrs = [];\n        const checkStyles = appendNode.style;\n\n        for (let i = 0, len = checkStyles.length; i < len; i++) {\n          checkAttrs.push(checkStyles[i]);\n        }\n\n        const ckeckClasses = appendNode.classList;\n\n        for (let i = 0, len = ckeckClasses.length; i < len; i++) {\n          checkAttrs.push('.' + ckeckClasses[i]);\n        }\n\n        if (checkAttrs.length > 0) {\n          while (!util.isFormatElement(sNode) && !util.isWysiwygDiv(sNode)) {\n            for (let i = 0; i < checkAttrs.length; i++) {\n              if (sNode.nodeType === 1) {\n                const s = checkAttrs[i];\n                const classReg = /^\\./.test(s) ? new wRegExp('\\\\s*' + s.replace(/^\\./, '') + '(\\\\s+|$)', 'ig') : false;\n                const styleCheck = isRemoveNode ? !!sNode.style[s] : !!sNode.style[s] && !!appendNode.style[s] && sNode.style[s] === appendNode.style[s];\n                const classCheck = classReg === false ? false : isRemoveNode ? !!sNode.className.match(classReg) : !!sNode.className.match(classReg) && !!appendNode.className.match(classReg);\n\n                if (styleCheck || classCheck) {\n                  checkCnt++;\n                }\n              }\n            }\n\n            sNode = sNode.parentNode;\n          }\n\n          if (checkCnt >= checkAttrs.length) return;\n        }\n      }\n\n      let start = {},\n          end = {};\n      let newNode,\n          styleRegExp = '',\n          classRegExp = '',\n          removeNodeRegExp = '';\n\n      if (styleArray) {\n        for (let i = 0, len = styleArray.length, s; i < len; i++) {\n          s = styleArray[i];\n\n          if (/^\\./.test(s)) {\n            classRegExp += (classRegExp ? '|' : '\\\\s*(?:') + s.replace(/^\\./, '');\n          } else {\n            styleRegExp += (styleRegExp ? '|' : '(?:;|^|\\\\s)(?:') + s;\n          }\n        }\n\n        if (styleRegExp) {\n          styleRegExp += ')\\\\s*:[^;]*\\\\s*(?:;|$)';\n          styleRegExp = new wRegExp(styleRegExp, 'ig');\n        }\n\n        if (classRegExp) {\n          classRegExp += ')(?=\\\\s+|$)';\n          classRegExp = new wRegExp(classRegExp, 'ig');\n        }\n      }\n\n      if (removeNodeArray) {\n        removeNodeRegExp = '^(?:' + removeNodeArray[0];\n\n        for (let i = 1; i < removeNodeArray.length; i++) {\n          removeNodeRegExp += '|' + removeNodeArray[i];\n        }\n\n        removeNodeRegExp += ')$';\n        removeNodeRegExp = new wRegExp(removeNodeRegExp, 'i');\n      }\n      /** validation check function*/\n\n\n      const wBoolean = _w.Boolean;\n      const _removeCheck = {\n        v: false\n      };\n\n      const validation = function (checkNode) {\n        const vNode = checkNode.cloneNode(false); // all path\n\n        if (vNode.nodeType === 3 || util.isBreak(vNode)) return vNode; // all remove\n\n        if (isRemoveFormat) return null; // remove node check\n\n        const tagRemove = !removeNodeRegExp && isRemoveNode || removeNodeRegExp && removeNodeRegExp.test(vNode.nodeName); // tag remove\n\n        if (tagRemove && !strictRemove) {\n          _removeCheck.v = true;\n          return null;\n        } // style regexp\n\n\n        const originStyle = vNode.style.cssText;\n        let style = '';\n\n        if (styleRegExp && originStyle.length > 0) {\n          style = originStyle.replace(styleRegExp, '').trim();\n          if (style !== originStyle) _removeCheck.v = true;\n        } // class check\n\n\n        const originClasses = vNode.className;\n        let classes = '';\n\n        if (classRegExp && originClasses.length > 0) {\n          classes = originClasses.replace(classRegExp, '').trim();\n          if (classes !== originClasses) _removeCheck.v = true;\n        } // remove only\n\n\n        if (isRemoveNode) {\n          if ((classRegExp || !originClasses) && (styleRegExp || !originStyle) && !style && !classes && tagRemove) {\n            _removeCheck.v = true;\n            return null;\n          }\n        } // change\n\n\n        if (style || classes || vNode.nodeName !== newNodeName || wBoolean(styleRegExp) !== wBoolean(originStyle) || wBoolean(classRegExp) !== wBoolean(originClasses)) {\n          if (styleRegExp && originStyle.length > 0) vNode.style.cssText = style;\n\n          if (!vNode.style.cssText) {\n            vNode.removeAttribute('style');\n          }\n\n          if (classRegExp && originClasses.length > 0) vNode.className = classes.trim();\n\n          if (!vNode.className.trim()) {\n            vNode.removeAttribute('class');\n          }\n\n          if (!vNode.style.cssText && !vNode.className && (vNode.nodeName === newNodeName || tagRemove)) {\n            _removeCheck.v = true;\n            return null;\n          }\n\n          return vNode;\n        }\n\n        _removeCheck.v = true;\n        return null;\n      }; // get line nodes\n\n\n      const lineNodes = this.getSelectedElements(null);\n      range = this.getRange();\n      startCon = range.startContainer;\n      startOff = range.startOffset;\n      endCon = range.endContainer;\n      endOff = range.endOffset;\n\n      if (!util.getFormatElement(startCon, null)) {\n        startCon = util.getChildElement(lineNodes[0], function (current) {\n          return current.nodeType === 3;\n        }, false);\n        startOff = 0;\n      }\n\n      if (!util.getFormatElement(endCon, null)) {\n        endCon = util.getChildElement(lineNodes[lineNodes.length - 1], function (current) {\n          return current.nodeType === 3;\n        }, false);\n        endOff = endCon.textContent.length;\n      }\n\n      const oneLine = util.getFormatElement(startCon, null) === util.getFormatElement(endCon, null);\n      const endLength = lineNodes.length - (oneLine ? 0 : 1); // node Changes\n\n      newNode = appendNode.cloneNode(false);\n\n      const isRemoveAnchor = isRemoveFormat || isRemoveNode && function (arr) {\n        for (let n = 0, len = arr.length; n < len; n++) {\n          if (util._isMaintainedNode(arr[n]) || util._isSizeNode(arr[n])) return true;\n        }\n\n        return false;\n      }(removeNodeArray);\n\n      const isSizeNode = isRemoveNode || util._isSizeNode(newNode);\n\n      const _getMaintainedNode = this._util_getMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\n\n      const _isMaintainedNode = this._util_isMaintainedNode.bind(util, isRemoveAnchor, isSizeNode); // one line\n\n\n      if (oneLine) {\n        const newRange = this._nodeChange_oneLine(lineNodes[0], newNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, range.collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode);\n\n        start.container = newRange.startContainer;\n        start.offset = newRange.startOffset;\n        end.container = newRange.endContainer;\n        end.offset = newRange.endOffset;\n\n        if (start.container === end.container && util.onlyZeroWidthSpace(start.container)) {\n          start.offset = end.offset = 1;\n        }\n\n        this._setCommonListStyle(newRange.ancestor, null);\n      } else {\n        // multi line \n        // end\n        if (endLength > 0) {\n          newNode = appendNode.cloneNode(false);\n          end = this._nodeChange_endLine(lineNodes[endLength], newNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode);\n        } // mid\n\n\n        for (let i = endLength - 1, newRange; i > 0; i--) {\n          newNode = appendNode.cloneNode(false);\n          newRange = this._nodeChange_middleLine(lineNodes[i], newNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, end.container);\n\n          if (newRange.endContainer) {\n            end.ancestor = null;\n            end.container = newRange.endContainer;\n          }\n\n          this._setCommonListStyle(newRange.ancestor, null);\n        } // start\n\n\n        newNode = appendNode.cloneNode(false);\n        start = this._nodeChange_startLine(lineNodes[0], newNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, end.container);\n\n        if (start.endContainer) {\n          end.ancestor = null;\n          end.container = start.endContainer;\n        }\n\n        if (endLength <= 0) {\n          end = start;\n        } else if (!end.container) {\n          end.ancestor = null;\n          end.container = start.container;\n          end.offset = start.container.textContent.length;\n        }\n\n        this._setCommonListStyle(start.ancestor, null);\n\n        this._setCommonListStyle(end.ancestor || util.getFormatElement(end.container), null);\n      } // set range\n\n\n      this.controllersOff();\n      this.setRange(start.container, start.offset, end.container, end.offset); // history stack\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description If certain styles are applied to all child nodes of the list cell, the style of the list cell is also changed. (bold, color, size)\r\n     * @param {Element} el List cell element. <li>\r\n     * @param {Element|null} child Variable for recursive call. (\"null\" on the first call)\r\n     * @private\r\n     */\n    _setCommonListStyle: function (el, child) {\n      if (!util.isListCell(el)) return;\n      if (!child) el.removeAttribute('style');\n      const children = util.getArrayItem((child || el).childNodes, function (current) {\n        return !util.isBreak(current) && !util.onlyZeroWidthSpace(current.textContent.trim());\n      }, true);\n\n      if (children[0] && children.length === 1) {\n        child = children[0];\n        if (!child || child.nodeType !== 1) return;\n        const childStyle = child.style;\n        const elStyle = el.style; // bold\n\n        if (/STRONG/i.test(child.nodeName)) elStyle.fontWeight = 'bold'; // bold\n        else if (childStyle.fontWeight) elStyle.fontWeight = childStyle.fontWeight; // styles\n\n        if (childStyle.color) elStyle.color = childStyle.color; // color\n\n        if (childStyle.fontSize) elStyle.fontSize = childStyle.fontSize; // size\n\n        this._setCommonListStyle(el, child);\n      }\n    },\n\n    /**\r\n     * @description Strip remove node\r\n     * @param {Node} removeNode The remove node\r\n     * @private\r\n     */\n    _stripRemoveNode: function (removeNode) {\n      const element = removeNode.parentNode;\n      if (!removeNode || removeNode.nodeType === 3 || !element) return;\n      const children = removeNode.childNodes;\n\n      while (children[0]) {\n        element.insertBefore(children[0], removeNode);\n      }\n\n      element.removeChild(removeNode);\n    },\n\n    /**\r\n     * @description Return the parent maintained tag. (bind and use a util object)\r\n     * @param {Element} element Element\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _util_getMaintainedNode: function (_isRemove, _isSizeNode, element) {\n      if (!element || _isRemove) return null;\n      return this.getParentElement(element, this._isMaintainedNode.bind(this)) || (!_isSizeNode ? this.getParentElement(element, this._isSizeNode.bind(this)) : null);\n    },\n\n    /**\r\n     * @description Check if element is a tag that should be persisted. (bind and use a util object)\r\n     * @param {Element} element Element\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _util_isMaintainedNode: function (_isRemove, _isSizeNode, element) {\n      if (!element || _isRemove || element.nodeType !== 1) return false;\n\n      const anchor = this._isMaintainedNode(element);\n\n      return this.getParentElement(element, this._isMaintainedNode.bind(this)) ? anchor : anchor || (!_isSizeNode ? this._isSizeNode(element) : false);\n    },\n\n    /**\r\n     * @description wraps text nodes of line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @param {Boolean} collapsed range.collapsed\r\n     * @returns {{ancestor: *, startContainer: *, startOffset: *, endContainer: *, endOffset: *}}\r\n     * @private\r\n     */\n    _nodeChange_oneLine: function (element, newInnerNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\n      // not add tag\n      let parentCon = startCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon === endCon.parentNode && parentCon.nodeName === newInnerNode.nodeName) {\n        if (util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff)) && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\n          const children = parentCon.childNodes;\n          let sameTag = true;\n\n          for (let i = 0, len = children.length, c, s, e, z; i < len; i++) {\n            c = children[i];\n            z = !util.onlyZeroWidthSpace(c);\n\n            if (c === startCon) {\n              s = true;\n              continue;\n            }\n\n            if (c === endCon) {\n              e = true;\n              continue;\n            }\n\n            if (!s && z || s && e && z) {\n              sameTag = false;\n              break;\n            }\n          }\n\n          if (sameTag) {\n            util.copyTagAttributes(parentCon, newInnerNode);\n            return {\n              startContainer: startCon,\n              startOffset: startOff,\n              endContainer: endCon,\n              endOffset: endOff\n            };\n          }\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      const el = element;\n      const nNodeArray = [newInnerNode];\n      const pNode = element.cloneNode(false);\n      const isSameNode = startCon === endCon;\n      let startContainer = startCon;\n      let startOffset = startOff;\n      let endContainer = endCon;\n      let endOffset = endOff;\n      let startPass = false;\n      let endPass = false;\n      let pCurrent, newNode, appendNode, cssText, anchorNode;\n      const wRegExp = _w.RegExp;\n\n      function checkCss(vNode) {\n        const regExp = new wRegExp('(?:;|^|\\\\s)(?:' + cssText + 'null)\\\\s*:[^;]*\\\\s*(?:;|$)', 'ig');\n        let style = '';\n\n        if (regExp && vNode.style.cssText.length > 0) {\n          style = regExp.test(vNode.style.cssText);\n        }\n\n        return !style;\n      }\n\n      (function recursionFunc(current, ancestor) {\n        const childNodes = current.childNodes;\n\n        for (let i = 0, len = childNodes.length, vNode; i < len; i++) {\n          let child = childNodes[i];\n          if (!child) continue;\n          let coverNode = ancestor;\n          let cloneNode; // startContainer\n\n          if (!startPass && child === startContainer) {\n            let line = pNode;\n            anchorNode = _getMaintainedNode(child);\n            const prevNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(0, startOffset));\n            const textNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(startOffset, isSameNode ? endOffset >= startOffset ? endOffset - startOffset : startContainer.data.length - startOffset : startContainer.data.length - startOffset));\n\n            if (anchorNode) {\n              const a = _getMaintainedNode(ancestor);\n\n              if (a && a.parentNode !== line) {\n                let m = a;\n                let p = null;\n\n                while (m.parentNode !== line) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.appendChild(a);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            }\n\n            if (!util.onlyZeroWidthSpace(prevNode)) {\n              ancestor.appendChild(prevNode);\n            }\n\n            const prevAnchorNode = _getMaintainedNode(ancestor);\n\n            if (!!prevAnchorNode) anchorNode = prevAnchorNode;\n            if (anchorNode) line = anchorNode;\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n\n            while (newNode !== line && newNode !== el && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\n                pCurrent.push(vNode);\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            const childNode = pCurrent.pop() || textNode;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            newInnerNode.appendChild(childNode);\n            line.appendChild(newInnerNode);\n\n            if (anchorNode && !_getMaintainedNode(endContainer)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            startContainer = textNode;\n            startOffset = 0;\n            startPass = true;\n            if (newNode !== textNode) newNode.appendChild(startContainer);\n            if (!isSameNode) continue;\n          } // endContainer\n\n\n          if (!endPass && child === endContainer) {\n            anchorNode = _getMaintainedNode(child);\n            const afterNode = util.createTextNode(endContainer.nodeType === 1 ? '' : endContainer.substringData(endOffset, endContainer.length - endOffset));\n            const textNode = util.createTextNode(isSameNode || endContainer.nodeType === 1 ? '' : endContainer.substringData(0, endOffset));\n\n            if (anchorNode) {\n              anchorNode = anchorNode.cloneNode(false);\n            } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!util.onlyZeroWidthSpace(afterNode)) {\n              newNode = child;\n              cssText = '';\n              pCurrent = [];\n              const anchors = [];\n\n              while (newNode !== pNode && newNode !== el && newNode !== null) {\n                if (newNode.nodeType === 1 && checkCss(newNode)) {\n                  if (_isMaintainedNode(newNode)) anchors.push(newNode.cloneNode(false));else pCurrent.push(newNode.cloneNode(false));\n                  cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n                }\n\n                newNode = newNode.parentNode;\n              }\n\n              pCurrent = pCurrent.concat(anchors);\n              cloneNode = appendNode = newNode = pCurrent.pop() || afterNode;\n\n              while (pCurrent.length > 0) {\n                newNode = pCurrent.pop();\n                appendNode.appendChild(newNode);\n                appendNode = newNode;\n              }\n\n              pNode.appendChild(cloneNode);\n              newNode.textContent = afterNode.data;\n            }\n\n            if (anchorNode && cloneNode) {\n              const afterAnchorNode = _getMaintainedNode(cloneNode);\n\n              if (afterAnchorNode) {\n                anchorNode = afterAnchorNode;\n              }\n            }\n\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n\n            while (newNode !== pNode && newNode !== el && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\n                pCurrent.push(vNode);\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            const childNode = pCurrent.pop() || textNode;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              newInnerNode.appendChild(childNode);\n              anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\n              pNode.appendChild(anchorNode);\n              nNodeArray.push(newInnerNode);\n              anchorNode = null;\n            } else {\n              newInnerNode.appendChild(childNode);\n            }\n\n            endContainer = textNode;\n            endOffset = textNode.data.length;\n            endPass = true;\n\n            if (!isRemoveFormat && collapsed) {\n              newInnerNode = textNode;\n              textNode.textContent = util.zeroWidthSpace;\n            }\n\n            if (newNode !== textNode) newNode.appendChild(endContainer);\n            continue;\n          } // other\n\n\n          if (startPass) {\n            if (child.nodeType === 1 && !util.isBreak(child)) {\n              if (util._isIgnoreNodeChange(child)) {\n                pNode.appendChild(child.cloneNode(true));\n\n                if (!collapsed) {\n                  newInnerNode = newInnerNode.cloneNode(false);\n                  pNode.appendChild(newInnerNode);\n                  nNodeArray.push(newInnerNode);\n                }\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n            const anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = endPass ? newNode.cloneNode(false) : validation(newNode);\n\n              if (newNode.nodeType === 1 && !util.isBreak(child) && vNode && checkCss(newNode)) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            const childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode) && !util.onlyZeroWidthSpace(newInnerNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!endPass && !anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              const aChildren = childNode.childNodes;\n\n              for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.appendChild(childNode);\n              nNodeArray.push(newInnerNode);\n              if (newInnerNode.children.length > 0) ancestor = newNode;else ancestor = newInnerNode;\n            } else if (childNode === child) {\n              if (!endPass) ancestor = newInnerNode;else ancestor = pNode;\n            } else if (endPass) {\n              pNode.appendChild(childNode);\n              ancestor = newNode;\n            } else {\n              newInnerNode.appendChild(childNode);\n              ancestor = newNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.appendChild(newInnerNode);\n              } else {\n                anchorNode = null;\n              }\n            }\n          }\n\n          cloneNode = child.cloneNode(false);\n          ancestor.appendChild(cloneNode);\n          if (child.nodeType === 1 && !util.isBreak(child)) coverNode = cloneNode;\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          startContainer: startCon,\n          startOffset: startOff,\n          endContainer: endCon,\n          endOffset: endOff\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (let i = 0; i < nNodeArray.length; i++) {\n          let removeNode = nNodeArray[i];\n          let textNode, textNode_s, textNode_e;\n\n          if (collapsed) {\n            textNode = util.createTextNode(util.zeroWidthSpace);\n            pNode.replaceChild(textNode, removeNode);\n          } else {\n            const rChildren = removeNode.childNodes;\n            textNode_s = rChildren[0];\n\n            while (rChildren[0]) {\n              textNode_e = rChildren[0];\n              pNode.insertBefore(textNode_e, removeNode);\n            }\n\n            util.removeItem(removeNode);\n          }\n\n          if (i === 0) {\n            if (collapsed) {\n              startContainer = endContainer = textNode;\n            } else {\n              startContainer = textNode_s;\n              endContainer = textNode_e;\n            }\n          }\n        }\n      } else {\n        if (isRemoveNode) {\n          for (let i = 0; i < nNodeArray.length; i++) {\n            this._stripRemoveNode(nNodeArray[i]);\n          }\n        }\n\n        if (collapsed) {\n          startContainer = endContainer = newInnerNode;\n        }\n      }\n\n      util.removeEmptyNode(pNode, newInnerNode);\n\n      if (collapsed) {\n        startOffset = startContainer.textContent.length;\n        endOffset = endContainer.textContent.length;\n      } // endContainer reset\n\n\n      const endConReset = isRemoveFormat || endContainer.textContent.length === 0;\n\n      if (!util.isBreak(endContainer) && endContainer.textContent.length === 0) {\n        util.removeItem(endContainer);\n        endContainer = startContainer;\n      }\n\n      endOffset = endConReset ? endContainer.textContent.length : endOffset; // node change\n\n      const newStartOffset = {\n        s: 0,\n        e: 0\n      };\n      const startPath = util.getNodePath(startContainer, pNode, newStartOffset);\n      const mergeEndCon = !endContainer.parentNode;\n      if (mergeEndCon) endContainer = startContainer;\n      const newEndOffset = {\n        s: 0,\n        e: 0\n      };\n      const endPath = util.getNodePath(endContainer, pNode, !mergeEndCon && !endConReset ? newEndOffset : null);\n      startOffset += newStartOffset.s;\n      endOffset = collapsed ? startOffset : mergeEndCon ? startContainer.textContent.length : endConReset ? endOffset + newStartOffset.s : endOffset + newEndOffset.s; // tag merge\n\n      const newOffsets = util.mergeSameTags(pNode, [startPath, endPath], true);\n      element.parentNode.replaceChild(pNode, element);\n      startContainer = util.getNodeFromPath(startPath, pNode);\n      endContainer = util.getNodeFromPath(endPath, pNode);\n      return {\n        ancestor: pNode,\n        startContainer: startContainer,\n        startOffset: startOffset + newOffsets[0],\n        endContainer: endContainer,\n        endOffset: endOffset + newOffsets[1]\n      };\n    },\n\n    /**\r\n     * @description wraps first line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @returns {null|Node} If end container is renewed, returned renewed node\r\n     * @returns {Object} { ancestor, container, offset, endContainer }\r\n     * @private\r\n     */\n    _nodeChange_startLine: function (element, newInnerNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, _endContainer) {\n      // not add tag\n      let parentCon = startCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.nextSibling && util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff))) {\n        let sameTag = true;\n        let s = startCon.previousSibling;\n\n        while (s) {\n          if (!util.onlyZeroWidthSpace(s)) {\n            sameTag = false;\n            break;\n          }\n\n          s = s.previousSibling;\n        }\n\n        if (sameTag) {\n          util.copyTagAttributes(parentCon, newInnerNode);\n          return {\n            ancestor: element,\n            container: startCon,\n            offset: startOff\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      const el = element;\n      const nNodeArray = [newInnerNode];\n      const pNode = element.cloneNode(false);\n      let container = startCon;\n      let offset = startOff;\n      let passNode = false;\n      let pCurrent, newNode, appendNode, anchorNode;\n\n      (function recursionFunc(current, ancestor) {\n        const childNodes = current.childNodes;\n\n        for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\n          const child = childNodes[i];\n          if (!child) continue;\n          let coverNode = ancestor;\n\n          if (passNode && !util.isBreak(child)) {\n            if (child.nodeType === 1) {\n              if (util._isIgnoreNodeChange(child)) {\n                newInnerNode = newInnerNode.cloneNode(false);\n                cloneChild = child.cloneNode(true);\n                pNode.appendChild(cloneChild);\n                pNode.appendChild(newInnerNode);\n                nNodeArray.push(newInnerNode); // end container\n\n                if (_endContainer && child.contains(_endContainer)) {\n                  const endPath = util.getNodePath(_endContainer, child);\n                  _endContainer = util.getNodeFromPath(endPath, cloneChild);\n                }\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            const anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = validation(newNode);\n\n              if (newNode.nodeType === 1 && vNode) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            const isTopNode = pCurrent.length > 0;\n            const childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              const aChildren = childNode.childNodes;\n\n              for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.appendChild(childNode);\n              ancestor = !_isMaintainedNode(newNode) ? newNode : newInnerNode;\n              nNodeArray.push(newInnerNode);\n            } else if (isTopNode) {\n              newInnerNode.appendChild(childNode);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.appendChild(newInnerNode);\n              } else {\n                anchorNode = null;\n              }\n            }\n          } // startContainer\n\n\n          if (!passNode && child === container) {\n            let line = pNode;\n            anchorNode = _getMaintainedNode(child);\n            const prevNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\n            const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, container.length - offset));\n\n            if (anchorNode) {\n              const a = _getMaintainedNode(ancestor);\n\n              if (a && a.parentNode !== line) {\n                let m = a;\n                let p = null;\n\n                while (m.parentNode !== line) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.appendChild(a);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            }\n\n            if (!util.onlyZeroWidthSpace(prevNode)) {\n              ancestor.appendChild(prevNode);\n            }\n\n            const prevAnchorNode = _getMaintainedNode(ancestor);\n\n            if (!!prevAnchorNode) anchorNode = prevAnchorNode;\n            if (anchorNode) line = anchorNode;\n            newNode = ancestor;\n            pCurrent = [];\n\n            while (newNode !== line && newNode !== null) {\n              vNode = validation(newNode);\n\n              if (newNode.nodeType === 1 && vNode) {\n                pCurrent.push(vNode);\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            const childNode = pCurrent.pop() || ancestor;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (childNode !== ancestor) {\n              newInnerNode.appendChild(childNode);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\n            line.appendChild(newInnerNode);\n            container = textNode;\n            offset = 0;\n            passNode = true;\n            ancestor.appendChild(container);\n            continue;\n          }\n\n          vNode = !passNode ? child.cloneNode(false) : validation(child);\n\n          if (vNode) {\n            ancestor.appendChild(vNode);\n            if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\n          }\n\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          container: startCon,\n          offset: startOff,\n          endContainer: _endContainer\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (let i = 0; i < nNodeArray.length; i++) {\n          let removeNode = nNodeArray[i];\n          const rChildren = removeNode.childNodes;\n          const textNode = rChildren[0];\n\n          while (rChildren[0]) {\n            pNode.insertBefore(rChildren[0], removeNode);\n          }\n\n          util.removeItem(removeNode);\n          if (i === 0) container = textNode;\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (let i = 0; i < nNodeArray.length; i++) {\n          this._stripRemoveNode(nNodeArray[i]);\n        }\n      }\n\n      if (!isRemoveFormat && pNode.childNodes.length === 0) {\n        if (element.childNodes) {\n          container = element.childNodes[0];\n        } else {\n          container = util.createTextNode(util.zeroWidthSpace);\n          element.appendChild(container);\n        }\n      } else {\n        util.removeEmptyNode(pNode, newInnerNode);\n\n        if (util.onlyZeroWidthSpace(pNode.textContent)) {\n          container = pNode.firstChild;\n          offset = 0;\n        } // node change\n\n\n        const offsets = {\n          s: 0,\n          e: 0\n        };\n        const path = util.getNodePath(container, pNode, offsets);\n        offset += offsets.s; // tag merge\n\n        const newOffsets = util.mergeSameTags(pNode, [path], true);\n        element.parentNode.replaceChild(pNode, element);\n        container = util.getNodeFromPath(path, pNode);\n        offset += newOffsets[0];\n      }\n\n      return {\n        ancestor: pNode,\n        container: container,\n        offset: offset,\n        endContainer: _endContainer\n      };\n    },\n\n    /**\r\n     * @description wraps mid lines selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @param {Node} _endContainer Offset node of last line already modified (end.container)\r\n     * @returns {Object} { ancestor, endContainer: \"If end container is renewed, returned renewed node\" }\r\n     * @private\r\n     */\n    _nodeChange_middleLine: function (element, newInnerNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, _endContainer) {\n      // not add tag\n      if (!isRemoveNode) {\n        // end container path\n        let endPath = null;\n        if (_endContainer && element.contains(_endContainer)) endPath = util.getNodePath(_endContainer, element);\n        const tempNode = element.cloneNode(true);\n        const newNodeName = newInnerNode.nodeName;\n        const newCssText = newInnerNode.style.cssText;\n        const newClass = newInnerNode.className;\n        let children = tempNode.childNodes;\n        let i = 0,\n            len = children.length;\n\n        for (let child; i < len; i++) {\n          child = children[i];\n          if (child.nodeType === 3) break;\n\n          if (child.nodeName === newNodeName) {\n            child.style.cssText += newCssText;\n            util.addClass(child, newClass);\n          } else if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\n            continue;\n          } else if (len === 1) {\n            children = child.childNodes;\n            len = children.length;\n            i = -1;\n            continue;\n          } else {\n            break;\n          }\n        }\n\n        if (len > 0 && i === len) {\n          element.innerHTML = tempNode.innerHTML;\n          return {\n            ancestor: element,\n            endContainer: endPath ? util.getNodeFromPath(endPath, element) : null\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      const pNode = element.cloneNode(false);\n      const nNodeArray = [newInnerNode];\n      let noneChange = true;\n\n      (function recursionFunc(current, ancestor) {\n        const childNodes = current.childNodes;\n\n        for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\n          let child = childNodes[i];\n          if (!child) continue;\n          let coverNode = ancestor;\n\n          if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\n            if (newInnerNode.childNodes.length > 0) {\n              pNode.appendChild(newInnerNode);\n              newInnerNode = newInnerNode.cloneNode(false);\n            }\n\n            cloneChild = child.cloneNode(true);\n            pNode.appendChild(cloneChild);\n            pNode.appendChild(newInnerNode);\n            nNodeArray.push(newInnerNode);\n            ancestor = newInnerNode; // end container\n\n            if (_endContainer && child.contains(_endContainer)) {\n              const endPath = util.getNodePath(_endContainer, child);\n              _endContainer = util.getNodeFromPath(endPath, cloneChild);\n            }\n\n            continue;\n          } else {\n            vNode = validation(child);\n\n            if (vNode) {\n              noneChange = false;\n              ancestor.appendChild(vNode);\n              if (child.nodeType === 1) coverNode = vNode;\n            }\n          }\n\n          if (!util.isBreak(child)) recursionFunc(child, coverNode);\n        }\n      })(element, newInnerNode); // not remove tag\n\n\n      if (noneChange || isRemoveNode && !isRemoveFormat && !_removeCheck.v) return {\n        ancestor: element,\n        endContainer: _endContainer\n      };\n      pNode.appendChild(newInnerNode);\n\n      if (isRemoveFormat && isRemoveNode) {\n        for (let i = 0; i < nNodeArray.length; i++) {\n          let removeNode = nNodeArray[i];\n          const rChildren = removeNode.childNodes;\n\n          while (rChildren[0]) {\n            pNode.insertBefore(rChildren[0], removeNode);\n          }\n\n          util.removeItem(removeNode);\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (let i = 0; i < nNodeArray.length; i++) {\n          this._stripRemoveNode(nNodeArray[i]);\n        }\n      }\n\n      util.removeEmptyNode(pNode, newInnerNode);\n      util.mergeSameTags(pNode, null, true); // node change\n\n      element.parentNode.replaceChild(pNode, element);\n      return {\n        ancestor: pNode,\n        endContainer: _endContainer\n      };\n    },\n\n    /**\r\n     * @description wraps last line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @returns {Object} { ancestor, container, offset }\r\n     * @private\r\n     */\n    _nodeChange_endLine: function (element, newInnerNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\n      // not add tag\n      let parentCon = endCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.previousSibling && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\n        let sameTag = true;\n        let e = endCon.nextSibling;\n\n        while (e) {\n          if (!util.onlyZeroWidthSpace(e)) {\n            sameTag = false;\n            break;\n          }\n\n          e = e.nextSibling;\n        }\n\n        if (sameTag) {\n          util.copyTagAttributes(parentCon, newInnerNode);\n          return {\n            ancestor: element,\n            container: endCon,\n            offset: endOff\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      const el = element;\n      const nNodeArray = [newInnerNode];\n      const pNode = element.cloneNode(false);\n      let container = endCon;\n      let offset = endOff;\n      let passNode = false;\n      let pCurrent, newNode, appendNode, anchorNode;\n\n      (function recursionFunc(current, ancestor) {\n        const childNodes = current.childNodes;\n\n        for (let i = childNodes.length - 1, vNode; 0 <= i; i--) {\n          const child = childNodes[i];\n          if (!child) continue;\n          let coverNode = ancestor;\n\n          if (passNode && !util.isBreak(child)) {\n            if (child.nodeType === 1) {\n              if (util._isIgnoreNodeChange(child)) {\n                newInnerNode = newInnerNode.cloneNode(false);\n                const cloneChild = child.cloneNode(true);\n                pNode.insertBefore(cloneChild, ancestor);\n                pNode.insertBefore(newInnerNode, cloneChild);\n                nNodeArray.push(newInnerNode);\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            const anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = validation(newNode);\n\n              if (vNode && newNode.nodeType === 1) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            const isTopNode = pCurrent.length > 0;\n            const childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.insertBefore(newInnerNode, pNode.firstChild);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              const aChildren = childNode.childNodes;\n\n              for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.insertBefore(childNode, pNode.firstChild);\n              nNodeArray.push(newInnerNode);\n              if (newInnerNode.children.length > 0) ancestor = newNode;else ancestor = newInnerNode;\n            } else if (isTopNode) {\n              newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.insertBefore(newInnerNode, pNode.firstChild);\n              } else {\n                anchorNode = null;\n              }\n            }\n          } // endContainer\n\n\n          if (!passNode && child === container) {\n            anchorNode = _getMaintainedNode(child);\n            const afterNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, container.length - offset));\n            const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\n\n            if (anchorNode) {\n              anchorNode = anchorNode.cloneNode(false);\n\n              const a = _getMaintainedNode(ancestor);\n\n              if (a && a.parentNode !== pNode) {\n                let m = a;\n                let p = null;\n\n                while (m.parentNode !== pNode) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.insertBefore(a, m.parentNode.firstChild);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!util.onlyZeroWidthSpace(afterNode)) {\n              ancestor.insertBefore(afterNode, ancestor.firstChild);\n            }\n\n            newNode = ancestor;\n            pCurrent = [];\n\n            while (newNode !== pNode && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1) {\n                pCurrent.push(vNode);\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            const childNode = pCurrent.pop() || ancestor;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (childNode !== ancestor) {\n              newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\n\n            if (anchorNode) {\n              anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\n              pNode.insertBefore(anchorNode, pNode.firstChild);\n              anchorNode = null;\n            } else {\n              pNode.insertBefore(newInnerNode, pNode.firstChild);\n            }\n\n            container = textNode;\n            offset = textNode.data.length;\n            passNode = true;\n            ancestor.insertBefore(container, ancestor.firstChild);\n            continue;\n          }\n\n          vNode = !passNode ? child.cloneNode(false) : validation(child);\n\n          if (vNode) {\n            ancestor.insertBefore(vNode, ancestor.firstChild);\n            if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\n          }\n\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          container: endCon,\n          offset: endOff\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (let i = 0; i < nNodeArray.length; i++) {\n          let removeNode = nNodeArray[i];\n          const rChildren = removeNode.childNodes;\n          let textNode = null;\n\n          while (rChildren[0]) {\n            textNode = rChildren[0];\n            pNode.insertBefore(textNode, removeNode);\n          }\n\n          util.removeItem(removeNode);\n\n          if (i === nNodeArray.length - 1) {\n            container = textNode;\n            offset = textNode.textContent.length;\n          }\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (let i = 0; i < nNodeArray.length; i++) {\n          this._stripRemoveNode(nNodeArray[i]);\n        }\n      }\n\n      if (!isRemoveFormat && pNode.childNodes.length === 0) {\n        if (element.childNodes) {\n          container = element.childNodes[0];\n        } else {\n          container = util.createTextNode(util.zeroWidthSpace);\n          element.appendChild(container);\n        }\n      } else {\n        if (!isRemoveNode && newInnerNode.textContent.length === 0) {\n          util.removeEmptyNode(pNode, null);\n          return {\n            ancestor: null,\n            container: null,\n            offset: 0\n          };\n        }\n\n        util.removeEmptyNode(pNode, newInnerNode);\n\n        if (util.onlyZeroWidthSpace(pNode.textContent)) {\n          container = pNode.firstChild;\n          offset = container.textContent.length;\n        } else if (util.onlyZeroWidthSpace(container)) {\n          container = newInnerNode;\n          offset = 1;\n        } // node change\n\n\n        const offsets = {\n          s: 0,\n          e: 0\n        };\n        const path = util.getNodePath(container, pNode, offsets);\n        offset += offsets.s; // tag merge\n\n        const newOffsets = util.mergeSameTags(pNode, [path], true);\n        element.parentNode.replaceChild(pNode, element);\n        container = util.getNodeFromPath(path, pNode);\n        offset += newOffsets[0];\n      }\n\n      return {\n        ancestor: pNode,\n        container: container,\n        offset: offset\n      };\n    },\n\n    /**\r\n     * @description Run plugin calls and basic commands.\r\n     * @param {String} command Command string\r\n     * @param {String} display Display type string ('command', 'submenu', 'dialog', 'container')\r\n     * @param {Element} target The element of command button\r\n     */\n    actionCall: function (command, display, target) {\n      // call plugins\n      if (display) {\n        if (/more/i.test(display) && target !== this._moreLayerActiveButton) {\n          const layer = context.element.toolbar.querySelector('.' + command);\n\n          if (layer) {\n            if (this._moreLayerActiveButton) {\n              context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command')).style.display = 'none';\n              util.removeClass(this._moreLayerActiveButton, 'on');\n            }\n\n            util.addClass(target, 'on');\n            this._moreLayerActiveButton = target;\n            layer.style.display = 'block';\n\n            event._showToolbarBalloon();\n\n            event._showToolbarInline();\n          }\n\n          return;\n        } else if (/submenu/.test(display) && (this._menuTray[command] === null || target !== this.submenuActiveButton)) {\n          this.callPlugin(command, this.submenuOn.bind(this, target), target);\n          return;\n        } else if (/dialog/.test(display)) {\n          this.callPlugin(command, this.plugins[command].open.bind(this), target);\n          return;\n        } else if (/command/.test(display)) {\n          this.callPlugin(command, this.plugins[command].action.bind(this), target);\n        } else if (/container/.test(display) && (this._menuTray[command] === null || target !== this.containerActiveButton)) {\n          this.callPlugin(command, this.containerOn.bind(this, target), target);\n          return;\n        } else if (/fileBrowser/.test(display)) {\n          this.callPlugin(command, this.plugins[command].open.bind(this, null), target);\n        }\n      } // default command\n      else if (command) {\n          this.commandHandler(target, command);\n        }\n\n      if (/more/i.test(display)) {\n        const layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\n\n        if (layer) {\n          util.removeClass(this._moreLayerActiveButton, 'on');\n          this._moreLayerActiveButton = null;\n          layer.style.display = 'none';\n\n          event._showToolbarBalloon();\n\n          event._showToolbarInline();\n        }\n      } else if (/submenu/.test(display)) {\n        this.submenuOff();\n      } else if (!/command/.test(display)) {\n        this.submenuOff();\n        this.containerOff();\n      }\n    },\n\n    /**\r\n     * @description Execute command of command button(All Buttons except submenu and dialog)\r\n     * (selectAll, codeView, fullScreen, indent, outdent, undo, redo, removeFormat, print, preview, showBlocks, save, bold, underline, italic, strike, subscript, superscript, copy, cut, paste)\r\n     * @param {Element|null} target The element of command button\r\n     * @param {String} command Property of command button (data-value)\r\n     */\n    commandHandler: function (target, command) {\n      switch (command) {\n        case 'copy':\n        case 'cut':\n          this.execCommand(command);\n          break;\n\n        case 'paste':\n          break;\n\n        case 'selectAll':\n          const wysiwyg = context.element.wysiwyg;\n          let first = util.getChildElement(wysiwyg.firstChild, function (current) {\n            return current.childNodes.length === 0 || current.nodeType === 3;\n          }, false) || wysiwyg.firstChild;\n          let last = util.getChildElement(wysiwyg.lastChild, function (current) {\n            return current.childNodes.length === 0 || current.nodeType === 3;\n          }, true) || wysiwyg.lastChild;\n          if (!first || !last) return;\n\n          if (util.isMedia(first)) {\n            const info = this.getFileComponent(first);\n            const br = util.createElement('BR');\n            const format = util.createElement(options.defaultTag);\n            format.appendChild(br);\n            first = info ? info.component : first;\n            first.parentNode.insertBefore(format, first);\n            first = br;\n          }\n\n          if (util.isMedia(last)) {\n            const br = util.createElement('BR');\n            const format = util.createElement(options.defaultTag);\n            format.appendChild(br);\n            wysiwyg.appendChild(format);\n            last = br;\n          }\n\n          this.setRange(first, 0, last, last.textContent.length);\n          break;\n\n        case 'codeView':\n          this.toggleCodeView();\n          break;\n\n        case 'fullScreen':\n          this.toggleFullScreen(target);\n          break;\n\n        case 'indent':\n        case 'outdent':\n          this.indent(command);\n          break;\n\n        case 'undo':\n          this.history.undo();\n          break;\n\n        case 'redo':\n          this.history.redo();\n          break;\n\n        case 'removeFormat':\n          this.removeFormat();\n          this.focus();\n          break;\n\n        case 'print':\n          this.print();\n          break;\n\n        case 'preview':\n          this.preview();\n          break;\n\n        case 'showBlocks':\n          this.toggleDisplayBlocks();\n          break;\n\n        case 'save':\n          if (typeof options.callBackSave === 'function') {\n            options.callBackSave(this.getContents(false), this._variable.isChanged);\n          } else if (this._variable.isChanged && typeof functions.save === 'function') {\n            functions.save();\n          } else {\n            throw Error('[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)');\n          }\n\n          this._variable.isChanged = false;\n          if (context.tool.save) context.tool.save.setAttribute('disabled', true);\n          break;\n\n        default:\n          // 'STRONG', 'U', 'EM', 'DEL', 'SUB', 'SUP'..\n          command = this._defaultCommand[command.toLowerCase()] || command;\n          if (!this.commandMap[command]) this.commandMap[command] = target;\n          const nodesMap = this._variable.currentNodesMap;\n          const cmd = nodesMap.indexOf(command) > -1 ? null : util.createElement(command);\n          let removeNode = command;\n\n          if (/^SUB$/i.test(command) && nodesMap.indexOf('SUP') > -1) {\n            removeNode = 'SUP';\n          } else if (/^SUP$/i.test(command) && nodesMap.indexOf('SUB') > -1) {\n            removeNode = 'SUB';\n          }\n\n          this.nodeChange(cmd, null, [removeNode], false);\n          this.focus();\n      }\n    },\n\n    /**\r\n     * @description Remove format of the currently selected range\r\n     */\n    removeFormat: function () {\n      this.nodeChange(null, null, null, null);\n    },\n\n    /**\r\n     * @description This method implements indentation to selected range.\r\n     * Setted \"margin-left\" to \"25px\" in the top \"P\" tag of the parameter node.\r\n     * @param {String} command Separator (\"indent\" or \"outdent\")\r\n     */\n    indent: function (command) {\n      const range = this.getRange();\n      const rangeLines = this.getSelectedElements(null);\n      const cells = [];\n      const shift = 'indent' !== command;\n      const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\n      let sc = range.startContainer;\n      let ec = range.endContainer;\n      let so = range.startOffset;\n      let eo = range.endOffset;\n\n      for (let i = 0, len = rangeLines.length, f, margin; i < len; i++) {\n        f = rangeLines[i];\n\n        if (!util.isListCell(f) || !this.plugins.list) {\n          margin = /\\d+/.test(f.style[marginDir]) ? util.getNumber(f.style[marginDir], 0) : 0;\n\n          if (shift) {\n            margin -= 25;\n          } else {\n            margin += 25;\n          }\n\n          util.setStyle(f, marginDir, margin <= 0 ? '' : margin + 'px');\n        } else {\n          if (shift || f.previousElementSibling) {\n            cells.push(f);\n          }\n        }\n      } // list cells\n\n\n      if (cells.length > 0) {\n        this.plugins.list.editInsideList.call(this, shift, cells);\n      }\n\n      this.effectNode = null;\n      this.setRange(sc, so, ec, eo); // history stack\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description Add or remove the class name of \"body\" so that the code block is visible\r\n     */\n    toggleDisplayBlocks: function () {\n      const wysiwyg = context.element.wysiwyg;\n      util.toggleClass(wysiwyg, 'se-show-block');\n\n      if (util.hasClass(wysiwyg, 'se-show-block')) {\n        util.addClass(this._styleCommandMap.showBlocks, 'active');\n      } else {\n        util.removeClass(this._styleCommandMap.showBlocks, 'active');\n      }\n\n      this._resourcesStateChange();\n    },\n\n    /**\r\n     * @description Changes to code view or wysiwyg view\r\n     */\n    toggleCodeView: function () {\n      const isCodeView = this._variable.isCodeView;\n      this.controllersOff();\n      util.setDisabledButtons(!isCodeView, this.codeViewDisabledButtons);\n\n      if (isCodeView) {\n        this._setCodeDataToEditor();\n\n        context.element.wysiwygFrame.scrollTop = 0;\n        context.element.code.style.display = 'none';\n        context.element.wysiwygFrame.style.display = 'block';\n        this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\n        this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\n        if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = '0px';\n        this._variable.isCodeView = false;\n\n        if (!this._variable.isFullScreen) {\n          this._notHideToolbar = false;\n\n          if (/balloon|balloon-always/i.test(options.mode)) {\n            context.element._arrow.style.display = '';\n            this._isInline = false;\n            this._isBalloon = true;\n\n            event._hideToolbar();\n          }\n        }\n\n        this.nativeFocus();\n        util.removeClass(this._styleCommandMap.codeView, 'active'); // history stack\n\n        this.history.push(false);\n\n        this.history._resetCachingButton();\n      } else {\n        this._setEditorDataToCodeView();\n\n        this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\n        this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\n        if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = context.element.code.scrollHeight > 0 ? context.element.code.scrollHeight + 'px' : 'auto';\n        if (options.codeMirrorEditor) options.codeMirrorEditor.refresh();\n        this._variable.isCodeView = true;\n\n        if (!this._variable.isFullScreen) {\n          this._notHideToolbar = true;\n\n          if (this._isBalloon) {\n            context.element._arrow.style.display = 'none';\n            context.element.toolbar.style.left = '';\n            this._isInline = true;\n            this._isBalloon = false;\n\n            event._showToolbarInline();\n          }\n        }\n\n        this._variable._range = null;\n        context.element.code.focus();\n        util.addClass(this._styleCommandMap.codeView, 'active');\n      }\n\n      this._checkPlaceholder(); // user event\n\n\n      if (typeof functions.toggleCodeView === 'function') functions.toggleCodeView(this._variable.isCodeView, this);\n    },\n\n    /**\r\n     * @description Convert the data of the code view and put it in the WYSIWYG area.\r\n     * @private\r\n     */\n    _setCodeDataToEditor: function () {\n      const code_html = this._getCodeView();\n\n      if (options.fullPage) {\n        const parseDocument = this._parser.parseFromString(code_html, 'text/html');\n\n        const headChildren = parseDocument.head.children;\n\n        for (let i = 0, len = headChildren.length; i < len; i++) {\n          if (/^script$/i.test(headChildren[i].tagName)) {\n            parseDocument.head.removeChild(headChildren[i]);\n            i--, len--;\n          }\n        }\n\n        this._wd.head.innerHTML = parseDocument.head.innerHTML;\n        this._wd.body.innerHTML = this.convertContentsForEditor(parseDocument.body.innerHTML);\n        const attrs = parseDocument.body.attributes;\n\n        for (let i = 0, len = attrs.length; i < len; i++) {\n          if (attrs[i].name === 'contenteditable') continue;\n\n          this._wd.body.setAttribute(attrs[i].name, attrs[i].value);\n        }\n\n        if (!util.hasClass(this._wd.body, 'sun-editor-editable')) {\n          const editableClasses = options._editableClass.split(' ');\n\n          for (let i = 0; i < editableClasses.length; i++) {\n            util.addClass(this._wd.body, options._editableClass[i]);\n          }\n        }\n      } else {\n        context.element.wysiwyg.innerHTML = code_html.length > 0 ? this.convertContentsForEditor(code_html) : '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n      }\n    },\n\n    /**\r\n     * @description Convert the data of the WYSIWYG area and put it in the code view area.\r\n     * @private\r\n     */\n    _setEditorDataToCodeView: function () {\n      const codeContents = this.convertHTMLForCodeView(context.element.wysiwyg);\n      let codeValue = '';\n\n      if (options.fullPage) {\n        const attrs = util.getAttributesToString(this._wd.body, null);\n        codeValue = '<!DOCTYPE html>\\n<html>\\n' + this._wd.head.outerHTML.replace(/>(?!\\n)/g, '>\\n') + '<body ' + attrs + '>\\n' + codeContents + '</body>\\n</html>';\n      } else {\n        codeValue = codeContents;\n      }\n\n      context.element.code.style.display = 'block';\n      context.element.wysiwygFrame.style.display = 'none';\n\n      this._setCodeView(codeValue);\n    },\n\n    /**\r\n     * @description Changes to full screen or default screen\r\n     * @param {Element} element full screen button\r\n     */\n    toggleFullScreen: function (element) {\n      const topArea = context.element.topArea;\n      const toolbar = context.element.toolbar;\n      const editorArea = context.element.editorArea;\n      const wysiwygFrame = context.element.wysiwygFrame;\n      const code = context.element.code;\n      const _var = this._variable;\n      this.controllersOff();\n\n      if (!_var.isFullScreen) {\n        _var.isFullScreen = true;\n        _var._fullScreenAttrs.inline = this._isInline;\n        _var._fullScreenAttrs.balloon = this._isBalloon;\n\n        if (this._isInline || this._isBalloon) {\n          this._isInline = false;\n          this._isBalloon = false;\n        }\n\n        if (!!options.toolbarContainer) context.element.relative.insertBefore(toolbar, editorArea);\n        topArea.style.position = 'fixed';\n        topArea.style.top = '0';\n        topArea.style.left = '0';\n        topArea.style.width = '100%';\n        topArea.style.maxWidth = '100%';\n        topArea.style.height = '100%';\n        topArea.style.zIndex = '2147483647';\n\n        if (context.element._stickyDummy.style.display !== ('none' && '')) {\n          _var._fullScreenAttrs.sticky = true;\n          context.element._stickyDummy.style.display = 'none';\n          util.removeClass(toolbar, 'se-toolbar-sticky');\n        }\n\n        _var._bodyOverflow = _d.body.style.overflow;\n        _d.body.style.overflow = 'hidden';\n        _var._editorAreaOriginCssText = editorArea.style.cssText;\n        _var._wysiwygOriginCssText = wysiwygFrame.style.cssText;\n        _var._codeOriginCssText = code.style.cssText;\n        editorArea.style.cssText = toolbar.style.cssText = '';\n        wysiwygFrame.style.cssText = (wysiwygFrame.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\n        code.style.cssText = (code.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\n        toolbar.style.width = wysiwygFrame.style.height = code.style.height = '100%';\n        toolbar.style.position = 'relative';\n        toolbar.style.display = 'block';\n        _var.innerHeight_fullScreen = _w.innerHeight - toolbar.offsetHeight;\n        editorArea.style.height = _var.innerHeight_fullScreen - options.fullScreenOffset + 'px';\n        util.changeElement(element.firstElementChild, icons.reduction);\n\n        if (options.iframe && options.height === 'auto') {\n          editorArea.style.overflow = 'auto';\n\n          this._iframeAutoHeight();\n        }\n\n        context.element.topArea.style.marginTop = options.fullScreenOffset + 'px';\n        util.addClass(this._styleCommandMap.fullScreen, 'active');\n      } else {\n        _var.isFullScreen = false;\n        wysiwygFrame.style.cssText = _var._wysiwygOriginCssText;\n        code.style.cssText = _var._codeOriginCssText;\n        toolbar.style.cssText = '';\n        editorArea.style.cssText = _var._editorAreaOriginCssText;\n        topArea.style.cssText = _var._originCssText;\n        _d.body.style.overflow = _var._bodyOverflow;\n        if (!!options.toolbarContainer) options.toolbarContainer.appendChild(toolbar);\n\n        if (options.stickyToolbar > -1) {\n          util.removeClass(toolbar, 'se-toolbar-sticky');\n        }\n\n        if (_var._fullScreenAttrs.sticky && !options.toolbarContainer) {\n          _var._fullScreenAttrs.sticky = false;\n          context.element._stickyDummy.style.display = 'block';\n          util.addClass(toolbar, \"se-toolbar-sticky\");\n        }\n\n        this._isInline = _var._fullScreenAttrs.inline;\n        this._isBalloon = _var._fullScreenAttrs.balloon;\n        if (this._isInline) event._showToolbarInline();\n        if (!!options.toolbarContainer) util.removeClass(toolbar, 'se-toolbar-balloon');\n        event.onScroll_window();\n        util.changeElement(element.firstElementChild, icons.expansion);\n        context.element.topArea.style.marginTop = '';\n        util.removeClass(this._styleCommandMap.fullScreen, 'active');\n      } // user event\n\n\n      if (typeof functions.toggleFullScreen === 'function') functions.toggleFullScreen(this._variable.isFullScreen, this);\n    },\n\n    /**\r\n     * @description Prints the current contents of the editor.\r\n     */\n    print: function () {\n      const iframe = util.createElement('IFRAME');\n      iframe.style.display = 'none';\n\n      _d.body.appendChild(iframe);\n\n      const contentsHTML = options.printTemplate ? options.printTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\n      const printDocument = util.getIframeDocument(iframe);\n      const wDoc = this._wd;\n\n      if (options.iframe) {\n        const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\n        printDocument.write('' + '<!DOCTYPE html><html>' + '<head>' + wDoc.head.innerHTML + '</head>' + '<body ' + arrts + '>' + contentsHTML + '</body>' + '</html>');\n      } else {\n        const links = _d.head.getElementsByTagName('link');\n\n        const styles = _d.head.getElementsByTagName('style');\n\n        let linkHTML = '';\n\n        for (let i = 0, len = links.length; i < len; i++) {\n          linkHTML += links[i].outerHTML;\n        }\n\n        for (let i = 0, len = styles.length; i < len; i++) {\n          linkHTML += styles[i].outerHTML;\n        }\n\n        printDocument.write('' + '<!DOCTYPE html><html>' + '<head>' + linkHTML + '</head>' + '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\">' + contentsHTML + '</body>' + '</html>');\n      }\n\n      this.showLoading();\n\n      _w.setTimeout(function () {\n        try {\n          iframe.focus(); // IE or Edge\n\n          if (util.isIE_Edge || !!_d.documentMode || !!_w.StyleMedia) {\n            try {\n              iframe.contentWindow.document.execCommand('print', false, null);\n            } catch (e) {\n              iframe.contentWindow.print();\n            }\n          } else {\n            // Other browsers\n            iframe.contentWindow.print();\n          }\n        } catch (error) {\n          throw Error('[SUNEDITOR.core.print.fail] error: ' + error);\n        } finally {\n          core.closeLoading();\n          util.removeItem(iframe);\n        }\n      }, 1000);\n    },\n\n    /**\r\n     * @description Open the preview window.\r\n     */\n    preview: function () {\n      core.submenuOff();\n      core.containerOff();\n      core.controllersOff();\n      const contentsHTML = options.previewTemplate ? options.previewTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\n\n      const windowObject = _w.open('', '_blank');\n\n      windowObject.mimeType = 'text/html';\n      const wDoc = this._wd;\n\n      if (options.iframe) {\n        const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\n        windowObject.document.write('' + '<!DOCTYPE html><html>' + '<head>' + wDoc.head.innerHTML + '<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style>' + '</head>' + '<body ' + arrts + '>' + contentsHTML + '</body>' + '</html>');\n      } else {\n        const links = _d.head.getElementsByTagName('link');\n\n        const styles = _d.head.getElementsByTagName('style');\n\n        let linkHTML = '';\n\n        for (let i = 0, len = links.length; i < len; i++) {\n          linkHTML += links[i].outerHTML;\n        }\n\n        for (let i = 0, len = styles.length; i < len; i++) {\n          linkHTML += styles[i].outerHTML;\n        }\n\n        windowObject.document.write('' + '<!DOCTYPE html><html>' + '<head>' + '<meta charset=\"utf-8\" />' + '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">' + '<title>' + lang.toolbar.preview + '</title>' + linkHTML + '</head>' + '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\" style=\"margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;\">' + contentsHTML + '</body>' + '</html>');\n      }\n    },\n\n    /**\r\n     * @description Sets the HTML string\r\n     * @param {String|undefined} html HTML string\r\n     */\n    setContents: function (html) {\n      this.removeRange();\n      const convertValue = html === null || html === undefined ? '' : this.convertContentsForEditor(html);\n\n      this._resetComponents();\n\n      if (!this._variable.isCodeView) {\n        context.element.wysiwyg.innerHTML = convertValue; // history stack\n\n        this.history.push(false);\n      } else {\n        const value = this.convertHTMLForCodeView(convertValue);\n\n        this._setCodeView(value);\n      }\n    },\n\n    /**\r\n     * @description Sets the contents of the iframe's head tag and body tag when using the \"iframe\" or \"fullPage\" option.\r\n     * @param {Object} ctx { head: HTML string, body: HTML string}\r\n     */\n    setIframeContents: function (ctx) {\n      if (!options.iframe) return false;\n      if (ctx.head) this._wd.head.innerHTML = ctx.head.replace(/<script[\\s\\S]*>[\\s\\S]*<\\/script>/gi, '');\n      if (ctx.body) this._wd.body.innerHTML = this.convertContentsForEditor(ctx.body);\n    },\n\n    /**\r\n     * @description Gets the current contents\r\n     * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {Object}\r\n     */\n    getContents: function (onlyContents) {\n      const contents = context.element.wysiwyg.innerHTML;\n      const renderHTML = util.createElement('DIV');\n      renderHTML.innerHTML = contents;\n      const figcaptions = util.getListChildren(renderHTML, function (current) {\n        return /FIGCAPTION/i.test(current.nodeName);\n      });\n\n      for (let i = 0, len = figcaptions.length; i < len; i++) {\n        figcaptions[i].removeAttribute('contenteditable');\n      }\n\n      if (options.fullPage && !onlyContents) {\n        const attrs = util.getAttributesToString(this._wd.body, ['contenteditable']);\n        return '<!DOCTYPE html><html>' + this._wd.head.outerHTML + '<body ' + attrs + '>' + renderHTML.innerHTML + '</body></html>';\n      } else {\n        return renderHTML.innerHTML;\n      }\n    },\n\n    /**\r\n     * @description Returns HTML string according to tag type and configuration.\r\n     * Use only \"cleanHTML\"\r\n     * @param {Node} node Node\r\n     * @param {Boolean} requireFormat If true, text nodes that do not have a format node is wrapped with the format tag.\r\n     * @private\r\n     */\n    _makeLine: function (node, requireFormat) {\n      const defaultTag = options.defaultTag; // element\n\n      if (node.nodeType === 1) {\n        if (util._disallowedTags(node)) return '';\n\n        if (!requireFormat || util.isFormatElement(node) || util.isRangeFormatElement(node) || util.isComponent(node) || util.isMedia(node) || util.isAnchor(node) && util.isMedia(node.firstElementChild)) {\n          return node.outerHTML;\n        } else {\n          return '<' + defaultTag + '>' + node.outerHTML + '</' + defaultTag + '>';\n        }\n      } // text\n\n\n      if (node.nodeType === 3) {\n        if (!requireFormat) return util._HTMLConvertor(node.textContent);\n        const textArray = node.textContent.split(/\\n/g);\n        let html = '';\n\n        for (let i = 0, tLen = textArray.length, text; i < tLen; i++) {\n          text = textArray[i].trim();\n          if (text.length > 0) html += '<' + defaultTag + '>' + util._HTMLConvertor(text) + '</' + defaultTag + '>';\n        }\n\n        return html;\n      } // comments\n\n\n      if (node.nodeType === 8 && this._allowHTMLComments) {\n        return '<!--' + node.textContent.trim() + '-->';\n      }\n\n      return '';\n    },\n\n    /**\r\n     * @description Removes attribute values such as style and converts tags that do not conform to the \"html5\" standard.\r\n     * @param {String} text \r\n     * @returns {String} HTML string\r\n     * @private\r\n     */\n    _tagConvertor: function (text) {\n      if (!this._disallowedTextTagsRegExp) return text;\n      const ec = options._textTagsMap;\n      return text.replace(this._disallowedTextTagsRegExp, function (m, t, n) {\n        return t + (typeof ec[n] === 'string' ? ec[n] : n);\n      });\n    },\n\n    /**\r\n     * @description Delete disallowed tags\r\n     * @param {String} html HTML string\r\n     * @returns {String}\r\n     * @private\r\n     */\n    _deleteDisallowedTags: function (html) {\n      return html.replace(/\\n/g, '').replace(/<(script|style)[\\s\\S]*>[\\s\\S]*<\\/(script|style)>/gi, '').replace(/<[a-z0-9]+\\:[a-z0-9]+[^>^\\/]*>[^>]*<\\/[a-z0-9]+\\:[a-z0-9]+>/gi, '').replace(this.editorTagsWhitelistRegExp, '');\n    },\n\n    /**\r\n     * @description Tag and tag attribute check RegExp function. (used by \"cleanHTML\" and \"convertContentsForEditor\")\r\n     * @param {Boolean} rowLevelCheck Row level check\r\n     * @param {String} m RegExp value\r\n     * @param {String} t RegExp value\r\n     * @returns {String}\r\n     * @private\r\n     */\n    _cleanTags: function (rowLevelCheck, m, t) {\n      if (/^<[a-z0-9]+\\:[a-z0-9]+/i.test(m)) return m;\n      let v = null;\n\n      const tAttr = this._attributesTagsWhitelist[t.match(/(?!<)[a-zA-Z0-9\\-]+/)[0].toLowerCase()];\n\n      if (tAttr) v = m.match(tAttr);else v = m.match(this._attributesWhitelistRegExp);\n\n      if ((rowLevelCheck || /<span/i.test(t)) && (!v || !/style=/i.test(v.toString()))) {\n        const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n        if (sv) {\n          if (!v) v = [];\n          v.push(sv[0]);\n        }\n      }\n\n      if (/<a\\b/i.test(t)) {\n        const sv = m.match(/id\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n        if (sv) {\n          if (!v) v = [];\n          v.push(sv[0]);\n        }\n      }\n\n      if (v) {\n        for (let i = 0, len = v.length; i < len; i++) {\n          if (rowLevelCheck && /^class=\"(?!(__se__|se-|katex))/.test(v[i])) continue;\n          t += ' ' + (/^href\\s*=\\s*('|\"|\\s)*javascript\\s*\\:/i.test(v[i]) ? '' : v[i]);\n        }\n      }\n\n      return t;\n    },\n\n    /**\r\n     * @description Gets the clean HTML code for editor\r\n     * @param {String} html HTML string\r\n     * @param {String|RegExp|null} whitelist Regular expression of allowed tags.\r\n     * RegExp object is create by util.createTagsWhitelist method. (core.pasteTagsWhitelistRegExp)\r\n     * @returns {String}\r\n     */\n    cleanHTML: function (html, whitelist) {\n      html = this._deleteDisallowedTags(this._parser.parseFromString(html, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, false));\n\n      const dom = _d.createRange().createContextualFragment(html);\n\n      try {\n        util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp);\n      } catch (error) {\n        console.warn('[SUNEDITOR.cleanHTML.consistencyCheck.fail] ' + error);\n      }\n\n      if (this.managedTagsInfo && this.managedTagsInfo.query) {\n        const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\n\n        for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\n          classList = [].slice.call(textCompList[i].classList);\n\n          for (let c = 0, cLen = classList.length; c < cLen; c++) {\n            initMethod = this.managedTagsInfo.map[classList[c]];\n\n            if (initMethod) {\n              initMethod(textCompList[i]);\n              break;\n            }\n          }\n        }\n      }\n\n      const domTree = dom.childNodes;\n      let cleanHTML = '';\n      let requireFormat = false;\n\n      for (let i = 0, len = domTree.length, t; i < len; i++) {\n        t = domTree[i];\n\n        if (t.nodeType === 1 && !util.isTextStyleElement(t) && !util.isBreak(t) && !util._disallowedTags(t)) {\n          requireFormat = true;\n          break;\n        }\n      }\n\n      for (let i = 0, len = domTree.length; i < len; i++) {\n        cleanHTML += this._makeLine(domTree[i], requireFormat);\n      }\n\n      cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\n      return this._tagConvertor(!cleanHTML ? html : !whitelist ? cleanHTML : cleanHTML.replace(typeof whitelist === 'string' ? util.createTagsWhitelist(whitelist) : whitelist, ''));\n    },\n\n    /**\r\n     * @description Converts contents into a format that can be placed in an editor\r\n     * @param {String} contents contents\r\n     * @returns {String}\r\n     */\n    convertContentsForEditor: function (contents) {\n      contents = this._deleteDisallowedTags(this._parser.parseFromString(contents, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, true));\n\n      const dom = _d.createRange().createContextualFragment(contents);\n\n      try {\n        util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp);\n      } catch (error) {\n        console.warn('[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] ' + error);\n      }\n\n      if (this.managedTagsInfo && this.managedTagsInfo.query) {\n        const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\n\n        for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\n          classList = [].slice.call(textCompList[i].classList);\n\n          for (let c = 0, cLen = classList.length; c < cLen; c++) {\n            initMethod = this.managedTagsInfo.map[classList[c]];\n\n            if (initMethod) {\n              initMethod(textCompList[i]);\n              break;\n            }\n          }\n        }\n      }\n\n      const domTree = dom.childNodes;\n      let cleanHTML = '';\n\n      for (let i = 0, len = domTree.length; i < len; i++) {\n        cleanHTML += this._makeLine(domTree[i], true);\n      }\n\n      if (cleanHTML.length === 0) return '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n      cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\n      return this._tagConvertor(cleanHTML);\n    },\n\n    /**\r\n     * @description Converts wysiwyg area element into a format that can be placed in an editor of code view mode\r\n     * @param {Element|String} html WYSIWYG element (context.element.wysiwyg) or HTML string.\r\n     * @returns {String}\r\n     */\n    convertHTMLForCodeView: function (html) {\n      let returnHTML = '';\n      const wRegExp = _w.RegExp;\n      const brReg = new wRegExp('^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$', 'i');\n      const wDoc = typeof html === 'string' ? _d.createRange().createContextualFragment(html) : html;\n\n      const isFormat = function (current) {\n        return this.isFormatElement(current) || this.isComponent(current);\n      }.bind(util);\n\n      let indentSize = this._variable.codeIndent * 1;\n      indentSize = indentSize > 0 ? new _w.Array(indentSize + 1).join(' ') : '';\n\n      (function recursionFunc(element, indent, lineBR) {\n        const children = element.childNodes;\n        const elementRegTest = brReg.test(element.nodeName);\n        const elementIndent = elementRegTest ? indent : '';\n\n        for (let i = 0, len = children.length, node, br, nodeRegTest, tag, tagIndent; i < len; i++) {\n          node = children[i];\n          nodeRegTest = brReg.test(node.nodeName);\n          br = nodeRegTest ? '\\n' : '';\n          lineBR = isFormat(node) && !elementRegTest && !/^(TH|TD)$/i.test(element.nodeName) ? '\\n' : '';\n\n          if (node.nodeType === 8) {\n            returnHTML += '\\n<!-- ' + node.textContent.trim() + ' -->' + br;\n            continue;\n          }\n\n          if (node.nodeType === 3) {\n            if (!util.isList(node.parentElement)) returnHTML += util._HTMLConvertor(/^\\n+$/.test(node.data) ? '' : node.data);\n            continue;\n          }\n\n          if (node.childNodes.length === 0) {\n            returnHTML += (/^HR$/i.test(node.nodeName) ? '\\n' : '') + (/^PRE$/i.test(node.parentElement.nodeName) && /^BR$/i.test(node.nodeName) ? '' : elementIndent) + node.outerHTML + br;\n            continue;\n          }\n\n          if (!node.outerHTML) {\n            // IE\n            returnHTML += new _w.XMLSerializer().serializeToString(node);\n          } else {\n            tag = node.nodeName.toLowerCase();\n            tagIndent = elementIndent || nodeRegTest ? indent : '';\n            returnHTML += (lineBR || (elementRegTest ? '' : br)) + tagIndent + node.outerHTML.match(wRegExp('<' + tag + '[^>]*>', 'i'))[0] + br;\n            recursionFunc(node, indent + indentSize, '');\n            returnHTML += (/\\n$/.test(returnHTML) ? tagIndent : '') + '</' + tag + '>' + (lineBR || br || elementRegTest ? '\\n' : '' || /^(TH|TD)$/i.test(node.nodeName) ? '\\n' : '');\n          }\n        }\n      })(wDoc, '', '\\n');\n\n      return returnHTML.trim() + '\\n';\n    },\n\n    /**\r\n     * @description Add an event to document.\r\n     * When created as an Iframe, the same event is added to the document in the Iframe.\r\n     * @param {String} type Event type\r\n     * @param {Function} listener Event listener\r\n     * @param {Boolean} useCapture Use event capture\r\n     */\n    addDocEvent: function (type, listener, useCapture) {\n      _d.addEventListener(type, listener, useCapture);\n\n      if (options.iframe) {\n        this._wd.addEventListener(type, listener);\n      }\n    },\n\n    /**\r\n     * @description Remove events from document.\r\n     * When created as an Iframe, the event of the document inside the Iframe is also removed.\r\n     * @param {String} type Event type\r\n     * @param {Function} listener Event listener\r\n     */\n    removeDocEvent: function (type, listener) {\n      _d.removeEventListener(type, listener);\n\n      if (options.iframe) {\n        this._wd.removeEventListener(type, listener);\n      }\n    },\n\n    /**\r\n     * @description The current number of characters is counted and displayed.\r\n     * @param {String} inputText Text added.\r\n     * @returns {Boolean}\r\n     * @private\r\n     */\n    _charCount: function (inputText) {\n      const maxCharCount = options.maxCharCount;\n      const countType = options.charCounterType;\n      let nextCharCount = 0;\n      if (!!inputText) nextCharCount = this.getCharLength(inputText, countType);\n\n      this._setCharCount();\n\n      if (maxCharCount > 0) {\n        let over = false;\n        const count = functions.getCharCount(countType);\n\n        if (count > maxCharCount) {\n          over = true;\n\n          if (nextCharCount > 0) {\n            this._editorRange();\n\n            const range = this.getRange();\n            const endOff = range.endOffset - 1;\n            const text = this.getSelectionNode().textContent;\n            const slicePosition = range.endOffset - (count - maxCharCount);\n            this.getSelectionNode().textContent = text.slice(0, slicePosition < 0 ? 0 : slicePosition) + text.slice(range.endOffset, text.length);\n            this.setRange(range.endContainer, endOff, range.endContainer, endOff);\n          }\n        } else if (count + nextCharCount > maxCharCount) {\n          over = true;\n        }\n\n        if (over) {\n          this._callCounterBlink();\n\n          if (nextCharCount > 0) return false;\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n     * @description When \"element\" is added, if it is greater than \"options.maxCharCount\", false is returned.\r\n     * @param {Node|String} element Element node or String.\r\n     * @param {String|null} charCounterType charCounterType. If it is null, the options.charCounterType\r\n     * @returns {Boolean}\r\n     */\n    checkCharCount: function (element, charCounterType) {\n      if (options.maxCharCount) {\n        const countType = charCounterType || options.charCounterType;\n        const length = this.getCharLength(typeof element === 'string' ? element : this._charTypeHTML && element.nodeType === 1 ? element.outerHTML : element.textContent, countType);\n\n        if (length > 0 && length + functions.getCharCount(countType) > options.maxCharCount) {\n          this._callCounterBlink();\n\n          return false;\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n     * @description Get the length of the content.\r\n     * Depending on the option, the length of the character is taken. (charCounterType)\r\n     * @param {String} content Content to count\r\n     * @param {String} charCounterType options.charCounterType\r\n     * @returns {Number}\r\n     */\n    getCharLength: function (content, charCounterType) {\n      return /byte/.test(charCounterType) ? util.getByteLength(content) : content.length;\n    },\n\n    /**\r\n     * @description Set the char count to charCounter element textContent.\r\n     * @private\r\n     */\n    _setCharCount: function () {\n      if (context.element.charCounter) {\n        _w.setTimeout(function () {\n          context.element.charCounter.textContent = functions.getCharCount(options.charCounterType);\n        });\n      }\n    },\n\n    /**\r\n     * @description The character counter blinks.\r\n     * @private\r\n     */\n    _callCounterBlink: function () {\n      const charWrapper = context.element.charWrapper;\n\n      if (charWrapper && !util.hasClass(charWrapper, 'se-blink')) {\n        util.addClass(charWrapper, 'se-blink');\n\n        _w.setTimeout(function () {\n          util.removeClass(charWrapper, 'se-blink');\n        }, 600);\n      }\n    },\n\n    /**\r\n     * @description Check the components such as image and video and modify them according to the format.\r\n     * @private\r\n     */\n    _checkComponents: function () {\n      for (let i = 0, len = this._fileInfoPluginsCheck.length; i < len; i++) {\n        this._fileInfoPluginsCheck[i]();\n      }\n    },\n\n    /**\r\n     * @description Initialize the information of the components.\r\n     * @private\r\n     */\n    _resetComponents: function () {\n      for (let i = 0, len = this._fileInfoPluginsReset.length; i < len; i++) {\n        this._fileInfoPluginsReset[i]();\n      }\n    },\n\n    /**\r\n     * @description Set method in the code view area\r\n     * @param {String} value HTML string\r\n     * @private\r\n     */\n    _setCodeView: function (value) {\n      if (options.codeMirrorEditor) {\n        options.codeMirrorEditor.getDoc().setValue(value);\n      } else {\n        context.element.code.value = value;\n      }\n    },\n\n    /**\r\n     * @description Get method in the code view area\r\n     * @private\r\n     */\n    _getCodeView: function () {\n      return options.codeMirrorEditor ? options.codeMirrorEditor.getDoc().getValue() : context.element.code.value;\n    },\n\n    /**\r\n     * @description Initializ core variable\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _init: function (reload, _initHTML) {\n      const wRegExp = _w.RegExp;\n      this._ww = options.iframe ? context.element.wysiwygFrame.contentWindow : _w;\n      this._wd = _d;\n      this._charTypeHTML = options.charCounterType === 'byte-html';\n\n      if (!options.iframe && typeof _w.ShadowRoot === 'function') {\n        let child = context.element.wysiwygFrame;\n\n        while (child) {\n          if (child.shadowRoot) {\n            this._shadowRoot = child.shadowRoot;\n            break;\n          } else if (child instanceof _w.ShadowRoot) {\n            this._shadowRoot = child;\n            break;\n          }\n\n          child = child.parentNode;\n        }\n\n        if (this._shadowRoot) this._shadowRootControllerEventTarget = [];\n      } // set disallow text nodes\n\n\n      const disallowTextTags = _w.Object.keys(options._textTagsMap);\n\n      const allowTextTags = !options.addTagsWhitelist ? [] : options.addTagsWhitelist.split('|').filter(function (v) {\n        return /b|i|ins|s|strike/i.test(v);\n      });\n\n      for (let i = 0; i < allowTextTags.length; i++) {\n        disallowTextTags.splice(disallowTextTags.indexOf(allowTextTags[i].toLowerCase()), 1);\n      }\n\n      this._disallowedTextTagsRegExp = disallowTextTags.length === 0 ? null : new wRegExp('(<\\\\/?)(' + disallowTextTags.join('|') + ')\\\\b\\\\s*(?:[^>^<]+)?\\\\s*(?=>)', 'gi'); // set whitelist\n\n      const defaultAttr = 'contenteditable|id|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|origin-size|data-exp|data-font-size';\n      this._allowHTMLComments = options._editorTagsWhitelist.indexOf('//') > -1;\n      this._htmlCheckWhitelistRegExp = new wRegExp('^(' + options._editorTagsWhitelist.replace('|//', '') + ')$', 'i');\n      this.editorTagsWhitelistRegExp = util.createTagsWhitelist(options._editorTagsWhitelist.replace('|//', '|<!--|-->'));\n      this.pasteTagsWhitelistRegExp = util.createTagsWhitelist(options.pasteTagsWhitelist);\n      const regEndStr = '\\\\s*=\\\\s*(\\\")[^\\\"]*\\\\1';\n      const _attr = options.attributesWhitelist;\n      const tagsAttr = {};\n      let allAttr = '';\n\n      if (!!_attr) {\n        for (let k in _attr) {\n          if (!util.hasOwn(_attr, k)) continue;\n\n          if (k === 'all') {\n            allAttr = _attr[k] + '|';\n          } else {\n            tagsAttr[k] = new wRegExp('(?:' + _attr[k] + '|' + defaultAttr + ')' + regEndStr, 'ig');\n          }\n        }\n      }\n\n      this._attributesWhitelistRegExp = new wRegExp('(?:' + allAttr + defaultAttr + ')' + regEndStr, 'ig');\n      this._attributesTagsWhitelist = tagsAttr; // set modes\n\n      this._isInline = /inline/i.test(options.mode);\n      this._isBalloon = /balloon|balloon-always/i.test(options.mode);\n      this._isBalloonAlways = /balloon-always/i.test(options.mode); // caching buttons\n\n      this._cachingButtons(); // file components\n\n\n      this._fileInfoPluginsCheck = [];\n      this._fileInfoPluginsReset = []; // text components\n\n      this.managedTagsInfo = {\n        query: '',\n        map: {}\n      };\n      const managedClass = []; // Command and file plugins registration\n\n      this.activePlugins = [];\n      this._fileManager.tags = [];\n      this._fileManager.pluginMap = {};\n      let filePluginRegExp = [];\n      let plugin, button;\n\n      for (let key in plugins) {\n        if (!util.hasOwn(plugins, key)) continue;\n        plugin = plugins[key];\n        button = pluginCallButtons[key];\n\n        if (plugin.active && button) {\n          this.callPlugin(key, null, button);\n        }\n\n        if (typeof plugin.checkFileInfo === 'function' && typeof plugin.resetFileInfo === 'function') {\n          this.callPlugin(key, null, button);\n\n          this._fileInfoPluginsCheck.push(plugin.checkFileInfo.bind(this));\n\n          this._fileInfoPluginsReset.push(plugin.resetFileInfo.bind(this));\n        }\n\n        if (_w.Array.isArray(plugin.fileTags)) {\n          const fileTags = plugin.fileTags;\n          this.callPlugin(key, null, button);\n          this._fileManager.tags = this._fileManager.tags.concat(fileTags);\n          filePluginRegExp.push(key);\n\n          for (let tag = 0, tLen = fileTags.length; tag < tLen; tag++) {\n            this._fileManager.pluginMap[fileTags[tag].toLowerCase()] = key;\n          }\n        }\n\n        if (plugin.managedTags) {\n          const info = plugin.managedTags();\n          managedClass.push('.' + info.className);\n          this.managedTagsInfo.map[info.className] = info.method.bind(this);\n        }\n      }\n\n      this.managedTagsInfo.query = managedClass.toString();\n      this._fileManager.queryString = this._fileManager.tags.join(',');\n      this._fileManager.regExp = new wRegExp('^(' + this._fileManager.tags.join('|') + ')$', 'i');\n      this._fileManager.pluginRegExp = new wRegExp('^(' + (filePluginRegExp.length === 0 ? 'undefined' : filePluginRegExp.join('|')) + ')$', 'i'); // cache editor's element\n\n      this._variable._originCssText = context.element.topArea.style.cssText;\n      this._placeholder = context.element.placeholder;\n      this._lineBreaker = context.element.lineBreaker;\n      this._lineBreakerButton = this._lineBreaker.querySelector('button'); // Excute history function\n\n      this.history = _history(this, this._onChange_historyStack.bind(this)); // register notice module\n\n      this.addModule([_notice]); // Init, validate\n\n      if (options.iframe) {\n        this._wd = context.element.wysiwygFrame.contentDocument;\n        context.element.wysiwyg = this._wd.body;\n        if (options._editorStyles.editor) context.element.wysiwyg.style.cssText = options._editorStyles.editor;\n        if (options.height === 'auto') this._iframeAuto = this._wd.body;\n      }\n\n      this._initWysiwygArea(reload, _initHTML);\n    },\n\n    /**\r\n     * @description Caching basic buttons to use\r\n     * @private\r\n     */\n    _cachingButtons: function () {\n      _w.setTimeout(function () {\n        this.codeViewDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-code-view-enabled\"])');\n        this.resizingDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-resizing-enabled\"]):not([data-display=\"MORE\"])');\n      }.bind(this));\n\n      const tool = context.tool;\n      this.commandMap = {\n        SUB: tool.subscript,\n        SUP: tool.superscript,\n        OUTDENT: tool.outdent,\n        INDENT: tool.indent\n      };\n      this.commandMap[options.textTags.bold.toUpperCase()] = tool.bold;\n      this.commandMap[options.textTags.underline.toUpperCase()] = tool.underline;\n      this.commandMap[options.textTags.italic.toUpperCase()] = tool.italic;\n      this.commandMap[options.textTags.strike.toUpperCase()] = tool.strike;\n      this._styleCommandMap = {\n        fullScreen: tool.fullScreen,\n        showBlocks: tool.showBlocks,\n        codeView: tool.codeView\n      };\n    },\n\n    /**\r\n     * @description Initializ wysiwyg area (Only called from core._init)\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _initWysiwygArea: function (reload, _initHTML) {\n      context.element.wysiwyg.innerHTML = reload ? _initHTML : this.convertContentsForEditor(typeof _initHTML === 'string' ? _initHTML : context.element.originElement.value);\n    },\n\n    /**\r\n     * @description Called when there are changes to tags in the wysiwyg region.\r\n     * @private\r\n     */\n    _resourcesStateChange: function () {\n      this._iframeAutoHeight();\n\n      this._checkPlaceholder();\n    },\n\n    /**\r\n     * @description Called when after execute \"history.push\"\r\n     * @private\r\n     */\n    _onChange_historyStack: function () {\n      if (this.hasFocus) event._applyTagEffects();\n      this._variable.isChanged = true;\n      if (context.tool.save) context.tool.save.removeAttribute('disabled'); // user event\n\n      if (functions.onChange) functions.onChange(this.getContents(true), this);\n      if (context.element.toolbar.style.display === 'block') event._showToolbarBalloon();\n    },\n\n    /**\r\n     * @description Modify the height value of the iframe when the height of the iframe is automatic.\r\n     * @private\r\n     */\n    _iframeAutoHeight: function () {\n      if (this._iframeAuto) {\n        _w.setTimeout(function () {\n          context.element.wysiwygFrame.style.height = core._iframeAuto.offsetHeight + 'px';\n        });\n      }\n    },\n\n    /**\r\n     * @description Set display property when there is placeholder.\r\n     * @private\r\n     */\n    _checkPlaceholder: function () {\n      if (this._placeholder) {\n        if (this._variable.isCodeView) {\n          this._placeholder.style.display = 'none';\n          return;\n        }\n\n        const wysiwyg = context.element.wysiwyg;\n\n        if (!util.onlyZeroWidthSpace(wysiwyg.textContent) || wysiwyg.querySelector(util._allowedEmptyNodeList) || (wysiwyg.innerText.match(/\\n/g) || '').length > 1) {\n          this._placeholder.style.display = 'none';\n        } else {\n          this._placeholder.style.display = 'block';\n        }\n      }\n    },\n\n    /**\r\n     * @description If there is no default format, add a format and move \"selection\".\r\n     * @param {String|null} formatName Format tag name (default: 'P')\r\n     * @private\r\n     */\n    _setDefaultFormat: function (formatName) {\n      if (this._fileManager.pluginRegExp.test(this.currentControllerName)) return;\n      const range = this.getRange();\n      const commonCon = range.commonAncestorContainer;\n      const startCon = range.startContainer;\n      const rangeEl = util.getRangeFormatElement(commonCon, null);\n      let focusNode, offset, format;\n      const fileComponent = util.getParentElement(commonCon, util.isComponent);\n      if (fileComponent && !util.isTable(fileComponent)) return;\n      if ((util.isRangeFormatElement(startCon) || util.isWysiwygDiv(startCon)) && (util.isComponent(startCon.children[range.startOffset]) || util.isComponent(startCon.children[range.startOffset - 1]))) return;\n\n      if (rangeEl) {\n        format = util.createElement(formatName || options.defaultTag);\n        format.innerHTML = rangeEl.innerHTML;\n        if (format.childNodes.length === 0) format.innerHTML = util.zeroWidthSpace;\n        rangeEl.innerHTML = format.outerHTML;\n        format = rangeEl.firstChild;\n        focusNode = util.getEdgeChildNodes(format, null).sc;\n\n        if (!focusNode) {\n          focusNode = util.createTextNode(util.zeroWidthSpace);\n          format.insertBefore(focusNode, format.firstChild);\n        }\n\n        offset = focusNode.textContent.length;\n        this.setRange(focusNode, offset, focusNode, offset);\n        return;\n      }\n\n      if (util.isRangeFormatElement(commonCon) && commonCon.childNodes.length <= 1) {\n        let br = null;\n\n        if (commonCon.childNodes.length === 1 && util.isBreak(commonCon.firstChild)) {\n          br = commonCon.firstChild;\n        } else {\n          br = util.createTextNode(util.zeroWidthSpace);\n          commonCon.appendChild(br);\n        }\n\n        this.setRange(br, 1, br, 1);\n        return;\n      }\n\n      this.execCommand('formatBlock', false, formatName || options.defaultTag);\n      focusNode = util.getEdgeChildNodes(commonCon, commonCon);\n      focusNode = focusNode ? focusNode.ec : commonCon;\n      format = util.getFormatElement(focusNode, null);\n\n      if (!format) {\n        this.removeRange();\n\n        this._editorRange();\n\n        return;\n      }\n\n      if (util.isBreak(format.nextSibling)) util.removeItem(format.nextSibling);\n      if (util.isBreak(format.previousSibling)) util.removeItem(format.previousSibling);\n\n      if (util.isBreak(focusNode)) {\n        const zeroWidth = util.createTextNode(util.zeroWidthSpace);\n        focusNode.parentNode.insertBefore(zeroWidth, focusNode);\n        focusNode = zeroWidth;\n      }\n\n      this.effectNode = null;\n      this.nativeFocus();\n    },\n\n    /**\r\n     * @description Initialization after \"setOptions\"\r\n     * @param {Object} el context.element\r\n     * @param {String} _initHTML Initial html string\r\n     * @private\r\n     */\n    _setOptionsInit: function (el, _initHTML) {\n      this.context = context = _Context(el.originElement, this._getConstructed(el), options);\n      this._componentsInfoReset = true;\n\n      this._editorInit(true, _initHTML);\n    },\n\n    /**\r\n     * @description Initializ editor\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _editorInit: function (reload, _initHTML) {\n      // initialize core and add event listeners\n      this._init(reload, _initHTML);\n\n      event._addEvent();\n\n      this._setCharCount();\n\n      event._offStickyToolbar();\n\n      event.onResize_window(); // toolbar visibility\n\n      context.element.toolbar.style.visibility = '';\n\n      this._checkComponents();\n\n      this._componentsInfoInit = false;\n      this._componentsInfoReset = false;\n      this.history.reset(true);\n\n      this._resourcesStateChange();\n\n      _w.setTimeout(function () {\n        // user event\n        if (typeof functions.onload === 'function') functions.onload(core, reload);\n      });\n    },\n\n    /**\r\n     * @description Create and return an object to cache the new context.\r\n     * @param {Element} contextEl context.element\r\n     * @returns {Object}\r\n     * @private\r\n     */\n    _getConstructed: function (contextEl) {\n      return {\n        _top: contextEl.topArea,\n        _relative: contextEl.relative,\n        _toolBar: contextEl.toolbar,\n        _menuTray: contextEl._menuTray,\n        _editorArea: contextEl.editorArea,\n        _wysiwygArea: contextEl.wysiwygFrame,\n        _codeArea: contextEl.code,\n        _placeholder: contextEl.placeholder,\n        _resizingBar: contextEl.resizingBar,\n        _navigation: contextEl.navigation,\n        _charCounter: contextEl.charCounter,\n        _charWrapper: contextEl.charWrapper,\n        _loading: contextEl.loading,\n        _lineBreaker: contextEl.lineBreaker,\n        _lineBreaker_t: contextEl.lineBreaker_t,\n        _lineBreaker_b: contextEl.lineBreaker_b,\n        _resizeBack: contextEl.resizeBackground,\n        _stickyDummy: contextEl._stickyDummy,\n        _arrow: contextEl._arrow\n      };\n    }\n  };\n  /**\r\n   * @description event function\r\n   */\n\n  const event = {\n    _IEisComposing: false,\n    // In IE, there is no \"e.isComposing\" in the key-up event.\n    _lineBreakerBind: null,\n    _responsiveCurrentSize: 'default',\n    _responsiveButtonSize: null,\n    _responsiveButtons: null,\n    _directionKeyCode: new _w.RegExp('^(8|13|3[2-9]|40|46)$'),\n    _nonTextKeyCode: new _w.RegExp('^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$'),\n    _historyIgnoreKeyCode: new _w.RegExp('^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$'),\n    _onButtonsCheck: new _w.RegExp('^(' + _w.Object.keys(options._textTagsMap).join('|') + ')$', 'i'),\n    _frontZeroWidthReg: new _w.RegExp(util.zeroWidthSpace + '+', ''),\n    _keyCodeShortcut: {\n      65: 'A',\n      66: 'B',\n      83: 'S',\n      85: 'U',\n      73: 'I',\n      89: 'Y',\n      90: 'Z',\n      219: '[',\n      221: ']'\n    },\n    _shortcutCommand: function (keyCode, shift) {\n      let command = null;\n      const keyStr = event._keyCodeShortcut[keyCode];\n\n      switch (keyStr) {\n        case 'A':\n          command = 'selectAll';\n          break;\n\n        case 'B':\n          if (options.shortcutsDisable.indexOf('bold') === -1) {\n            command = 'bold';\n          }\n\n          break;\n\n        case 'S':\n          if (shift && options.shortcutsDisable.indexOf('strike') === -1) {\n            command = 'strike';\n          } else if (!shift && options.shortcutsDisable.indexOf('save') === -1) {\n            command = 'save';\n          }\n\n          break;\n\n        case 'U':\n          if (options.shortcutsDisable.indexOf('underline') === -1) {\n            command = 'underline';\n          }\n\n          break;\n\n        case 'I':\n          if (options.shortcutsDisable.indexOf('italic') === -1) {\n            command = 'italic';\n          }\n\n          break;\n\n        case 'Z':\n          if (options.shortcutsDisable.indexOf('undo') === -1) {\n            if (shift) {\n              command = 'redo';\n            } else {\n              command = 'undo';\n            }\n          }\n\n          break;\n\n        case 'Y':\n          if (options.shortcutsDisable.indexOf('undo') === -1) {\n            command = 'redo';\n          }\n\n          break;\n\n        case '[':\n          if (options.shortcutsDisable.indexOf('indent') === -1) {\n            command = options.rtl ? 'indent' : 'outdent';\n          }\n\n          break;\n\n        case ']':\n          if (options.shortcutsDisable.indexOf('indent') === -1) {\n            command = options.rtl ? 'outdent' : 'indent';\n          }\n\n          break;\n      }\n\n      if (!command) return false;\n      core.commandHandler(core.commandMap[command], command);\n      return true;\n    },\n    _applyTagEffects: function () {\n      let selectionNode = core.getSelectionNode();\n      if (selectionNode === core.effectNode) return;\n      core.effectNode = selectionNode;\n      const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\n      const commandMap = core.commandMap;\n      const classOnCheck = this._onButtonsCheck;\n      const commandMapNodes = [];\n      const currentNodes = [];\n      const activePlugins = core.activePlugins;\n      const cLen = activePlugins.length;\n      let nodeName = '';\n\n      while (selectionNode.firstChild) {\n        selectionNode = selectionNode.firstChild;\n      }\n\n      for (let element = selectionNode; !util.isWysiwygDiv(element); element = element.parentNode) {\n        if (!element) break;\n        if (element.nodeType !== 1 || util.isBreak(element)) continue;\n        nodeName = element.nodeName.toUpperCase();\n        currentNodes.push(nodeName);\n        /* Active plugins */\n\n        for (let c = 0, name; c < cLen; c++) {\n          name = activePlugins[c];\n\n          if (commandMapNodes.indexOf(name) === -1 && plugins[name].active.call(core, element)) {\n            commandMapNodes.push(name);\n          }\n        }\n\n        if (util.isFormatElement(element)) {\n          /* Outdent */\n          if (commandMapNodes.indexOf('OUTDENT') === -1 && commandMap.OUTDENT) {\n            if (util.isListCell(element) || element.style[marginDir] && util.getNumber(element.style[marginDir], 0) > 0) {\n              commandMapNodes.push('OUTDENT');\n              commandMap.OUTDENT.removeAttribute('disabled');\n            }\n          }\n          /* Indent */\n\n\n          if (commandMapNodes.indexOf('INDENT') === -1 && commandMap.INDENT) {\n            commandMapNodes.push('INDENT');\n\n            if (util.isListCell(element) && !element.previousElementSibling) {\n              commandMap.INDENT.setAttribute('disabled', true);\n            } else {\n              commandMap.INDENT.removeAttribute('disabled');\n            }\n          }\n\n          continue;\n        }\n        /** default active buttons [strong, ins, em, del, sub, sup] */\n\n\n        if (classOnCheck.test(nodeName)) {\n          commandMapNodes.push(nodeName);\n          util.addClass(commandMap[nodeName], 'active');\n        }\n      }\n      /** remove class, display text */\n\n\n      for (let key in commandMap) {\n        if (commandMapNodes.indexOf(key) > -1 || !util.hasOwn(commandMap, key)) continue;\n\n        if (activePlugins.indexOf(key) > -1) {\n          plugins[key].active.call(core, null);\n        } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\n          commandMap.OUTDENT.setAttribute('disabled', true);\n        } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\n          commandMap.INDENT.removeAttribute('disabled');\n        } else {\n          util.removeClass(commandMap[key], 'active');\n        }\n      }\n      /** save current nodes */\n\n\n      core._variable.currentNodes = currentNodes.reverse();\n      core._variable.currentNodesMap = commandMapNodes;\n      /**  Displays the current node structure to resizingBar */\n\n      if (options.showPathLabel) context.element.navigation.textContent = core._variable.currentNodes.join(' > ');\n    },\n    _cancelCaptionEdit: function () {\n      this.setAttribute('contenteditable', false);\n      this.removeEventListener('blur', event._cancelCaptionEdit);\n    },\n    _buttonsEventHandler: function (e) {\n      let target = e.target;\n      if (core._bindControllersOff) e.stopPropagation();\n\n      if (/^(input|textarea|select|option)$/i.test(target.nodeName)) {\n        core._antiBlur = false;\n      } else {\n        e.preventDefault();\n      }\n\n      if (util.getParentElement(target, '.se-submenu')) {\n        e.stopPropagation();\n        core._notHideToolbar = true;\n      } else {\n        let command = target.getAttribute('data-command');\n        let className = target.className;\n\n        while (!command && !/se-menu-list/.test(className) && !/sun-editor-common/.test(className)) {\n          target = target.parentNode;\n          command = target.getAttribute('data-command');\n          className = target.className;\n        }\n\n        if (command === core._submenuName || command === core._containerName) {\n          e.stopPropagation();\n        }\n      }\n    },\n    onClick_toolbar: function (e) {\n      let target = e.target;\n      let display = target.getAttribute('data-display');\n      let command = target.getAttribute('data-command');\n      let className = target.className;\n      core.controllersOff();\n\n      while (target.parentNode && !command && !/se-menu-list/.test(className) && !/se-toolbar/.test(className)) {\n        target = target.parentNode;\n        command = target.getAttribute('data-command');\n        display = target.getAttribute('data-display');\n        className = target.className;\n      }\n\n      if (!command && !display) return;\n      if (target.disabled) return;\n      if (!core.hasFocus) core.nativeFocus();\n      if (!core._variable.isCodeView) core._editorRange();\n      core.actionCall(command, display, target);\n    },\n    onMouseDown_wysiwyg: function (e) {\n      if (util.isNonEditable(context.element.wysiwyg)) return; // user event\n\n      if (typeof functions.onMouseDown === 'function' && functions.onMouseDown(e, core) === false) return;\n      const tableCell = util.getParentElement(e.target, util.isCell);\n\n      if (tableCell) {\n        const tablePlugin = core.plugins.table;\n\n        if (tablePlugin && tableCell !== tablePlugin._fixedCell && !tablePlugin._shift) {\n          core.callPlugin('table', function () {\n            tablePlugin.onTableCellMultiSelect.call(core, tableCell, false);\n          }, null);\n        }\n      }\n\n      if (core._isBalloon) {\n        event._hideToolbar();\n      }\n\n      if (/FIGURE/i.test(e.target.nodeName)) e.preventDefault();\n    },\n    onClick_wysiwyg: function (e) {\n      const targetElement = e.target;\n      if (util.isNonEditable(context.element.wysiwyg)) return; // user event\n\n      if (typeof functions.onClick === 'function' && functions.onClick(e, core) === false) return;\n      const fileComponentInfo = core.getFileComponent(targetElement);\n\n      if (fileComponentInfo) {\n        e.preventDefault();\n        core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n        return;\n      }\n\n      const figcaption = util.getParentElement(targetElement, 'FIGCAPTION');\n\n      if (util.isNonEditable(figcaption)) {\n        e.preventDefault();\n        figcaption.setAttribute('contenteditable', true);\n        figcaption.focus();\n\n        if (core._isInline && !core._inlineToolbarAttr.isShow) {\n          event._showToolbarInline();\n\n          const hideToolbar = function () {\n            event._hideToolbar();\n\n            figcaption.removeEventListener('blur', hideToolbar);\n          };\n\n          figcaption.addEventListener('blur', hideToolbar);\n        }\n      }\n\n      _w.setTimeout(core._editorRange.bind(core));\n\n      core._editorRange();\n\n      const selectionNode = core.getSelectionNode();\n      const formatEl = util.getFormatElement(selectionNode, null);\n      const rangeEl = util.getRangeFormatElement(selectionNode, null);\n\n      if ((!formatEl || formatEl === rangeEl) && !util.isNonEditable(targetElement) && !util.isList(rangeEl)) {\n        const range = core.getRange();\n\n        if (util.getFormatElement(range.startContainer) === util.getFormatElement(range.endContainer)) {\n          if (util.isList(rangeEl)) {\n            e.preventDefault();\n            const oLi = util.createElement('LI');\n            const prevLi = selectionNode.nextElementSibling;\n            oLi.appendChild(selectionNode);\n            rangeEl.insertBefore(oLi, prevLi);\n            core.focus();\n          } else if (!util.isWysiwygDiv(selectionNode) && !util.isComponent(selectionNode) && (!util.isTable(selectionNode) || util.isCell(selectionNode))) {\n            e.preventDefault();\n\n            core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag);\n\n            core.focus();\n          } else {\n            event._applyTagEffects();\n          }\n        }\n      } else {\n        event._applyTagEffects();\n      }\n\n      if (core._isBalloon) _w.setTimeout(event._toggleToolbarBalloon);\n    },\n    _balloonDelay: null,\n    _showToolbarBalloonDelay: function () {\n      if (event._balloonDelay) {\n        _w.clearTimeout(event._balloonDelay);\n      }\n\n      event._balloonDelay = _w.setTimeout(function () {\n        _w.clearTimeout(this._balloonDelay);\n\n        this._balloonDelay = null;\n\n        this._showToolbarBalloon();\n      }.bind(event), 350);\n    },\n    _toggleToolbarBalloon: function () {\n      core._editorRange();\n\n      const range = core.getRange();\n      if (core._bindControllersOff || !core._isBalloonAlways && range.collapsed) event._hideToolbar();else event._showToolbarBalloon(range);\n    },\n    _showToolbarBalloon: function (rangeObj) {\n      if (!core._isBalloon) return;\n      const range = rangeObj || core.getRange();\n      const toolbar = context.element.toolbar;\n      const topArea = context.element.topArea;\n      const selection = core.getSelection();\n      let isDirTop;\n\n      if (core._isBalloonAlways && range.collapsed) {\n        isDirTop = true;\n      } else if (selection.focusNode === selection.anchorNode) {\n        isDirTop = selection.focusOffset < selection.anchorOffset;\n      } else {\n        const childNodes = util.getListChildNodes(range.commonAncestorContainer, null);\n        isDirTop = util.getArrayIndex(childNodes, selection.focusNode) < util.getArrayIndex(childNodes, selection.anchorNode);\n      }\n\n      let rects = range.getClientRects();\n      rects = rects[isDirTop ? 0 : rects.length - 1];\n      const globalScroll = core.getGlobalScrollOffset();\n      let scrollLeft = globalScroll.left;\n      let scrollTop = globalScroll.top;\n      const editorWidth = topArea.offsetWidth;\n\n      const offsets = event._getEditorOffsets(null);\n\n      const stickyTop = offsets.top;\n      const editorLeft = offsets.left;\n      toolbar.style.top = '-10000px';\n      toolbar.style.visibility = 'hidden';\n      toolbar.style.display = 'block';\n\n      if (!rects) {\n        const node = core.getSelectionNode();\n\n        if (util.isFormatElement(node)) {\n          const zeroWidth = util.createTextNode(util.zeroWidthSpace);\n          core.insertNode(zeroWidth, null, false);\n          core.setRange(zeroWidth, 1, zeroWidth, 1);\n\n          core._editorRange();\n\n          rects = core.getRange().getClientRects();\n          rects = rects[isDirTop ? 0 : rects.length - 1];\n        }\n\n        if (!rects) {\n          const nodeOffset = util.getOffset(node, context.element.wysiwygFrame);\n          rects = {\n            left: nodeOffset.left,\n            top: nodeOffset.top,\n            right: nodeOffset.left,\n            bottom: nodeOffset.top + node.offsetHeight,\n            noText: true\n          };\n          scrollLeft = 0;\n          scrollTop = 0;\n        }\n\n        isDirTop = true;\n      }\n\n      const arrowMargin = _w.Math.round(context.element._arrow.offsetWidth / 2);\n\n      const toolbarWidth = toolbar.offsetWidth;\n      const toolbarHeight = toolbar.offsetHeight;\n      const iframeRects = /iframe/i.test(context.element.wysiwygFrame.nodeName) ? context.element.wysiwygFrame.getClientRects()[0] : null;\n\n      if (iframeRects) {\n        rects = {\n          left: rects.left + iframeRects.left,\n          top: rects.top + iframeRects.top,\n          right: rects.right + iframeRects.right - iframeRects.width,\n          bottom: rects.bottom + iframeRects.bottom - iframeRects.height\n        };\n      }\n\n      event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\n\n      if (toolbarWidth !== toolbar.offsetWidth || toolbarHeight !== toolbar.offsetHeight) {\n        event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\n      }\n\n      if (options.toolbarContainer) {\n        const editorParent = topArea.parentElement;\n        let container = options.toolbarContainer;\n        let left = container.offsetLeft;\n        let top = container.offsetTop;\n\n        while (!container.parentElement.contains(editorParent) || !/^(BODY|HTML)$/i.test(container.parentElement.nodeName)) {\n          container = container.offsetParent;\n          left += container.offsetLeft;\n          top += container.offsetTop;\n        }\n\n        toolbar.style.left = toolbar.offsetLeft - left + topArea.offsetLeft + 'px';\n        toolbar.style.top = toolbar.offsetTop - top + topArea.offsetTop + 'px';\n      }\n\n      toolbar.style.visibility = '';\n    },\n    _setToolbarOffset: function (isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin) {\n      const padding = 1;\n      const toolbarWidth = toolbar.offsetWidth;\n      const toolbarHeight = rects.noText && !isDirTop ? 0 : toolbar.offsetHeight;\n      const absoluteLeft = (isDirTop ? rects.left : rects.right) - editorLeft - toolbarWidth / 2 + scrollLeft;\n      const overRight = absoluteLeft + toolbarWidth - editorWidth;\n      let t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\n      let l = absoluteLeft < 0 ? padding : overRight < 0 ? absoluteLeft : absoluteLeft - overRight - padding - 1;\n      let resetTop = false;\n      const space = t + (isDirTop ? event._getEditorOffsets(null).top : toolbar.offsetHeight - context.element.wysiwyg.offsetHeight);\n\n      if (!isDirTop && space > 0 && event._getPageBottomSpace() < space) {\n        isDirTop = true;\n        resetTop = true;\n      } else if (isDirTop && _d.documentElement.offsetTop > space) {\n        isDirTop = false;\n        resetTop = true;\n      }\n\n      if (resetTop) t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\n      toolbar.style.left = _w.Math.floor(l) + 'px';\n      toolbar.style.top = _w.Math.floor(t) + 'px';\n\n      if (isDirTop) {\n        util.removeClass(context.element._arrow, 'se-arrow-up');\n        util.addClass(context.element._arrow, 'se-arrow-down');\n        context.element._arrow.style.top = toolbarHeight + 'px';\n      } else {\n        util.removeClass(context.element._arrow, 'se-arrow-down');\n        util.addClass(context.element._arrow, 'se-arrow-up');\n        context.element._arrow.style.top = -arrowMargin + 'px';\n      }\n\n      const arrow_left = _w.Math.floor(toolbarWidth / 2 + (absoluteLeft - l));\n\n      context.element._arrow.style.left = (arrow_left + arrowMargin > toolbar.offsetWidth ? toolbar.offsetWidth - arrowMargin : arrow_left < arrowMargin ? arrowMargin : arrow_left) + 'px';\n    },\n    _showToolbarInline: function () {\n      if (!core._isInline) return;\n      const toolbar = context.element.toolbar;\n      if (options.toolbarContainer) toolbar.style.position = 'relative';else toolbar.style.position = 'absolute';\n      toolbar.style.visibility = 'hidden';\n      toolbar.style.display = 'block';\n      core._inlineToolbarAttr.width = toolbar.style.width = options.toolbarWidth;\n      core._inlineToolbarAttr.top = toolbar.style.top = (options.toolbarContainer ? 0 : -1 - toolbar.offsetHeight) + 'px';\n      if (typeof functions.showInline === 'function') functions.showInline(toolbar, context, core);\n      event.onScroll_window();\n      core._inlineToolbarAttr.isShow = true;\n      toolbar.style.visibility = '';\n    },\n    _hideToolbar: function () {\n      if (!core._notHideToolbar && !core._variable.isFullScreen) {\n        context.element.toolbar.style.display = 'none';\n        core._inlineToolbarAttr.isShow = false;\n      }\n    },\n    onInput_wysiwyg: function (e) {\n      core._editorRange(); // user event\n\n\n      if (typeof functions.onInput === 'function' && functions.onInput(e, core) === false) return;\n      const data = (e.data === null ? '' : e.data === undefined ? ' ' : e.data) || '';\n\n      if (!core._charCount(data)) {\n        e.preventDefault();\n        e.stopPropagation();\n      } // history stack\n\n\n      core.history.push(true);\n    },\n    _isUneditableNode: function (range, isFront) {\n      const container = isFront ? range.startContainer : range.endContainer;\n      const offset = isFront ? range.startOffset : range.endOffset;\n      const siblingKey = isFront ? 'previousSibling' : 'nextSibling';\n      const isElement = container.nodeType === 1;\n      let siblingNode;\n\n      if (isElement) {\n        siblingNode = event._isUneditableNode_getSibling(container.childNodes[offset], siblingKey, container);\n        return siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\n      } else {\n        siblingNode = event._isUneditableNode_getSibling(container, siblingKey, container);\n        return core.isEdgePoint(container, offset, isFront ? 'front' : 'end') && siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\n      }\n    },\n    _isUneditableNode_getSibling: function (selectNode, siblingKey, container) {\n      if (!selectNode) return null;\n      let siblingNode = selectNode[siblingKey];\n\n      if (!siblingNode) {\n        siblingNode = util.getFormatElement(container);\n        siblingNode = siblingNode ? siblingNode[siblingKey] : null;\n        if (siblingNode && !util.isComponent(siblingNode)) siblingNode = siblingKey === 'previousSibling' ? siblingNode.firstElementChild : siblingNode.lastElementChild;else return null;\n      }\n\n      return siblingNode;\n    },\n    _onShortcutKey: false,\n    onKeyDown_wysiwyg: function (e) {\n      const keyCode = e.keyCode;\n      const shift = e.shiftKey;\n      const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\n      const alt = e.altKey;\n      event._IEisComposing = keyCode === 229;\n      core.submenuOff();\n\n      if (core._isBalloon) {\n        event._hideToolbar();\n      } // user event\n\n\n      if (typeof functions.onKeyDown === 'function' && functions.onKeyDown(e, core) === false) return;\n      /** Shortcuts */\n\n      if (ctrl && event._shortcutCommand(keyCode, shift)) {\n        event._onShortcutKey = true;\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      } else if (event._onShortcutKey) {\n        event._onShortcutKey = false;\n      }\n      /** default key action */\n\n\n      let selectionNode = core.getSelectionNode();\n      const range = core.getRange();\n      const selectRange = !range.collapsed || range.startContainer !== range.endContainer;\n      const fileComponentName = core._fileManager.pluginRegExp.test(core.currentControllerName) ? core.currentControllerName : '';\n      let formatEl = util.getFormatElement(selectionNode, null) || selectionNode;\n      let rangeEl = util.getRangeFormatElement(formatEl, null);\n\n      switch (keyCode) {\n        case 8:\n          /** backspace key */\n          if (!selectRange) {\n            if (fileComponentName) {\n              e.preventDefault();\n              e.stopPropagation();\n              core.plugins[fileComponentName].destroy.call(core);\n              break;\n            }\n          }\n\n          if (selectRange && event._hardDelete()) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          }\n\n          if (!util.isFormatElement(formatEl) && !context.element.wysiwyg.firstElementChild && !util.isComponent(selectionNode)) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            core._setDefaultFormat(options.defaultTag);\n\n            return false;\n          }\n\n          if (!selectRange && !formatEl.previousElementSibling && range.startOffset === 0 && !selectionNode.previousSibling && !util.isListCell(formatEl) && util.isFormatElement(formatEl) && (!util.isFreeFormatElement(formatEl) || util.isClosureFreeFormatElement(formatEl))) {\n            // closure range\n            if (util.isClosureRangeFormatElement(formatEl.parentNode)) {\n              e.preventDefault();\n              e.stopPropagation();\n              return false;\n            } // maintain default format\n\n\n            if (util.isWysiwygDiv(formatEl.parentNode) && formatEl.childNodes.length <= 1 && (!formatEl.firstChild || util.onlyZeroWidthSpace(formatEl.textContent))) {\n              e.preventDefault();\n              e.stopPropagation();\n\n              if (formatEl.nodeName.toUpperCase() === options.defaultTag.toUpperCase()) {\n                formatEl.innerHTML = '<br>';\n                const attrs = formatEl.attributes;\n\n                while (attrs[0]) {\n                  formatEl.removeAttribute(attrs[0].name);\n                }\n              } else {\n                const defaultFormat = util.createElement(options.defaultTag);\n                defaultFormat.innerHTML = '<br>';\n                formatEl.parentElement.replaceChild(defaultFormat, formatEl);\n              }\n\n              core.nativeFocus();\n              return false;\n            }\n          } // clean remove tag\n\n\n          if (formatEl && range.startContainer === range.endContainer && selectionNode.nodeType === 3 && !util.isFormatElement(selectionNode.parentNode)) {\n            if (range.collapsed ? selectionNode.textContent.length === 1 : range.endOffset - range.startOffset === selectionNode.textContent.length) {\n              e.preventDefault();\n              let offset = null;\n              let prev = selectionNode.parentNode.previousSibling;\n              const next = selectionNode.parentNode.nextSibling;\n\n              if (!prev) {\n                if (!next) {\n                  prev = util.createElement('BR');\n                  formatEl.appendChild(prev);\n                } else {\n                  prev = next;\n                  offset = 0;\n                }\n              }\n\n              selectionNode.textContent = '';\n              util.removeItemAllParents(selectionNode, null, formatEl);\n              offset = typeof offset === 'number' ? offset : prev.nodeType === 3 ? prev.textContent.length : 1;\n              core.setRange(prev, offset, prev, offset);\n              break;\n            }\n          } // tag[contenteditable=\"false\"]\n\n\n          if (event._isUneditableNode(range, true)) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // nested list\n\n\n          const commonCon = range.commonAncestorContainer;\n          formatEl = util.getFormatElement(range.startContainer, null);\n          rangeEl = util.getRangeFormatElement(formatEl, null);\n\n          if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\n            if (util.isListCell(formatEl) && util.isList(rangeEl) && (util.isListCell(rangeEl.parentNode) || formatEl.previousElementSibling) && (selectionNode === formatEl || selectionNode.nodeType === 3 && (!selectionNode.previousSibling || util.isList(selectionNode.previousSibling))) && (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.startContainer) : range.startOffset === 0 && range.collapsed)) {\n              if (range.startContainer !== range.endContainer) {\n                e.preventDefault();\n                core.removeNode();\n\n                if (range.startContainer.nodeType === 3) {\n                  core.setRange(range.startContainer, range.startContainer.textContent.length, range.startContainer, range.startContainer.textContent.length);\n                } // history stack\n\n\n                core.history.push(true);\n              } else {\n                let prev = formatEl.previousElementSibling || rangeEl.parentNode;\n\n                if (util.isListCell(prev)) {\n                  e.preventDefault();\n                  let prevLast = prev;\n\n                  if (!prev.contains(formatEl) && util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\n                    prevLast = prevLast.lastElementChild.lastElementChild;\n\n                    while (util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\n                      prevLast = prevLast.lastElementChild && prevLast.lastElementChild.lastElementChild;\n                    }\n\n                    prev = prevLast;\n                  }\n\n                  let con = prev === rangeEl.parentNode ? rangeEl.previousSibling : prev.lastChild;\n\n                  if (!con) {\n                    con = util.createTextNode(util.zeroWidthSpace);\n                    rangeEl.parentNode.insertBefore(con, rangeEl.parentNode.firstChild);\n                  }\n\n                  const offset = con.nodeType === 3 ? con.textContent.length : 1;\n                  const children = formatEl.childNodes;\n                  let after = con;\n                  let child = children[0];\n\n                  while (child = children[0]) {\n                    prev.insertBefore(child, after.nextSibling);\n                    after = child;\n                  }\n\n                  util.removeItem(formatEl);\n                  if (rangeEl.children.length === 0) util.removeItem(rangeEl);\n                  core.setRange(con, offset, con, offset); // history stack\n\n                  core.history.push(true);\n                }\n              }\n\n              break;\n            } // detach range\n\n\n            if (!selectRange && range.startOffset === 0) {\n              let detach = true;\n              let comm = commonCon;\n\n              while (comm && comm !== rangeEl && !util.isWysiwygDiv(comm)) {\n                if (comm.previousSibling) {\n                  if (comm.previousSibling.nodeType === 1 || !util.onlyZeroWidthSpace(comm.previousSibling.textContent.trim())) {\n                    detach = false;\n                    break;\n                  }\n                }\n\n                comm = comm.parentNode;\n              }\n\n              if (detach && rangeEl.parentNode) {\n                e.preventDefault();\n                core.detachRangeFormatElement(rangeEl, util.isListCell(formatEl) ? [formatEl] : null, null, false, false); // history stack\n\n                core.history.push(true);\n                break;\n              }\n            }\n          } // component\n\n\n          if (!selectRange && formatEl && (range.startOffset === 0 || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\n            const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode;\n            const prev = formatEl.previousSibling; // select file component\n\n            const ignoreZWS = (commonCon.nodeType === 3 || util.isBreak(commonCon)) && !commonCon.previousSibling && range.startOffset === 0;\n\n            if (!sel.previousSibling && (util.isComponent(commonCon.previousSibling) || ignoreZWS && util.isComponent(prev))) {\n              const fileComponentInfo = core.getFileComponent(prev);\n\n              if (fileComponentInfo) {\n                e.preventDefault();\n                e.stopPropagation();\n                if (formatEl.textContent.length === 0) util.removeItem(formatEl);\n                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\n              } else if (util.isComponent(prev)) {\n                e.preventDefault();\n                e.stopPropagation();\n                util.removeItem(prev);\n              }\n\n              break;\n            } // delete nonEditable\n\n\n            if (util.isNonEditable(sel.previousSibling)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(sel.previousSibling);\n              break;\n            }\n          }\n\n          break;\n\n        case 46:\n          /** delete key */\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            core.plugins[fileComponentName].destroy.call(core);\n            break;\n          }\n\n          if (selectRange && event._hardDelete()) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // tag[contenteditable=\"false\"]\n\n\n          if (event._isUneditableNode(range, false)) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // component\n\n\n          if ((util.isFormatElement(selectionNode) || selectionNode.nextSibling === null || util.onlyZeroWidthSpace(selectionNode.nextSibling) && selectionNode.nextSibling.nextSibling === null) && range.startOffset === selectionNode.textContent.length) {\n            let nextEl = formatEl.nextElementSibling;\n\n            if (!nextEl) {\n              e.preventDefault();\n              break;\n            }\n\n            if (util.isComponent(nextEl)) {\n              e.preventDefault();\n\n              if (util.onlyZeroWidthSpace(formatEl)) {\n                util.removeItem(formatEl); // table component\n\n                if (util.isTable(nextEl)) {\n                  let cell = util.getChildElement(nextEl, util.isCell, false);\n                  cell = cell.firstElementChild || cell;\n                  core.setRange(cell, 0, cell, 0);\n                  break;\n                }\n              } // select file component\n\n\n              const fileComponentInfo = core.getFileComponent(nextEl);\n\n              if (fileComponentInfo) {\n                e.stopPropagation();\n                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\n              } else if (util.isComponent(nextEl)) {\n                e.stopPropagation();\n                util.removeItem(nextEl);\n              }\n\n              break;\n            }\n          }\n\n          if (!selectRange && (core.isEdgePoint(range.endContainer, range.endOffset) || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\n            const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode; // delete nonEditable\n\n            if (util.isNonEditable(sel.nextSibling)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(sel.nextSibling);\n              break;\n            }\n          } // nested list\n\n\n          formatEl = util.getFormatElement(range.startContainer, null);\n          rangeEl = util.getRangeFormatElement(formatEl, null);\n\n          if (util.isListCell(formatEl) && util.isList(rangeEl) && (selectionNode === formatEl || selectionNode.nodeType === 3 && (!selectionNode.nextSibling || util.isList(selectionNode.nextSibling)) && (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.endContainer) : range.endOffset === selectionNode.textContent.length && range.collapsed))) {\n            if (range.startContainer !== range.endContainer) core.removeNode();\n            let next = util.getArrayItem(formatEl.children, util.isList, false);\n            next = next || formatEl.nextElementSibling || rangeEl.parentNode.nextElementSibling;\n\n            if (next && (util.isList(next) || util.getArrayItem(next.children, util.isList, false))) {\n              e.preventDefault();\n              let con, children;\n\n              if (util.isList(next)) {\n                const child = next.firstElementChild;\n                children = child.childNodes;\n                con = children[0];\n\n                while (children[0]) {\n                  formatEl.insertBefore(children[0], next);\n                }\n\n                util.removeItem(child);\n              } else {\n                con = next.firstChild;\n                children = next.childNodes;\n\n                while (children[0]) {\n                  formatEl.appendChild(children[0]);\n                }\n\n                util.removeItem(next);\n              }\n\n              core.setRange(con, 0, con, 0); // history stack\n\n              core.history.push(true);\n            }\n\n            break;\n          }\n\n          break;\n\n        case 9:\n          /** tab key */\n          if (fileComponentName || options.tabDisable) break;\n          e.preventDefault();\n          if (ctrl || alt || util.isWysiwygDiv(selectionNode)) break;\n          const isEdge = !range.collapsed || core.isEdgePoint(range.startContainer, range.startOffset);\n          const selectedFormats = core.getSelectedElements(null);\n          selectionNode = core.getSelectionNode();\n          const cells = [];\n          let lines = [];\n          let fc = util.isListCell(selectedFormats[0]),\n              lc = util.isListCell(selectedFormats[selectedFormats.length - 1]);\n          let r = {\n            sc: range.startContainer,\n            so: range.startOffset,\n            ec: range.endContainer,\n            eo: range.endOffset\n          };\n\n          for (let i = 0, len = selectedFormats.length, f; i < len; i++) {\n            f = selectedFormats[i];\n\n            if (util.isListCell(f)) {\n              if (!f.previousElementSibling && !shift) {\n                continue;\n              } else {\n                cells.push(f);\n              }\n            } else {\n              lines.push(f);\n            }\n          } // Nested list\n\n\n          if (cells.length > 0 && isEdge && core.plugins.list) {\n            r = core.plugins.list.editInsideList.call(core, shift, cells);\n          } else {\n            // table\n            const tableCell = util.getParentElement(selectionNode, util.isCell);\n\n            if (tableCell && isEdge) {\n              const table = util.getParentElement(tableCell, 'table');\n              const cells = util.getListChildren(table, util.isCell);\n              let idx = shift ? util.prevIdx(cells, tableCell) : util.nextIdx(cells, tableCell);\n              if (idx === cells.length && !shift) idx = 0;\n              if (idx === -1 && shift) idx = cells.length - 1;\n              let moveCell = cells[idx];\n              if (!moveCell) break;\n              moveCell = moveCell.firstElementChild || moveCell;\n              core.setRange(moveCell, 0, moveCell, 0);\n              break;\n            }\n\n            lines = lines.concat(cells);\n            fc = lc = null;\n          } // Lines tab(4)\n\n\n          if (lines.length > 0) {\n            if (!shift) {\n              const tabText = util.createTextNode(new _w.Array(core._variable.tabSize + 1).join('\\u00A0'));\n\n              if (lines.length === 1) {\n                const textRange = core.insertNode(tabText, null, true);\n                if (!textRange) return false;\n\n                if (!fc) {\n                  r.sc = tabText;\n                  r.so = textRange.endOffset;\n                }\n\n                if (!lc) {\n                  r.ec = tabText;\n                  r.eo = textRange.endOffset;\n                }\n              } else {\n                const len = lines.length - 1;\n\n                for (let i = 0, child; i <= len; i++) {\n                  child = lines[i].firstChild;\n                  if (!child) continue;\n\n                  if (util.isBreak(child)) {\n                    lines[i].insertBefore(tabText.cloneNode(false), child);\n                  } else {\n                    child.textContent = tabText.textContent + child.textContent;\n                  }\n                }\n\n                const firstChild = util.getChildElement(lines[0], 'text', false);\n                const endChild = util.getChildElement(lines[len], 'text', true);\n\n                if (!fc && firstChild) {\n                  r.sc = firstChild;\n                  r.so = 0;\n                }\n\n                if (!lc && endChild) {\n                  r.ec = endChild;\n                  r.eo = endChild.textContent.length;\n                }\n              }\n            } else {\n              const len = lines.length - 1;\n\n              for (let i = 0, line; i <= len; i++) {\n                line = lines[i].childNodes;\n\n                for (let c = 0, cLen = line.length, child; c < cLen; c++) {\n                  child = line[c];\n                  if (!child) break;\n                  if (util.onlyZeroWidthSpace(child)) continue;\n\n                  if (/^\\s{1,4}$/.test(child.textContent)) {\n                    util.removeItem(child);\n                  } else if (/^\\s{1,4}/.test(child.textContent)) {\n                    child.textContent = child.textContent.replace(/^\\s{1,4}/, '');\n                  }\n\n                  break;\n                }\n              }\n\n              const firstChild = util.getChildElement(lines[0], 'text', false);\n              const endChild = util.getChildElement(lines[len], 'text', true);\n\n              if (!fc && firstChild) {\n                r.sc = firstChild;\n                r.so = 0;\n              }\n\n              if (!lc && endChild) {\n                r.ec = endChild;\n                r.eo = endChild.textContent.length;\n              }\n            }\n          }\n\n          core.setRange(r.sc, r.so, r.ec, r.eo); // history stack\n\n          core.history.push(false);\n          break;\n\n        case 13:\n          /** enter key */\n          const freeFormatEl = util.getFreeFormatElement(selectionNode, null);\n\n          if (core._charTypeHTML) {\n            let enterHTML = '';\n\n            if (!shift && freeFormatEl || shift) {\n              enterHTML = '<br>';\n            } else {\n              enterHTML = '<' + formatEl.nodeName + '><br></' + formatEl.nodeName + '>';\n            }\n\n            if (!core.checkCharCount(enterHTML, 'byte-html')) {\n              e.preventDefault();\n              return false;\n            }\n          }\n\n          if (!shift) {\n            const formatInners = core._isEdgeFormat(range.endContainer, range.endOffset, 'end');\n\n            if (formatInners && /^H[1-6]$/i.test(formatEl.nodeName) || /^HR$/i.test(formatEl.nodeName)) {\n              e.preventDefault();\n              let temp = null;\n              const newFormat = core.appendFormatTag(formatEl, options.defaultTag);\n\n              if (formatInners && formatInners.length > 0) {\n                temp = formatInners.pop();\n                const innerNode = temp;\n\n                while (formatInners.length > 0) {\n                  temp = temp.appendChild(formatInners.pop());\n                }\n\n                newFormat.appendChild(innerNode);\n              }\n\n              temp = !temp ? newFormat.firstChild : temp.appendChild(newFormat.firstChild);\n              core.setRange(temp, 0, temp, 0);\n              break;\n            }\n\n            if (freeFormatEl) {\n              e.preventDefault();\n              const selectionFormat = selectionNode === freeFormatEl;\n              const wSelection = core.getSelection();\n              const children = selectionNode.childNodes,\n                    offset = wSelection.focusOffset,\n                    prev = selectionNode.previousElementSibling,\n                    next = selectionNode.nextSibling;\n\n              if (!util.isClosureFreeFormatElement(freeFormatEl) && !!children && (selectionFormat && range.collapsed && children.length - 1 <= offset + 1 && util.isBreak(children[offset]) && (!children[offset + 1] || (!children[offset + 2] || util.onlyZeroWidthSpace(children[offset + 2].textContent)) && children[offset + 1].nodeType === 3 && util.onlyZeroWidthSpace(children[offset + 1].textContent)) && offset > 0 && util.isBreak(children[offset - 1]) || !selectionFormat && util.onlyZeroWidthSpace(selectionNode.textContent) && util.isBreak(prev) && (util.isBreak(prev.previousSibling) || !util.onlyZeroWidthSpace(prev.previousSibling.textContent)) && (!next || !util.isBreak(next) && util.onlyZeroWidthSpace(next.textContent)))) {\n                if (selectionFormat) util.removeItem(children[offset - 1]);else util.removeItem(selectionNode);\n                const newEl = core.appendFormatTag(freeFormatEl, util.isFormatElement(freeFormatEl.nextElementSibling) ? freeFormatEl.nextElementSibling : null);\n                util.copyFormatAttributes(newEl, freeFormatEl);\n                core.setRange(newEl, 1, newEl, 1);\n                break;\n              }\n\n              if (selectionFormat) {\n                functions.insertHTML(range.collapsed && util.isBreak(range.startContainer.childNodes[range.startOffset - 1]) ? '<br>' : '<br><br>', true, false);\n                let focusNode = wSelection.focusNode;\n                const wOffset = wSelection.focusOffset;\n\n                if (freeFormatEl === focusNode) {\n                  focusNode = focusNode.childNodes[wOffset - offset > 1 ? wOffset - 1 : wOffset];\n                }\n\n                core.setRange(focusNode, 1, focusNode, 1);\n              } else {\n                const focusNext = wSelection.focusNode.nextSibling;\n                const br = util.createElement('BR');\n                core.insertNode(br, null, false);\n                const brPrev = br.previousSibling,\n                      brNext = br.nextSibling;\n\n                if (!util.isBreak(focusNext) && !util.isBreak(brPrev) && (!brNext || util.onlyZeroWidthSpace(brNext))) {\n                  br.parentNode.insertBefore(br.cloneNode(false), br);\n                  core.setRange(br, 1, br, 1);\n                } else {\n                  core.setRange(brNext, 0, brNext, 0);\n                }\n              }\n\n              event._onShortcutKey = true;\n              break;\n            }\n          }\n\n          if (selectRange) break;\n\n          if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\n            const range = core.getRange();\n\n            if (core.isEdgePoint(range.endContainer, range.endOffset) && util.isList(selectionNode.nextSibling)) {\n              e.preventDefault();\n              const newEl = util.createElement('LI');\n              const br = util.createElement('BR');\n              newEl.appendChild(br);\n              formatEl.parentNode.insertBefore(newEl, formatEl.nextElementSibling);\n              newEl.appendChild(selectionNode.nextSibling);\n              core.setRange(br, 1, br, 1);\n              break;\n            }\n\n            if ((range.commonAncestorContainer.nodeType === 3 ? !range.commonAncestorContainer.nextElementSibling : true) && util.onlyZeroWidthSpace(formatEl.innerText.trim())) {\n              e.preventDefault();\n              let newEl = null;\n\n              if (util.isListCell(rangeEl.parentNode)) {\n                rangeEl = formatEl.parentNode.parentNode.parentNode;\n                newEl = util.splitElement(formatEl, null, util.getElementDepth(formatEl) - 2);\n\n                if (!newEl) {\n                  const newListCell = util.createElement('LI');\n                  newListCell.innerHTML = '<br>';\n                  rangeEl.insertBefore(newListCell, newEl);\n                  newEl = newListCell;\n                }\n              } else {\n                const newFormat = util.isCell(rangeEl.parentNode) ? 'DIV' : util.isList(rangeEl.parentNode) ? 'LI' : util.isFormatElement(rangeEl.nextElementSibling) ? rangeEl.nextElementSibling.nodeName : util.isFormatElement(rangeEl.previousElementSibling) ? rangeEl.previousElementSibling.nodeName : options.defaultTag;\n                newEl = util.createElement(newFormat);\n                const edge = core.detachRangeFormatElement(rangeEl, [formatEl], null, true, true);\n                edge.cc.insertBefore(newEl, edge.ec);\n              }\n\n              newEl.innerHTML = '<br>';\n              util.copyFormatAttributes(newEl, formatEl);\n              util.removeItemAllParents(formatEl, null, null);\n              core.setRange(newEl, 1, newEl, 1);\n              break;\n            }\n          }\n\n          if (rangeEl && util.getParentElement(rangeEl, 'FIGCAPTION') && util.getParentElement(rangeEl, util.isList)) {\n            e.preventDefault();\n            formatEl = core.appendFormatTag(formatEl, null);\n            core.setRange(formatEl, 0, formatEl, 0);\n          }\n\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            const compContext = context[fileComponentName];\n            const container = compContext._container;\n            const sibling = container.previousElementSibling || container.nextElementSibling;\n            let newEl = null;\n\n            if (util.isListCell(container.parentNode)) {\n              newEl = util.createElement('BR');\n            } else {\n              newEl = util.createElement(util.isFormatElement(sibling) ? sibling.nodeName : options.defaultTag);\n              newEl.innerHTML = '<br>';\n            }\n\n            container.parentNode.insertBefore(newEl, container);\n            core.callPlugin(fileComponentName, function () {\n              if (core.selectComponent(compContext._element, fileComponentName) === false) core.blur();\n            }, null);\n          }\n\n          break;\n\n        case 27:\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            core.controllersOff();\n            return false;\n          }\n\n          break;\n      }\n\n      if (shift && keyCode === 16) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tablePlugin = core.plugins.table;\n\n        if (tablePlugin && !tablePlugin._shift && !tablePlugin._ref) {\n          const cell = util.getParentElement(formatEl, util.isCell);\n\n          if (cell) {\n            tablePlugin.onTableCellMultiSelect.call(core, cell, true);\n            return;\n          }\n        }\n      } else if (shift && (util.isOSX_IOS ? alt : ctrl) && keyCode === 32) {\n        e.preventDefault();\n        e.stopPropagation();\n        const nbsp = core.insertNode(util.createTextNode('\\u00a0'));\n\n        if (nbsp && nbsp.container) {\n          core.setRange(nbsp.container, nbsp.endOffset, nbsp.container, nbsp.endOffset);\n          return;\n        }\n      }\n\n      const textKey = !ctrl && !alt && !selectRange && !event._nonTextKeyCode.test(keyCode);\n\n      if (textKey && range.collapsed && range.startContainer === range.endContainer && util.isBreak(range.commonAncestorContainer)) {\n        const zeroWidth = util.createTextNode(util.zeroWidthSpace);\n        core.insertNode(zeroWidth, null, false);\n        core.setRange(zeroWidth, 1, zeroWidth, 1);\n      }\n    },\n    onKeyUp_wysiwyg: function (e) {\n      if (event._onShortcutKey) return;\n\n      core._editorRange();\n\n      const range = core.getRange();\n      const keyCode = e.keyCode;\n      const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\n      const alt = e.altKey;\n      let selectionNode = core.getSelectionNode();\n\n      if (core._isBalloon && (core._isBalloonAlways && keyCode !== 27 || !range.collapsed)) {\n        if (core._isBalloonAlways) {\n          if (keyCode !== 27) event._showToolbarBalloonDelay();\n        } else {\n          event._showToolbarBalloon();\n\n          return;\n        }\n      } // user event\n\n\n      if (typeof functions.onKeyUp === 'function' && functions.onKeyUp(e, core) === false) return;\n      /** when format tag deleted */\n\n      if (keyCode === 8 && util.isWysiwygDiv(selectionNode) && selectionNode.textContent === '' && selectionNode.children.length === 0) {\n        e.preventDefault();\n        e.stopPropagation();\n        selectionNode.innerHTML = '';\n        const oFormatTag = util.createElement(util.isFormatElement(core._variable.currentNodes[0]) ? core._variable.currentNodes[0] : options.defaultTag);\n        oFormatTag.innerHTML = '<br>';\n        selectionNode.appendChild(oFormatTag);\n        core.setRange(oFormatTag, 0, oFormatTag, 0);\n\n        event._applyTagEffects();\n\n        core.history.push(false);\n        return;\n      }\n\n      const formatEl = util.getFormatElement(selectionNode, null);\n      const rangeEl = util.getRangeFormatElement(selectionNode, null);\n\n      if ((!formatEl && range.collapsed || formatEl === rangeEl) && !util.isComponent(selectionNode) && !util.isList(selectionNode)) {\n        core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag);\n\n        selectionNode = core.getSelectionNode();\n      }\n\n      if (event._directionKeyCode.test(keyCode)) {\n        event._applyTagEffects();\n      }\n\n      const textKey = !ctrl && !alt && !event._nonTextKeyCode.test(keyCode);\n\n      if (textKey && selectionNode.nodeType === 3 && util.zeroWidthRegExp.test(selectionNode.textContent) && !(e.isComposing !== undefined ? e.isComposing : event._IEisComposing)) {\n        let so = range.startOffset,\n            eo = range.endOffset;\n        const frontZeroWidthCnt = (selectionNode.textContent.substring(0, eo).match(event._frontZeroWidthReg) || '').length;\n        so = range.startOffset - frontZeroWidthCnt;\n        eo = range.endOffset - frontZeroWidthCnt;\n        selectionNode.textContent = selectionNode.textContent.replace(util.zeroWidthRegExp, '');\n        core.setRange(selectionNode, so < 0 ? 0 : so, selectionNode, eo < 0 ? 0 : eo);\n      }\n\n      core._charCount(''); // history stack\n\n\n      core.history.push(true);\n    },\n    onScroll_wysiwyg: function (e) {\n      core.controllersOff();\n      if (core._isBalloon) event._hideToolbar(); // user event\n\n      if (typeof functions.onScroll === 'function') functions.onScroll(e, core);\n    },\n    onFocus_wysiwyg: function (e) {\n      if (core._antiBlur) return;\n      core.hasFocus = true;\n\n      event._applyTagEffects();\n\n      if (core._isInline) event._showToolbarInline(); // user event\n\n      if (typeof functions.onFocus === 'function') functions.onFocus(e, core);\n    },\n    onBlur_wysiwyg: function (e) {\n      if (core._antiBlur || core._variable.isCodeView) return;\n      core.hasFocus = false;\n      core.controllersOff();\n      if (core._isInline || core._isBalloon) event._hideToolbar(); // user event\n\n      if (typeof functions.onBlur === 'function') functions.onBlur(e, core); // active class reset of buttons\n\n      const commandMap = core.commandMap;\n      const activePlugins = core.activePlugins;\n\n      for (let key in commandMap) {\n        if (!util.hasOwn(commandMap, key)) continue;\n\n        if (activePlugins.indexOf(key) > -1) {\n          plugins[key].active.call(core, null);\n        } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\n          commandMap.OUTDENT.setAttribute('disabled', true);\n        } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\n          commandMap.INDENT.removeAttribute('disabled');\n        } else {\n          util.removeClass(commandMap[key], 'active');\n        }\n      }\n\n      core._variable.currentNodes = [];\n      core._variable.currentNodesMap = [];\n      if (options.showPathLabel) context.element.navigation.textContent = '';\n    },\n    onMouseDown_resizingBar: function (e) {\n      e.stopPropagation();\n      core.submenuOff();\n      core.controllersOff();\n      const prevHeight = util.getNumber(context.element.wysiwygFrame.style.height, 0);\n      core._variable.resizeClientY = e.clientY;\n      context.element.resizeBackground.style.display = 'block';\n\n      function closureFunc() {\n        context.element.resizeBackground.style.display = 'none';\n\n        _d.removeEventListener('mousemove', event._resize_editor);\n\n        _d.removeEventListener('mouseup', closureFunc);\n\n        if (typeof functions.onResizeEditor === 'function') functions.onResizeEditor(util.getNumber(context.element.wysiwygFrame.style.height, 0), prevHeight, core);\n      }\n\n      _d.addEventListener('mousemove', event._resize_editor);\n\n      _d.addEventListener('mouseup', closureFunc);\n    },\n    _resize_editor: function (e) {\n      const resizeInterval = context.element.editorArea.offsetHeight + (e.clientY - core._variable.resizeClientY);\n      context.element.wysiwygFrame.style.height = context.element.code.style.height = (resizeInterval < core._variable.minResizingSize ? core._variable.minResizingSize : resizeInterval) + 'px';\n      core._variable.resizeClientY = e.clientY;\n    },\n    onResize_window: function () {\n      core.controllersOff();\n      const responsiveSize = event._responsiveButtonSize;\n\n      if (responsiveSize) {\n        let w = 0;\n\n        if ((core._isBalloon || core._isInline) && options.toolbarWidth === 'auto') {\n          w = context.element.topArea.offsetWidth;\n        } else {\n          w = context.element.toolbar.offsetWidth;\n        }\n\n        let responsiveWidth = 'default';\n\n        for (let i = 1, len = responsiveSize.length; i < len; i++) {\n          if (w < responsiveSize[i]) {\n            responsiveWidth = responsiveSize[i] + '';\n            break;\n          }\n        }\n\n        if (event._responsiveCurrentSize !== responsiveWidth) {\n          event._responsiveCurrentSize = responsiveWidth;\n          functions.setToolbarButtons(event._responsiveButtons[responsiveWidth]);\n        }\n      }\n\n      if (context.element.toolbar.offsetWidth === 0) return;\n\n      if (context.fileBrowser && context.fileBrowser.area.style.display === 'block') {\n        context.fileBrowser.body.style.maxHeight = _w.innerHeight - context.fileBrowser.header.offsetHeight - 50 + 'px';\n      }\n\n      if (core.submenuActiveButton && core.submenu) {\n        core._setMenuPosition(core.submenuActiveButton, core.submenu);\n      }\n\n      if (core._variable.isFullScreen) {\n        core._variable.innerHeight_fullScreen += _w.innerHeight - context.element.toolbar.offsetHeight - core._variable.innerHeight_fullScreen;\n        context.element.editorArea.style.height = core._variable.innerHeight_fullScreen + 'px';\n        return;\n      }\n\n      if (core._variable.isCodeView && core._isInline) {\n        event._showToolbarInline();\n\n        return;\n      }\n\n      core._iframeAutoHeight();\n\n      if (core._sticky) {\n        context.element.toolbar.style.width = context.element.topArea.offsetWidth - 2 + 'px';\n        event.onScroll_window();\n      }\n    },\n    onScroll_window: function () {\n      if (core._variable.isFullScreen || context.element.toolbar.offsetWidth === 0 || options.stickyToolbar < 0) return;\n      const element = context.element;\n      const editorHeight = element.editorArea.offsetHeight;\n      const y = (this.scrollY || _d.documentElement.scrollTop) + options.stickyToolbar;\n      const editorTop = event._getEditorOffsets(options.toolbarContainer).top - (core._isInline ? element.toolbar.offsetHeight : 0);\n\n      if (y < editorTop) {\n        event._offStickyToolbar();\n      } else if (y + core._variable.minResizingSize >= editorHeight + editorTop) {\n        if (!core._sticky) event._onStickyToolbar();\n        element.toolbar.style.top = editorHeight + editorTop + options.stickyToolbar - y - core._variable.minResizingSize + 'px';\n      } else if (y >= editorTop) {\n        event._onStickyToolbar();\n      }\n    },\n    _getEditorOffsets: function (container) {\n      let offsetEl = container || context.element.topArea;\n      let t = 0,\n          l = 0,\n          s = 0;\n\n      while (offsetEl) {\n        t += offsetEl.offsetTop;\n        l += offsetEl.offsetLeft;\n        s += offsetEl.scrollTop;\n        offsetEl = offsetEl.offsetParent;\n      }\n\n      return {\n        top: t,\n        left: l,\n        scroll: s\n      };\n    },\n    _getPageBottomSpace: function () {\n      return _d.documentElement.scrollHeight - (event._getEditorOffsets(null).top + context.element.topArea.offsetHeight);\n    },\n    _onStickyToolbar: function () {\n      const element = context.element;\n\n      if (!core._isInline && !options.toolbarContainer) {\n        element._stickyDummy.style.height = element.toolbar.offsetHeight + 'px';\n        element._stickyDummy.style.display = 'block';\n      }\n\n      element.toolbar.style.top = options.stickyToolbar + 'px';\n      element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : element.toolbar.offsetWidth + 'px';\n      util.addClass(element.toolbar, 'se-toolbar-sticky');\n      core._sticky = true;\n    },\n    _offStickyToolbar: function () {\n      const element = context.element;\n      element._stickyDummy.style.display = 'none';\n      element.toolbar.style.top = core._isInline ? core._inlineToolbarAttr.top : '';\n      element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : '';\n      element.editorArea.style.marginTop = '';\n      util.removeClass(element.toolbar, 'se-toolbar-sticky');\n      core._sticky = false;\n    },\n    _codeViewAutoHeight: function () {\n      context.element.code.style.height = context.element.code.scrollHeight + 'px';\n    },\n    // FireFox - table delete, Chrome - image, video, audio\n    _hardDelete: function () {\n      const range = core.getRange();\n      const sc = range.startContainer;\n      const ec = range.endContainer; // table\n\n      const sCell = util.getRangeFormatElement(sc);\n      const eCell = util.getRangeFormatElement(ec);\n      const sIsCell = util.isCell(sCell);\n      const eIsCell = util.isCell(eCell);\n\n      if ((sIsCell && !sCell.previousElementSibling && !sCell.parentElement.previousElementSibling || eIsCell && !eCell.nextElementSibling && !eCell.parentElement.nextElementSibling) && sCell !== eCell) {\n        if (!sIsCell) {\n          util.removeItem(util.getParentElement(eCell, util.isComponent));\n        } else if (!eIsCell) {\n          util.removeItem(util.getParentElement(sCell, util.isComponent));\n        } else {\n          util.removeItem(util.getParentElement(sCell, util.isComponent));\n          core.nativeFocus();\n          return true;\n        }\n      } // component\n\n\n      const sComp = sc.nodeType === 1 ? util.getParentElement(sc, '.se-component') : null;\n      const eComp = ec.nodeType === 1 ? util.getParentElement(ec, '.se-component') : null;\n      if (sComp) util.removeItem(sComp);\n      if (eComp) util.removeItem(eComp);\n      return false;\n    },\n    onPaste_wysiwyg: function (e) {\n      const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\n      if (!clipboardData) return true;\n      return event._dataTransferAction('paste', e, clipboardData);\n    },\n    _setClipboardComponent: function (e, info, clipboardData) {\n      e.preventDefault();\n      e.stopPropagation();\n      clipboardData.setData('text/html', info.component.outerHTML);\n    },\n    onCopy_wysiwyg: function (e) {\n      const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData; // user event\n\n      if (typeof functions.onCopy === 'function' && !functions.onCopy(e, clipboardData, core)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      const info = core.currentFileComponentInfo;\n\n      if (info && !util.isIE) {\n        event._setClipboardComponent(e, info, clipboardData);\n\n        util.addClass(info.component, 'se-component-copy'); // copy effect\n\n        _w.setTimeout(function () {\n          util.removeClass(info.component, 'se-component-copy');\n        }, 150);\n      }\n    },\n    onCut_wysiwyg: function (e) {\n      const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData; // user event\n\n      if (typeof functions.onCut === 'function' && !functions.onCut(e, clipboardData, core)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      const info = core.currentFileComponentInfo;\n\n      if (info && !util.isIE) {\n        event._setClipboardComponent(e, info, clipboardData);\n\n        util.removeItem(info.component);\n        core.controllersOff();\n      }\n\n      _w.setTimeout(function () {\n        // history stack\n        core.history.push(false);\n      });\n    },\n    onDrop_wysiwyg: function (e) {\n      const dataTransfer = e.dataTransfer;\n      if (!dataTransfer) return true;\n\n      if (util.isIE) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      core.removeNode();\n\n      event._setDropLocationSelection(e);\n\n      return event._dataTransferAction('drop', e, dataTransfer);\n    },\n    _setDropLocationSelection: function (e) {\n      if (e.rangeParent) {\n        core.setRange(e.rangeParent, e.rangeOffset, e.rangeParent, e.rangeOffset);\n      } else if (core._wd.caretRangeFromPoint) {\n        const r = core._wd.caretRangeFromPoint(e.clientX, e.clientY);\n\n        core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\n      } else {\n        const r = core.getRange();\n        core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\n      }\n    },\n    _dataTransferAction: function (type, e, data) {\n      let plainText, cleanData;\n\n      if (util.isIE) {\n        plainText = data.getData('Text');\n        const range = core.getRange();\n        const tempDiv = util.createElement('DIV');\n        const tempRange = {\n          sc: range.startContainer,\n          so: range.startOffset,\n          ec: range.endContainer,\n          eo: range.endOffset\n        };\n        tempDiv.setAttribute('contenteditable', true);\n        tempDiv.style.cssText = 'position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;';\n        context.element.relative.appendChild(tempDiv);\n        tempDiv.focus();\n\n        _w.setTimeout(function () {\n          cleanData = tempDiv.innerHTML;\n          util.removeItem(tempDiv);\n          core.setRange(tempRange.sc, tempRange.so, tempRange.ec, tempRange.eo);\n\n          event._setClipboardData(type, e, plainText, cleanData, data);\n        });\n\n        return true;\n      } else {\n        plainText = data.getData('text/plain');\n        cleanData = data.getData('text/html');\n\n        if (event._setClipboardData(type, e, plainText, cleanData, data) === false) {\n          e.preventDefault();\n          e.stopPropagation();\n          return false;\n        }\n      }\n    },\n    _setClipboardData: function (type, e, plainText, cleanData, data) {\n      // MS word, OneNode, Excel\n      const MSData = /class=[\"']*Mso(Normal|List)/i.test(cleanData) || /content=[\"']*Word.Document/i.test(cleanData) || /content=[\"']*OneNote.File/i.test(cleanData) || /content=[\"']*Excel.Sheet/i.test(cleanData);\n      const onlyText = !cleanData;\n\n      if (!onlyText) {\n        if (MSData) {\n          cleanData = cleanData.replace(/\\n/g, ' ');\n          plainText = plainText.replace(/\\n/g, ' ');\n        } else {\n          cleanData = (plainText === cleanData ? plainText : cleanData).replace(/\\n/g, '<br>');\n        }\n\n        cleanData = core.cleanHTML(cleanData, core.pasteTagsWhitelistRegExp);\n      } else {\n        cleanData = util._HTMLConvertor(plainText).replace(/\\n/g, '<br>');\n      }\n\n      const maxCharCount = core._charCount(core._charTypeHTML ? cleanData : plainText); // user event - paste\n\n\n      if (type === 'paste' && typeof functions.onPaste === 'function') {\n        const value = functions.onPaste(e, cleanData, maxCharCount, core);\n        if (!value) return false;\n        if (typeof value === 'string') cleanData = value;\n      } // user event - drop\n\n\n      if (type === 'drop' && typeof functions.onDrop === 'function') {\n        const value = functions.onDrop(e, cleanData, maxCharCount, core);\n        if (!value) return false;\n        if (typeof value === 'string') cleanData = value;\n      } // files\n\n\n      const files = data.files;\n\n      if (files.length > 0 && !MSData) {\n        if (/^image/.test(files[0].type) && core.plugins.image) {\n          functions.insertImage(files);\n        }\n\n        return false;\n      }\n\n      if (!maxCharCount) {\n        return false;\n      }\n\n      if (cleanData) {\n        functions.insertHTML(cleanData, true, false);\n        return false;\n      }\n    },\n    onMouseMove_wysiwyg: function (e) {\n      if (core.isDisabled) return;\n      const component = util.getParentElement(e.target, util.isComponent);\n      const lineBreakerStyle = core._lineBreaker.style;\n\n      if (component && !core.currentControllerName) {\n        const ctxEl = context.element;\n        let scrollTop = 0;\n        let el = ctxEl.wysiwyg;\n\n        do {\n          scrollTop += el.scrollTop;\n          el = el.parentElement;\n        } while (el && !/^(BODY|HTML)$/i.test(el.nodeName));\n\n        const wScroll = ctxEl.wysiwyg.scrollTop;\n\n        const offsets = event._getEditorOffsets(null);\n\n        const componentTop = util.getOffset(component, ctxEl.wysiwygFrame).top + wScroll;\n        const y = e.pageY + scrollTop + (options.iframe && !options.toolbarContainer ? ctxEl.toolbar.offsetHeight : 0);\n        const c = componentTop + (options.iframe ? scrollTop : offsets.top);\n        const isList = util.isListCell(component.parentNode);\n        let dir = '',\n            top = '';\n\n        if ((isList ? !component.previousSibling : !util.isFormatElement(component.previousElementSibling)) && y < c + 20) {\n          top = componentTop;\n          dir = 't';\n        } else if ((isList ? !component.nextSibling : !util.isFormatElement(component.nextElementSibling)) && y > c + component.offsetHeight - 20) {\n          top = componentTop + component.offsetHeight;\n          dir = 'b';\n        } else {\n          lineBreakerStyle.display = 'none';\n          return;\n        }\n\n        core._variable._lineBreakComp = component;\n        core._variable._lineBreakDir = dir;\n        lineBreakerStyle.top = top - wScroll + 'px';\n        core._lineBreakerButton.style.left = util.getOffset(component).left + component.offsetWidth / 2 - 15 + 'px';\n        lineBreakerStyle.display = 'block';\n      } // off line breaker\n      else if (lineBreakerStyle.display !== 'none') {\n          lineBreakerStyle.display = 'none';\n        }\n    },\n    _onMouseDown_lineBreak: function (e) {\n      e.preventDefault();\n    },\n    _onLineBreak: function (e) {\n      e.preventDefault();\n      const component = core._variable._lineBreakComp;\n      const dir = !this ? core._variable._lineBreakDir : this;\n      const isList = util.isListCell(component.parentNode);\n      const format = util.createElement(isList ? 'BR' : util.isCell(component.parentNode) ? 'DIV' : options.defaultTag);\n      if (!isList) format.innerHTML = '<br>';\n      if (core._charTypeHTML && !core.checkCharCount(format.outerHTML, 'byte-html')) return;\n      component.parentNode.insertBefore(format, dir === 't' ? component : component.nextSibling);\n      core._lineBreaker.style.display = 'none';\n      core._variable._lineBreakComp = null;\n      const focusEl = isList ? format : format.firstChild;\n      core.setRange(focusEl, 1, focusEl, 1); // history stack\n\n      core.history.push(false);\n    },\n    _addEvent: function () {\n      const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\n      /** toolbar event */\n\n      context.element.toolbar.addEventListener('mousedown', event._buttonsEventHandler, false);\n\n      context.element._menuTray.addEventListener('mousedown', event._buttonsEventHandler, false);\n\n      context.element.toolbar.addEventListener('click', event.onClick_toolbar, false);\n      /** editor area */\n\n      eventWysiwyg.addEventListener('mousedown', event.onMouseDown_wysiwyg, false);\n      eventWysiwyg.addEventListener('click', event.onClick_wysiwyg, false);\n      eventWysiwyg.addEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg, false);\n      eventWysiwyg.addEventListener('keydown', event.onKeyDown_wysiwyg, false);\n      eventWysiwyg.addEventListener('keyup', event.onKeyUp_wysiwyg, false);\n      eventWysiwyg.addEventListener('paste', event.onPaste_wysiwyg, false);\n      eventWysiwyg.addEventListener('copy', event.onCopy_wysiwyg, false);\n      eventWysiwyg.addEventListener('cut', event.onCut_wysiwyg, false);\n      eventWysiwyg.addEventListener('drop', event.onDrop_wysiwyg, false);\n      eventWysiwyg.addEventListener('scroll', event.onScroll_wysiwyg, false);\n      eventWysiwyg.addEventListener('focus', event.onFocus_wysiwyg, false);\n      eventWysiwyg.addEventListener('blur', event.onBlur_wysiwyg, false);\n      /** line breaker */\n\n      event._lineBreakerBind = {\n        a: event._onLineBreak.bind(''),\n        t: event._onLineBreak.bind('t'),\n        b: event._onLineBreak.bind('b')\n      };\n      eventWysiwyg.addEventListener('mousemove', event.onMouseMove_wysiwyg, false);\n\n      core._lineBreakerButton.addEventListener('mousedown', event._onMouseDown_lineBreak, false);\n\n      core._lineBreakerButton.addEventListener('click', event._lineBreakerBind.a, false);\n\n      context.element.lineBreaker_t.addEventListener('mousedown', event._lineBreakerBind.t, false);\n      context.element.lineBreaker_b.addEventListener('mousedown', event._lineBreakerBind.b, false);\n      /** Events are registered only when there is a table plugin.  */\n\n      if (core.plugins.table) {\n        eventWysiwyg.addEventListener('touchstart', event.onMouseDown_wysiwyg, {\n          passive: true,\n          useCapture: false\n        });\n      }\n      /** code view area auto line */\n\n\n      if (options.height === 'auto' && !options.codeMirrorEditor) {\n        context.element.code.addEventListener('keydown', event._codeViewAutoHeight, false);\n        context.element.code.addEventListener('keyup', event._codeViewAutoHeight, false);\n        context.element.code.addEventListener('paste', event._codeViewAutoHeight, false);\n      }\n      /** resizingBar */\n\n\n      if (context.element.resizingBar) {\n        if (/\\d+/.test(options.height)) {\n          context.element.resizingBar.addEventListener('mousedown', event.onMouseDown_resizingBar, false);\n        } else {\n          util.addClass(context.element.resizingBar, 'se-resizing-none');\n        }\n      }\n      /** window event */\n\n\n      event._setResponsiveToolbar();\n\n      _w.removeEventListener('resize', event.onResize_window);\n\n      _w.removeEventListener('scroll', event.onScroll_window);\n\n      _w.addEventListener('resize', event.onResize_window, false);\n\n      if (options.stickyToolbar > -1) {\n        _w.addEventListener('scroll', event.onScroll_window, false);\n      }\n    },\n    _removeEvent: function () {\n      const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\n      context.element.toolbar.removeEventListener('mousedown', event._buttonsEventHandler);\n\n      context.element._menuTray.removeEventListener('mousedown', event._buttonsEventHandler);\n\n      context.element.toolbar.removeEventListener('click', event.onClick_toolbar);\n      eventWysiwyg.removeEventListener('mousedown', event.onMouseDown_wysiwyg);\n      eventWysiwyg.removeEventListener('click', event.onClick_wysiwyg);\n      eventWysiwyg.removeEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg);\n      eventWysiwyg.removeEventListener('keydown', event.onKeyDown_wysiwyg);\n      eventWysiwyg.removeEventListener('keyup', event.onKeyUp_wysiwyg);\n      eventWysiwyg.removeEventListener('paste', event.onPaste_wysiwyg);\n      eventWysiwyg.removeEventListener('copy', event.onCopy_wysiwyg);\n      eventWysiwyg.removeEventListener('cut', event.onCut_wysiwyg);\n      eventWysiwyg.removeEventListener('drop', event.onDrop_wysiwyg);\n      eventWysiwyg.removeEventListener('scroll', event.onScroll_wysiwyg);\n      eventWysiwyg.removeEventListener('mousemove', event.onMouseMove_wysiwyg);\n\n      core._lineBreakerButton.removeEventListener('mousedown', event._onMouseDown_lineBreak);\n\n      core._lineBreakerButton.removeEventListener('click', event._lineBreakerBind.a);\n\n      context.element.lineBreaker_t.removeEventListener('mousedown', event._lineBreakerBind.t);\n      context.element.lineBreaker_b.removeEventListener('mousedown', event._lineBreakerBind.b);\n      event._lineBreakerBind = null;\n      eventWysiwyg.removeEventListener('touchstart', event.onMouseDown_wysiwyg, {\n        passive: true,\n        useCapture: false\n      });\n      eventWysiwyg.removeEventListener('focus', event.onFocus_wysiwyg);\n      eventWysiwyg.removeEventListener('blur', event.onBlur_wysiwyg);\n      context.element.code.removeEventListener('keydown', event._codeViewAutoHeight);\n      context.element.code.removeEventListener('keyup', event._codeViewAutoHeight);\n      context.element.code.removeEventListener('paste', event._codeViewAutoHeight);\n\n      if (context.element.resizingBar) {\n        context.element.resizingBar.removeEventListener('mousedown', event.onMouseDown_resizingBar);\n      }\n\n      _w.removeEventListener('resize', event.onResize_window);\n\n      _w.removeEventListener('scroll', event.onScroll_window);\n    },\n    _setResponsiveToolbar: function () {\n      if (_responsiveButtons.length === 0) {\n        _responsiveButtons = null;\n        return;\n      }\n\n      event._responsiveCurrentSize = 'default';\n      const sizeArray = event._responsiveButtonSize = [];\n      const buttonsObj = event._responsiveButtons = {\n        default: _responsiveButtons[0]\n      };\n\n      for (let i = 1, len = _responsiveButtons.length, size, buttonGroup; i < len; i++) {\n        buttonGroup = _responsiveButtons[i];\n        size = buttonGroup[0] * 1;\n        sizeArray.push(size);\n        buttonsObj[size] = buttonGroup[1];\n      }\n\n      sizeArray.sort(function (a, b) {\n        return a - b;\n      }).unshift('default');\n    }\n  };\n  /** functions */\n\n  const functions = {\n    /**\r\n     * @description Core, Util object\r\n     */\n    core: core,\n    util: util,\n\n    /**\r\n     * @description Event functions\r\n     * @param {Object} e Event Object\r\n     * @param {Object} core Core object\r\n     */\n    onload: null,\n    onScroll: null,\n    onMouseDown: null,\n    onClick: null,\n    onInput: null,\n    onKeyDown: null,\n    onKeyUp: null,\n    onCopy: null,\n    onCut: null,\n    onFocus: null,\n    onBlur: null,\n\n    /**\r\n     * @description Event functions\r\n     * @param {String} contents Current contents\r\n     * @param {Object} core Core object\r\n     */\n    onChange: null,\n\n    /**\r\n     * @description Event functions (drop, paste)\r\n     * When false is returned, the default behavior is stopped.\r\n     * If the string is returned, the cleanData value is modified to the return value.\r\n     * @param {Object} e Event object.\r\n     * @param {String} cleanData HTML string modified for editor format.\r\n     * @param {Boolean} maxChartCount option (true if max character is exceeded)\r\n     * @param {Object} core Core object\r\n     * @returns {Boolean|String}\r\n     */\n    onDrop: null,\n    onPaste: null,\n\n    /**\r\n     * @description Called just before the inline toolbar is positioned and displayed on the screen.\r\n     * @param {Element} toolbar Toolbar Element\r\n     * @param {Object} context The editor's context object (editor.getContext())\r\n     * @param {Object} core Core object\r\n     */\n    showInline: null,\n\n    /**\r\n     * @description Called just after the controller is positioned and displayed on the screen.\r\n     * controller - editing elements displayed on the screen [image resizing, table editor, link editor..]]\r\n     * @param {String} name The name of the plugin that called the controller\r\n     * @param {Array} controllers Array of Controller elements\r\n     * @param {Object} core Core object\r\n     */\n    showController: null,\n\n    /**\r\n     * @description An event when toggling between code view and wysiwyg view.\r\n     * @param {Boolean} isCodeView Whether the current code view mode\r\n     * @param {Object} core Core object\r\n     */\n    toggleCodeView: null,\n\n    /**\r\n     * @description An event when toggling full screen.\r\n     * @param {Boolean} isFullScreen Whether the current full screen mode\r\n     * @param {Object} core Core object\r\n     */\n    toggleFullScreen: null,\n\n    /**\r\n     * @description It replaces the default callback function of the image upload\r\n     * @param {Object} response Response object\r\n     * @param {Object} info Input information\r\n     * - linkValue: Link url value\r\n     * - linkNewWindow: Open in new window Check Value\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update image if true, create image if false\r\n     * - element: If isUpdate is true, the currently selected image.\r\n     * @param {Object} core Core object\r\n     */\n    imageUploadHandler: null,\n\n    /**\r\n     * @description It replaces the default callback function of the video upload\r\n     * @param xmlHttp xmlHttpRequest object\r\n     * @param info Input information\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update video if true, create video if false\r\n     * - element: If isUpdate is true, the currently selected video.\r\n     * @param core Core object\r\n     */\n    videoUploadHandler: null,\n\n    /**\r\n     * @description It replaces the default callback function of the audio upload\r\n     * @param xmlHttp xmlHttpRequest object\r\n     * @param info Input information\r\n     * - isUpdate: Update audio if true, create audio if false\r\n     * - element: If isUpdate is true, the currently selected audio.\r\n     * @param core Core object\r\n     */\n    audioUploadHandler: null,\n\n    /**\r\n     * @description Called before the image is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no image upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - linkValue: Link url value\r\n     * - linkNewWindow: Open in new window Check Value\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update image if true, create image if false\r\n     * - element: If isUpdate is true, the currently selected image.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"imageUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onImageUploadBefore: null,\n\n    /**\r\n     * @description Called before the video is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no video(iframe, video) upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update video if true, create video if false\r\n     * - element: If isUpdate is true, the currently selected video.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"videoUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onVideoUploadBefore: null,\n\n    /**\r\n     * @description Called before the audio is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no audio upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - isUpdate: Update audio if true, create audio if false\r\n     * - element: If isUpdate is true, the currently selected audio.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"audioUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onAudioUploadBefore: null,\n\n    /**\r\n     * @description Called when the image is uploaded, updated, deleted\r\n     * @param {Element} targetElement Target element\r\n     * @param {Number} index Uploaded index\r\n     * @param {String} state Upload status ('create', 'update', 'delete')\r\n     * @param {Object} info Image info object\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @param {Number} remainingFilesCount Count of remaining files to upload (0 when added as a url)\r\n     * @param {Object} core Core object\r\n     */\n    onImageUpload: null,\n\n    /**\r\n    * @description Called when the video(iframe, video) is is uploaded, updated, deleted\r\n    * -- arguments is same \"onImageUpload\" --\r\n    */\n    onVideoUpload: null,\n\n    /**\r\n    * @description Called when the audio is is uploaded, updated, deleted\r\n    * -- arguments is same \"onImageUpload\" --\r\n    */\n    onAudioUpload: null,\n\n    /**\r\n     * @description Called when the image is upload failed\r\n     * @param {String} errorMessage Error message\r\n     * @param {Object} result Response Object\r\n     * @param {Object} core Core object\r\n     * @returns {Boolean}\r\n     */\n    onImageUploadError: null,\n\n    /**\r\n     * @description Called when the video(iframe, video) upload failed\r\n     * -- arguments is same \"onImageUploadError\" --\r\n     */\n    onVideoUploadError: null,\n\n    /**\r\n     * @description Called when the audio upload failed\r\n     * -- arguments is same \"onImageUploadError\" --\r\n     */\n    onAudioUploadError: null,\n\n    /**\r\n     * @description Called when the editor is resized using the bottom bar\r\n     */\n    onResizeEditor: null,\n\n    /**\r\n     * @description Reset the buttons on the toolbar. (Editor is not reloaded)\r\n     * You cannot set a new plugin for the button.\r\n     * @param {Array} buttonList Button list \r\n     */\n    setToolbarButtons: function (buttonList) {\n      core.submenuOff();\n      core.containerOff();\n\n      const newToolbar = _Constructor._createToolBar(_d, buttonList, core.plugins, options);\n\n      _responsiveButtons = newToolbar.responsiveButtons;\n      core._moreLayerActiveButton = null;\n\n      event._setResponsiveToolbar();\n\n      context.element.toolbar.replaceChild(newToolbar._buttonTray, context.element._buttonTray);\n\n      const newContext = _Context(context.element.originElement, core._getConstructed(context.element), options);\n\n      context.element = newContext.element;\n      context.tool = newContext.tool;\n      if (options.iframe) context.element.wysiwyg = core._wd.body;\n\n      core._cachingButtons();\n\n      core.history._resetCachingButton();\n\n      core.activePlugins = [];\n      const oldCallButtons = pluginCallButtons;\n      pluginCallButtons = newToolbar.pluginCallButtons;\n      let plugin, button, oldButton;\n\n      for (let key in pluginCallButtons) {\n        if (!util.hasOwn(pluginCallButtons, key)) continue;\n        plugin = plugins[key];\n        button = pluginCallButtons[key];\n\n        if (plugin.active && button) {\n          oldButton = oldCallButtons[key];\n          core.callPlugin(key, null, oldButton || button);\n\n          if (oldButton) {\n            button.parentElement.replaceChild(oldButton, button);\n            pluginCallButtons[key] = oldButton;\n          }\n        }\n      }\n\n      if (core.hasFocus) event._applyTagEffects();\n      if (core._variable.isCodeView) util.addClass(core._styleCommandMap.codeView, 'active');\n      if (core._variable.isFullScreen) util.addClass(core._styleCommandMap.fullScreen, 'active');\n      if (util.hasClass(context.element.wysiwyg, 'se-show-block')) util.addClass(core._styleCommandMap.showBlocks, 'active');\n    },\n\n    /**\r\n     * @description Add or reset option property (Editor is reloaded)\r\n     * @param {Object} _options Options\r\n     */\n    setOptions: function (_options) {\n      event._removeEvent();\n\n      core._resetComponents();\n\n      util.removeClass(core._styleCommandMap.showBlocks, 'active');\n      util.removeClass(core._styleCommandMap.codeView, 'active');\n      core._variable.isCodeView = false;\n      core._iframeAuto = null;\n      core.plugins = _options.plugins || core.plugins;\n      const mergeOptions = [options, _options].reduce(function (init, option) {\n        for (let key in option) {\n          if (!util.hasOwn(option, key)) continue;\n\n          if (key === 'plugins' && option[key] && init[key]) {\n            let i = init[key],\n                o = option[key];\n            i = i.length ? i : _w.Object.keys(i).map(function (name) {\n              return i[name];\n            });\n            o = o.length ? o : _w.Object.keys(o).map(function (name) {\n              return o[name];\n            });\n            init[key] = o.filter(function (val) {\n              return i.indexOf(val) === -1;\n            }).concat(i);\n          } else {\n            init[key] = option[key];\n          }\n        }\n\n        return init;\n      }, {});\n      const el = context.element;\n      const _initHTML = el.wysiwyg.innerHTML; // set option\n\n      const cons = _Constructor._setOptions(mergeOptions, context, options);\n\n      if (cons.callButtons) {\n        pluginCallButtons = cons.callButtons;\n        core.initPlugins = {};\n      }\n\n      if (cons.plugins) {\n        core.plugins = plugins = cons.plugins;\n      } // reset context\n\n\n      if (el._menuTray.children.length === 0) this._menuTray = {};\n      _responsiveButtons = cons.toolbar.responsiveButtons;\n      core.options = options = mergeOptions;\n      core.lang = lang = options.lang;\n\n      if (options.iframe) {\n        el.wysiwygFrame.addEventListener('load', function () {\n          util._setIframeDocument(this, options);\n\n          core._setOptionsInit(el, _initHTML);\n        });\n      }\n\n      el.editorArea.appendChild(el.wysiwygFrame);\n\n      if (!options.iframe) {\n        core._setOptionsInit(el, _initHTML);\n      }\n    },\n\n    /**\r\n     * @description Set \"options.defaultStyle\" style.\r\n     * Define the style of the edit area\r\n     * It can also be defined with the \"setOptions\" method, but the \"setDefaultStyle\" method does not render the editor again.\r\n     * @param {String} style Style string\r\n     */\n    setDefaultStyle: function (style) {\n      const newStyles = options._editorStyles = util._setDefaultOptionStyle(options, style);\n\n      const el = context.element; // top area\n\n      el.topArea.style.cssText = newStyles.top; // code view\n\n      el.code.style.cssText = options._editorStyles.frame;\n      el.code.style.display = 'none';\n\n      if (options.height === 'auto') {\n        el.code.style.overflow = 'hidden';\n      } else {\n        el.code.style.overflow = '';\n      } // wysiwyg frame\n\n\n      if (!options.iframe) {\n        el.wysiwygFrame.style.cssText = newStyles.frame + newStyles.editor;\n      } else {\n        el.wysiwygFrame.style.cssText = newStyles.frame;\n        el.wysiwyg.style.cssText = newStyles.editor;\n      }\n    },\n\n    /**\r\n     * @description Open a notice area\r\n     * @param {String} message Notice message\r\n     */\n    noticeOpen: function (message) {\n      core.notice.open.call(core, message);\n    },\n\n    /**\r\n     * @description Close a notice area\r\n     */\n    noticeClose: function () {\n      core.notice.close.call(core);\n    },\n\n    /**\r\n     * @description Copying the contents of the editor to the original textarea\r\n     */\n    save: function () {\n      context.element.originElement.value = core.getContents(false);\n    },\n\n    /**\r\n     * @description Gets the suneditor's context object. Contains settings, plugins, and cached element objects\r\n     * @returns {Object}\r\n     */\n    getContext: function () {\n      return context;\n    },\n\n    /**\r\n     * @description Gets the contents of the suneditor\r\n     * @param {Boolean} onlyContents - Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {String}\r\n     */\n    getContents: function (onlyContents) {\n      return core.getContents(onlyContents);\n    },\n\n    /**\r\n     * @description Gets only the text of the suneditor contents\r\n     * @returns {String}\r\n     */\n    getText: function () {\n      return context.element.wysiwyg.textContent;\n    },\n\n    /**\r\n     * @description Get the editor's number of characters or binary data size.\r\n     * You can use the \"charCounterType\" option format.\r\n     * @param {String|null} charCounterType options - charCounterType ('char', 'byte', 'byte-html')\r\n     * If argument is no value, the currently set \"charCounterType\" option is used.\r\n     * @returns {Number}\r\n     */\n    getCharCount: function (charCounterType) {\n      charCounterType = typeof charCounterType === 'string' ? charCounterType : options.charCounterType;\n      return core.getCharLength(core._charTypeHTML ? context.element.wysiwyg.innerHTML : context.element.wysiwyg.textContent, charCounterType);\n    },\n\n    /**\r\n     * @description Gets uploaded images informations\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @returns {Array}\r\n     */\n    getImagesInfo: function () {\n      return context.image ? context.image._infoList : [];\n    },\n\n    /**\r\n     * @description Gets uploaded files(plugin using fileManager) information list.\r\n     * image: [img], video: [video, iframe], audio: [audio]\r\n     * When the argument value is 'image', it is the same function as \"getImagesInfo\".\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @param {String} pluginName Plugin name (image, video, audio)\r\n     * @returns {Array}\r\n     */\n    getFilesInfo: function (pluginName) {\n      return context[pluginName] ? context[pluginName]._infoList : [];\n    },\n\n    /**\r\n     * @description Upload images using image plugin\r\n     * @param {FileList} files FileList\r\n     */\n    insertImage: function (files) {\n      if (!core.plugins.image || !files) return;\n      if (!core.initPlugins.image) core.callPlugin('image', core.plugins.image.submitAction.bind(core, files), null);else core.plugins.image.submitAction.call(core, files);\n      core.focus();\n    },\n\n    /**\r\n     * @description Inserts an HTML element or HTML string or plain string at the current cursor position\r\n     * @param {Element|String} html HTML Element or HTML string or plain string\r\n     * @param {Boolean} notCleaningData If true, inserts the HTML string without refining it with core.cleanHTML.\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @param {Boolean} rangeSelection If true, range select the inserted node.\r\n     */\n    insertHTML: function (html, notCleaningData, checkCharCount, rangeSelection) {\n      if (typeof html === 'string') {\n        if (!notCleaningData) html = core.cleanHTML(html, null);\n\n        try {\n          const dom = _d.createRange().createContextualFragment(html);\n\n          const domTree = dom.childNodes;\n\n          if (checkCharCount) {\n            const type = core._charTypeHTML ? 'outerHTML' : 'textContent';\n            let checkHTML = '';\n\n            for (let i = 0, len = domTree.length; i < len; i++) {\n              checkHTML += domTree[i][type];\n            }\n\n            if (!core.checkCharCount(checkHTML, null)) return;\n          }\n\n          let c, a, t, prev, firstCon;\n\n          while (c = domTree[0]) {\n            if (prev && prev.nodeType === 3 && a && a.nodeType === 1 && util.isBreak(c)) {\n              prev = c;\n              util.removeItem(c);\n              continue;\n            }\n\n            t = core.insertNode(c, a, false);\n            a = t.container || t;\n            if (!firstCon) firstCon = t;\n            prev = c;\n          }\n\n          if (prev.nodeType === 3 && a.nodeType === 1) a = prev;\n          const offset = a.nodeType === 3 ? t.endOffset || a.textContent.length : a.childNodes.length;\n          if (rangeSelection) core.setRange(firstCon.container || firstCon, firstCon.startOffset || 0, a, offset);else core.setRange(a, offset, a, offset);\n        } catch (error) {\n          console.warn('[SUNEDITOR.insertHTML.fail] ' + error);\n          core.execCommand('insertHTML', false, html);\n        }\n      } else {\n        if (util.isComponent(html)) {\n          core.insertComponent(html, false, checkCharCount, false);\n        } else {\n          let afterNode = null;\n\n          if (util.isFormatElement(html) || util.isMedia(html)) {\n            afterNode = util.getFormatElement(core.getSelectionNode(), null);\n          }\n\n          core.insertNode(html, afterNode, checkCharCount);\n        }\n      }\n\n      core.effectNode = null;\n      core.focus(); // history stack\n\n      core.history.push(false);\n    },\n\n    /**\r\n     * @description Change the contents of the suneditor\r\n     * @param {String|undefined} contents Contents to Input\r\n     */\n    setContents: function (contents) {\n      core.setContents(contents);\n    },\n\n    /**\r\n     * @description Add contents to the suneditor\r\n     * @param {String} contents Contents to Input\r\n     */\n    appendContents: function (contents) {\n      const convertValue = core.convertContentsForEditor(contents);\n\n      if (!core._variable.isCodeView) {\n        const temp = util.createElement('DIV');\n        temp.innerHTML = convertValue;\n        const wysiwyg = context.element.wysiwyg;\n        const children = temp.children;\n\n        for (let i = 0, len = children.length; i < len; i++) {\n          wysiwyg.appendChild(children[i]);\n        }\n      } else {\n        core._setCodeView(core._getCodeView() + '\\n' + core.convertHTMLForCodeView(convertValue));\n      } // history stack\n\n\n      core.history.push(false);\n    },\n\n    /**\r\n     * @description Disable the suneditor\r\n     */\n    disabled: function () {\n      context.tool.cover.style.display = 'block';\n      context.element.wysiwyg.setAttribute('contenteditable', false);\n      core.isDisabled = true;\n\n      if (options.codeMirrorEditor) {\n        options.codeMirrorEditor.setOption('readOnly', true);\n      } else {\n        context.element.code.setAttribute('disabled', 'disabled');\n      }\n    },\n\n    /**\r\n     * @description Enable the suneditor\r\n     */\n    enabled: function () {\n      context.tool.cover.style.display = 'none';\n      context.element.wysiwyg.setAttribute('contenteditable', true);\n      core.isDisabled = false;\n\n      if (options.codeMirrorEditor) {\n        options.codeMirrorEditor.setOption('readOnly', false);\n      } else {\n        context.element.code.removeAttribute('disabled');\n      }\n    },\n\n    /**\r\n     * @description Show the suneditor\r\n     */\n    show: function () {\n      const topAreaStyle = context.element.topArea.style;\n      if (topAreaStyle.display === 'none') topAreaStyle.display = options.display;\n    },\n\n    /**\r\n     * @description Hide the suneditor\r\n     */\n    hide: function () {\n      context.element.topArea.style.display = 'none';\n    },\n\n    /**\r\n     * @description Destroy the suneditor\r\n     */\n    destroy: function () {\n      /** off menus */\n      core.submenuOff();\n      core.containerOff();\n      core.controllersOff();\n      if (core.notice) core.notice.close.call(core);\n      if (core.modalForm) core.plugins.dialog.close.call(core);\n      /** remove history */\n\n      core.history._destroy();\n      /** remove event listeners */\n\n\n      event._removeEvent();\n      /** remove element */\n\n\n      util.removeItem(context.element.toolbar);\n      util.removeItem(context.element.topArea);\n      /** remove object reference */\n\n      for (let k in core.functions) {\n        if (util.hasOwn(core, k)) delete core.functions[k];\n      }\n\n      for (let k in core) {\n        if (util.hasOwn(core, k)) delete core[k];\n      }\n\n      for (let k in event) {\n        if (util.hasOwn(event, k)) delete event[k];\n      }\n\n      for (let k in context) {\n        if (util.hasOwn(context, k)) delete context[k];\n      }\n\n      for (let k in pluginCallButtons) {\n        if (util.hasOwn(pluginCallButtons, k)) delete pluginCallButtons[k];\n      }\n      /** remove user object */\n\n\n      for (let k in this) {\n        if (util.hasOwn(this, k)) delete this[k];\n      }\n    },\n\n    /**\r\n     * @description Toolbar methods\r\n     */\n    toolbar: {\n      /**\r\n       * @description Disable the toolbar\r\n       */\n      disabled: function () {\n        context.tool.cover.style.display = 'block';\n      },\n\n      /**\r\n       * @description Enable the toolbar\r\n       */\n      enabled: function () {\n        context.tool.cover.style.display = 'none';\n      },\n\n      /**\r\n       * @description Show the toolbar\r\n       */\n      show: function () {\n        if (core._isInline) {\n          event._showToolbarInline();\n        } else {\n          context.element.toolbar.style.display = '';\n          context.element._stickyDummy.style.display = '';\n        }\n      },\n\n      /**\r\n       * @description Hide the toolbar\r\n       */\n      hide: function () {\n        if (core._isInline) {\n          event._hideToolbar();\n        } else {\n          context.element.toolbar.style.display = 'none';\n          context.element._stickyDummy.style.display = 'none';\n        }\n      }\n    }\n  };\n  /************ Core init ************/\n  // functions\n\n  core.functions = functions;\n  core.options = options; // Create to sibling node\n\n  let contextEl = context.element;\n  let originEl = contextEl.originElement;\n  let topEl = contextEl.topArea;\n  originEl.style.display = 'none';\n  topEl.style.display = 'block'; // init\n\n  if (options.iframe) {\n    contextEl.wysiwygFrame.addEventListener('load', function () {\n      util._setIframeDocument(this, options);\n\n      core._editorInit(false, options.value);\n\n      options.value = null;\n    });\n  } // insert editor element\n\n\n  if (typeof originEl.nextElementSibling === 'object') {\n    originEl.parentNode.insertBefore(topEl, originEl.nextElementSibling);\n  } else {\n    originEl.parentNode.appendChild(topEl);\n  }\n\n  contextEl.editorArea.appendChild(contextEl.wysiwygFrame);\n  contextEl = originEl = topEl = null; // init\n\n  if (!options.iframe) {\n    core._editorInit(false, options.value);\n\n    options.value = null;\n  }\n\n  return functions;\n}","map":{"version":3,"sources":["/home/shubham/Projects/Transgazination_Project/TG_UI/node_modules/suneditor/src/lib/core.js"],"names":["_Constructor","_Context","_history","_util","_notice","context","pluginCallButtons","plugins","lang","options","_responsiveButtons","_d","element","originElement","ownerDocument","document","_w","defaultView","window","util","icons","core","_parser","DOMParser","_wd","_ww","_shadowRoot","_shadowRootControllerEventTarget","functions","wwComputedStyle","getComputedStyle","wysiwyg","notice","history","initPlugins","_targetPlugins","_menuTray","effectNode","submenu","container","_submenuName","_bindedSubmenuOff","_bindedContainerOff","submenuActiveButton","containerActiveButton","controllerArray","currentControllerName","currentControllerTarget","currentFileComponentInfo","codeViewDisabledButtons","resizingDisabledButtons","_moreLayerActiveButton","_htmlCheckWhitelistRegExp","_disallowedTextTagsRegExp","editorTagsWhitelistRegExp","pasteTagsWhitelistRegExp","hasFocus","isDisabled","_attributesWhitelistRegExp","_attributesTagsWhitelist","_bindControllersOff","_isInline","_isBalloon","_isBalloonAlways","_inlineToolbarAttr","top","width","isShow","_notHideToolbar","_sticky","_antiBlur","_lineBreaker","_lineBreakerButton","_componentsInfoInit","_componentsInfoReset","activePlugins","managedTagsInfo","_charTypeHTML","_fileInfoPluginsCheck","_fileInfoPluginsReset","_fileManager","tags","regExp","queryString","pluginRegExp","pluginMap","commandMap","_styleCommandMap","_defaultCommand","bold","textTags","underline","italic","strike","subscript","sub","superscript","sup","_variable","isChanged","isCodeView","isFullScreen","innerHeight_fullScreen","resizeClientY","tabSize","codeIndent","minResizingSize","getNumber","wysiwygFrame","style","minHeight","currentNodes","currentNodesMap","_range","_selectionNode","_originCssText","topArea","cssText","_bodyOverflow","_editorAreaOriginCssText","_wysiwygOriginCssText","_codeOriginCssText","_fullScreenAttrs","sticky","balloon","inline","_lineBreakComp","_lineBreakDir","callPlugin","pluginName","callBackFunction","_target","Error","add","initMenuTarget","active","push","addModule","moduleArray","i","len","length","moduleName","name","getGlobalScrollOffset","t","l","el","scrollTop","scrollLeft","parentElement","host","left","target","menu","appendChild","getAttribute","submenuOn","controllersOff","submenuName","_setMenuPosition","submenuOff","bind","addDocEvent","on","call","removeDocEvent","display","removeClass","containerOn","containerName","_containerName","containerOff","visibility","height","addClass","toolbar","toolbarW","offsetWidth","toolbarOffset","event","_getEditorOffsets","menuW","offsetLeft","rtl","elementW","rtlW","rtlL","overLeft","offsetEl","offsetTop","offsetParent","bt","offsetHeight","toolbarTop","menuHeight","menuHeight_bottom","innerHeight","menuTop","insTop","menuHeight_top","controllersOn","arg","arguments","hasClass","getFileComponent","indexOf","addEventListener","e","preventDefault","stopPropagation","showController","contains","test","type","keyCode","lineBreaker_t","lineBreaker_b","setControllerPosition","controller","referEl","position","addOffset","offset","getOffset","topMargin","controllerW","referElW","allow","firstElementChild","overSize","execCommand","command","showDefaultUI","value","nativeFocus","caption","getParentElement","getSelectionNode","focus","_editorRange","iframe","range","getRange","startContainer","endContainer","isWysiwygDiv","currentNode","commonAncestorContainer","children","startOffset","isFormatElement","isComponent","format","createElement","defaultTag","br","insertBefore","setRange","endOffset","_applyTagEffects","_toggleToolbarBalloon","focusEdge","focusEl","lastElementChild","fileComponentInfo","selectComponent","getChildElement","current","childNodes","nodeType","textContent","blur","startCon","startOff","endCon","endOff","createRange","setStart","setEnd","error","console","warn","selection","getSelection","removeAllRanges","addRange","removeRange","key","hasOwn","OUTDENT","setAttribute","INDENT","removeAttribute","_createDefaultRange","collapsed","isCollapsed","focusNode","rangeCount","getRangeAt","sc","anchorNode","ec","so","anchorOffset","eo","focusOffset","compareValue","compareElements","rightDir","ancestor","result","getRange_addLine","_selectionVoid","op","innerHTML","nextElementSibling","selectionNode","firstChild","extentNode","comm","nodeName","isMediaComponent","_resetRangeToTextNode","tempCon","tempOffset","tempChild","lastChild","isBreak","onlyBreak","nextSibling","getFormatElement","getRangeFormatElement","isCell","parentNode","emptyText","createTextNode","zeroWidthSpace","previousElementSibling","previousSibling","removeItem","getSelectedElements","validation","trim","commonCon","lineNodes","getListChildren","isRangeFormatElement","unshift","startLine","endLine","startIdx","endIdx","onlyTable","isTable","startRangeEl","endRangeEl","isListCell","sameRange","line","slice","getSelectedElementsAndComponents","removeDuplicate","myComponent","selectedLines","component","j","splice","isEdgePoint","dir","nodeValue","_isEdgeFormat","node","cloneNode","showLoading","loading","closeLoading","appendFormatTag","formatNode","currentFormatEl","oFormatName","isFreeFormatElement","oFormat","copyTagAttributes","insertComponent","notHistoryPush","checkCharCount","notSelect","r","removeNode","oNode","formatEl","insertNode","depthFormat","splitElement","getElementDepth","onlyZeroWidthSpace","getEdgeChildNodes","className","querySelector","toLowerCase","isUneditableComponent","plugin","setTimeout","select","_setComponentLineBreaker","t_style","b_style","resizing","resizeContainer","isList","componentTop","wScroll","w","afterNode","freeFormat","getFreeFormatElement","isFormats","isMedia","formatRange","originAfter","splitText","c","removeChild","isSameContainer","removedTag","prevContainer","sameParent","oldParent","rangeCon","fNode","cItem","isEmptyLine","_setIntoFreeFormat","previous","next","previousText","nextText","newRange","zeroWidth","_isIgnoreNodeChange","oNodeChildren","lastONode","beforeNode","getListChildNodes","startIndex","getArrayIndex","endIndex","startNode","endNode","remove","item","list","getArrayItem","child","removeItemAllParents","data","undefined","substringData","rc","text","applyRangeFormatElement","rangeElement","rangeLines","linesLoop","nested","fEl","lEl","f","last","standTag","beforeTag","pElement","parentDepth","listParent","lineArr","removeItems","parent","origin","before","cc","originParent","depth","nextLine","nextList","p","edge","detachRangeFormatElement","cLen","removeArray","mergeSameTags","mergeNestedTags","splitRange","selectedFormats","newRangeElement","firstNode","lastNode","rangeEl","newList","insertedNew","reset","moveComplete","appendNode","insNode","sibling","originNode","insChildren","first","_notTextNode","originNext","detachRange","detachNestedList","fChildren","lineIndex","insNext","inner","innerChildren","copyFormatAttributes","rangeParent","rangeRight","removeEmptyNode","childEdge","detachList","rangeArr","listFirst","listLast","passComponent","o","lastIndex","nodeChange","styleArray","removeNodeArray","strictRemove","isRemoveNode","isRemoveFormat","isNonEditable","wRegExp","RegExp","newNodeName","sNode","checkCnt","checkAttrs","checkStyles","ckeckClasses","classList","s","classReg","replace","styleCheck","classCheck","match","start","end","newNode","styleRegExp","classRegExp","removeNodeRegExp","wBoolean","Boolean","_removeCheck","v","checkNode","vNode","tagRemove","originStyle","originClasses","classes","oneLine","endLength","isRemoveAnchor","arr","n","_isMaintainedNode","_isSizeNode","isSizeNode","_getMaintainedNode","_util_getMaintainedNode","_util_isMaintainedNode","_nodeChange_oneLine","_setCommonListStyle","_nodeChange_endLine","_nodeChange_middleLine","_nodeChange_startLine","childStyle","elStyle","fontWeight","color","fontSize","_stripRemoveNode","_isRemove","anchor","newInnerNode","parentCon","sameTag","z","nNodeArray","pNode","isSameNode","startPass","endPass","pCurrent","checkCss","recursionFunc","coverNode","prevNode","textNode","a","m","prevAnchorNode","substr","childNode","pop","anchors","concat","afterAnchorNode","aChildren","aLen","ancestorAnchorNode","textNode_s","textNode_e","replaceChild","rChildren","endConReset","newStartOffset","startPath","getNodePath","mergeEndCon","newEndOffset","endPath","newOffsets","getNodeFromPath","_endContainer","passNode","cloneChild","isTopNode","offsets","path","tempNode","newCssText","newClass","noneChange","actionCall","layer","_showToolbarBalloon","_showToolbarInline","open","action","commandHandler","info","toggleCodeView","toggleFullScreen","indent","undo","redo","removeFormat","print","preview","toggleDisplayBlocks","callBackSave","getContents","save","tool","nodesMap","cmd","cells","shift","marginDir","margin","setStyle","editInsideList","toggleClass","showBlocks","_resourcesStateChange","setDisabledButtons","_setCodeDataToEditor","code","codeMirrorEditor","mode","_arrow","_hideToolbar","codeView","_resetCachingButton","_setEditorDataToCodeView","scrollHeight","refresh","_checkPlaceholder","code_html","_getCodeView","fullPage","parseDocument","parseFromString","headChildren","head","tagName","body","convertContentsForEditor","attrs","attributes","editableClasses","_editableClass","split","codeContents","convertHTMLForCodeView","codeValue","getAttributesToString","outerHTML","_setCodeView","editorArea","_var","toolbarContainer","relative","maxWidth","zIndex","_stickyDummy","overflow","fullScreenOffset","changeElement","reduction","_iframeAutoHeight","marginTop","fullScreen","stickyToolbar","onScroll_window","expansion","contentsHTML","printTemplate","printDocument","getIframeDocument","wDoc","arrts","_printClass","write","links","getElementsByTagName","styles","linkHTML","isIE_Edge","documentMode","StyleMedia","contentWindow","previewTemplate","windowObject","mimeType","setContents","html","convertValue","_resetComponents","setIframeContents","ctx","onlyContents","contents","renderHTML","figcaptions","_makeLine","requireFormat","_disallowedTags","isAnchor","_HTMLConvertor","textArray","tLen","_allowHTMLComments","_tagConvertor","_textTagsMap","_deleteDisallowedTags","_cleanTags","rowLevelCheck","tAttr","toString","sv","cleanHTML","whitelist","dom","createContextualFragment","_consistencyCheckOfHTML","query","textCompList","querySelectorAll","initMethod","map","domTree","isTextStyleElement","htmlRemoveWhiteSpace","createTagsWhitelist","returnHTML","brReg","isFormat","indentSize","Array","join","lineBR","elementRegTest","elementIndent","nodeRegTest","tag","tagIndent","XMLSerializer","serializeToString","listener","useCapture","removeEventListener","_charCount","inputText","maxCharCount","countType","charCounterType","nextCharCount","getCharLength","_setCharCount","over","count","getCharCount","slicePosition","_callCounterBlink","content","getByteLength","charCounter","charWrapper","_checkComponents","getDoc","setValue","getValue","_init","reload","_initHTML","ShadowRoot","shadowRoot","disallowTextTags","Object","keys","allowTextTags","addTagsWhitelist","filter","defaultAttr","_editorTagsWhitelist","pasteTagsWhitelist","regEndStr","_attr","attributesWhitelist","tagsAttr","allAttr","k","_cachingButtons","managedClass","filePluginRegExp","button","checkFileInfo","resetFileInfo","isArray","fileTags","managedTags","method","_placeholder","placeholder","lineBreaker","_onChange_historyStack","contentDocument","_editorStyles","editor","_iframeAuto","_initWysiwygArea","_buttonTray","SUB","SUP","outdent","toUpperCase","onChange","_allowedEmptyNodeList","innerText","_setDefaultFormat","formatName","fileComponent","_setOptionsInit","_getConstructed","_editorInit","_addEvent","_offStickyToolbar","onResize_window","onload","contextEl","_top","_relative","_toolBar","_editorArea","_wysiwygArea","_codeArea","_resizingBar","resizingBar","_navigation","navigation","_charCounter","_charWrapper","_loading","_lineBreaker_t","_lineBreaker_b","_resizeBack","resizeBackground","_IEisComposing","_lineBreakerBind","_responsiveCurrentSize","_responsiveButtonSize","_directionKeyCode","_nonTextKeyCode","_historyIgnoreKeyCode","_onButtonsCheck","_frontZeroWidthReg","_keyCodeShortcut","_shortcutCommand","keyStr","shortcutsDisable","classOnCheck","commandMapNodes","reverse","showPathLabel","_cancelCaptionEdit","_buttonsEventHandler","onClick_toolbar","disabled","onMouseDown_wysiwyg","onMouseDown","tableCell","tablePlugin","table","_fixedCell","_shift","onTableCellMultiSelect","onClick_wysiwyg","targetElement","onClick","figcaption","hideToolbar","oLi","prevLi","_balloonDelay","_showToolbarBalloonDelay","clearTimeout","rangeObj","isDirTop","rects","getClientRects","globalScroll","editorWidth","stickyTop","editorLeft","nodeOffset","right","bottom","noText","arrowMargin","Math","round","toolbarWidth","toolbarHeight","iframeRects","_setToolbarOffset","editorParent","padding","absoluteLeft","overRight","resetTop","space","_getPageBottomSpace","documentElement","floor","arrow_left","showInline","onInput_wysiwyg","onInput","_isUneditableNode","isFront","siblingKey","isElement","siblingNode","_isUneditableNode_getSibling","selectNode","_onShortcutKey","onKeyDown_wysiwyg","shiftKey","ctrl","ctrlKey","metaKey","alt","altKey","onKeyDown","selectRange","fileComponentName","destroy","_hardDelete","isClosureFreeFormatElement","isClosureRangeFormatElement","defaultFormat","prev","prevLast","con","after","detach","sel","ignoreZWS","nextEl","cell","tabDisable","isEdge","lines","fc","lc","idx","prevIdx","nextIdx","moveCell","tabText","textRange","endChild","freeFormatEl","enterHTML","formatInners","temp","newFormat","innerNode","selectionFormat","wSelection","newEl","insertHTML","wOffset","focusNext","brPrev","brNext","newListCell","compContext","_container","_element","_ref","isOSX_IOS","nbsp","textKey","onKeyUp_wysiwyg","onKeyUp","oFormatTag","zeroWidthRegExp","isComposing","frontZeroWidthCnt","substring","onScroll_wysiwyg","onScroll","onFocus_wysiwyg","onFocus","onBlur_wysiwyg","onBlur","onMouseDown_resizingBar","prevHeight","clientY","closureFunc","_resize_editor","onResizeEditor","resizeInterval","responsiveSize","responsiveWidth","setToolbarButtons","fileBrowser","area","maxHeight","header","editorHeight","y","scrollY","editorTop","_onStickyToolbar","scroll","_codeViewAutoHeight","sCell","eCell","sIsCell","eIsCell","sComp","eComp","onPaste_wysiwyg","clipboardData","isIE","_dataTransferAction","_setClipboardComponent","setData","onCopy_wysiwyg","onCopy","onCut_wysiwyg","onCut","onDrop_wysiwyg","dataTransfer","_setDropLocationSelection","rangeOffset","caretRangeFromPoint","clientX","plainText","cleanData","getData","tempDiv","tempRange","_setClipboardData","MSData","onlyText","onPaste","onDrop","files","image","insertImage","onMouseMove_wysiwyg","lineBreakerStyle","ctxEl","pageY","_onMouseDown_lineBreak","_onLineBreak","eventWysiwyg","b","passive","_setResponsiveToolbar","_removeEvent","sizeArray","buttonsObj","default","size","buttonGroup","sort","imageUploadHandler","videoUploadHandler","audioUploadHandler","onImageUploadBefore","onVideoUploadBefore","onAudioUploadBefore","onImageUpload","onVideoUpload","onAudioUpload","onImageUploadError","onVideoUploadError","onAudioUploadError","buttonList","newToolbar","_createToolBar","responsiveButtons","newContext","oldCallButtons","oldButton","setOptions","_options","mergeOptions","reduce","init","option","val","cons","_setOptions","callButtons","_setIframeDocument","setDefaultStyle","newStyles","_setDefaultOptionStyle","frame","noticeOpen","message","noticeClose","close","getContext","getText","getImagesInfo","_infoList","getFilesInfo","submitAction","notCleaningData","rangeSelection","checkHTML","firstCon","appendContents","cover","setOption","enabled","show","topAreaStyle","hide","modalForm","dialog","_destroy","originEl","topEl"],"mappings":"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CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IA9IP;;AA+Id;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IA1KP;;AA2Kd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IAnMP;;AAqMd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IArND;;AAsNb;AACT;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IA1ND;;AA2Nb;AACT;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IA/ND;;AAiOd;AACR;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IAxON;;AAyOd;AACR;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IA7ON;;AA8Od;AACR;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IAlPN;;AAoPd;AACR;AACA;AACQ/E,IAAAA,cAAc,EAAE,IAvPF;;AAyPd;AACR;AACA;AACA;AACA;AACQI,IAAAA,iBAAiB,EAAE,UAAU4E,UAAV,EAAsB;AACrCtlC,MAAAA,IAAI,CAAC4I,UAAL;AACA5I,MAAAA,IAAI,CAACuJ,YAAL;;AAEA,YAAMg8B,UAAU,GAAG5mC,YAAY,CAAC6mC,cAAb,CAA4BlmC,EAA5B,EAAgCgmC,UAAhC,EAA4CtlC,IAAI,CAACd,OAAjD,EAA0DE,OAA1D,CAAnB;;AACAC,MAAAA,kBAAkB,GAAGkmC,UAAU,CAACE,iBAAhC;AACA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","sourcesContent":["/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\r\n'use strict';\r\n\r\nimport _Constructor from './constructor';\r\nimport _Context from './context';\r\nimport _history from './history';\r\nimport _util from './util';\r\nimport _notice from '../plugins/modules/_notice';\r\n\r\n/**\r\n * @description SunEditor constuctor function.\r\n * create core object and event registration.\r\n * core, event, functions\r\n * @param {Object} context\r\n * @param {Object} pluginCallButtons\r\n * @param {Object} plugins \r\n * @param {Object} lang\r\n * @param {Object} options\r\n * @param {Object} _responsiveButtons\r\n * @returns {Object} functions Object\r\n */\r\nexport default function (context, pluginCallButtons, plugins, lang, options, _responsiveButtons) {\r\n    const _d = context.element.originElement.ownerDocument || document;\r\n    const _w = _d.defaultView || window;\r\n    const util = _util;\r\n    const icons = options.icons;\r\n\r\n    /**\r\n     * @description editor core object\r\n     * should always bind this object when registering an event in the plug-in.\r\n     */\r\n    const core = {\r\n        _d: _d,\r\n        _w: _w,\r\n        _parser: new _w.DOMParser(),\r\n\r\n        /**\r\n         * @description Document object of the iframe if created as an iframe || _d\r\n         * @private\r\n         */\r\n        _wd: null,\r\n\r\n        /**\r\n         * @description Window object of the iframe if created as an iframe || _w\r\n         * @private\r\n         */\r\n        _ww: null,\r\n        \r\n        /**\r\n         * @description Closest ShadowRoot to editor if found\r\n         * @private\r\n         */\r\n        _shadowRoot: null,\r\n\r\n        /**\r\n         * @description Block controller mousedown events in \"shadowRoot\" environment\r\n         * @private\r\n         */\r\n        _shadowRootControllerEventTarget: null,\r\n\r\n        /**\r\n         * @description Util object\r\n         */\r\n        util: util,\r\n\r\n        /**\r\n         * @description Functions object\r\n         */\r\n        functions: null,\r\n\r\n        /**\r\n         * @description Editor options\r\n         */\r\n        options: null,\r\n\r\n        /**\r\n         * @description Computed style of the wysiwyg area (window.getComputedStyle(context.element.wysiwyg))\r\n         */\r\n        wwComputedStyle: _w.getComputedStyle(context.element.wysiwyg),\r\n\r\n        /**\r\n         * @description Notice object\r\n         */\r\n        notice: _notice,\r\n\r\n        /**\r\n         * @description Default icons object\r\n         */\r\n        icons: icons,\r\n\r\n        /**\r\n         * @description History object for undo, redo\r\n         */\r\n        history: null,\r\n        \r\n        /**\r\n         * @description Elements and user options parameters of the suneditor\r\n         */\r\n        context: context,\r\n\r\n        /**\r\n         * @description Plugin buttons\r\n         */\r\n        pluginCallButtons: pluginCallButtons,\r\n\r\n        /**\r\n         * @description Loaded plugins\r\n         */\r\n        plugins: plugins || {},\r\n\r\n        /**\r\n         * @description Whether the plugin is initialized\r\n         */\r\n        initPlugins: {},\r\n\r\n        /**\r\n         * @description Object for managing submenu elements\r\n         * @private\r\n         */\r\n        _targetPlugins: {},\r\n\r\n        /**\r\n         * @description Save rendered submenus and containers\r\n         * @private\r\n         */\r\n        _menuTray: {},\r\n\r\n        /**\r\n         * @description loaded language\r\n         */\r\n        lang: lang,\r\n\r\n        /**\r\n         * @description The selection node (core.getSelectionNode()) to which the effect was last applied\r\n         */\r\n        effectNode: null,\r\n\r\n        /**\r\n         * @description submenu element\r\n         */\r\n        submenu: null,\r\n\r\n        /**\r\n         * @description container element\r\n         */\r\n        container: null,\r\n\r\n        /**\r\n         * @description current subment name\r\n         * @private\r\n         */\r\n        _submenuName: '',\r\n\r\n        /**\r\n         * @description binded submenuOff method\r\n         * @private\r\n         */\r\n        _bindedSubmenuOff: null,\r\n\r\n        /**\r\n         * @description binded containerOff method\r\n         * @private\r\n         */\r\n        _bindedContainerOff: null,\r\n\r\n        /**\r\n         * @description active button element in submenu\r\n         */\r\n        submenuActiveButton: null,\r\n\r\n        /**\r\n         * @description active button element in container\r\n         */\r\n        containerActiveButton: null,\r\n\r\n        /**\r\n         * @description The elements array to be processed unvisible when the controllersOff function is executed (resizing, link modified button, table controller)\r\n         */\r\n        controllerArray: [],\r\n\r\n        /**\r\n         * @description The name of the plugin that called the currently active controller\r\n         */\r\n        currentControllerName: '',\r\n\r\n        /**\r\n         * @description The target element of current controller\r\n         */\r\n        currentControllerTarget: null,\r\n\r\n        /**\r\n         * @description The file component object of current selected file tag (getFileComponent)\r\n         */\r\n        currentFileComponentInfo: null,\r\n\r\n        /**\r\n         * @description An array of buttons whose class name is not \"se-code-view-enabled\"\r\n         */\r\n        codeViewDisabledButtons: null,\r\n\r\n        /**\r\n         * @description An array of buttons whose class name is not \"se-resizing-enabled\"\r\n         */\r\n        resizingDisabledButtons: null,\r\n\r\n        /**\r\n         * @description active more layer element in submenu\r\n         * @private\r\n         */\r\n        _moreLayerActiveButton: null,\r\n\r\n        /**\r\n         * @description Tag whitelist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n         * ^(options._editorTagsWhitelist)$\r\n         * @private\r\n         */\r\n        _htmlCheckWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description RegExp when using check disallowd tags. (b, i, ins, strike, s)\r\n         * @private\r\n         */\r\n        _disallowedTextTagsRegExp: null,\r\n\r\n        /**\r\n         * @description Editor tags whitelist (RegExp object)\r\n         * util.createTagsWhitelist(options._editorTagsWhitelist)\r\n         */\r\n        editorTagsWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Tag whitelist when pasting (RegExp object)\r\n         * util.createTagsWhitelist(options.pasteTagsWhitelist)\r\n         */\r\n        pasteTagsWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor has focus\r\n         */\r\n        hasFocus: false,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor is disabled\r\n         */\r\n        isDisabled: false,\r\n\r\n        /**\r\n         * @description Attributes whitelist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Attributes of tags whitelist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesTagsWhitelist: null,\r\n\r\n        /**\r\n         * @description binded controllersOff method\r\n         * @private\r\n         */\r\n        _bindControllersOff: null,\r\n\r\n        /**\r\n         * @description Is inline mode?\r\n         * @private\r\n         */\r\n        _isInline: null,\r\n\r\n        /**\r\n         * @description Is balloon|balloon-always mode?\r\n         * @private\r\n         */\r\n        _isBalloon: null,\r\n\r\n        /**\r\n         * @description Is balloon-always mode?\r\n         * @private\r\n         */\r\n        _isBalloonAlways: null,\r\n\r\n        /**\r\n         * @description Required value when using inline mode to sticky toolbar\r\n         * @private\r\n         */\r\n        _inlineToolbarAttr: {top: '', width: '', isShow: false},\r\n\r\n        /**\r\n         * @description Variable that controls the \"blur\" event in the editor of inline or balloon mode when the focus is moved to submenu\r\n         * @private\r\n         */\r\n        _notHideToolbar: false,\r\n\r\n        /**\r\n         * @description Variable value that sticky toolbar mode\r\n         * @private\r\n         */\r\n        _sticky: false,\r\n\r\n        /**\r\n         * @description Variables for controlling focus and blur events\r\n         * @private\r\n         */\r\n        _antiBlur: false,\r\n\r\n        /**\r\n         * @description Component line breaker element\r\n         * @private\r\n         */\r\n        _lineBreaker: null,\r\n        _lineBreakerButton: null,\r\n\r\n        /**\r\n         * @description If true, (initialize, reset) all indexes of image, video information\r\n         * @private\r\n         */\r\n        _componentsInfoInit: true,\r\n        _componentsInfoReset: false,\r\n\r\n        /**\r\n         * @description Plugins array with \"active\" method.\r\n         * \"activePlugins\" runs the \"add\" method when creating the editor.\r\n         */\r\n        activePlugins: null,\r\n\r\n        /**\r\n         * @description Information of tags that should maintain HTML structure, style, class name, etc. (In use by \"math\" plugin)\r\n         * When inserting \"html\" such as paste, it is executed on the \"html\" to be inserted. (core.cleanHTML)\r\n         * Basic Editor Actions:\r\n         * 1. All classes not starting with \"__se__\" or \"se-\" in the editor are removed.\r\n         * 2. The style of all tags except the \"span\" tag is removed from the editor.\r\n         * \"managedTagsInfo\" structure ex:\r\n         * managedTagsInfo: {\r\n         *   query: '.__se__xxx, se-xxx'\r\n         *   map: {\r\n         *     '__se__xxx': method.bind(core),\r\n         *     'se-xxx': method.bind(core),\r\n         *   }\r\n         * }\r\n         * @example\r\n         * Define in the following return format in the \"managedTagInfo\" function of the plugin.\r\n         * managedTagInfo() => {\r\n         *  return {\r\n         *    className: 'string', // Class name to identify the tag. (\"__se__xxx\", \"se-xxx\")\r\n         *    // Change the html of the \"element\". (\"element\" is the element found with \"className\".)\r\n         *    // \"method\" is executed by binding \"core\".\r\n         *    method: function (element) {\r\n         *      // this === core\r\n         *      element.innerHTML = // (rendered html);\r\n         *    }\r\n         *  }\r\n         * }\r\n         */\r\n        managedTagsInfo: null,\r\n\r\n        /**\r\n         * @description cashing: options.charCounterType === 'byte-html'\r\n         * @private\r\n         */\r\n        _charTypeHTML: false,\r\n\r\n        /**\r\n         * @description Array of \"checkFileInfo\" functions with the core bound\r\n         * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n         * \"fileInfoPlugins\" runs the \"add\" method when creating the editor.\r\n         * \"checkFileInfo\" method is always call just before the \"change\" event.\r\n         * @private\r\n         */\r\n        _fileInfoPluginsCheck: null,\r\n\r\n        /**\r\n         * @description Array of \"resetFileInfo\" functions with the core bound\r\n         * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n         * \"checkFileInfo\" method is always call just before the \"functions.setOptions\" method.\r\n         * @private\r\n         */\r\n        _fileInfoPluginsReset: null,\r\n\r\n        /**\r\n         * @description Variables for file component management\r\n         * @private\r\n         */\r\n        _fileManager: {\r\n            tags: null,\r\n            regExp: null,\r\n            queryString: null,\r\n            pluginRegExp: null,\r\n            pluginMap: null\r\n        },\r\n\r\n        /**\r\n         * @description Elements that need to change text or className for each selection change\r\n         * After creating the editor, \"activePlugins\" are added.\r\n         * @property {Element} STRONG bold button\r\n         * @property {Element} U underline button\r\n         * @property {Element} EM italic button\r\n         * @property {Element} DEL strike button\r\n         * @property {Element} SUB subscript button\r\n         * @property {Element} SUP superscript button\r\n         * @property {Element} OUTDENT outdent button\r\n         * @property {Element} INDENT indent button\r\n         */\r\n        commandMap: null,\r\n\r\n        /**\r\n         * @description Style button related to edit area\r\n         * @property {Element} fullScreen fullScreen button element\r\n         * @property {Element} showBlocks showBlocks button element\r\n         * @property {Element} codeView codeView button element\r\n         * @private\r\n         */\r\n        _styleCommandMap: null,\r\n\r\n        /**\r\n         * @description Map of default command\r\n         * @private\r\n         */\r\n        _defaultCommand: {\r\n            bold: options.textTags.bold,\r\n            underline: options.textTags.underline,\r\n            italic: options.textTags.italic,\r\n            strike: options.textTags.strike,\r\n            subscript: options.textTags.sub,\r\n            superscript: options.textTags.sup\r\n        },\r\n\r\n        /**\r\n         * @description Variables used internally in editor operation\r\n         * @property {Boolean} isCodeView State of code view\r\n         * @property {Boolean} isFullScreen State of full screen\r\n         * @property {Number} innerHeight_fullScreen InnerHeight in editor when in full screen\r\n         * @property {Number} resizeClientY Remember the vertical size of the editor before resizing the editor (Used when calculating during resize operation)\r\n         * @property {Number} tabSize Indent size of tab (4)\r\n         * @property {Number} codeIndent Indent size of Code view mode (2)\r\n         * @property {Number} minResizingSize Minimum size of editing area when resized {Number} (.se-wrapper-inner {min-height: 65px;} || 65)\r\n         * @property {Array} currentNodes  An array of the current cursor's node structure\r\n         * @private\r\n         */\r\n        _variable: {\r\n            isChanged: false,\r\n            isCodeView: false,\r\n            isFullScreen: false,\r\n            innerHeight_fullScreen: 0,\r\n            resizeClientY: 0,\r\n            tabSize: 4,\r\n            codeIndent: 2,\r\n            minResizingSize: util.getNumber((context.element.wysiwygFrame.style.minHeight || '65'), 0),\r\n            currentNodes: [],\r\n            currentNodesMap: [],\r\n            _range: null,\r\n            _selectionNode: null,\r\n            _originCssText: context.element.topArea.style.cssText,\r\n            _bodyOverflow: '',\r\n            _editorAreaOriginCssText: '',\r\n            _wysiwygOriginCssText: '',\r\n            _codeOriginCssText: '',\r\n            _fullScreenAttrs: {sticky: false, balloon: false, inline: false},\r\n            _lineBreakComp: null,\r\n            _lineBreakDir: ''\r\n        },\r\n\r\n        /**\r\n         * @description If the plugin is not added, add the plugin and call the 'add' function.\r\n         * If the plugin is added call callBack function.\r\n         * @param {String} pluginName The name of the plugin to call\r\n         * @param {function} callBackFunction Function to be executed immediately after module call\r\n         * @param {Element|null} _target Plugin target button (This is not necessary if you have a button list when creating the editor)\r\n         */\r\n        callPlugin: function (pluginName, callBackFunction, _target) {\r\n            _target = _target || pluginCallButtons[pluginName];\r\n\r\n            if (!this.plugins[pluginName]) {\r\n                throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:\"' + pluginName + '\")');\r\n            } else if (!this.initPlugins[pluginName]) {\r\n                this.plugins[pluginName].add(this, _target);\r\n                this.initPlugins[pluginName] = true;\r\n            } else if (typeof this._targetPlugins[pluginName] === 'object' && !!_target) {\r\n                this.initMenuTarget(pluginName, _target, this._targetPlugins[pluginName]);\r\n            }\r\n\r\n            if (this.plugins[pluginName].active && !this.commandMap[pluginName] && !!_target) {\r\n                this.commandMap[pluginName] = _target;\r\n                this.activePlugins.push(pluginName);\r\n            }\r\n                \r\n            if (typeof callBackFunction === 'function') callBackFunction();\r\n        },\r\n\r\n        /**\r\n         * @description If the module is not added, add the module and call the 'add' function\r\n         * @param {Array} moduleArray module object's Array [dialog, resizing]\r\n         */\r\n        addModule: function (moduleArray) {\r\n            for (let i = 0, len = moduleArray.length, moduleName; i < len; i++) {\r\n                moduleName = moduleArray[i].name;\r\n                if (!this.plugins[moduleName]) {\r\n                    this.plugins[moduleName] = moduleArray[i];\r\n                }\r\n                if (!this.initPlugins[moduleName]) {\r\n                    this.initPlugins[moduleName] = true;\r\n                    if (typeof this.plugins[moduleName].add === 'function') this.plugins[moduleName].add(this);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current editor-relative scroll offset.\r\n         * @returns {Object} {top, left}\r\n         */\r\n        getGlobalScrollOffset: function () {\r\n            let t = 0, l = 0;\r\n            let el = context.element.topArea;\r\n            while (el) {\r\n                t += el.scrollTop;\r\n                l += el.scrollLeft;\r\n                el = el.parentElement;\r\n            }\r\n            \r\n            el = this._shadowRoot ? this._shadowRoot.host : null;\r\n            while (el) {\r\n                t += el.scrollTop;\r\n                l += el.scrollLeft;\r\n                el = el.parentElement;\r\n            }\r\n\r\n            return {\r\n                top: t,\r\n                left: l\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Method for managing submenu element.\r\n         * You must add the \"submenu\" element using the this method at custom plugin.\r\n         * @param {String} pluginName Plugin name\r\n         * @param {Element|null} target Target button\r\n         * @param {Element} menu Submenu element\r\n         */\r\n        initMenuTarget: function (pluginName, target, menu) {\r\n            if (!target) {\r\n                this._targetPlugins[pluginName] = menu;\r\n            } else {\r\n                context.element._menuTray.appendChild(menu);\r\n                this._targetPlugins[pluginName] = true;\r\n                this._menuTray[target.getAttribute('data-command')] = menu;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Enabled submenu\r\n         * @param {Element} element Submenu's button element to call\r\n         */\r\n        submenuOn: function (element) {\r\n            if (this._bindedSubmenuOff) this._bindedSubmenuOff();\r\n            if (this._bindControllersOff) this.controllersOff();\r\n\r\n            const submenuName = this._submenuName = element.getAttribute('data-command');\r\n            const menu = this.submenu = this._menuTray[submenuName];\r\n            this.submenuActiveButton = element;\r\n            this._setMenuPosition(element, menu);\r\n            \r\n            this._bindedSubmenuOff = this.submenuOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindedSubmenuOff, false);\r\n\r\n            if (this.plugins[submenuName].on) this.plugins[submenuName].on.call(this);\r\n            this._antiBlur = true;\r\n        },\r\n\r\n        /**\r\n         * @description Disable submenu\r\n         */\r\n        submenuOff: function () {\r\n            this.removeDocEvent('mousedown', this._bindedSubmenuOff);\r\n            this._bindedSubmenuOff = null;\r\n\r\n            if (this.submenu) {\r\n                this._submenuName = '';\r\n                this.submenu.style.display = 'none';\r\n                this.submenu = null;\r\n                util.removeClass(this.submenuActiveButton, 'on');\r\n                this.submenuActiveButton = null;\r\n                this._notHideToolbar = false;\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Enabled container\r\n         * @param {Element} element Container's button element to call\r\n         */\r\n        containerOn: function (element) {\r\n            if (this._bindedContainerOff) this._bindedContainerOff();\r\n\r\n            const containerName = this._containerName = element.getAttribute('data-command');\r\n            const menu = this.container = this._menuTray[containerName];\r\n            this.containerActiveButton = element;\r\n            this._setMenuPosition(element, menu);\r\n            \r\n            this._bindedContainerOff = this.containerOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindedContainerOff, false);\r\n\r\n            if (this.plugins[containerName].on) this.plugins[containerName].on.call(this);\r\n            this._antiBlur = true;\r\n        },\r\n\r\n        /**\r\n         * @description Disable container\r\n         */\r\n        containerOff: function () {\r\n            this.removeDocEvent('mousedown', this._bindedContainerOff);\r\n            this._bindedContainerOff = null;\r\n\r\n            if (this.container) {\r\n                this._containerName = '';\r\n                this.container.style.display = 'none';\r\n                this.container = null;\r\n                util.removeClass(this.containerActiveButton, 'on');\r\n                this.containerActiveButton = null;\r\n                this._notHideToolbar = false;\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Set the menu position. (submenu, container)\r\n         * @param {*} element Button element\r\n         * @param {*} menu Menu element\r\n         * @private\r\n         */\r\n        _setMenuPosition: function (element, menu) {\r\n            menu.style.visibility = 'hidden';\r\n            menu.style.display = 'block';\r\n            menu.style.height = '';\r\n            util.addClass(element, 'on');\r\n\r\n            const toolbar = this.context.element.toolbar;\r\n            const toolbarW = toolbar.offsetWidth;\r\n            const toolbarOffset = event._getEditorOffsets(context.element.toolbar);\r\n            const menuW = menu.offsetWidth;\r\n            const l = element.parentElement.offsetLeft + 3;\r\n\r\n            // rtl\r\n            if (options.rtl) {\r\n                const elementW = element.offsetWidth;\r\n                const rtlW = menuW > elementW ? menuW - elementW : 0;\r\n                const rtlL = rtlW > 0 ? 0 : elementW - menuW;\r\n                menu.style.left = (l - rtlW + rtlL) + 'px';\r\n                if (toolbarOffset.left > event._getEditorOffsets(menu).left) {\r\n                    menu.style.left = '0px';\r\n                }\r\n            } else {\r\n                const overLeft = toolbarW <= menuW ? 0 : toolbarW - (l + menuW);\r\n                if (overLeft < 0) menu.style.left = (l + overLeft) + 'px';\r\n                else menu.style.left = l + 'px';\r\n            }\r\n\r\n            // get element top\r\n            let t = 0;\r\n            let offsetEl = element;\r\n            while (offsetEl && offsetEl !== toolbar) {\r\n                t += offsetEl.offsetTop;\r\n                offsetEl = offsetEl.offsetParent;\r\n            }\r\n\r\n            const bt = t;\r\n            if (this._isBalloon) {\r\n                t += toolbar.offsetTop + element.offsetHeight;\r\n            } else {\r\n                t -= element.offsetHeight;\r\n            }\r\n\r\n            // set menu position\r\n            const toolbarTop = toolbarOffset.top;\r\n            const menuHeight = menu.offsetHeight;\r\n            const scrollTop = this.getGlobalScrollOffset().top;\r\n\r\n            const menuHeight_bottom = _w.innerHeight - (toolbarTop - scrollTop + bt + element.parentElement.offsetHeight);\r\n            if (menuHeight_bottom < menuHeight) {\r\n                let menuTop = -1 * (menuHeight - bt + 3);\r\n                const insTop = toolbarTop - scrollTop + menuTop;\r\n                const menuHeight_top = menuHeight + (insTop < 0 ? insTop : 0);\r\n                \r\n                if (menuHeight_top > menuHeight_bottom) {\r\n                    menu.style.height = menuHeight_top + 'px';\r\n                    menuTop = -1 * (menuHeight_top - bt + 3);\r\n                } else {\r\n                    menu.style.height = menuHeight_bottom + 'px';\r\n                    menuTop = bt + element.parentElement.offsetHeight;\r\n                }\r\n\r\n                menu.style.top = menuTop + 'px';\r\n            } else {\r\n                menu.style.top = (bt + element.parentElement.offsetHeight) + 'px';\r\n            }\r\n\r\n            menu.style.visibility = '';\r\n        },\r\n\r\n        /**\r\n         * @description Show controller at editor area (controller elements, function, \"controller target element(@Required)\", \"controller name(@Required)\", etc..)\r\n         * @param {*} arguments controller elements, functions..\r\n         */\r\n        controllersOn: function () {\r\n            if (this._bindControllersOff) this._bindControllersOff();\r\n            this.controllerArray = [];\r\n\r\n            for (let i = 0, arg; i < arguments.length; i++) {\r\n                arg = arguments[i];\r\n                if (!arg) continue;\r\n                \r\n                if (typeof arg === 'string') {\r\n                    this.currentControllerName = arg;\r\n                    continue;\r\n                }\r\n                if (typeof arg === 'function') {\r\n                    this.controllerArray.push(arg);\r\n                    continue;\r\n                }\r\n                if (!util.hasClass(arg, 'se-controller')) {\r\n                    this.currentControllerTarget = arg;\r\n                    this.currentFileComponentInfo = this.getFileComponent(arg);\r\n                    continue;\r\n                }\r\n                if (arg.style) {\r\n                    arg.style.display = 'block';\r\n                    if (this._shadowRoot && this._shadowRootControllerEventTarget.indexOf(arg) === -1) {\r\n                        arg.addEventListener('mousedown', function (e) { e.preventDefault(); e.stopPropagation(); });\r\n                        this._shadowRootControllerEventTarget.push(arg);\r\n                    }\r\n                }\r\n                this.controllerArray.push(arg);\r\n            }\r\n\r\n            this._bindControllersOff = this.controllersOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindControllersOff, false);\r\n            this.addDocEvent('keydown', this._bindControllersOff, false);\r\n            this._antiBlur = true;\r\n\r\n            if (typeof functions.showController === 'function') functions.showController(this.currentControllerName, this.controllerArray, this);\r\n        },\r\n\r\n        /**\r\n         * @description Hide controller at editor area (link button, image resize button..)\r\n         * @param {KeyboardEvent|MouseEvent|null} e Event object when called from mousedown and keydown events registered in \"core.controllersOn\"\r\n         */\r\n        controllersOff: function (e) {\r\n            this._lineBreaker.style.display = 'none';\r\n            const len = this.controllerArray.length;\r\n\r\n            if (e && e.target && len > 0) {\r\n                for (let i = 0; i < len; i++) {\r\n                    if (typeof this.controllerArray[i].contains === 'function' && this.controllerArray[i].contains(e.target)) return;\r\n                }\r\n            }\r\n            \r\n            if (this._fileManager.pluginRegExp.test(this.currentControllerName) && e && e.type === 'keydown' && e.keyCode !== 27) return;\r\n            context.element.lineBreaker_t.style.display = context.element.lineBreaker_b.style.display = 'none';\r\n            this._variable._lineBreakComp = null;\r\n\r\n            this.currentControllerName = '';\r\n            this.currentControllerTarget = null;\r\n            this.currentFileComponentInfo = null;\r\n            this.effectNode = null;\r\n            if (!this._bindControllersOff) return;\r\n\r\n            this.removeDocEvent('mousedown', this._bindControllersOff);\r\n            this.removeDocEvent('keydown', this._bindControllersOff);\r\n            this._bindControllersOff = null;\r\n\r\n            if (len > 0) {\r\n                for (let i = 0; i < len; i++) {\r\n                    if (typeof this.controllerArray[i] === 'function') this.controllerArray[i]();\r\n                    else this.controllerArray[i].style.display = 'none';\r\n                }\r\n\r\n                this.controllerArray = [];\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Specify the position of the controller.\r\n         * @param {Element} controller Controller element.\r\n         * @param {Element} referEl Element that is the basis of the controller's position.\r\n         * @param {String} position Type of position (\"top\" | \"bottom\")\r\n         * When using the \"top\" position, there should not be an arrow on the controller.\r\n         * When using the \"bottom\" position there should be an arrow on the controller.\r\n         * @param {Object} addOffset These are the left and top values that need to be added specially. \r\n         * This argument is required. - {left: 0, top: 0}\r\n         * Please enter the value based on ltr mode.\r\n         * Calculated automatically in rtl mode.\r\n         */\r\n        setControllerPosition: function (controller, referEl, position, addOffset) {\r\n            if (options.rtl) addOffset.left *= -1;\r\n\r\n            const offset = util.getOffset(referEl, context.element.wysiwygFrame);\r\n            controller.style.visibility = 'hidden';\r\n            controller.style.display = 'block';\r\n\r\n            // Height value of the arrow element is 11px\r\n            const topMargin = position === 'top' ? -(controller.offsetHeight + 2) : (referEl.offsetHeight + 12);\r\n            controller.style.top = (offset.top + topMargin + addOffset.top) + 'px';\r\n\r\n            const l = offset.left - context.element.wysiwygFrame.scrollLeft + addOffset.left;\r\n            const controllerW = controller.offsetWidth;\r\n            const referElW = referEl.offsetWidth;\r\n            \r\n            const allow = util.hasClass(controller.firstElementChild, 'se-arrow') ? controller.firstElementChild : null;\r\n\r\n            // rtl (Width value of the arrow element is 22px)\r\n            if (options.rtl) {\r\n                const rtlW = (controllerW > referElW) ? controllerW - referElW : 0;\r\n                const rtlL = rtlW > 0 ? 0 : referElW - controllerW;\r\n                controller.style.left = (l - rtlW + rtlL) + 'px';\r\n                \r\n                if (rtlW > 0) {\r\n                    if (allow) allow.style.left = ((controllerW - 14 < 10 + rtlW) ? (controllerW - 14) : (10 + rtlW)) + 'px';\r\n                }\r\n                \r\n                const overSize = context.element.wysiwygFrame.offsetLeft - controller.offsetLeft;\r\n                if (overSize > 0) {\r\n                    controller.style.left = '0px';\r\n                    if (allow) allow.style.left = overSize + 'px';\r\n                }\r\n            } else {\r\n                controller.style.left = l + 'px';\r\n\r\n                const overSize = context.element.wysiwygFrame.offsetWidth - (controller.offsetLeft + controllerW);\r\n                if (overSize < 0) {\r\n                    controller.style.left = (controller.offsetLeft + overSize) + 'px';\r\n                    if (allow) allow.style.left = (20 - overSize) + 'px';\r\n                } else {\r\n                    if (allow) allow.style.left = '20px';\r\n                }\r\n            }\r\n\r\n            controller.style.visibility = '';\r\n        },\r\n\r\n        /**\r\n         * @description javascript execCommand\r\n         * @param {String} command javascript execCommand function property\r\n         * @param {Boolean|undefined} showDefaultUI javascript execCommand function property\r\n         * @param {String|undefined} value javascript execCommand function property\r\n         */\r\n        execCommand: function (command, showDefaultUI, value) {\r\n            this._wd.execCommand(command, showDefaultUI, (command === 'formatBlock' ? '<' + value + '>' : value));\r\n            // history stack\r\n            this.history.push(true);\r\n        },\r\n\r\n        /**\r\n         * @description Focus to wysiwyg area using \"native focus function\"\r\n         */\r\n        nativeFocus: function () {\r\n            const caption = util.getParentElement(this.getSelectionNode(), 'figcaption');\r\n            if (caption) {\r\n                caption.focus();\r\n            } else {\r\n                context.element.wysiwyg.focus();\r\n            }\r\n\r\n            this._editorRange();\r\n        },\r\n\r\n        /**\r\n         * @description Focus to wysiwyg area\r\n         */\r\n        focus: function () {\r\n            if (context.element.wysiwygFrame.style.display === 'none') return;\r\n\r\n            if (options.iframe) {\r\n                this.nativeFocus();\r\n            } else {\r\n                try {\r\n                    const range = this.getRange();\r\n                    if (range.startContainer === range.endContainer && util.isWysiwygDiv(range.startContainer)) {\r\n                        const currentNode = range.commonAncestorContainer.children[range.startOffset];\r\n                        if (!util.isFormatElement(currentNode) && !util.isComponent(currentNode)) {\r\n                            const format = util.createElement(options.defaultTag);\r\n                            const br = util.createElement('BR');\r\n                            format.appendChild(br);\r\n                            context.element.wysiwyg.insertBefore(format, currentNode);\r\n                            this.setRange(br, 0, br, 0);\r\n                            return;\r\n                        }\r\n                    }\r\n                    this.setRange(range.startContainer, range.startOffset, range.endContainer, range.endOffset);\r\n                } catch (e) {\r\n                    this.nativeFocus();\r\n                }\r\n            }\r\n\r\n            event._applyTagEffects();\r\n            if (this._isBalloon) event._toggleToolbarBalloon();\r\n        },\r\n\r\n        /**\r\n         * @description If \"focusEl\" is a component, then that component is selected; if it is a format element, the last text is selected\r\n         * If \"focusEdge\" is null, then selected last element\r\n         * @param {Element|null} focusEl Focus element\r\n         */\r\n        focusEdge: function (focusEl) {\r\n            if (!focusEl) focusEl = context.element.wysiwyg.lastElementChild;\r\n\r\n            const fileComponentInfo = this.getFileComponent(focusEl);\r\n            if (fileComponentInfo) {\r\n                this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n            } else if (focusEl) {\r\n                focusEl = util.getChildElement(focusEl, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, true);\r\n                if (!focusEl) this.nativeFocus();\r\n                else this.setRange(focusEl, focusEl.textContent.length, focusEl, focusEl.textContent.length);\r\n            } else {\r\n                this.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Focusout to wysiwyg area (.blur())\r\n         */\r\n        blur: function () {\r\n            if (options.iframe) {\r\n                context.element.wysiwygFrame.blur();\r\n            } else {\r\n                context.element.wysiwyg.blur();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set current editor's range object and return.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @returns {Object} Range object.\r\n         */\r\n        setRange: function (startCon, startOff, endCon, endOff) {\r\n            if (!startCon || !endCon) return;\r\n            if (startOff > startCon.textContent.length) startOff = startCon.textContent.length;\r\n            if (endOff > endCon.textContent.length) endOff = endCon.textContent.length;\r\n            if (util.isFormatElement(startCon)) {\r\n                startCon = startCon.childNodes[startOff] || startCon;\r\n                startOff = 0;\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon;\r\n                endOff = startOff > 1 ? startOff : 0;\r\n            }\r\n            \r\n            const range = this._wd.createRange();\r\n\r\n            try {\r\n                range.setStart(startCon, startOff);\r\n                range.setEnd(endCon, endOff);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.core.focus.error] ' + error);\r\n                this.nativeFocus();\r\n                return;\r\n            }\r\n\r\n            const selection = this.getSelection();\r\n\r\n            if (selection.removeAllRanges) {\r\n                selection.removeAllRanges();\r\n            }\r\n\r\n            selection.addRange(range);\r\n            this._editorRange();\r\n            if (options.iframe) this.nativeFocus();\r\n\r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Remove range object and button effect\r\n         */\r\n        removeRange: function () {\r\n            this._variable._range = null;\r\n            this._variable._selectionNode = null;\r\n            if (this.hasFocus) this.getSelection().removeAllRanges();\r\n\r\n            const commandMap = this.commandMap;\r\n            const activePlugins = this.activePlugins;\r\n            for (let key in commandMap) {\r\n                if (!util.hasOwn(commandMap, key)) continue;\r\n                if (activePlugins.indexOf(key) > -1) {\r\n                    plugins[key].active.call(this, null);\r\n                } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\r\n                    commandMap.OUTDENT.setAttribute('disabled', true);\r\n                } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\r\n                    commandMap.INDENT.removeAttribute('disabled');\r\n                } else {\r\n                    util.removeClass(commandMap[key], 'active');\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Get current editor's range object\r\n         * @returns {Object}\r\n         */\r\n        getRange: function () {\r\n            const range = this._variable._range || this._createDefaultRange();\r\n            const selection = this.getSelection();\r\n            if (range.collapsed === selection.isCollapsed || !context.element.wysiwyg.contains(selection.focusNode)) return range;\r\n            \r\n            if (selection.rangeCount > 0) {\r\n                this._variable._range = selection.getRangeAt(0);\r\n                return this._variable._range;\r\n            } else {\r\n                const sc = selection.anchorNode, ec = selection.focusNode, so = selection.anchorOffset, eo = selection.focusOffset;\r\n                const compareValue = util.compareElements(sc, ec);\r\n                const rightDir = compareValue.ancestor && (compareValue.result === 0 ? so <= eo : compareValue.result > 1 ? true : false);\r\n                return this.setRange(\r\n                    rightDir ? sc : ec,\r\n                    rightDir ? so : eo,\r\n                    rightDir ? ec : sc,\r\n                    rightDir ? eo : so\r\n                );\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If the \"range\" object is a non-editable area, add a line at the top of the editor and update the \"range\" object.\r\n         * Returns a new \"range\" or argument \"range\".\r\n         * @param {Object} range core.getRange()\r\n         * @param {Element|null} container If there is \"container\" argument, it creates a line in front of the container.\r\n         * @returns {Object} range\r\n         */\r\n        getRange_addLine: function (range, container) {\r\n            if (this._selectionVoid(range)) {\r\n                const wysiwyg = context.element.wysiwyg;\r\n                const op = util.createElement(options.defaultTag);\r\n                op.innerHTML = '<br>';\r\n                wysiwyg.insertBefore(op, container && container !== wysiwyg ? container.nextElementSibling : wysiwyg.firstElementChild);\r\n                this.setRange(op.firstElementChild, 0, op.firstElementChild, 1);\r\n                range = this._variable._range;\r\n            }\r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Get window selection obejct\r\n         * @returns {Object}\r\n         */\r\n        getSelection: function () {\r\n            return this._shadowRoot && this._shadowRoot.getSelection ? this._shadowRoot.getSelection() : this._ww.getSelection();\r\n        },\r\n\r\n        /**\r\n         * @description Get current select node\r\n         * @returns {Node}\r\n         */\r\n        getSelectionNode: function () {\r\n            if(!context.element.wysiwyg.contains(this._variable._selectionNode))this._editorRange();\r\n            if (!this._variable._selectionNode) {\r\n                const selectionNode = util.getChildElement(context.element.wysiwyg.firstChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, false);\r\n                if (!selectionNode){\r\n                    this._editorRange();\r\n                } else {\r\n                    this._variable._selectionNode = selectionNode;\r\n                    return selectionNode;\r\n                }\r\n            }\r\n            return this._variable._selectionNode;\r\n        },\r\n\r\n        /**\r\n         * @description Saving the range object and the currently selected node of editor\r\n         * @private\r\n         */\r\n        _editorRange: function () {\r\n            const selection = this.getSelection();\r\n            if (!selection) return null;\r\n            let range = null;\r\n            let selectionNode = null;\r\n\r\n            if (selection.rangeCount > 0) {\r\n                range = selection.getRangeAt(0);\r\n            } else {\r\n                range = this._createDefaultRange();\r\n            }\r\n\r\n            this._variable._range = range;\r\n\r\n            if (range.collapsed) {\r\n                if (util.isWysiwygDiv(range.commonAncestorContainer)) selectionNode = range.commonAncestorContainer.children[range.startOffset] || range.commonAncestorContainer;\r\n                else selectionNode = range.commonAncestorContainer;\r\n            } else {\r\n                selectionNode = selection.extentNode || selection.anchorNode;\r\n            }\r\n\r\n            this._variable._selectionNode = selectionNode;\r\n        },\r\n\r\n        /**\r\n         * @description Return the range object of editor's first child node\r\n         * @returns {Object}\r\n         * @private\r\n         */\r\n        _createDefaultRange: function () {\r\n            const wysiwyg = context.element.wysiwyg;\r\n            wysiwyg.focus();\r\n            const range = this._wd.createRange();\r\n\r\n            let focusEl = wysiwyg.firstElementChild;\r\n            if (!focusEl) {\r\n                focusEl = util.createElement(options.defaultTag);\r\n                focusEl.innerHTML = '<br>';\r\n                wysiwyg.appendChild(focusEl);\r\n            }\r\n\r\n            range.setStart(focusEl, 0);\r\n            range.setEnd(focusEl, 0);\r\n            \r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Returns true if there is no valid \"selection\".\r\n         * @param {Object} range core.getRange()\r\n         * @returns {Object} range\r\n         * @private\r\n         */\r\n        _selectionVoid: function (range) {\r\n            const comm = range.commonAncestorContainer;\r\n            return (util.isWysiwygDiv(range.startContainer) && util.isWysiwygDiv(range.endContainer)) || /FIGURE/i.test(comm.nodeName) || this._fileManager.regExp.test(comm.nodeName) || util.isMediaComponent(comm);\r\n        },\r\n\r\n        /**\r\n         * @description Reset range object to text node selected status.\r\n         * @returns {Boolean} Returns false if there is no valid selection.\r\n         * @private\r\n         */\r\n        _resetRangeToTextNode: function () {\r\n            const range = this.getRange();\r\n            if (this._selectionVoid(range)) return false;\r\n            \r\n            let startCon = range.startContainer;\r\n            let startOff = range.startOffset;\r\n            let endCon = range.endContainer;\r\n            let endOff = range.endOffset;\r\n            let tempCon, tempOffset, tempChild;\r\n\r\n            if (util.isFormatElement(startCon)) {\r\n                startCon = startCon.childNodes[startOff] || startCon.lastChild;\r\n                startOff = startCon.textContent.length;\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.lastChild;\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            // startContainer\r\n            tempCon = util.isWysiwygDiv(startCon) ? context.element.wysiwyg.firstChild : startCon;\r\n            tempOffset = startOff;\r\n\r\n            if (util.isBreak(tempCon) || (tempCon.nodeType === 1 && tempCon.childNodes.length > 0)) {\r\n                const onlyBreak = util.isBreak(tempCon);\r\n                if (!onlyBreak) {\r\n                    while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\r\n                        tempCon = tempCon.childNodes[tempOffset] || tempCon.nextElementSibling || tempCon.nextSibling;\r\n                        tempOffset = 0;\r\n                    }\r\n    \r\n                    let format = util.getFormatElement(tempCon, null);\r\n                    if (format === util.getRangeFormatElement(format, null)) {\r\n                        format = util.createElement(util.getParentElement(tempCon, util.isCell) ? 'DIV' : options.defaultTag);\r\n                        tempCon.parentNode.insertBefore(format, tempCon);\r\n                        format.appendChild(tempCon);\r\n                    }\r\n                }\r\n\r\n                if (util.isBreak(tempCon)) {\r\n                    const emptyText = util.createTextNode(util.zeroWidthSpace);\r\n                    tempCon.parentNode.insertBefore(emptyText, tempCon);\r\n                    tempCon = emptyText;\r\n                    if (onlyBreak) {\r\n                        if (startCon === endCon) {\r\n                            endCon = tempCon;\r\n                            endOff = 1;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // set startContainer\r\n            startCon = tempCon;\r\n            startOff = tempOffset;\r\n\r\n            // endContainer\r\n            tempCon = util.isWysiwygDiv(endCon) ? context.element.wysiwyg.lastChild : endCon;\r\n            tempOffset = endOff;\r\n\r\n            if (util.isBreak(tempCon) || (tempCon.nodeType === 1 && tempCon.childNodes.length > 0)) {\r\n                const onlyBreak = util.isBreak(tempCon);\r\n                if (!onlyBreak) {\r\n                    while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\r\n                        tempChild = tempCon.childNodes;\r\n                        if (tempChild.length === 0) break;\r\n                        tempCon = tempChild[tempOffset > 0 ? tempOffset - 1 : tempOffset] || !/FIGURE/i.test(tempChild[0].nodeName) ? tempChild[0] : (tempCon.previousElementSibling || tempCon.previousSibling || startCon);\r\n                        tempOffset = tempOffset > 0 ? tempCon.textContent.length : tempOffset;\r\n                    }\r\n    \r\n                    let format = util.getFormatElement(tempCon, null);\r\n                    if (format === util.getRangeFormatElement(format, null)) {\r\n                        format = util.createElement(util.isCell(format) ? 'DIV' : options.defaultTag);\r\n                        tempCon.parentNode.insertBefore(format, tempCon);\r\n                        format.appendChild(tempCon);\r\n                    }\r\n                }\r\n\r\n                if (util.isBreak(tempCon)) {\r\n                    const emptyText = util.createTextNode(util.zeroWidthSpace);\r\n                    tempCon.parentNode.insertBefore(emptyText, tempCon);\r\n                    tempCon = emptyText;\r\n                    tempOffset = 1;\r\n                    if (onlyBreak && !tempCon.previousSibling) {\r\n                        util.removeItem(endCon);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // set endContainer\r\n            endCon = tempCon;\r\n            endOff = tempOffset;\r\n\r\n            // set Range\r\n            this.setRange(startCon, startOff, endCon, endOff);\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description Returns a \"formatElement\"(util.isFormatElement) array from the currently selected range.\r\n         * @param {Function|null} validation The validation function. (Replaces the default validation function-util.isFormatElement(current))\r\n         * @returns {Array}\r\n         */\r\n        getSelectedElements: function (validation) {\r\n            if (!this._resetRangeToTextNode()) return [];\r\n            let range = this.getRange();\r\n\r\n            if (util.isWysiwygDiv(range.startContainer)) {\r\n                const children = context.element.wysiwyg.children;\r\n                if (children.length === 0) return [];\r\n\r\n                this.setRange(children[0], 0, children[children.length - 1], children[children.length - 1].textContent.trim().length);\r\n                range = this.getRange();\r\n            }\r\n\r\n            const startCon = range.startContainer;\r\n            const endCon = range.endContainer;\r\n            const commonCon = range.commonAncestorContainer;\r\n\r\n            // get line nodes\r\n            const lineNodes = util.getListChildren(commonCon, function (current) {\r\n                return validation ? validation(current) : util.isFormatElement(current);\r\n            });\r\n\r\n            if (!util.isWysiwygDiv(commonCon) && !util.isRangeFormatElement(commonCon)) lineNodes.unshift(util.getFormatElement(commonCon, null));\r\n            if (startCon === endCon || lineNodes.length === 1) return lineNodes;\r\n\r\n            let startLine = util.getFormatElement(startCon, null);\r\n            let endLine = util.getFormatElement(endCon, null);\r\n            let startIdx = null;\r\n            let endIdx = null;\r\n            \r\n            const onlyTable = function (current) {\r\n                return util.isTable(current) ? /^TABLE$/i.test(current.nodeName) : true;\r\n            };\r\n\r\n            let startRangeEl = util.getRangeFormatElement(startLine, onlyTable);\r\n            let endRangeEl = util.getRangeFormatElement(endLine, onlyTable);\r\n            if (util.isTable(startRangeEl) && util.isListCell(startRangeEl.parentNode)) startRangeEl = startRangeEl.parentNode;\r\n            if (util.isTable(endRangeEl) && util.isListCell(endRangeEl.parentNode)) endRangeEl = endRangeEl.parentNode;\r\n            \r\n            const sameRange = startRangeEl === endRangeEl;\r\n            for (let i = 0, len = lineNodes.length, line; i < len; i++) {\r\n                line = lineNodes[i];\r\n\r\n                if (startLine === line || (!sameRange && line === startRangeEl)) {\r\n                    startIdx = i;\r\n                    continue;\r\n                }\r\n\r\n                if (endLine === line || (!sameRange && line === endRangeEl)) {\r\n                    endIdx = i;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (startIdx === null) startIdx = 0;\r\n            if (endIdx === null) endIdx = lineNodes.length - 1;\r\n\r\n            return lineNodes.slice(startIdx, endIdx + 1);\r\n        },\r\n\r\n        /**\r\n         * @description Get format elements and components from the selected area. (P, DIV, H[1-6], OL, UL, TABLE..)\r\n         * If some of the component are included in the selection, get the entire that component.\r\n         * @param {Boolean} removeDuplicate If true, if there is a parent and child tag among the selected elements, the child tag is excluded.\r\n         * @returns {Array}\r\n         */\r\n        getSelectedElementsAndComponents: function (removeDuplicate) {\r\n            const commonCon = this.getRange().commonAncestorContainer;\r\n            const myComponent = util.getParentElement(commonCon, util.isComponent);\r\n            const selectedLines = util.isTable(commonCon) ? \r\n                this.getSelectedElements(null) :\r\n                this.getSelectedElements(function (current) {\r\n                    const component = this.getParentElement(current, this.isComponent);\r\n                    return (this.isFormatElement(current) && (!component || component === myComponent)) || (this.isComponent(current) && !this.getFormatElement(current));\r\n                }.bind(util));\r\n            \r\n            if (removeDuplicate) {\r\n                for (let i = 0, len = selectedLines.length; i < len; i++) {\r\n                    for (let j = i - 1; j >= 0; j--) {\r\n                        if (selectedLines[j].contains(selectedLines[i])) {\r\n                            selectedLines.splice(i, 1);\r\n                            i--; len--;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            return selectedLines;\r\n        },\r\n\r\n        /**\r\n         * @description Determine if this offset is the edge offset of container\r\n         * @param {Node} container The node of the selection object. (range.startContainer..)\r\n         * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n         * @param {String|undefined} dir Select check point - Both edge, Front edge or End edge. (\"front\": Front edge, \"end\": End edge, undefined: Both edge)\r\n         * @returns {Boolean}\r\n         */\r\n        isEdgePoint: function (container, offset, dir) {\r\n            return (dir !== 'end' && offset === 0) || ((!dir || dir !== 'front') && !container.nodeValue && offset === 1) || ((!dir || dir === 'end') && !!container.nodeValue && offset === container.nodeValue.length);\r\n        },\r\n\r\n        /**\r\n         * @description Check if the container and offset values are the edges of the format tag\r\n         * @param {Node} container The node of the selection object. (range.startContainer..)\r\n         * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n         * @param {String} dir Select check point - \"front\": Front edge, \"end\": End edge, undefined: Both edge.\r\n         * @returns {Array|null}\r\n         * @private\r\n         */\r\n        _isEdgeFormat: function (node, offset, dir) {\r\n            if (!this.isEdgePoint(node, offset, dir)) return false;\r\n\r\n            const result = [];\r\n            dir = dir === 'front' ? 'previousSibling' : 'nextSibling';\r\n            while (node && !util.isFormatElement(node) && !util.isWysiwygDiv(node)) {\r\n                if (!node[dir] || (util.isBreak(node[dir]) && !node[dir][dir])) {\r\n                    if (node.nodeType === 1) result.push(node.cloneNode(false));\r\n                    node = node.parentNode;\r\n                } else {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        /**\r\n         * @description Show loading box\r\n         */\r\n        showLoading: function () {\r\n            context.element.loading.style.display = 'block';\r\n        },\r\n\r\n        /**\r\n         * @description Close loading box\r\n         */\r\n        closeLoading: function () {\r\n            context.element.loading.style.display = 'none';\r\n        },\r\n\r\n        /**\r\n         * @description Append format element to sibling node of argument element.\r\n         * If the \"formatNodeName\" argument value is present, the tag of that argument value is inserted,\r\n         * If not, the currently selected format tag is inserted.\r\n         * @param {Element} element Insert as siblings of that element\r\n         * @param {String|Element|null} formatNode Node name or node obejct to be inserted\r\n         * @returns {Element}\r\n         */\r\n        appendFormatTag: function (element, formatNode) {\r\n            const currentFormatEl = util.getFormatElement(this.getSelectionNode(), null);\r\n            const oFormatName = formatNode ? (typeof formatNode === 'string' ? formatNode : formatNode.nodeName) : (util.isFormatElement(currentFormatEl) && !util.isFreeFormatElement(currentFormatEl)) ? currentFormatEl.nodeName : options.defaultTag;\r\n            const oFormat = util.createElement(oFormatName);\r\n            oFormat.innerHTML = '<br>';\r\n\r\n            if ((formatNode && typeof formatNode !== 'string') || (!formatNode && util.isFormatElement(currentFormatEl))) {\r\n                util.copyTagAttributes(oFormat, formatNode || currentFormatEl);\r\n            }\r\n\r\n            if (util.isCell(element)) element.insertBefore(oFormat, element.nextElementSibling);\r\n            else element.parentNode.insertBefore(oFormat, element.nextElementSibling);\r\n\r\n            return oFormat;\r\n        },\r\n\r\n        /**\r\n         * @description The method to insert a element and return. (used elements : table, hr, image, video)\r\n         * If \"element\" is \"HR\", insert and return the new line.\r\n         * @param {Element} element Element to be inserted\r\n         * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @param {Boolean} notSelect If true, Do not automatically select the inserted component.\r\n         * @returns {Element}\r\n         */\r\n        insertComponent: function (element, notHistoryPush, checkCharCount, notSelect) {\r\n            if (checkCharCount && !this.checkCharCount(element, null)) {\r\n                return null;\r\n            }\r\n\r\n            const r = this.removeNode();\r\n            this.getRange_addLine(this.getRange(), r.container);\r\n            let oNode = null;\r\n            let selectionNode = this.getSelectionNode();\r\n            let formatEl = util.getFormatElement(selectionNode, null);\r\n\r\n            if (util.isListCell(formatEl)) {\r\n                this.insertNode(element, selectionNode === formatEl ? null : r.container.nextSibling, false);\r\n                if (!element.nextSibling) element.parentNode.appendChild(util.createElement('BR'));\r\n            } else {\r\n                if (this.getRange().collapsed && (r.container.nodeType === 3 || util.isBreak(r.container))) {\r\n                    const depthFormat = util.getParentElement(r.container, function (current) { return this.isRangeFormatElement(current); }.bind(util));\r\n                    oNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                    if (oNode) formatEl = oNode.previousSibling;\r\n                }\r\n                this.insertNode(element, formatEl, false);\r\n                if (formatEl && util.onlyZeroWidthSpace(formatEl)) util.removeItem(formatEl);\r\n            }\r\n\r\n            this.setRange(element, 0, element, 0);\r\n\r\n            if (!notSelect) {\r\n                const fileComponentInfo = this.getFileComponent(element);\r\n                if (fileComponentInfo) {\r\n                    this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n                } else if (oNode) {\r\n                    oNode = util.getEdgeChildNodes(oNode, null).sc || oNode;\r\n                    this.setRange(oNode, 0, oNode, 0);\r\n                }\r\n            }\r\n\r\n            // history stack\r\n            if (!notHistoryPush) this.history.push(1);\r\n\r\n            return oNode || element;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the file component and that plugin name\r\n         * return: {target, component, pluginName} | null\r\n         * @param {Element} element Target element (figure tag, component div, file tag)\r\n         * @returns {Object|null}\r\n         */\r\n        getFileComponent: function (element) {\r\n            if (!this._fileManager.queryString || !element) return null;\r\n\r\n            let target, pluginName;\r\n            if (/^FIGURE$/i.test(element.nodeName) || /se-component/.test(element.className)) {\r\n                target = element.querySelector(this._fileManager.queryString);\r\n            }\r\n            if (!target && element.nodeName && this._fileManager.regExp.test(element.nodeName)) {\r\n                target = element;\r\n            }\r\n\r\n            if (target) {\r\n                pluginName = this._fileManager.pluginMap[target.nodeName.toLowerCase()];\r\n                if (pluginName) {\r\n                    return {\r\n                        target: target,\r\n                        component: util.getParentElement(target, util.isComponent),\r\n                        pluginName: pluginName\r\n                    };\r\n                }\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        /**\r\n         * @description The component(image, video) is selected and the resizing module is called.\r\n         * @param {Element} element Element tag (img, iframe, video)\r\n         * @param {String} pluginName Plugin name (image, video)\r\n         */\r\n        selectComponent: function (element, pluginName) {\r\n            if (util.isUneditableComponent(util.getParentElement(element, util.isComponent)) || util.isUneditableComponent(element)) return false;\r\n            if (!this.hasFocus) this.focus();\r\n            const plugin = this.plugins[pluginName];\r\n            if (!plugin) return;\r\n            _w.setTimeout(function () {\r\n                if (typeof plugin.select === 'function') this.callPlugin(pluginName, plugin.select.bind(this, element), null);\r\n                this._setComponentLineBreaker(element);\r\n            }.bind(this));\r\n        },\r\n\r\n        /**\r\n         * @description Set line breaker of component\r\n         * @param {Element} element Element tag (img, iframe, video)\r\n         * @private\r\n         */\r\n        _setComponentLineBreaker: function (element) {\r\n            // line breaker\r\n            this._lineBreaker.style.display = 'none';\r\n            const container = util.getParentElement(element, util.isComponent);\r\n            const t_style = context.element.lineBreaker_t.style;\r\n            const b_style = context.element.lineBreaker_b.style;\r\n            const target = this.context.resizing.resizeContainer.style.display === 'block' ? this.context.resizing.resizeContainer : element;\r\n\r\n            const isList = util.isListCell(container.parentNode);\r\n            let componentTop, wScroll, w;\r\n            // top\r\n            if (isList ? !container.previousSibling : !util.isFormatElement(container.previousElementSibling)) {\r\n                this._variable._lineBreakComp = container;\r\n                wScroll = context.element.wysiwyg.scrollTop;\r\n                componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\r\n                w = (target.offsetWidth / 2) / 2;\r\n\r\n                t_style.top = (componentTop - wScroll - 12) + 'px';\r\n                t_style.left = (util.getOffset(target).left + w) + 'px';\r\n                t_style.display = 'block';\r\n            } else {\r\n                t_style.display = 'none';\r\n            }\r\n            // bottom\r\n            if (isList ? !container.nextSibling : !util.isFormatElement(container.nextElementSibling)) {\r\n                if (!componentTop) {\r\n                    this._variable._lineBreakComp = container;\r\n                    wScroll = context.element.wysiwyg.scrollTop;\r\n                    componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\r\n                    w = (target.offsetWidth / 2) / 2;\r\n                }\r\n\r\n                b_style.top = (componentTop + target.offsetHeight - wScroll - 12) + 'px';\r\n                b_style.left = (util.getOffset(target).left + target.offsetWidth - w - 24) + 'px';\r\n                b_style.display = 'block';\r\n            } else {\r\n                b_style.display = 'none';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Delete selected node and insert argument value node and return.\r\n         * If the \"afterNode\" exists, it is inserted after the \"afterNode\"\r\n         * Inserting a text node merges with both text nodes on both sides and returns a new \"{ container, startOffset, endOffset }\".\r\n         * @param {Node} oNode Element to be inserted\r\n         * @param {Node|null} afterNode If the node exists, it is inserted after the node\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @returns {Object|Node|null}\r\n         */\r\n        insertNode: function (oNode, afterNode, checkCharCount) {\r\n            if (checkCharCount && !this.checkCharCount(oNode, null)) {\r\n                return null;\r\n            }\r\n\r\n            const freeFormat = util.getFreeFormatElement(this.getSelectionNode(), null);\r\n            const isFormats = (!freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) || util.isComponent(oNode);\r\n\r\n            if (!afterNode && (isFormats || util.isComponent(oNode) || util.isMedia(oNode))) {\r\n                const r = this.removeNode();\r\n                if (r.container.nodeType === 3 || util.isBreak(r.container)) {\r\n                    const depthFormat = util.getParentElement(r.container, function (current) { return this.isRangeFormatElement(current) || this.isListCell(current); }.bind(util));\r\n                    afterNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                    if (afterNode) afterNode = afterNode.previousSibling;\r\n                }\r\n            }\r\n\r\n            const range = (!afterNode && !isFormats) ? this.getRange_addLine(this.getRange(), null) : this.getRange();\r\n            const commonCon = range.commonAncestorContainer;\r\n            const startOff = range.startOffset;\r\n            const endOff = range.endOffset;\r\n            const formatRange = range.startContainer === commonCon && util.isFormatElement(commonCon);\r\n            const startCon = formatRange ? (commonCon.childNodes[startOff] || commonCon.childNodes[0]) : range.startContainer;\r\n            const endCon = formatRange ? (commonCon.childNodes[endOff] || commonCon.childNodes[commonCon.childNodes.length - 1]) : range.endContainer;\r\n            let parentNode, originAfter = null;\r\n\r\n            if (!afterNode) {\r\n                parentNode = startCon;\r\n                if (startCon.nodeType === 3) {\r\n                    parentNode = startCon.parentNode;\r\n                }\r\n\r\n                /** No Select range node */\r\n                if (range.collapsed) {\r\n                    if (commonCon.nodeType === 3) {\r\n                        if (commonCon.textContent.length > endOff) afterNode = commonCon.splitText(endOff);\r\n                        else afterNode = commonCon.nextSibling;\r\n                    } else {\r\n                        if (!util.isBreak(parentNode)) {\r\n                            let c = parentNode.childNodes[startOff];\r\n                            const focusNode = (c && c.nodeType === 3 && util.onlyZeroWidthSpace(c) && util.isBreak(c.nextSibling)) ? c.nextSibling : c;\r\n                            if (focusNode) {\r\n                                if (!focusNode.nextSibling) {\r\n                                    parentNode.removeChild(focusNode);\r\n                                    afterNode = null;\r\n                                } else {\r\n                                    afterNode = (util.isBreak(focusNode) && !util.isBreak(oNode)) ? focusNode : focusNode.nextSibling;\r\n                                }\r\n                            } else {\r\n                                afterNode = null;\r\n                            }\r\n                        } else {\r\n                            afterNode = parentNode;\r\n                            parentNode = parentNode.parentNode;\r\n                        }\r\n                    }\r\n                } else { /** Select range nodes */\r\n                    const isSameContainer = startCon === endCon;\r\n\r\n                    if (isSameContainer) {\r\n                        if (this.isEdgePoint(endCon, endOff)) afterNode = endCon.nextSibling;\r\n                        else afterNode = endCon.splitText(endOff);\r\n\r\n                        let removeNode = startCon;\r\n                        if (!this.isEdgePoint(startCon, startOff)) removeNode = startCon.splitText(startOff);\r\n\r\n                        parentNode.removeChild(removeNode);\r\n                        if (parentNode.childNodes.length === 0 && isFormats) {\r\n                            parentNode.innerHTML = '<br>';\r\n                        }\r\n                    }\r\n                    else {\r\n                        const removedTag = this.removeNode();\r\n                        const container = removedTag.container;\r\n                        const prevContainer = removedTag.prevContainer;\r\n                        if (container && container.childNodes.length === 0 && isFormats) {\r\n                            if (util.isFormatElement(container)) {\r\n                                container.innerHTML = '<br>';\r\n                            } else if (util.isRangeFormatElement(container)) {\r\n                                container.innerHTML = '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n                            }\r\n                        }\r\n\r\n                        if (!isFormats && prevContainer) {\r\n                            parentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\r\n                            if (parentNode.contains(container)) {\r\n                                let sameParent = true;\r\n                                afterNode = container;\r\n                                while (afterNode.parentNode !== parentNode) {\r\n                                    afterNode = afterNode.parentNode;\r\n                                    sameParent = false;\r\n                                }\r\n                                if (sameParent && container === prevContainer) afterNode = afterNode.nextSibling;\r\n                            } else {\r\n                                afterNode = null;\r\n                            }\r\n                        } else {\r\n                            afterNode = isFormats ? endCon : container === prevContainer ? container.nextSibling : container;\r\n                            parentNode = (!afterNode || !afterNode.parentNode) ? commonCon : afterNode.parentNode;\r\n                        }\r\n\r\n                        while (afterNode && !util.isFormatElement(afterNode) && afterNode.parentNode !== commonCon) {\r\n                            afterNode = afterNode.parentNode;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // has afterNode\r\n            else {\r\n                parentNode = afterNode.parentNode;\r\n                afterNode = afterNode.nextSibling;\r\n                originAfter = true;\r\n            }\r\n\r\n            // --- insert node ---\r\n            try {\r\n                if (util.isWysiwygDiv(afterNode) || parentNode === context.element.wysiwyg.parentNode) {\r\n                    parentNode = context.element.wysiwyg;\r\n                    afterNode = null;\r\n                }\r\n\r\n                if (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode) || (!util.isListCell(parentNode) && util.isComponent(oNode))) {\r\n                    const oldParent = parentNode;\r\n                    if (util.isList(afterNode)) {\r\n                        parentNode = afterNode;\r\n                        afterNode = null;\r\n                    } else if (util.isListCell(afterNode)) {\r\n                        parentNode = afterNode.previousElementSibling || afterNode;\r\n                    } else if (!originAfter && !afterNode) {\r\n                        const r = this.removeNode();\r\n                        const container = r.container.nodeType === 3 ? (util.isListCell(util.getFormatElement(r.container, null)) ? r.container : (util.getFormatElement(r.container, null) || r.container.parentNode)) : r.container;\r\n                        const rangeCon = util.isWysiwygDiv(container) || util.isRangeFormatElement(container);\r\n                        parentNode = rangeCon ? container : container.parentNode;\r\n                        afterNode = rangeCon ? null : container.nextSibling;\r\n                    }\r\n\r\n                    if (oldParent.childNodes.length === 0 && parentNode !== oldParent) util.removeItem(oldParent);\r\n                }\r\n\r\n                if (isFormats && !freeFormat && !util.isRangeFormatElement(parentNode) && !util.isListCell(parentNode) && !util.isWysiwygDiv(parentNode)) {\r\n                    afterNode = parentNode.nextElementSibling;\r\n                    parentNode = parentNode.parentNode;\r\n                }\r\n\r\n                if (util.isWysiwygDiv(parentNode) && (oNode.nodeType === 3 || util.isBreak(oNode))) {\r\n                    const fNode = util.createElement(options.defaultTag);\r\n                    fNode.appendChild(oNode);\r\n                    oNode = fNode;\r\n                }\r\n\r\n                parentNode.insertBefore(oNode, parentNode === afterNode ? parentNode.lastChild : afterNode);\r\n            } catch (e) {\r\n                parentNode.appendChild(oNode);\r\n            } finally {\r\n                if ((util.isFormatElement(oNode) || util.isComponent(oNode)) && startCon === endCon) {\r\n                    const cItem = util.getFormatElement(commonCon, null);\r\n                    if (cItem && cItem.nodeType === 1 && util.isEmptyLine(cItem)) {\r\n                        util.removeItem(cItem);\r\n                    }\r\n                }\r\n\r\n                if (freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) {\r\n                    oNode = this._setIntoFreeFormat(oNode);\r\n                }\r\n\r\n                if (!util.isComponent(oNode)) {\r\n                    let offset = 1;\r\n                    if (oNode.nodeType === 3) {\r\n                        const previous = oNode.previousSibling;\r\n                        const next = oNode.nextSibling;\r\n                        const previousText = (!previous ||  previous.nodeType === 1 || util.onlyZeroWidthSpace(previous)) ? '' : previous.textContent;\r\n                        const nextText = (!next || next.nodeType === 1 || util.onlyZeroWidthSpace(next)) ? '' : next.textContent;\r\n        \r\n                        if (previous && previousText.length > 0) {\r\n                            oNode.textContent = previousText + oNode.textContent;\r\n                            util.removeItem(previous);\r\n                        }\r\n        \r\n                        if (next && next.length > 0) {\r\n                            oNode.textContent += nextText;\r\n                            util.removeItem(next);\r\n                        }\r\n\r\n                        const newRange = {\r\n                            container: oNode,\r\n                            startOffset: previousText.length,\r\n                            endOffset: oNode.textContent.length - nextText.length\r\n                        };\r\n\r\n                        this.setRange(oNode, newRange.startOffset, oNode, newRange.endOffset);\r\n    \r\n                        return newRange;\r\n                    } else if (!util.isBreak(oNode) && util.isFormatElement(parentNode)) {\r\n                        let zeroWidth = null;\r\n                        if (!oNode.previousSibling || util.isBreak(oNode.previousSibling)) {\r\n                            zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                            oNode.parentNode.insertBefore(zeroWidth, oNode);\r\n                        }\r\n                        \r\n                        if (!oNode.nextSibling || util.isBreak(oNode.nextSibling)) {\r\n                            zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                            oNode.parentNode.insertBefore(zeroWidth, oNode.nextSibling);\r\n                        }\r\n    \r\n                        if (util._isIgnoreNodeChange(oNode)) {\r\n                            oNode = oNode.nextSibling;\r\n                            offset = 0;\r\n                        }\r\n                    }\r\n    \r\n                    this.setRange(oNode, offset, oNode, offset);\r\n                }\r\n\r\n                // history stack\r\n                this.history.push(true);\r\n\r\n                return oNode;\r\n            }\r\n        },\r\n\r\n        _setIntoFreeFormat: function (oNode) {\r\n            const parentNode = oNode.parentNode;\r\n            let oNodeChildren, lastONode;\r\n            \r\n            while (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) {\r\n                oNodeChildren = oNode.childNodes;\r\n                lastONode = null;\r\n                \r\n                while (oNodeChildren[0]) {\r\n                    lastONode = oNodeChildren[0];\r\n                    if (util.isFormatElement(lastONode) || util.isRangeFormatElement(lastONode)) {\r\n                        this._setIntoFreeFormat(lastONode);\r\n                        if (!oNode.parentNode) break;\r\n                        oNodeChildren = oNode.childNodes;\r\n                        continue;\r\n                    }\r\n                    \r\n                    parentNode.insertBefore(lastONode, oNode);\r\n                }\r\n                \r\n                if (oNode.childNodes.length === 0) util.removeItem(oNode);\r\n                oNode = util.createElement('BR');\r\n                parentNode.insertBefore(oNode, lastONode.nextSibling);\r\n            }\r\n\r\n            return oNode;\r\n        },\r\n\r\n        /**\r\n         * @description Delete the currently selected nodes and reset selection range\r\n         * Returns {container: \"the last element after deletion\", offset: \"offset\", prevContainer: \"previousElementSibling Of the deleted area\"}\r\n         * @returns {Object}\r\n         */\r\n        removeNode: function () {\r\n            this._resetRangeToTextNode();\r\n\r\n            const range = this.getRange();\r\n            let container, offset = 0;\r\n            let startCon = range.startContainer;\r\n            let endCon = range.endContainer;\r\n            let startOff = range.startOffset;\r\n            let endOff = range.endOffset;\r\n            const commonCon = (range.commonAncestorContainer.nodeType === 3 && range.commonAncestorContainer.parentNode === startCon.parentNode) ? startCon.parentNode : range.commonAncestorContainer;\r\n            if (commonCon === startCon && commonCon === endCon) {\r\n                startCon = commonCon.children[startOff];\r\n                endCon = commonCon.children[endOff];\r\n                startOff = endOff = 0;\r\n            }\r\n\r\n            let beforeNode = null;\r\n            let afterNode = null;\r\n\r\n            const childNodes = util.getListChildNodes(commonCon, null);\r\n            let startIndex = util.getArrayIndex(childNodes, startCon);\r\n            let endIndex = util.getArrayIndex(childNodes, endCon);\r\n\r\n            if (childNodes.length > 0 && startIndex > -1 && endIndex > -1) {\r\n                for (let i = startIndex + 1, startNode = startCon; i >= 0; i--) {\r\n                    if (childNodes[i] === startNode.parentNode && childNodes[i].firstChild === startNode && startOff === 0) {\r\n                        startIndex = i;\r\n                        startNode = startNode.parentNode;\r\n                    }\r\n                }\r\n    \r\n                for (let i = endIndex - 1, endNode = endCon; i > startIndex; i--) {\r\n                    if (childNodes[i] === endNode.parentNode && childNodes[i].nodeType === 1) {\r\n                        childNodes.splice(i, 1);\r\n                        endNode = endNode.parentNode;\r\n                        --endIndex;\r\n                    }\r\n                }\r\n            } else {\r\n                if (childNodes.length === 0) {\r\n                    if (util.isFormatElement(commonCon) || util.isRangeFormatElement(commonCon) || util.isWysiwygDiv(commonCon) || util.isBreak(commonCon) || util.isMedia(commonCon)) {\r\n                        return {\r\n                            container: commonCon,\r\n                            offset: 0\r\n                        };\r\n                    } else if (commonCon.nodeType === 3) {\r\n                        return {\r\n                            container: commonCon,\r\n                            offset: endOff\r\n                        };\r\n                    }\r\n                    childNodes.push(commonCon);\r\n                    startCon = endCon = commonCon;\r\n                } else {\r\n                    startCon = endCon = childNodes[0];\r\n                    if (util.isBreak(startCon) || util.onlyZeroWidthSpace(startCon)) {\r\n                        return {\r\n                            container: util.isMedia(commonCon) ? commonCon : startCon,\r\n                            offset: 0\r\n                        };\r\n                    }\r\n                }\r\n\r\n                startIndex = endIndex = 0;\r\n            }\r\n\r\n            function remove (item) {\r\n                const format = util.getFormatElement(item, null);\r\n                util.removeItem(item);\r\n\r\n                if(util.isListCell(format)) {\r\n                    const list = util.getArrayItem(format.children, util.isList, false);\r\n                    if (list) {\r\n                        const child = list.firstElementChild;\r\n                        const children = child.childNodes;\r\n                        while (children[0]) {\r\n                            format.insertBefore(children[0], list);\r\n                        }\r\n                        util.removeItemAllParents(child, null, null);\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let i = startIndex; i <= endIndex; i++) {\r\n                const item = childNodes[i];\r\n\r\n                if (item.length === 0 || (item.nodeType === 3 && item.data === undefined)) {\r\n                    remove(item);\r\n                    continue;\r\n                }\r\n\r\n                if (item === startCon) {\r\n                    if (startCon.nodeType === 1) {\r\n                        if (util.isComponent(startCon)) continue;\r\n                        else beforeNode = util.createTextNode(startCon.textContent);\r\n                    } else {\r\n                        if (item === endCon) {\r\n                            beforeNode = util.createTextNode(startCon.substringData(0, startOff) + endCon.substringData(endOff, (endCon.length - endOff)));\r\n                            offset = startOff;\r\n                        } else {\r\n                            beforeNode = util.createTextNode(startCon.substringData(0, startOff));\r\n                        }\r\n                    }\r\n\r\n                    if (beforeNode.length > 0) {\r\n                        startCon.data = beforeNode.data;\r\n                    } else {\r\n                        remove(startCon);\r\n                    }\r\n\r\n                    if (item === endCon) break;\r\n                    continue;\r\n                }\r\n\r\n                if (item === endCon) {\r\n                    if (endCon.nodeType === 1) {\r\n                        if (util.isComponent(endCon)) continue;\r\n                        else afterNode = util.createTextNode(endCon.textContent);\r\n                    } else {\r\n                        afterNode = util.createTextNode(endCon.substringData(endOff, (endCon.length - endOff)));\r\n                    }\r\n\r\n                    if (afterNode.length > 0) {\r\n                        endCon.data = afterNode.data;\r\n                    } else {\r\n                        remove(endCon);\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                remove(item);\r\n            }\r\n\r\n            container = endCon && endCon.parentNode ? endCon : startCon && startCon.parentNode ? startCon : (range.endContainer || range.startContainer);\r\n            \r\n            if (!util.isWysiwygDiv(container) && container.childNodes.length === 0) {\r\n                const rc = util.removeItemAllParents(container, function (current) {\r\n                    if (this.isComponent(current)) return false;\r\n                    const text = current.textContent;\r\n                    return text.length === 0 || /^(\\n|\\u200B)+$/.test(text);\r\n                }.bind(util), null);\r\n                \r\n                if (rc) container = rc.sc || rc.ec || context.element.wysiwyg;\r\n            }\r\n\r\n            // set range\r\n            this.setRange(container, offset, container, offset);\r\n            // history stack\r\n            this.history.push(true);\r\n\r\n            return {\r\n                container: container,\r\n                offset: offset,\r\n                prevContainer: startCon && startCon.parentNode ? startCon : null\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Appended all selected format Element to the argument element and insert\r\n         * @param {Element} rangeElement Element of wrap the arguments (BLOCKQUOTE...)\r\n         */\r\n        applyRangeFormatElement: function (rangeElement) {\r\n            this.getRange_addLine(this.getRange(), null);\r\n            const rangeLines = this.getSelectedElementsAndComponents(false);\r\n            if (!rangeLines || rangeLines.length === 0) return;\r\n\r\n            linesLoop:\r\n            for (let i = 0, len = rangeLines.length, line, nested, fEl, lEl, f, l; i < len; i++) {\r\n                line = rangeLines[i];\r\n                if (!util.isListCell(line)) continue;\r\n\r\n                nested = line.lastElementChild;\r\n                if (nested && util.isListCell(line.nextElementSibling) && rangeLines.indexOf(line.nextElementSibling) > -1) {\r\n                    lEl = nested.lastElementChild;\r\n                    if (rangeLines.indexOf(lEl) > -1) {\r\n                        let list = null;\r\n                        while ((list = lEl.lastElementChild)) {\r\n                            if (util.isList(list)) {\r\n                                if (rangeLines.indexOf(list.lastElementChild) > -1) {\r\n                                    lEl = list.lastElementChild;\r\n                                } else {\r\n                                    continue linesLoop;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        fEl = nested.firstElementChild;\r\n                        f = rangeLines.indexOf(fEl);\r\n                        l = rangeLines.indexOf(lEl);\r\n                        rangeLines.splice(f, (l - f) + 1);\r\n                        len = rangeLines.length;\r\n                        continue;\r\n                    }\r\n                }\r\n            }\r\n\r\n            let last  = rangeLines[rangeLines.length - 1];\r\n            let standTag, beforeTag, pElement;\r\n\r\n            if (util.isRangeFormatElement(last) || util.isFormatElement(last)) {\r\n                standTag = last;\r\n            } else {\r\n                standTag = util.getRangeFormatElement(last, null) || util.getFormatElement(last, null);\r\n            }\r\n\r\n            if (util.isCell(standTag)) {\r\n                beforeTag = null;\r\n                pElement = standTag;\r\n            } else {\r\n                beforeTag = standTag.nextSibling;\r\n                pElement = standTag.parentNode;\r\n            }\r\n            \r\n            let parentDepth = util.getElementDepth(standTag);\r\n            let listParent = null;\r\n            const lineArr = [];\r\n            const removeItems = function (parent, origin, before) {\r\n                let cc = null;\r\n                if (parent !== origin && !util.isTable(origin)) {\r\n                    if (origin && util.getElementDepth(parent) === util.getElementDepth(origin)) return before;\r\n                    cc = util.removeItemAllParents(origin, null, parent);\r\n                }\r\n\r\n                return cc ? cc.ec : before;\r\n            };\r\n            \r\n            for (let i = 0, len = rangeLines.length, line, originParent, depth, before, nextLine, nextList, nested; i < len; i++) {\r\n                line = rangeLines[i];\r\n                originParent = line.parentNode;\r\n                if (!originParent || rangeElement.contains(originParent)) continue;\r\n\r\n                depth = util.getElementDepth(line);\r\n\r\n                if (util.isList(originParent)) {\r\n                    if (listParent === null) {\r\n                        if (nextList) {\r\n                            listParent = nextList;\r\n                            nested = true;\r\n                            nextList = null;\r\n                        } else {\r\n                            listParent = originParent.cloneNode(false);\r\n                        }\r\n                    }\r\n\r\n                    lineArr.push(line);\r\n                    nextLine = rangeLines[i + 1];\r\n\r\n                    if (i === len - 1 || (nextLine && nextLine.parentNode !== originParent)) {\r\n                        // nested list\r\n                        if (nextLine && line.contains(nextLine.parentNode)) {\r\n                            nextList = nextLine.parentNode.cloneNode(false);\r\n                        }\r\n\r\n                        let list = originParent.parentNode, p;\r\n                        while (util.isList(list)) {\r\n                            p = util.createElement(list.nodeName);\r\n                            p.appendChild(listParent);\r\n                            listParent = p;\r\n                            list = list.parentNode;\r\n                        }\r\n\r\n                        const edge = this.detachRangeFormatElement(originParent, lineArr, null, true, true);\r\n\r\n                        if (parentDepth >= depth) {\r\n                            parentDepth = depth;\r\n                            pElement = edge.cc;\r\n                            beforeTag = removeItems(pElement, originParent, edge.ec);\r\n                            if (beforeTag) pElement = beforeTag.parentNode;\r\n                        } else if (pElement === edge.cc) {\r\n                            beforeTag = edge.ec;\r\n                        }\r\n\r\n                        if (pElement !== edge.cc) {\r\n                            before = removeItems(pElement, edge.cc, before);\r\n                            if (before !== undefined) beforeTag = before;\r\n                            else beforeTag = edge.cc;\r\n                        }\r\n\r\n                        for (let c = 0, cLen = edge.removeArray.length; c < cLen; c++) {\r\n                            listParent.appendChild(edge.removeArray[c]);\r\n                        }\r\n\r\n                        if (!nested) rangeElement.appendChild(listParent);\r\n                        if (nextList) edge.removeArray[edge.removeArray.length - 1].appendChild(nextList);\r\n                        listParent = null;\r\n                        nested = false;\r\n                    }\r\n                } else {\r\n                    if (parentDepth >= depth) {\r\n                        parentDepth = depth;\r\n                        pElement = originParent;\r\n                        beforeTag = line.nextSibling;\r\n                    }\r\n                    \r\n                    rangeElement.appendChild(line);\r\n\r\n                    if (pElement !== originParent) {\r\n                        before = removeItems(pElement, originParent);\r\n                        if (before !== undefined) beforeTag = before;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.effectNode = null;\r\n            util.mergeSameTags(rangeElement, null, false);\r\n            util.mergeNestedTags(rangeElement, function (current) { return this.isList(current); }.bind(util));\r\n\r\n            // Nested list\r\n            if (beforeTag && util.getElementDepth(beforeTag) > 0 && (util.isList(beforeTag.parentNode) || util.isList(beforeTag.parentNode.parentNode))) {\r\n                const depthFormat = util.getParentElement(beforeTag, function (current) { return this.isRangeFormatElement(current) && !this.isList(current); }.bind(util));\r\n                const splitRange = util.splitElement(beforeTag, null, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                splitRange.parentNode.insertBefore(rangeElement, splitRange);\r\n            } else { // basic\r\n                pElement.insertBefore(rangeElement, beforeTag);\r\n                removeItems(rangeElement, beforeTag);\r\n            }\r\n\r\n            const edge = util.getEdgeChildNodes(rangeElement.firstElementChild, rangeElement.lastElementChild);\r\n            if (rangeLines.length > 1) {\r\n                this.setRange(edge.sc, 0, edge.ec, edge.ec.textContent.length);\r\n            } else {\r\n                this.setRange(edge.ec, edge.ec.textContent.length, edge.ec, edge.ec.textContent.length);\r\n            }\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description The elements of the \"selectedFormats\" array are detached from the \"rangeElement\" element. (\"LI\" tags are converted to \"P\" tags)\r\n         * When \"selectedFormats\" is null, all elements are detached and return {cc: parentNode, sc: nextSibling, ec: previousSibling, removeArray: [Array of removed elements]}.\r\n         * @param {Element} rangeElement Range format element (PRE, BLOCKQUOTE, OL, UL...)\r\n         * @param {Array|null} selectedFormats Array of format elements (P, DIV, LI...) to remove.\r\n         * If null, Applies to all elements and return {cc: parentNode, sc: nextSibling, ec: previousSibling}\r\n         * @param {Element|null} newRangeElement The node(rangeElement) to replace the currently wrapped node.\r\n         * @param {Boolean} remove If true, deleted without detached.\r\n         * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n         * @returns {Object}\r\n         */\r\n        detachRangeFormatElement: function (rangeElement, selectedFormats, newRangeElement, remove, notHistoryPush) {\r\n            const range = this.getRange();\r\n            const so = range.startOffset;\r\n            const eo = range.endOffset;\r\n\r\n            let children = util.getListChildNodes(rangeElement, function (current) { return current.parentNode === rangeElement; });\r\n            let parent = rangeElement.parentNode;\r\n            let firstNode = null;\r\n            let lastNode = null;\r\n            let rangeEl = rangeElement.cloneNode(false);\r\n            \r\n            const removeArray = [];\r\n            const newList = util.isList(newRangeElement);\r\n            let insertedNew = false;\r\n            let reset = false;\r\n            let moveComplete = false;\r\n\r\n            function appendNode (parent, insNode, sibling, originNode) {\r\n                if (util.onlyZeroWidthSpace(insNode)) insNode.innerHTML = util.zeroWidthSpace;\r\n\r\n                if (insNode.nodeType === 3) {\r\n                    parent.insertBefore(insNode, sibling);\r\n                    return insNode;\r\n                }\r\n                \r\n                const insChildren = (moveComplete ? insNode : originNode).childNodes;\r\n                let format = insNode.cloneNode(false);\r\n                let first = null;\r\n                let c = null;\r\n\r\n                while (insChildren[0]) {\r\n                    c = insChildren[0];\r\n                    if (util._notTextNode(c) && !util.isBreak(c) && !util.isListCell(format)) {\r\n                        if (format.childNodes.length > 0) {\r\n                            if (!first) first = format;\r\n                            parent.insertBefore(format, sibling);\r\n                            format = insNode.cloneNode(false);\r\n                        }\r\n                        parent.insertBefore(c, sibling);\r\n                        if (!first) first = c;\r\n                    } else {\r\n                        format.appendChild(c);\r\n                    }\r\n                }\r\n\r\n                if (format.childNodes.length > 0) {\r\n                    if (util.isListCell(parent) && util.isListCell(format) && util.isList(sibling)) {\r\n                        if (newList) {\r\n                            first = sibling;\r\n                            while(sibling) {\r\n                                format.appendChild(sibling);\r\n                                sibling = sibling.nextSibling;\r\n                            }\r\n                            parent.parentNode.insertBefore(format, parent.nextElementSibling);\r\n                        } else {\r\n                            const originNext = originNode.nextElementSibling;\r\n                            const detachRange = util.detachNestedList(originNode, false);\r\n                            if ((rangeElement !== detachRange) || (originNext !== originNode.nextElementSibling)) {\r\n                                const fChildren = format.childNodes;\r\n                                while (fChildren[0]) {\r\n                                    originNode.appendChild(fChildren[0]);\r\n                                }\r\n\r\n                                rangeElement = detachRange;\r\n                                reset = true;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        parent.insertBefore(format, sibling);\r\n                    }\r\n\r\n                    if (!first) first = format;\r\n                }\r\n\r\n                return first;\r\n            }\r\n\r\n            // detach loop\r\n            for (let i = 0, len = children.length, insNode, lineIndex, next; i < len; i++) {\r\n                insNode = children[i];\r\n                if (insNode.nodeType === 3 && util.isList(rangeEl)) continue;\r\n                \r\n                moveComplete = false;\r\n                if (remove && i === 0) {\r\n                    if (!selectedFormats || selectedFormats.length === len || selectedFormats[0] === insNode) {\r\n                        firstNode = rangeElement.previousSibling;\r\n                    } else {\r\n                        firstNode = rangeEl;\r\n                    }\r\n                }\r\n\r\n                if (selectedFormats) lineIndex = selectedFormats.indexOf(insNode);\r\n                if (selectedFormats && lineIndex === -1) {\r\n                    if (!rangeEl) rangeEl = rangeElement.cloneNode(false);\r\n                    rangeEl.appendChild(insNode);\r\n                } else {\r\n                    if (selectedFormats) next = selectedFormats[lineIndex + 1];\r\n                    if (rangeEl && rangeEl.children.length > 0) {\r\n                        parent.insertBefore(rangeEl, rangeElement);\r\n                        rangeEl = null;\r\n                    }\r\n\r\n                    if (!newList && util.isListCell(insNode)) {\r\n                        if (next && util.getElementDepth(insNode) !== util.getElementDepth(next) && (util.isListCell(parent) || util.getArrayItem(insNode.children, util.isList, false))) {\r\n                            const insNext = insNode.nextElementSibling;\r\n                            const detachRange = util.detachNestedList(insNode, false);\r\n                            if ((rangeElement !== detachRange) || insNext !== insNode.nextElementSibling) {\r\n                                rangeElement = detachRange;\r\n                                reset = true;\r\n                            }\r\n                        } else {\r\n                            const inner = insNode;\r\n                            insNode = util.createElement(remove ? inner.nodeName : (util.isList(rangeElement.parentNode) || util.isListCell(rangeElement.parentNode)) ? 'LI' : util.isCell(rangeElement.parentNode) ? 'DIV' : options.defaultTag);\r\n                            const isCell = util.isListCell(insNode);\r\n                            const innerChildren = inner.childNodes;\r\n                            while (innerChildren[0]) {\r\n                                if (util.isList(innerChildren[0]) && !isCell) break;\r\n                                insNode.appendChild(innerChildren[0]);\r\n                            }\r\n                            util.copyFormatAttributes(insNode, inner);\r\n                            moveComplete = true;\r\n                        }\r\n                    } else {\r\n                        insNode = insNode.cloneNode(false);\r\n                    }\r\n\r\n                    if (!reset) {\r\n                        if (!remove) {\r\n                            if (newRangeElement) {\r\n                                if (!insertedNew) {\r\n                                    parent.insertBefore(newRangeElement, rangeElement);\r\n                                    insertedNew = true;\r\n                                }\r\n                                insNode = appendNode(newRangeElement, insNode, null, children[i]);\r\n                            } else {\r\n                                insNode = appendNode(parent, insNode, rangeElement, children[i]);\r\n                            }\r\n    \r\n                            if (!reset) {\r\n                                if (selectedFormats) {\r\n                                    lastNode = insNode;\r\n                                    if (!firstNode) {\r\n                                        firstNode = insNode;\r\n                                    }\r\n                                } else if (!firstNode) {\r\n                                    firstNode = lastNode = insNode;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            removeArray.push(insNode);\r\n                            util.removeItem(children[i]);\r\n                        }\r\n\r\n                        if (reset) {\r\n                            reset = moveComplete = false;\r\n                            children = util.getListChildNodes(rangeElement, function (current) { return current.parentNode === rangeElement; });\r\n                            rangeEl = rangeElement.cloneNode(false);\r\n                            parent = rangeElement.parentNode;\r\n                            i = -1;\r\n                            len = children.length;\r\n                            continue;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            const rangeParent = rangeElement.parentNode;\r\n            let rangeRight = rangeElement.nextSibling;\r\n            if (rangeEl && rangeEl.children.length > 0) {\r\n                rangeParent.insertBefore(rangeEl, rangeRight);\r\n            }\r\n            \r\n            if (newRangeElement) firstNode = newRangeElement.previousSibling;\r\n            else if (!firstNode) firstNode = rangeElement.previousSibling;\r\n            rangeRight = rangeElement.nextSibling;\r\n\r\n            if (rangeElement.children.length === 0 || rangeElement.textContent.length === 0) {\r\n                util.removeItem(rangeElement);\r\n            } else {\r\n                util.removeEmptyNode(rangeElement, null);\r\n            }\r\n\r\n            let edge = null;\r\n            if (remove) {\r\n                edge = {\r\n                    cc: rangeParent,\r\n                    sc: firstNode,\r\n                    ec: rangeRight,\r\n                    removeArray: removeArray\r\n                };\r\n            } else {\r\n                if (!firstNode) firstNode = lastNode;\r\n                if (!lastNode) lastNode = firstNode;\r\n                const childEdge = util.getEdgeChildNodes(firstNode, (lastNode.parentNode ? firstNode : lastNode));\r\n                edge = {\r\n                    cc: (childEdge.sc || childEdge.ec).parentNode,\r\n                    sc: childEdge.sc,\r\n                    ec: childEdge.ec\r\n                };\r\n            }\r\n\r\n            this.effectNode = null;\r\n            if (notHistoryPush) return edge;\r\n            \r\n            if (!remove && edge) {\r\n                if (!selectedFormats) {\r\n                    this.setRange(edge.sc, 0, edge.sc, 0);\r\n                } else {\r\n                    this.setRange(edge.sc, so, edge.ec, eo);\r\n                }\r\n            }\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description \"selectedFormats\" array are detached from the list element.\r\n         * The return value is applied when the first and last lines of \"selectedFormats\" are \"LI\" respectively.\r\n         * @param {Array} selectedFormats Array of format elements (LI, P...) to remove.\r\n         * @param {Boolean} remove If true, deleted without detached.\r\n         * @returns {Object} {sc: <LI>, ec: <LI>}.\r\n         */\r\n        detachList: function (selectedFormats, remove) {\r\n            let rangeArr = {};\r\n            let listFirst = false;\r\n            let listLast = false;\r\n            let first = null;\r\n            let last = null;\r\n            const passComponent = function (current) { return !this.isComponent(current); }.bind(util);\r\n\r\n            for (let i = 0, len = selectedFormats.length, r, o, lastIndex, isList; i < len; i++) {\r\n                lastIndex = i === len - 1;\r\n                o = util.getRangeFormatElement(selectedFormats[i], passComponent);\r\n                isList = util.isList(o);\r\n                if (!r && isList) {\r\n                    r = o;\r\n                    rangeArr = {r: r, f: [util.getParentElement(selectedFormats[i], 'LI')]};\r\n                    if (i === 0) listFirst = true;\r\n                } else if (r && isList) {\r\n                    if (r !== o) {\r\n                        const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\r\n                        o = selectedFormats[i].parentNode;\r\n                        if (listFirst) {\r\n                            first = edge.sc;\r\n                            listFirst = false;\r\n                        }\r\n                        if (lastIndex) last = edge.ec;\r\n\r\n                        if (isList) {\r\n                            r = o;\r\n                            rangeArr = {r: r, f: [util.getParentElement(selectedFormats[i], 'LI')]};\r\n                            if (lastIndex) listLast = true;\r\n                        } else {\r\n                            r = null;\r\n                        }\r\n                    } else {\r\n                        rangeArr.f.push(util.getParentElement(selectedFormats[i], 'LI'));\r\n                        if (lastIndex) listLast = true;\r\n                    }\r\n                }\r\n\r\n                if (lastIndex && util.isList(r)) {\r\n                    const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\r\n                    if (listLast || len === 1) last = edge.ec;\r\n                    if (listFirst) first = edge.sc || last;\r\n                }\r\n            }\r\n\r\n            return {\r\n                sc: first,\r\n                ec: last\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Add, update, and delete nodes from selected text.\r\n         * 1. If there is a node in the \"appendNode\" argument, a node with the same tags and attributes as \"appendNode\" is added to the selection text.\r\n         * 2. If it is in the same tag, only the tag's attributes are changed without adding a tag.\r\n         * 3. If the \"appendNode\" argument is null, the node of the selection is update or remove without adding a new node.\r\n         * 4. The same style as the style attribute of the \"styleArray\" argument is deleted.\r\n         *    (Styles should be put with attribute names from css. [\"background-color\"])\r\n         * 5. The same class name as the class attribute of the \"styleArray\" argument is deleted.\r\n         *    (The class name is preceded by \".\" [\".className\"])\r\n         * 6. Use a list of styles and classes of \"appendNode\" in \"styleArray\" to avoid duplicate property values.\r\n         * 7. If a node with all styles and classes removed has the same tag name as \"appendNode\" or \"removeNodeArray\", or \"appendNode\" is null, that node is deleted.\r\n         * 8. Regardless of the style and class of the node, the tag with the same name as the \"removeNodeArray\" argument value is deleted.\r\n         * 9. If the \"strictRemove\" argument is true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n         *10. It won't work if the parent node has the same class and same value style.\r\n         *    However, if there is a value in \"removeNodeArray\", it works and the text node is separated even if there is no node to replace.\r\n         * @param {Element|null} appendNode The element to be added to the selection. If it is null, only delete the node.\r\n         * @param {Array|null} styleArray The style or className attribute name Array to check (['font-size'], ['.className'], ['font-family', 'color', '.className']...])\r\n         * @param {Array|null} removeNodeArray An array of node names to remove types from, remove all formats when \"appendNode\" is null and there is an empty array or null value. (['span'], ['strong', 'em'] ...])\r\n         * @param {Boolean|null} strictRemove If true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n         */\r\n        nodeChange: function (appendNode, styleArray, removeNodeArray, strictRemove) {\r\n            this._resetRangeToTextNode();\r\n            let range = this.getRange_addLine(this.getRange(), null);\r\n            styleArray = styleArray && styleArray.length > 0 ? styleArray : false;\r\n            removeNodeArray = removeNodeArray && removeNodeArray.length > 0 ? removeNodeArray : false;\r\n            \r\n            const isRemoveNode = !appendNode;\r\n            const isRemoveFormat = isRemoveNode && !removeNodeArray && !styleArray;\r\n            let startCon = range.startContainer;\r\n            let startOff = range.startOffset;\r\n            let endCon = range.endContainer;\r\n            let endOff = range.endOffset;\r\n\r\n            if ((isRemoveFormat && range.collapsed && util.isFormatElement(startCon.parentNode) && util.isFormatElement(endCon.parentNode)) || (startCon === endCon && startCon.nodeType === 1 && util.isNonEditable(startCon))) {\r\n                return;\r\n            }\r\n\r\n            if (range.collapsed && !isRemoveFormat) {\r\n                if (startCon.nodeType === 1 && !util.isBreak(startCon) && !util.isComponent(startCon)) {\r\n                    let afterNode = null;\r\n                    const focusNode = startCon.childNodes[startOff];\r\n\r\n                    if (focusNode) {\r\n                        if (!focusNode.nextSibling) {\r\n                            afterNode = null;\r\n                        } else {\r\n                            afterNode = util.isBreak(focusNode) ? focusNode : focusNode.nextSibling;\r\n                        }\r\n                    }\r\n\r\n                    const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                    startCon.insertBefore(zeroWidth, afterNode);\r\n                    this.setRange(zeroWidth, 1, zeroWidth, 1);\r\n\r\n                    range = this.getRange();\r\n                    startCon = range.startContainer;\r\n                    startOff = range.startOffset;\r\n                    endCon = range.endContainer;\r\n                    endOff = range.endOffset;\r\n                }\r\n            }\r\n\r\n            if (util.isFormatElement(startCon)) {\r\n                startCon = startCon.childNodes[startOff] || startCon.firstChild;\r\n                startOff = 0;\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.lastChild;\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            if (isRemoveNode) {\r\n                appendNode = util.createElement('DIV');\r\n            }\r\n\r\n            const wRegExp = _w.RegExp;\r\n            const newNodeName = appendNode.nodeName;\r\n\r\n            /* checked same style property */\r\n            if (!isRemoveFormat && startCon === endCon && !removeNodeArray && appendNode) {\r\n                let sNode = startCon;\r\n                let checkCnt = 0;\r\n                const checkAttrs = [];\r\n                \r\n                const checkStyles = appendNode.style;\r\n                for (let i = 0, len = checkStyles.length; i < len; i++) {\r\n                    checkAttrs.push(checkStyles[i]);\r\n                }\r\n\r\n                const ckeckClasses = appendNode.classList;\r\n                for (let i = 0, len = ckeckClasses.length; i < len; i++) {\r\n                    checkAttrs.push('.' + ckeckClasses[i]);\r\n                }\r\n\r\n                if (checkAttrs.length > 0) {\r\n                    while(!util.isFormatElement(sNode) && !util.isWysiwygDiv(sNode)) {\r\n                        for (let i = 0; i < checkAttrs.length; i++) {\r\n                            if (sNode.nodeType === 1) {\r\n                                const s = checkAttrs[i];\r\n                                const classReg = /^\\./.test(s) ? new wRegExp('\\\\s*' + s.replace(/^\\./, '') + '(\\\\s+|$)', 'ig') : false;\r\n    \r\n                                const styleCheck = isRemoveNode ? !!sNode.style[s] : (!!sNode.style[s] && !!appendNode.style[s] && sNode.style[s] === appendNode.style[s]);\r\n                                const classCheck = classReg === false ? false : isRemoveNode ? !!sNode.className.match(classReg) : !!sNode.className.match(classReg) && !!appendNode.className.match(classReg);\r\n                                if (styleCheck || classCheck) {\r\n                                    checkCnt++;\r\n                                }\r\n                            }\r\n                        }\r\n                        sNode = sNode.parentNode;\r\n                    }\r\n    \r\n                    if (checkCnt >= checkAttrs.length) return;\r\n                }\r\n            }\r\n\r\n            let start = {}, end = {};\r\n            let newNode, styleRegExp = '', classRegExp = '', removeNodeRegExp = '';\r\n\r\n            if (styleArray) {\r\n                for (let i = 0, len = styleArray.length, s; i < len; i++) {\r\n                    s = styleArray[i];\r\n                    if (/^\\./.test(s)) {\r\n                        classRegExp += (classRegExp ? '|' : '\\\\s*(?:') + s.replace(/^\\./, '');\r\n                    } else {\r\n                        styleRegExp += (styleRegExp ? '|' : '(?:;|^|\\\\s)(?:') + s;\r\n                    }\r\n                }\r\n\r\n                if (styleRegExp) {\r\n                    styleRegExp += ')\\\\s*:[^;]*\\\\s*(?:;|$)';\r\n                    styleRegExp = new wRegExp(styleRegExp, 'ig');\r\n                }\r\n\r\n                if (classRegExp) {\r\n                    classRegExp += ')(?=\\\\s+|$)';\r\n                    classRegExp = new wRegExp(classRegExp, 'ig');\r\n                }\r\n            }\r\n\r\n            if (removeNodeArray) {\r\n                removeNodeRegExp = '^(?:' + removeNodeArray[0];\r\n                for (let i = 1; i < removeNodeArray.length; i++) {\r\n                    removeNodeRegExp += '|' + removeNodeArray[i];\r\n                }\r\n                removeNodeRegExp += ')$';\r\n                removeNodeRegExp = new wRegExp(removeNodeRegExp, 'i');\r\n            }\r\n\r\n            /** validation check function*/\r\n            const wBoolean = _w.Boolean;\r\n            const _removeCheck = {v: false};\r\n            const validation = function (checkNode) {\r\n                const vNode = checkNode.cloneNode(false);\r\n\r\n                // all path\r\n                if (vNode.nodeType === 3 || util.isBreak(vNode)) return vNode;\r\n                // all remove\r\n                if (isRemoveFormat) return null;\r\n\r\n                // remove node check\r\n                const tagRemove = (!removeNodeRegExp && isRemoveNode) || (removeNodeRegExp && removeNodeRegExp.test(vNode.nodeName));\r\n\r\n                // tag remove\r\n                if (tagRemove && !strictRemove) {\r\n                    _removeCheck.v = true;\r\n                    return null;\r\n                }\r\n\r\n                // style regexp\r\n                const originStyle = vNode.style.cssText;\r\n                let style = '';\r\n                if (styleRegExp && originStyle.length > 0) {\r\n                    style = originStyle.replace(styleRegExp, '').trim();\r\n                    if (style !== originStyle) _removeCheck.v = true;\r\n                }\r\n\r\n                // class check\r\n                const originClasses = vNode.className;\r\n                let classes = '';\r\n                if (classRegExp && originClasses.length > 0) {\r\n                    classes = originClasses.replace(classRegExp, '').trim();\r\n                    if (classes !== originClasses) _removeCheck.v = true;\r\n                }\r\n\r\n                // remove only\r\n                if (isRemoveNode) {\r\n                    if ((classRegExp || !originClasses) && (styleRegExp || !originStyle) && !style && !classes && tagRemove) {\r\n                        _removeCheck.v = true;\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // change\r\n                if (style || classes || vNode.nodeName !== newNodeName || (wBoolean(styleRegExp) !== wBoolean(originStyle)) || (wBoolean(classRegExp) !== wBoolean(originClasses))) {\r\n                    if (styleRegExp && originStyle.length > 0) vNode.style.cssText = style;\r\n                    if (!vNode.style.cssText) {\r\n                        vNode.removeAttribute('style');\r\n                    }\r\n\r\n                    if (classRegExp && originClasses.length > 0) vNode.className = classes.trim();\r\n                    if (!vNode.className.trim()) {\r\n                        vNode.removeAttribute('class');\r\n                    }\r\n\r\n                    if (!vNode.style.cssText && !vNode.className && (vNode.nodeName === newNodeName || tagRemove)) {\r\n                        _removeCheck.v = true;\r\n                        return null;\r\n                    }\r\n\r\n                    return vNode;\r\n                }\r\n\r\n                _removeCheck.v = true;\r\n                return null;\r\n            };\r\n\r\n            // get line nodes\r\n            const lineNodes = this.getSelectedElements(null);\r\n            range = this.getRange();\r\n            startCon = range.startContainer;\r\n            startOff = range.startOffset;\r\n            endCon = range.endContainer;\r\n            endOff = range.endOffset;\r\n\r\n            if (!util.getFormatElement(startCon, null)) {\r\n                startCon = util.getChildElement(lineNodes[0], function (current) { return current.nodeType === 3; }, false);\r\n                startOff = 0;\r\n            }\r\n\r\n            if (!util.getFormatElement(endCon, null)) {\r\n                endCon = util.getChildElement(lineNodes[lineNodes.length - 1], function (current) { return current.nodeType === 3; }, false);\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            \r\n            const oneLine = util.getFormatElement(startCon, null) === util.getFormatElement(endCon, null);\r\n            const endLength = lineNodes.length - (oneLine ? 0 : 1);\r\n\r\n            // node Changes\r\n            newNode = appendNode.cloneNode(false);\r\n\r\n            const isRemoveAnchor = isRemoveFormat || (isRemoveNode && (function (arr) {\r\n                for (let n = 0, len = arr.length; n < len; n++) {\r\n                    if (util._isMaintainedNode(arr[n]) || util._isSizeNode(arr[n])) return true;\r\n                }\r\n                return false;\r\n            })(removeNodeArray));\r\n\r\n            const isSizeNode = isRemoveNode || util._isSizeNode(newNode);\r\n            const _getMaintainedNode = this._util_getMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\r\n            const _isMaintainedNode = this._util_isMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\r\n\r\n            // one line\r\n            if (oneLine) {\r\n                const newRange = this._nodeChange_oneLine(lineNodes[0], newNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, range.collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode);\r\n                start.container = newRange.startContainer;\r\n                start.offset = newRange.startOffset;\r\n                end.container = newRange.endContainer;\r\n                end.offset = newRange.endOffset;\r\n                if (start.container === end.container && util.onlyZeroWidthSpace(start.container)) {\r\n                    start.offset = end.offset = 1;\r\n                }\r\n                this._setCommonListStyle(newRange.ancestor, null);\r\n            } else { // multi line \r\n                // end\r\n                if (endLength > 0) {\r\n                    newNode = appendNode.cloneNode(false);\r\n                    end = this._nodeChange_endLine(lineNodes[endLength], newNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode);\r\n                }\r\n\r\n                // mid\r\n                for (let i = endLength - 1, newRange; i > 0; i--) {\r\n                    newNode = appendNode.cloneNode(false);\r\n                    newRange = this._nodeChange_middleLine(lineNodes[i], newNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, end.container);\r\n                    if (newRange.endContainer) {\r\n                        end.ancestor = null;\r\n                        end.container = newRange.endContainer;\r\n                    }\r\n                    this._setCommonListStyle(newRange.ancestor, null);\r\n                }\r\n\r\n                // start\r\n                newNode = appendNode.cloneNode(false);\r\n                start = this._nodeChange_startLine(lineNodes[0], newNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, end.container);\r\n\r\n                if (start.endContainer) {\r\n                    end.ancestor = null;\r\n                    end.container = start.endContainer;\r\n                }\r\n\r\n                if (endLength <= 0) {\r\n                    end = start;\r\n                } else if (!end.container) {\r\n                    end.ancestor = null;\r\n                    end.container = start.container;\r\n                    end.offset = start.container.textContent.length;\r\n                }\r\n\r\n                this._setCommonListStyle(start.ancestor, null);\r\n                this._setCommonListStyle(end.ancestor || util.getFormatElement(end.container), null);\r\n            }\r\n\r\n            // set range\r\n            this.controllersOff();\r\n            this.setRange(start.container, start.offset, end.container, end.offset);\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description If certain styles are applied to all child nodes of the list cell, the style of the list cell is also changed. (bold, color, size)\r\n         * @param {Element} el List cell element. <li>\r\n         * @param {Element|null} child Variable for recursive call. (\"null\" on the first call)\r\n         * @private\r\n         */\r\n        _setCommonListStyle: function (el, child) {\r\n            if (!util.isListCell(el)) return;\r\n            if (!child) el.removeAttribute('style');\r\n            \r\n            const children = util.getArrayItem((child || el).childNodes, function (current) { return !util.isBreak(current) && !util.onlyZeroWidthSpace(current.textContent.trim()); }, true);\r\n            if (children[0] && children.length === 1){\r\n                child = children[0];\r\n                if (!child || child.nodeType !== 1) return;\r\n\r\n                const childStyle = child.style;\r\n                const elStyle = el.style;\r\n\r\n                // bold\r\n                if (/STRONG/i.test(child.nodeName)) elStyle.fontWeight = 'bold'; // bold\r\n                else if (childStyle.fontWeight) elStyle.fontWeight = childStyle.fontWeight;\r\n\r\n                // styles\r\n                if (childStyle.color) elStyle.color = childStyle.color; // color\r\n                if (childStyle.fontSize) elStyle.fontSize = childStyle.fontSize; // size\r\n\r\n                this._setCommonListStyle(el, child);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Strip remove node\r\n         * @param {Node} removeNode The remove node\r\n         * @private\r\n         */\r\n        _stripRemoveNode: function (removeNode) {\r\n            const element = removeNode.parentNode;\r\n            if (!removeNode || removeNode.nodeType === 3 || !element) return;\r\n            \r\n            const children = removeNode.childNodes;\r\n            while (children[0]) {\r\n                element.insertBefore(children[0], removeNode);\r\n            }\r\n\r\n            element.removeChild(removeNode);\r\n        },\r\n\r\n        /**\r\n         * @description Return the parent maintained tag. (bind and use a util object)\r\n         * @param {Element} element Element\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _util_getMaintainedNode: function (_isRemove, _isSizeNode, element) {\r\n            if (!element || _isRemove) return null;\r\n            return this.getParentElement(element, this._isMaintainedNode.bind(this)) || (!_isSizeNode ? this.getParentElement(element, this._isSizeNode.bind(this)) : null);\r\n        },\r\n\r\n        /**\r\n         * @description Check if element is a tag that should be persisted. (bind and use a util object)\r\n         * @param {Element} element Element\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _util_isMaintainedNode: function (_isRemove, _isSizeNode, element) {\r\n            if (!element || _isRemove || element.nodeType !== 1) return false;\r\n            const anchor = this._isMaintainedNode(element);\r\n            return this.getParentElement(element, this._isMaintainedNode.bind(this)) ? anchor : (anchor || (!_isSizeNode ? this._isSizeNode(element) : false));\r\n        },\r\n\r\n        /**\r\n         * @description wraps text nodes of line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @param {Boolean} collapsed range.collapsed\r\n         * @returns {{ancestor: *, startContainer: *, startOffset: *, endContainer: *, endOffset: *}}\r\n         * @private\r\n         */\r\n        _nodeChange_oneLine: function (element, newInnerNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\r\n            // not add tag\r\n            let parentCon = startCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n\r\n            if (!isRemoveNode && parentCon === endCon.parentNode && parentCon.nodeName === newInnerNode.nodeName) {\r\n                if (util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff)) && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\r\n                    const children = parentCon.childNodes;\r\n                    let sameTag = true;\r\n    \r\n                    for (let i = 0, len = children.length, c, s, e, z; i < len; i++) {\r\n                        c = children[i];\r\n                        z = !util.onlyZeroWidthSpace(c);\r\n                        if (c === startCon) {\r\n                            s = true;\r\n                            continue;\r\n                        }\r\n                        if (c === endCon) {\r\n                            e = true;\r\n                            continue;\r\n                        }\r\n                        if ((!s && z) || (s && e && z)) {\r\n                            sameTag = false;\r\n                            break;\r\n                        }\r\n                    }\r\n    \r\n                    if (sameTag) {\r\n                        util.copyTagAttributes(parentCon, newInnerNode);\r\n        \r\n                        return {\r\n                            startContainer: startCon,\r\n                            startOffset: startOff,\r\n                            endContainer: endCon,\r\n                            endOffset: endOff\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n            const isSameNode = startCon === endCon;\r\n            let startContainer = startCon;\r\n            let startOffset = startOff;\r\n            let endContainer = endCon;\r\n            let endOffset = endOff;\r\n            let startPass = false;\r\n            let endPass = false;\r\n            let pCurrent, newNode, appendNode, cssText, anchorNode;\r\n\r\n            const wRegExp = _w.RegExp;\r\n            function checkCss (vNode) {\r\n                const regExp = new wRegExp('(?:;|^|\\\\s)(?:' + cssText + 'null)\\\\s*:[^;]*\\\\s*(?:;|$)', 'ig');\r\n                let style = '';\r\n\r\n                if (regExp && vNode.style.cssText.length > 0) {\r\n                    style = regExp.test(vNode.style.cssText);\r\n                }\r\n            \r\n                return !style;\r\n            }\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode; i < len; i++) {\r\n                    let child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n                    let cloneNode;\r\n\r\n                    // startContainer\r\n                    if (!startPass && child === startContainer) {\r\n                        let line = pNode;\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const prevNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(0, startOffset));\r\n                        const textNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(startOffset, \r\n                                isSameNode ? \r\n                                (endOffset >= startOffset ? endOffset - startOffset : startContainer.data.length - startOffset) : \r\n                                startContainer.data.length - startOffset)\r\n                            );\r\n\r\n                        if (anchorNode) {\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== line) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== line) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.appendChild(a);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        }\r\n                        \r\n                        if (!util.onlyZeroWidthSpace(prevNode)) {\r\n                            ancestor.appendChild(prevNode);\r\n                        }\r\n\r\n                        const prevAnchorNode = _getMaintainedNode(ancestor);\r\n                        if (!!prevAnchorNode) anchorNode = prevAnchorNode;\r\n                        if (anchorNode) line = anchorNode;\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        while (newNode !== line && newNode !== el && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                pCurrent.push(vNode);\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || textNode;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        newInnerNode.appendChild(childNode);\r\n                        line.appendChild(newInnerNode);\r\n\r\n                        if (anchorNode && !_getMaintainedNode(endContainer)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        startContainer = textNode;\r\n                        startOffset = 0;\r\n                        startPass = true;\r\n\r\n                        if (newNode !== textNode) newNode.appendChild(startContainer);\r\n                        if (!isSameNode) continue;\r\n                    }\r\n\r\n                    // endContainer\r\n                    if (!endPass && child === endContainer) {\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const afterNode = util.createTextNode(endContainer.nodeType === 1 ? '' : endContainer.substringData(endOffset, (endContainer.length - endOffset)));\r\n                        const textNode = util.createTextNode(isSameNode || endContainer.nodeType === 1 ? '' : endContainer.substringData(0, endOffset));\r\n\r\n                        if (anchorNode) {\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(afterNode)) {\r\n                            newNode = child;\r\n                            cssText = '';\r\n                            pCurrent = [];\r\n                            const anchors = [];\r\n                            while (newNode !== pNode && newNode !== el && newNode !== null) {\r\n                                if (newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                    if (_isMaintainedNode(newNode)) anchors.push(newNode.cloneNode(false));\r\n                                    else pCurrent.push(newNode.cloneNode(false));\r\n                                    cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                                }\r\n                                newNode = newNode.parentNode;\r\n                            }\r\n                            pCurrent = pCurrent.concat(anchors);\r\n\r\n                            cloneNode = appendNode = newNode = pCurrent.pop() || afterNode;\r\n                            while (pCurrent.length > 0) {\r\n                                newNode = pCurrent.pop();\r\n                                appendNode.appendChild(newNode);\r\n                                appendNode = newNode;\r\n                            }\r\n\r\n                            pNode.appendChild(cloneNode);\r\n                            newNode.textContent = afterNode.data;\r\n                        }\r\n\r\n                        if (anchorNode && cloneNode) {\r\n                            const afterAnchorNode = _getMaintainedNode(cloneNode);\r\n                            if (afterAnchorNode) {\r\n                                anchorNode = afterAnchorNode;\r\n                            }\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        while (newNode !== pNode && newNode !== el && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                pCurrent.push(vNode);\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || textNode;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            newInnerNode.appendChild(childNode);\r\n                            anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\r\n                            pNode.appendChild(anchorNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                            anchorNode = null;\r\n                        } else {\r\n                            newInnerNode.appendChild(childNode);\r\n                        }\r\n\r\n                        endContainer = textNode;\r\n                        endOffset = textNode.data.length;\r\n                        endPass = true;\r\n\r\n                        if (!isRemoveFormat && collapsed) {\r\n                            newInnerNode = textNode;\r\n                            textNode.textContent = util.zeroWidthSpace;\r\n                        }\r\n\r\n                        if (newNode !== textNode) newNode.appendChild(endContainer);\r\n                        continue;\r\n                    }\r\n\r\n                    // other\r\n                    if (startPass) {\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                pNode.appendChild(child.cloneNode(true));\r\n                                if (!collapsed) {\r\n                                    newInnerNode = newInnerNode.cloneNode(false);\r\n                                    pNode.appendChild(newInnerNode);\r\n                                    nNodeArray.push(newInnerNode);\r\n                                }\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = endPass ? newNode.cloneNode(false) : validation(newNode);\r\n                            if (newNode.nodeType === 1 && !util.isBreak(child) && vNode && checkCss(newNode)) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n                        \r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode) && !util.onlyZeroWidthSpace(newInnerNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n                        \r\n                        if (!endPass && !anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.appendChild(childNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                            if (newInnerNode.children.length > 0) ancestor = newNode;\r\n                            else ancestor = newInnerNode;\r\n                        } else if (childNode === child) {\r\n                            if (!endPass) ancestor = newInnerNode;\r\n                            else ancestor = pNode;\r\n                        } else if (endPass) {\r\n                            pNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.appendChild(newInnerNode);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    cloneNode = child.cloneNode(false);\r\n                    ancestor.appendChild(cloneNode);\r\n                    if (child.nodeType === 1 && !util.isBreak(child)) coverNode = cloneNode;\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    startContainer: startCon,\r\n                    startOffset: startOff,\r\n                    endContainer: endCon,\r\n                    endOffset: endOff\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    let textNode, textNode_s, textNode_e;\r\n                    \r\n                    if (collapsed) {\r\n                        textNode = util.createTextNode(util.zeroWidthSpace);\r\n                        pNode.replaceChild(textNode, removeNode);\r\n                    } else {\r\n                        const rChildren = removeNode.childNodes;\r\n                        textNode_s = rChildren[0];\r\n                        while (rChildren[0]) {\r\n                            textNode_e = rChildren[0];\r\n                            pNode.insertBefore(textNode_e, removeNode);\r\n                        }\r\n                        util.removeItem(removeNode);\r\n                    }\r\n\r\n                    if (i === 0) {\r\n                        if (collapsed) {\r\n                            startContainer = endContainer = textNode;\r\n                        } else {\r\n                            startContainer = textNode_s;\r\n                            endContainer = textNode_e;\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                if (isRemoveNode) {\r\n                    for (let i = 0; i < nNodeArray.length; i++) {\r\n                        this._stripRemoveNode(nNodeArray[i]);\r\n                    }\r\n                }\r\n                \r\n                if (collapsed) {\r\n                    startContainer = endContainer = newInnerNode;\r\n                }\r\n            }\r\n\r\n            util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n            if (collapsed) {\r\n                startOffset = startContainer.textContent.length;\r\n                endOffset = endContainer.textContent.length;\r\n            }\r\n\r\n            // endContainer reset\r\n            const endConReset = isRemoveFormat || endContainer.textContent.length === 0;\r\n\r\n            if (!util.isBreak(endContainer) && endContainer.textContent.length === 0) {\r\n                util.removeItem(endContainer);\r\n                endContainer = startContainer;\r\n            }\r\n            endOffset = endConReset ? endContainer.textContent.length : endOffset;\r\n\r\n            // node change\r\n            const newStartOffset = {s: 0, e: 0};\r\n            const startPath = util.getNodePath(startContainer, pNode, newStartOffset);\r\n\r\n            const mergeEndCon = !endContainer.parentNode;\r\n            if (mergeEndCon) endContainer = startContainer;\r\n            const newEndOffset = {s: 0, e: 0};\r\n            const endPath = util.getNodePath(endContainer , pNode, (!mergeEndCon && !endConReset) ? newEndOffset : null);\r\n\r\n            startOffset += newStartOffset.s;\r\n            endOffset = (collapsed ? startOffset : mergeEndCon ? startContainer.textContent.length : endConReset ? endOffset + newStartOffset.s : endOffset + newEndOffset.s);\r\n\r\n            // tag merge\r\n            const newOffsets = util.mergeSameTags(pNode, [startPath, endPath], true);\r\n\r\n            element.parentNode.replaceChild(pNode, element);\r\n\r\n            startContainer = util.getNodeFromPath(startPath, pNode);\r\n            endContainer = util.getNodeFromPath(endPath, pNode);\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                startContainer: startContainer,\r\n                startOffset: startOffset + newOffsets[0],\r\n                endContainer: endContainer,\r\n                endOffset: endOffset + newOffsets[1]\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description wraps first line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @returns {null|Node} If end container is renewed, returned renewed node\r\n         * @returns {Object} { ancestor, container, offset, endContainer }\r\n         * @private\r\n         */\r\n        _nodeChange_startLine: function (element, newInnerNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, _endContainer) {\r\n            // not add tag\r\n            let parentCon = startCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n\r\n            if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.nextSibling && util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff))) {\r\n                let sameTag = true;\r\n                let s = startCon.previousSibling;\r\n                while (s) {\r\n                    if (!util.onlyZeroWidthSpace(s)) {\r\n                        sameTag = false;\r\n                        break;\r\n                    }\r\n                    s = s.previousSibling;\r\n                }\r\n\r\n                if (sameTag) {\r\n                    util.copyTagAttributes(parentCon, newInnerNode);\r\n    \r\n                    return {\r\n                        ancestor: element,\r\n                        container: startCon,\r\n                        offset: startOff\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n\r\n            let container = startCon;\r\n            let offset = startOff;\r\n            let passNode = false;\r\n            let pCurrent, newNode, appendNode, anchorNode;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\r\n                    const child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (passNode && !util.isBreak(child)) {\r\n                        if (child.nodeType === 1) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                newInnerNode = newInnerNode.cloneNode(false);\r\n                                cloneChild = child.cloneNode(true);\r\n                                pNode.appendChild(cloneChild);\r\n                                pNode.appendChild(newInnerNode);\r\n                                nNodeArray.push(newInnerNode);\r\n\r\n                                // end container\r\n                                if (_endContainer && child.contains(_endContainer)) {\r\n                                    const endPath = util.getNodePath(_endContainer, child);\r\n                                    _endContainer = util.getNodeFromPath(endPath, cloneChild);\r\n                                }\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = validation(newNode);\r\n                            if (newNode.nodeType === 1 && vNode) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const isTopNode = pCurrent.length > 0;\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n                        \r\n                        if (!anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.appendChild(childNode);\r\n                            ancestor = !_isMaintainedNode(newNode) ? newNode : newInnerNode;\r\n                            nNodeArray.push(newInnerNode);\r\n                        } else if (isTopNode) {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.appendChild(newInnerNode);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // startContainer\r\n                    if (!passNode && child === container) {\r\n                        let line = pNode;\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const prevNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\r\n                        const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, (container.length - offset)));\r\n\r\n                        if (anchorNode) {\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== line) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== line) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.appendChild(a);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(prevNode)) {\r\n                            ancestor.appendChild(prevNode);\r\n                        }\r\n\r\n                        const prevAnchorNode = _getMaintainedNode(ancestor);\r\n                        if (!!prevAnchorNode) anchorNode = prevAnchorNode;\r\n                        if (anchorNode) line = anchorNode;\r\n\r\n                        newNode = ancestor;\r\n                        pCurrent = [];\r\n                        while (newNode !== line && newNode !== null) {\r\n                            vNode = validation(newNode);\r\n                            if (newNode.nodeType === 1 && vNode) {\r\n                                pCurrent.push(vNode);\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || ancestor;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (childNode !== ancestor) {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\r\n                        line.appendChild(newInnerNode);\r\n\r\n                        container = textNode;\r\n                        offset = 0;\r\n                        passNode = true;\r\n\r\n                        ancestor.appendChild(container);\r\n                        continue;\r\n                    }\r\n\r\n                    vNode = !passNode ? child.cloneNode(false) : validation(child);\r\n                    if (vNode) {\r\n                        ancestor.appendChild(vNode);\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\r\n                    }\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    container: startCon,\r\n                    offset: startOff,\r\n                    endContainer: _endContainer\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n\r\n                    const rChildren = removeNode.childNodes;\r\n                    const textNode = rChildren[0];\r\n                    while (rChildren[0]) {\r\n                        pNode.insertBefore(rChildren[0], removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n\r\n                    if (i === 0) container = textNode;\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            if (!isRemoveFormat && pNode.childNodes.length === 0) {\r\n                if (element.childNodes) {\r\n                    container = element.childNodes[0];\r\n                } else {\r\n                    container = util.createTextNode(util.zeroWidthSpace);\r\n                    element.appendChild(container);\r\n                }\r\n            } else {\r\n                util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n                if (util.onlyZeroWidthSpace(pNode.textContent)) {\r\n                    container = pNode.firstChild;\r\n                    offset = 0;\r\n                }\r\n\r\n                // node change\r\n                const offsets = {s: 0, e: 0};\r\n                const path = util.getNodePath(container, pNode, offsets);\r\n                offset += offsets.s;\r\n\r\n                // tag merge\r\n                const newOffsets = util.mergeSameTags(pNode, [path], true);\r\n\r\n                element.parentNode.replaceChild(pNode, element);\r\n\r\n                container = util.getNodeFromPath(path, pNode);\r\n                offset += newOffsets[0];\r\n            }\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                container: container,\r\n                offset: offset,\r\n                endContainer: _endContainer\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description wraps mid lines selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @param {Node} _endContainer Offset node of last line already modified (end.container)\r\n         * @returns {Object} { ancestor, endContainer: \"If end container is renewed, returned renewed node\" }\r\n         * @private\r\n         */\r\n        _nodeChange_middleLine: function (element, newInnerNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, _endContainer) {\r\n            // not add tag\r\n            if (!isRemoveNode) {\r\n                // end container path\r\n                let endPath = null;\r\n                if (_endContainer && element.contains(_endContainer)) endPath = util.getNodePath(_endContainer, element);\r\n\r\n                const tempNode = element.cloneNode(true);\r\n                const newNodeName = newInnerNode.nodeName;\r\n                const newCssText = newInnerNode.style.cssText;\r\n                const newClass = newInnerNode.className;\r\n\r\n                let children = tempNode.childNodes;\r\n                let i = 0, len = children.length;\r\n                for (let child; i < len; i++) {\r\n                    child = children[i];\r\n                    if (child.nodeType === 3) break;\r\n                    if (child.nodeName === newNodeName) {\r\n                        child.style.cssText += newCssText;\r\n                        util.addClass(child, newClass);\r\n                    } else if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\r\n                        continue;\r\n                    } else if (len === 1) {\r\n                        children = child.childNodes;\r\n                        len = children.length;\r\n                        i = -1;\r\n                        continue;\r\n                    } else {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (len > 0 && i === len) {\r\n                    element.innerHTML = tempNode.innerHTML;\r\n                    return {\r\n                        ancestor: element,\r\n                        endContainer: endPath ? util.getNodeFromPath(endPath, element) : null\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const pNode = element.cloneNode(false);\r\n            const nNodeArray = [newInnerNode];\r\n            let noneChange = true;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\r\n                    let child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\r\n                        if (newInnerNode.childNodes.length > 0) {\r\n                            pNode.appendChild(newInnerNode);\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                        }\r\n                        \r\n                        cloneChild = child.cloneNode(true);\r\n                        pNode.appendChild(cloneChild);\r\n                        pNode.appendChild(newInnerNode);\r\n                        nNodeArray.push(newInnerNode);\r\n                        ancestor = newInnerNode;\r\n\r\n                        // end container\r\n                        if (_endContainer && child.contains(_endContainer)) {\r\n                            const endPath = util.getNodePath(_endContainer, child);\r\n                            _endContainer = util.getNodeFromPath(endPath, cloneChild);\r\n                        }\r\n\r\n                        continue;\r\n                    } else {\r\n                        vNode = validation(child);\r\n                        if (vNode) {\r\n                            noneChange = false;\r\n                            ancestor.appendChild(vNode);\r\n                            if (child.nodeType === 1) coverNode = vNode;\r\n                        }\r\n                    }\r\n\r\n                    if (!util.isBreak(child)) recursionFunc(child, coverNode);\r\n                }\r\n            })(element, newInnerNode);\r\n\r\n            // not remove tag\r\n            if (noneChange || (isRemoveNode && !isRemoveFormat && !_removeCheck.v)) return { ancestor: element, endContainer: _endContainer };\r\n\r\n            pNode.appendChild(newInnerNode);\r\n\r\n            if (isRemoveFormat && isRemoveNode) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    \r\n                    const rChildren = removeNode.childNodes;\r\n                    while (rChildren[0]) {\r\n                        pNode.insertBefore(rChildren[0], removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            util.removeEmptyNode(pNode, newInnerNode);\r\n            util.mergeSameTags(pNode, null, true);\r\n\r\n            // node change\r\n            element.parentNode.replaceChild(pNode, element);\r\n            return { ancestor: pNode, endContainer: _endContainer };\r\n        },\r\n\r\n        /**\r\n         * @description wraps last line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @returns {Object} { ancestor, container, offset }\r\n         * @private\r\n         */\r\n        _nodeChange_endLine: function (element, newInnerNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\r\n            // not add tag\r\n            let parentCon = endCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n            \r\n            if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.previousSibling && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\r\n                let sameTag = true;\r\n                let e = endCon.nextSibling;\r\n                while (e) {\r\n                    if (!util.onlyZeroWidthSpace(e)) {\r\n                        sameTag = false;\r\n                        break;\r\n                    }\r\n                    e = e.nextSibling;\r\n                }\r\n\r\n                if (sameTag) {\r\n                    util.copyTagAttributes(parentCon, newInnerNode);\r\n    \r\n                    return {\r\n                        ancestor: element,\r\n                        container: endCon,\r\n                        offset: endOff\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n\r\n            let container = endCon;\r\n            let offset = endOff;\r\n            let passNode = false;\r\n            let pCurrent, newNode, appendNode, anchorNode;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = childNodes.length - 1, vNode; 0 <= i; i--) {\r\n                    const child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (passNode && !util.isBreak(child)) {\r\n                        if (child.nodeType === 1) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                newInnerNode = newInnerNode.cloneNode(false);\r\n                                const cloneChild = child.cloneNode(true);\r\n                                pNode.insertBefore(cloneChild, ancestor);\r\n                                pNode.insertBefore(newInnerNode, cloneChild);\r\n                                nNodeArray.push(newInnerNode);\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const isTopNode = pCurrent.length > 0;\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.insertBefore(childNode, pNode.firstChild);\r\n                            nNodeArray.push(newInnerNode);\r\n                            if (newInnerNode.children.length > 0) ancestor = newNode;\r\n                            else ancestor = newInnerNode;\r\n                        } else if (isTopNode) {\r\n                            newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // endContainer\r\n                    if (!passNode && child === container) {\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const afterNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, (container.length - offset)));\r\n                        const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\r\n\r\n                        if (anchorNode) {\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== pNode) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== pNode) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.insertBefore(a, m.parentNode.firstChild);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(afterNode)) {\r\n                            ancestor.insertBefore(afterNode, ancestor.firstChild);\r\n                        }\r\n\r\n                        newNode = ancestor;\r\n                        pCurrent = [];\r\n                        while (newNode !== pNode && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1) {\r\n                                pCurrent.push(vNode);\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || ancestor;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (childNode !== ancestor) {\r\n                            newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\r\n                        \r\n                        if (anchorNode) {\r\n                            anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\r\n                            pNode.insertBefore(anchorNode, pNode.firstChild);\r\n                            anchorNode = null;\r\n                        } else {\r\n                            pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                        }\r\n\r\n                        container = textNode;\r\n                        offset = textNode.data.length;\r\n                        passNode = true;\r\n\r\n                        ancestor.insertBefore(container, ancestor.firstChild);\r\n                        continue;\r\n                    }\r\n\r\n                    vNode = !passNode ? child.cloneNode(false) : validation(child);\r\n                    if (vNode) {\r\n                        ancestor.insertBefore(vNode, ancestor.firstChild);\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\r\n                    }\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    container: endCon,\r\n                    offset: endOff\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    \r\n                    const rChildren = removeNode.childNodes;\r\n                    let textNode = null;\r\n                    while (rChildren[0]) {\r\n                        textNode = rChildren[0];\r\n                        pNode.insertBefore(textNode, removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n\r\n                    if (i === nNodeArray.length - 1) {\r\n                        container = textNode;\r\n                        offset = textNode.textContent.length;\r\n                    }\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            if (!isRemoveFormat && pNode.childNodes.length === 0) {\r\n                if (element.childNodes) {\r\n                    container = element.childNodes[0];\r\n                } else {\r\n                    container = util.createTextNode(util.zeroWidthSpace);\r\n                    element.appendChild(container);\r\n                }\r\n            } else {\r\n                if (!isRemoveNode && newInnerNode.textContent.length === 0) {\r\n                    util.removeEmptyNode(pNode, null);\r\n                    return {\r\n                        ancestor: null,\r\n                        container: null,\r\n                        offset: 0\r\n                    };\r\n                }\r\n\r\n                util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n                if (util.onlyZeroWidthSpace(pNode.textContent)) {\r\n                    container = pNode.firstChild;\r\n                    offset = container.textContent.length;\r\n                } else if (util.onlyZeroWidthSpace(container)) {\r\n                    container = newInnerNode;\r\n                    offset = 1;\r\n                }\r\n                \r\n                // node change\r\n                const offsets = {s: 0, e: 0};\r\n                const path = util.getNodePath(container, pNode, offsets);\r\n                offset += offsets.s;\r\n\r\n                // tag merge\r\n                const newOffsets = util.mergeSameTags(pNode, [path], true);\r\n\r\n                element.parentNode.replaceChild(pNode, element);\r\n\r\n                container = util.getNodeFromPath(path, pNode);\r\n                offset += newOffsets[0];\r\n            }\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                container: container,\r\n                offset: offset\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Run plugin calls and basic commands.\r\n         * @param {String} command Command string\r\n         * @param {String} display Display type string ('command', 'submenu', 'dialog', 'container')\r\n         * @param {Element} target The element of command button\r\n         */\r\n        actionCall: function (command, display, target) {\r\n            // call plugins\r\n            if (display) {\r\n                if (/more/i.test(display) && target !== this._moreLayerActiveButton) {\r\n                    const layer = context.element.toolbar.querySelector('.' + command);\r\n                    if (layer) {\r\n                        if (this._moreLayerActiveButton) {\r\n                            (context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'))).style.display = 'none';\r\n                            util.removeClass(this._moreLayerActiveButton, 'on');\r\n                        }\r\n                        util.addClass(target, 'on');\r\n                        this._moreLayerActiveButton = target;\r\n                        layer.style.display = 'block';\r\n\r\n                        event._showToolbarBalloon();\r\n                        event._showToolbarInline();\r\n                    }\r\n                    return;\r\n                } else if (/submenu/.test(display) && (this._menuTray[command] === null || target !== this.submenuActiveButton)) {\r\n                    this.callPlugin(command, this.submenuOn.bind(this, target), target);\r\n                    return;\r\n                } else if (/dialog/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].open.bind(this), target);\r\n                    return;\r\n                } else if (/command/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].action.bind(this), target);\r\n                } else if (/container/.test(display) && (this._menuTray[command] === null || target !== this.containerActiveButton)) {\r\n                    this.callPlugin(command, this.containerOn.bind(this, target), target);\r\n                    return;\r\n                } else if (/fileBrowser/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].open.bind(this, null), target);\r\n                }\r\n            } // default command\r\n            else if (command) {\r\n                this.commandHandler(target, command);\r\n            }\r\n\r\n            if (/more/i.test(display)) {\r\n                const layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\r\n                if (layer) {\r\n                    util.removeClass(this._moreLayerActiveButton, 'on');\r\n                    this._moreLayerActiveButton = null;\r\n                    layer.style.display = 'none';\r\n\r\n                    event._showToolbarBalloon();\r\n                    event._showToolbarInline();\r\n                }\r\n            } else if (/submenu/.test(display)) {\r\n                this.submenuOff();\r\n            } else if (!/command/.test(display)) {\r\n                this.submenuOff();\r\n                this.containerOff();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Execute command of command button(All Buttons except submenu and dialog)\r\n         * (selectAll, codeView, fullScreen, indent, outdent, undo, redo, removeFormat, print, preview, showBlocks, save, bold, underline, italic, strike, subscript, superscript, copy, cut, paste)\r\n         * @param {Element|null} target The element of command button\r\n         * @param {String} command Property of command button (data-value)\r\n         */\r\n        commandHandler: function (target, command) {\r\n            switch (command) {\r\n                case 'copy':\r\n                case 'cut':\r\n                    this.execCommand(command);\r\n                    break;\r\n                case 'paste':\r\n                    break;\r\n                case 'selectAll':\r\n                    const wysiwyg = context.element.wysiwyg;\r\n                    let first = util.getChildElement(wysiwyg.firstChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, false) || wysiwyg.firstChild;\r\n                    let last = util.getChildElement(wysiwyg.lastChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, true) || wysiwyg.lastChild;\r\n                    if (!first || !last) return;\r\n                    if (util.isMedia(first)) {\r\n                        const info = this.getFileComponent(first);\r\n                        const br = util.createElement('BR');\r\n                        const format = util.createElement(options.defaultTag);\r\n                        format.appendChild(br);\r\n                        first = info ? info.component : first;\r\n                        first.parentNode.insertBefore(format, first);\r\n                        first = br;\r\n                    }\r\n                    if (util.isMedia(last)) {\r\n                        const br = util.createElement('BR');\r\n                        const format = util.createElement(options.defaultTag);\r\n                        format.appendChild(br);\r\n                        wysiwyg.appendChild(format);\r\n                        last = br;\r\n                    }\r\n                    this.setRange(first, 0, last, last.textContent.length);\r\n                    break;\r\n                case 'codeView':\r\n                    this.toggleCodeView();\r\n                    break;\r\n                case 'fullScreen':\r\n                    this.toggleFullScreen(target);\r\n                    break;\r\n                case 'indent':\r\n                case 'outdent':\r\n                    this.indent(command);\r\n                    break;\r\n                case 'undo':\r\n                    this.history.undo();\r\n                    break;\r\n                case 'redo':\r\n                    this.history.redo();\r\n                    break;\r\n                case 'removeFormat':\r\n                    this.removeFormat();\r\n                    this.focus();\r\n                    break;\r\n                case 'print':\r\n                    this.print();\r\n                    break;\r\n                case 'preview':\r\n                    this.preview();\r\n                    break;\r\n                case 'showBlocks':\r\n                    this.toggleDisplayBlocks();\r\n                    break;\r\n                case 'save':\r\n                    if (typeof options.callBackSave === 'function') {\r\n                        options.callBackSave(this.getContents(false), this._variable.isChanged);\r\n                    } else if (this._variable.isChanged && typeof functions.save === 'function') {\r\n                        functions.save();\r\n                    } else {\r\n                        throw Error('[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)');\r\n                    }\r\n\r\n                    this._variable.isChanged = false;\r\n                    if (context.tool.save) context.tool.save.setAttribute('disabled', true);\r\n                    break;\r\n                default : // 'STRONG', 'U', 'EM', 'DEL', 'SUB', 'SUP'..\r\n                    command = this._defaultCommand[command.toLowerCase()] || command;\r\n                    if (!this.commandMap[command]) this.commandMap[command] = target;\r\n\r\n                    const nodesMap = this._variable.currentNodesMap;\r\n                    const cmd = nodesMap.indexOf(command) > -1 ? null : util.createElement(command);\r\n                    let removeNode = command;\r\n\r\n                    if (/^SUB$/i.test(command) && nodesMap.indexOf('SUP') > -1) {\r\n                        removeNode = 'SUP';\r\n                    } else if (/^SUP$/i.test(command) && nodesMap.indexOf('SUB') > -1) {\r\n                        removeNode = 'SUB';\r\n                    }\r\n\r\n                    this.nodeChange(cmd, null, [removeNode], false);\r\n                    this.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Remove format of the currently selected range\r\n         */\r\n        removeFormat: function () {\r\n            this.nodeChange(null, null, null, null);\r\n        },\r\n\r\n        /**\r\n         * @description This method implements indentation to selected range.\r\n         * Setted \"margin-left\" to \"25px\" in the top \"P\" tag of the parameter node.\r\n         * @param {String} command Separator (\"indent\" or \"outdent\")\r\n         */\r\n        indent: function (command) {\r\n            const range = this.getRange();\r\n            const rangeLines = this.getSelectedElements(null);\r\n            const cells = [];\r\n            const shift = 'indent' !== command;\r\n            const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\r\n            let sc = range.startContainer;\r\n            let ec = range.endContainer;\r\n            let so = range.startOffset;\r\n            let eo = range.endOffset;\r\n\r\n            for (let i = 0, len = rangeLines.length, f, margin; i < len; i++) {\r\n                f = rangeLines[i];\r\n                if (!util.isListCell(f) || !this.plugins.list) {\r\n                    margin = /\\d+/.test(f.style[marginDir]) ? util.getNumber(f.style[marginDir], 0) : 0;\r\n                    if (shift) {\r\n                        margin -= 25;\r\n                    } else {\r\n                        margin += 25;\r\n                    }\r\n                    util.setStyle(f, marginDir, (margin <= 0 ? '' : margin + 'px'));\r\n                } else {\r\n                    if (shift || f.previousElementSibling) {\r\n                        cells.push(f);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // list cells\r\n            if (cells.length > 0) {\r\n                this.plugins.list.editInsideList.call(this, shift, cells);\r\n            }\r\n\r\n            this.effectNode = null;\r\n            this.setRange(sc, so, ec, eo);\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Add or remove the class name of \"body\" so that the code block is visible\r\n         */\r\n        toggleDisplayBlocks: function () {\r\n            const wysiwyg = context.element.wysiwyg;\r\n            util.toggleClass(wysiwyg, 'se-show-block');\r\n            if (util.hasClass(wysiwyg, 'se-show-block')) {\r\n                util.addClass(this._styleCommandMap.showBlocks, 'active');\r\n            } else {\r\n                util.removeClass(this._styleCommandMap.showBlocks, 'active');\r\n            }\r\n            this._resourcesStateChange();\r\n        },\r\n\r\n        /**\r\n         * @description Changes to code view or wysiwyg view\r\n         */\r\n        toggleCodeView: function () {\r\n            const isCodeView = this._variable.isCodeView;\r\n            this.controllersOff();\r\n            util.setDisabledButtons(!isCodeView, this.codeViewDisabledButtons);\r\n\r\n            if (isCodeView) {\r\n                this._setCodeDataToEditor();\r\n                context.element.wysiwygFrame.scrollTop = 0;\r\n                context.element.code.style.display = 'none';\r\n                context.element.wysiwygFrame.style.display = 'block';\r\n\r\n                this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\r\n                this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\r\n\r\n                if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = '0px';\r\n                \r\n                this._variable.isCodeView = false;\r\n                \r\n                if (!this._variable.isFullScreen) {\r\n                    this._notHideToolbar = false;\r\n                    if (/balloon|balloon-always/i.test(options.mode)) {\r\n                        context.element._arrow.style.display = '';\r\n                        this._isInline = false;\r\n                        this._isBalloon = true;\r\n                        event._hideToolbar();    \r\n                    }\r\n                }\r\n\r\n                this.nativeFocus();\r\n                util.removeClass(this._styleCommandMap.codeView, 'active');\r\n\r\n                // history stack\r\n                this.history.push(false);\r\n                this.history._resetCachingButton();\r\n            } else {\r\n                this._setEditorDataToCodeView();\r\n                this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\r\n                this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\r\n\r\n                if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = context.element.code.scrollHeight > 0 ? (context.element.code.scrollHeight + 'px') : 'auto';\r\n                if (options.codeMirrorEditor) options.codeMirrorEditor.refresh();\r\n                \r\n                this._variable.isCodeView = true;\r\n\r\n                if (!this._variable.isFullScreen) {\r\n                    this._notHideToolbar = true;\r\n                    if (this._isBalloon) {\r\n                        context.element._arrow.style.display = 'none';\r\n                        context.element.toolbar.style.left = '';\r\n                        this._isInline = true;\r\n                        this._isBalloon = false;\r\n                        event._showToolbarInline();\r\n                    }\r\n                }\r\n                \r\n                this._variable._range = null;\r\n                context.element.code.focus();\r\n                util.addClass(this._styleCommandMap.codeView, 'active');\r\n            }\r\n\r\n            this._checkPlaceholder();\r\n            // user event\r\n            if (typeof functions.toggleCodeView === 'function') functions.toggleCodeView(this._variable.isCodeView, this);\r\n        },\r\n\r\n        /**\r\n         * @description Convert the data of the code view and put it in the WYSIWYG area.\r\n         * @private\r\n         */\r\n        _setCodeDataToEditor: function () {\r\n            const code_html = this._getCodeView();\r\n\r\n            if (options.fullPage) {\r\n                const parseDocument = this._parser.parseFromString(code_html, 'text/html');\r\n                const headChildren = parseDocument.head.children;\r\n\r\n                for (let i = 0, len = headChildren.length; i < len; i++) {\r\n                    if (/^script$/i.test(headChildren[i].tagName)) {\r\n                        parseDocument.head.removeChild(headChildren[i]);\r\n                        i--, len--;\r\n                    }\r\n                }\r\n\r\n                this._wd.head.innerHTML = parseDocument.head.innerHTML;\r\n                this._wd.body.innerHTML = this.convertContentsForEditor(parseDocument.body.innerHTML);\r\n\r\n                const attrs = parseDocument.body.attributes;\r\n                for (let i = 0, len = attrs.length; i < len; i++) {\r\n                    if (attrs[i].name === 'contenteditable') continue;\r\n                    this._wd.body.setAttribute(attrs[i].name, attrs[i].value);\r\n                }\r\n                if (!util.hasClass(this._wd.body, 'sun-editor-editable')) {\r\n                    const editableClasses = options._editableClass.split(' ');\r\n                    for (let i = 0; i < editableClasses.length; i++) {\r\n                        util.addClass(this._wd.body, options._editableClass[i]);\r\n                    }\r\n                }\r\n            } else {\r\n                context.element.wysiwyg.innerHTML = code_html.length > 0 ? this.convertContentsForEditor(code_html) : '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Convert the data of the WYSIWYG area and put it in the code view area.\r\n         * @private\r\n         */\r\n        _setEditorDataToCodeView: function () {\r\n            const codeContents = this.convertHTMLForCodeView(context.element.wysiwyg);\r\n            let codeValue = '';\r\n\r\n            if (options.fullPage) {\r\n                const attrs = util.getAttributesToString(this._wd.body, null);\r\n                codeValue = '<!DOCTYPE html>\\n<html>\\n' + this._wd.head.outerHTML.replace(/>(?!\\n)/g, '>\\n') + '<body ' + attrs + '>\\n' + codeContents + '</body>\\n</html>';\r\n            } else {\r\n                codeValue = codeContents;\r\n            }\r\n\r\n            context.element.code.style.display = 'block';\r\n            context.element.wysiwygFrame.style.display = 'none';\r\n\r\n            this._setCodeView(codeValue);\r\n        },\r\n\r\n        /**\r\n         * @description Changes to full screen or default screen\r\n         * @param {Element} element full screen button\r\n         */\r\n        toggleFullScreen: function (element) {\r\n            const topArea = context.element.topArea;\r\n            const toolbar = context.element.toolbar;\r\n            const editorArea = context.element.editorArea;\r\n            const wysiwygFrame = context.element.wysiwygFrame;\r\n            const code = context.element.code;\r\n            const _var = this._variable;\r\n            this.controllersOff();\r\n\r\n            if (!_var.isFullScreen) {\r\n                _var.isFullScreen = true;\r\n                \r\n                _var._fullScreenAttrs.inline = this._isInline;\r\n                _var._fullScreenAttrs.balloon = this._isBalloon;\r\n\r\n                if (this._isInline || this._isBalloon) {\r\n                    this._isInline = false;\r\n                    this._isBalloon = false;\r\n                }\r\n                \r\n                if (!!options.toolbarContainer) context.element.relative.insertBefore(toolbar, editorArea);\r\n\r\n                topArea.style.position = 'fixed';\r\n                topArea.style.top = '0';\r\n                topArea.style.left = '0';\r\n                topArea.style.width = '100%';\r\n                topArea.style.maxWidth = '100%';\r\n                topArea.style.height = '100%';\r\n                topArea.style.zIndex = '2147483647';\r\n\r\n                if (context.element._stickyDummy.style.display !== ('none' && '')) {\r\n                    _var._fullScreenAttrs.sticky = true;\r\n                    context.element._stickyDummy.style.display = 'none';\r\n                    util.removeClass(toolbar, 'se-toolbar-sticky');\r\n                }\r\n\r\n                _var._bodyOverflow = _d.body.style.overflow;\r\n                _d.body.style.overflow = 'hidden';\r\n\r\n                _var._editorAreaOriginCssText = editorArea.style.cssText;\r\n                _var._wysiwygOriginCssText = wysiwygFrame.style.cssText;\r\n                _var._codeOriginCssText = code.style.cssText;\r\n\r\n                editorArea.style.cssText = toolbar.style.cssText = '';\r\n                wysiwygFrame.style.cssText = (wysiwygFrame.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\r\n                code.style.cssText = (code.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\r\n                toolbar.style.width = wysiwygFrame.style.height = code.style.height = '100%';\r\n                toolbar.style.position = 'relative';\r\n                toolbar.style.display = 'block';\r\n\r\n                _var.innerHeight_fullScreen = (_w.innerHeight - toolbar.offsetHeight);\r\n                editorArea.style.height = (_var.innerHeight_fullScreen - options.fullScreenOffset) + 'px';\r\n\r\n                util.changeElement(element.firstElementChild, icons.reduction);\r\n\r\n                if (options.iframe && options.height === 'auto') {\r\n                    editorArea.style.overflow = 'auto';\r\n                    this._iframeAutoHeight();\r\n                }\r\n\r\n                context.element.topArea.style.marginTop = options.fullScreenOffset + 'px';\r\n                util.addClass(this._styleCommandMap.fullScreen, 'active');\r\n            } else {\r\n                _var.isFullScreen = false;\r\n\r\n                wysiwygFrame.style.cssText = _var._wysiwygOriginCssText;\r\n                code.style.cssText = _var._codeOriginCssText;\r\n                toolbar.style.cssText = '';\r\n                editorArea.style.cssText = _var._editorAreaOriginCssText;\r\n                topArea.style.cssText = _var._originCssText;\r\n                _d.body.style.overflow = _var._bodyOverflow;\r\n\r\n                if (!!options.toolbarContainer) options.toolbarContainer.appendChild(toolbar);\r\n\r\n                if (options.stickyToolbar > -1) {\r\n                    util.removeClass(toolbar, 'se-toolbar-sticky');\r\n                }\r\n\r\n                if (_var._fullScreenAttrs.sticky && !options.toolbarContainer) {\r\n                    _var._fullScreenAttrs.sticky = false;\r\n                    context.element._stickyDummy.style.display = 'block';\r\n                    util.addClass(toolbar, \"se-toolbar-sticky\");\r\n                }\r\n\r\n                this._isInline = _var._fullScreenAttrs.inline;\r\n                this._isBalloon = _var._fullScreenAttrs.balloon;\r\n                if (this._isInline) event._showToolbarInline();\r\n                if (!!options.toolbarContainer) util.removeClass(toolbar, 'se-toolbar-balloon');\r\n\r\n                event.onScroll_window();\r\n                util.changeElement(element.firstElementChild, icons.expansion);\r\n\r\n                context.element.topArea.style.marginTop = '';\r\n                util.removeClass(this._styleCommandMap.fullScreen, 'active');\r\n            }\r\n\r\n            // user event\r\n            if (typeof functions.toggleFullScreen === 'function') functions.toggleFullScreen(this._variable.isFullScreen, this);\r\n        },\r\n\r\n        /**\r\n         * @description Prints the current contents of the editor.\r\n         */\r\n        print: function () {\r\n            const iframe = util.createElement('IFRAME');\r\n            iframe.style.display = 'none';\r\n            _d.body.appendChild(iframe);\r\n\r\n            const contentsHTML = options.printTemplate ? options.printTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\r\n            const printDocument = util.getIframeDocument(iframe);\r\n            const wDoc = this._wd;\r\n\r\n            if (options.iframe) {\r\n                const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\r\n\r\n                printDocument.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    wDoc.head.innerHTML +\r\n                    '</head>' +\r\n                    '<body ' + arrts + '>' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            } else {\r\n                const links = _d.head.getElementsByTagName('link');\r\n                const styles = _d.head.getElementsByTagName('style');\r\n                let linkHTML = '';\r\n                for (let i = 0, len = links.length; i < len; i++) {\r\n                    linkHTML += links[i].outerHTML;\r\n                }\r\n                for (let i = 0, len = styles.length; i < len; i++) {\r\n                    linkHTML += styles[i].outerHTML;\r\n                }\r\n\r\n                printDocument.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    linkHTML +\r\n                    '</head>' +\r\n                    '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\">' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            }\r\n\r\n            this.showLoading();\r\n            _w.setTimeout(function () {\r\n                try {\r\n                    iframe.focus();\r\n                    // IE or Edge\r\n                    if (util.isIE_Edge || !!_d.documentMode || !!_w.StyleMedia) {\r\n                        try {\r\n                            iframe.contentWindow.document.execCommand('print', false, null);\r\n                        } catch (e) {\r\n                            iframe.contentWindow.print();\r\n                        }\r\n                    } else {\r\n                        // Other browsers\r\n                        iframe.contentWindow.print();\r\n                    }\r\n                } catch (error) {\r\n                    throw Error('[SUNEDITOR.core.print.fail] error: ' + error);\r\n                } finally {\r\n                    core.closeLoading();\r\n                    util.removeItem(iframe);\r\n                }\r\n            }, 1000);\r\n        },\r\n\r\n        /**\r\n         * @description Open the preview window.\r\n         */\r\n        preview: function () {\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.controllersOff();\r\n            \r\n            const contentsHTML = options.previewTemplate ? options.previewTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\r\n            const windowObject = _w.open('', '_blank');\r\n            windowObject.mimeType = 'text/html';\r\n            const wDoc = this._wd;\r\n\r\n            if (options.iframe) {\r\n                const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\r\n\r\n                windowObject.document.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    wDoc.head.innerHTML +\r\n                    '<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style>' +\r\n                    '</head>' +\r\n                    '<body ' + arrts + '>' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            } else {\r\n                const links = _d.head.getElementsByTagName('link');\r\n                const styles = _d.head.getElementsByTagName('style');\r\n                let linkHTML = '';\r\n                for (let i = 0, len = links.length; i < len; i++) {\r\n                    linkHTML += links[i].outerHTML;\r\n                }\r\n                for (let i = 0, len = styles.length; i < len; i++) {\r\n                    linkHTML += styles[i].outerHTML;\r\n                }\r\n                \r\n                windowObject.document.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    '<meta charset=\"utf-8\" />' +\r\n                    '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">' +\r\n                    '<title>' + lang.toolbar.preview + '</title>' +\r\n                    linkHTML +\r\n                    '</head>' +\r\n                    '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\" style=\"margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;\">' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Sets the HTML string\r\n         * @param {String|undefined} html HTML string\r\n         */\r\n        setContents: function (html) {\r\n            this.removeRange();\r\n            \r\n            const convertValue = (html === null || html === undefined) ? '' : this.convertContentsForEditor(html);\r\n            this._resetComponents();\r\n\r\n            if (!this._variable.isCodeView) {\r\n                context.element.wysiwyg.innerHTML = convertValue;\r\n                // history stack\r\n                this.history.push(false);\r\n            } else {\r\n                const value = this.convertHTMLForCodeView(convertValue);\r\n                this._setCodeView(value);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Sets the contents of the iframe's head tag and body tag when using the \"iframe\" or \"fullPage\" option.\r\n         * @param {Object} ctx { head: HTML string, body: HTML string}\r\n         */\r\n        setIframeContents: function (ctx) {\r\n            if (!options.iframe) return false;\r\n            if (ctx.head) this._wd.head.innerHTML = ctx.head.replace(/<script[\\s\\S]*>[\\s\\S]*<\\/script>/gi, '');\r\n            if (ctx.body) this._wd.body.innerHTML = this.convertContentsForEditor(ctx.body);\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current contents\r\n         * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {Object}\r\n         */\r\n        getContents: function (onlyContents) {\r\n            const contents = context.element.wysiwyg.innerHTML;\r\n            const renderHTML = util.createElement('DIV');\r\n            renderHTML.innerHTML = contents;\r\n\r\n            const figcaptions = util.getListChildren(renderHTML, function (current) {\r\n                return /FIGCAPTION/i.test(current.nodeName);\r\n            });\r\n\r\n            for (let i = 0, len = figcaptions.length; i < len; i++) {\r\n                figcaptions[i].removeAttribute('contenteditable');\r\n            }\r\n\r\n            if (options.fullPage && !onlyContents) {\r\n                const attrs = util.getAttributesToString(this._wd.body, ['contenteditable']);\r\n                return '<!DOCTYPE html><html>' + this._wd.head.outerHTML + '<body ' + attrs + '>' + renderHTML.innerHTML + '</body></html>';\r\n            } else {\r\n                return renderHTML.innerHTML;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Returns HTML string according to tag type and configuration.\r\n         * Use only \"cleanHTML\"\r\n         * @param {Node} node Node\r\n         * @param {Boolean} requireFormat If true, text nodes that do not have a format node is wrapped with the format tag.\r\n         * @private\r\n         */\r\n        _makeLine: function (node, requireFormat) {\r\n            const defaultTag = options.defaultTag;\r\n            // element\r\n            if (node.nodeType === 1) {\r\n                if (util._disallowedTags(node)) return '';\r\n                if (!requireFormat || (util.isFormatElement(node) || util.isRangeFormatElement(node) || util.isComponent(node) || util.isMedia(node) || (util.isAnchor(node) && util.isMedia(node.firstElementChild)))) {\r\n                    return node.outerHTML;\r\n                } else {\r\n                    return '<' + defaultTag + '>' + node.outerHTML + '</' + defaultTag + '>';\r\n                }\r\n            }\r\n            // text\r\n            if (node.nodeType === 3) {\r\n                if (!requireFormat) return util._HTMLConvertor(node.textContent);\r\n                const textArray = node.textContent.split(/\\n/g);\r\n                let html = '';\r\n                for (let i = 0, tLen = textArray.length, text; i < tLen; i++) {\r\n                    text = textArray[i].trim();\r\n                    if (text.length > 0) html += '<' + defaultTag + '>' + util._HTMLConvertor(text) + '</' + defaultTag + '>';\r\n                }\r\n                return html;\r\n            }\r\n            // comments\r\n            if (node.nodeType === 8 && this._allowHTMLComments) {\r\n                return '<!--' + node.textContent.trim() + '-->';\r\n            }\r\n\r\n            return '';\r\n        },\r\n\r\n        /**\r\n         * @description Removes attribute values such as style and converts tags that do not conform to the \"html5\" standard.\r\n         * @param {String} text \r\n         * @returns {String} HTML string\r\n         * @private\r\n         */\r\n        _tagConvertor: function (text) {\r\n            if (!this._disallowedTextTagsRegExp) return text;\r\n\r\n            const ec = options._textTagsMap;\r\n            return text.replace(this._disallowedTextTagsRegExp, function (m, t, n) {\r\n                return t + (typeof ec[n] === 'string' ? ec[n] : n);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * @description Delete disallowed tags\r\n         * @param {String} html HTML string\r\n         * @returns {String}\r\n         * @private\r\n         */\r\n        _deleteDisallowedTags: function (html) {\r\n            return html\r\n                .replace(/\\n/g, '')\r\n                .replace(/<(script|style)[\\s\\S]*>[\\s\\S]*<\\/(script|style)>/gi, '')\r\n                .replace(/<[a-z0-9]+\\:[a-z0-9]+[^>^\\/]*>[^>]*<\\/[a-z0-9]+\\:[a-z0-9]+>/gi, '')\r\n                .replace(this.editorTagsWhitelistRegExp, '');\r\n        },\r\n\r\n        /**\r\n         * @description Tag and tag attribute check RegExp function. (used by \"cleanHTML\" and \"convertContentsForEditor\")\r\n         * @param {Boolean} rowLevelCheck Row level check\r\n         * @param {String} m RegExp value\r\n         * @param {String} t RegExp value\r\n         * @returns {String}\r\n         * @private\r\n         */\r\n        _cleanTags: function (rowLevelCheck, m, t) {\r\n            if (/^<[a-z0-9]+\\:[a-z0-9]+/i.test(m)) return m;\r\n\r\n            let v = null;\r\n            const tAttr = this._attributesTagsWhitelist[t.match(/(?!<)[a-zA-Z0-9\\-]+/)[0].toLowerCase()];\r\n            if (tAttr) v = m.match(tAttr);\r\n            else v = m.match(this._attributesWhitelistRegExp);\r\n\r\n            if ((rowLevelCheck || /<span/i.test(t)) && (!v || !/style=/i.test(v.toString()))) {\r\n                const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n                if (sv) {\r\n                    if (!v) v = [];\r\n                    v.push(sv[0]);\r\n                }\r\n            }\r\n\r\n            if (/<a\\b/i.test(t)) {\r\n                const sv = m.match(/id\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n                if (sv) {\r\n                    if (!v) v = [];\r\n                    v.push(sv[0]);\r\n                }\r\n            }\r\n\r\n            if (v) {\r\n                for (let i = 0, len = v.length; i < len; i++) {\r\n                    if (rowLevelCheck && /^class=\"(?!(__se__|se-|katex))/.test(v[i])) continue;\r\n                    t += ' ' + (/^href\\s*=\\s*('|\"|\\s)*javascript\\s*\\:/i.test(v[i]) ? '' : v[i]);\r\n                }\r\n            }\r\n\r\n            return t;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the clean HTML code for editor\r\n         * @param {String} html HTML string\r\n         * @param {String|RegExp|null} whitelist Regular expression of allowed tags.\r\n         * RegExp object is create by util.createTagsWhitelist method. (core.pasteTagsWhitelistRegExp)\r\n         * @returns {String}\r\n         */\r\n        cleanHTML: function (html, whitelist) {\r\n            html = this._deleteDisallowedTags(this._parser.parseFromString(html, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, false));\r\n\r\n            const dom = _d.createRange().createContextualFragment(html);\r\n            try {\r\n                util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.cleanHTML.consistencyCheck.fail] ' + error);\r\n            }\r\n            \r\n            if (this.managedTagsInfo && this.managedTagsInfo.query) {\r\n                const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\r\n                for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\r\n                    classList = [].slice.call(textCompList[i].classList);\r\n                    for (let c = 0, cLen = classList.length; c < cLen; c++) {\r\n                        initMethod = this.managedTagsInfo.map[classList[c]];\r\n                        if (initMethod) {\r\n                            initMethod(textCompList[i]);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            const domTree = dom.childNodes;\r\n            let cleanHTML = '';\r\n            let requireFormat = false;\r\n\r\n            for (let i = 0, len = domTree.length, t; i < len; i++) {\r\n                t = domTree[i];\r\n                if (t.nodeType === 1 && !util.isTextStyleElement(t) && !util.isBreak(t) && !util._disallowedTags(t)) {\r\n                    requireFormat = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            for (let i = 0, len = domTree.length; i < len; i++) {\r\n                cleanHTML += this._makeLine(domTree[i], requireFormat);\r\n            }\r\n\r\n            cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\r\n            return this._tagConvertor(!cleanHTML ? html : !whitelist ? cleanHTML : cleanHTML.replace(typeof whitelist === 'string' ? util.createTagsWhitelist(whitelist) : whitelist, ''));\r\n        },\r\n\r\n        /**\r\n         * @description Converts contents into a format that can be placed in an editor\r\n         * @param {String} contents contents\r\n         * @returns {String}\r\n         */\r\n        convertContentsForEditor: function (contents) {\r\n            contents = this._deleteDisallowedTags(this._parser.parseFromString(contents, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, true));\r\n            const dom = _d.createRange().createContextualFragment(contents);\r\n\r\n            try {\r\n                util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] ' + error);\r\n            }\r\n\r\n            if (this.managedTagsInfo && this.managedTagsInfo.query) {\r\n                const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\r\n                for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\r\n                    classList = [].slice.call(textCompList[i].classList);\r\n                    for (let c = 0, cLen = classList.length; c < cLen; c++) {\r\n                        initMethod = this.managedTagsInfo.map[classList[c]];\r\n                        if (initMethod) {\r\n                            initMethod(textCompList[i]);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            const domTree = dom.childNodes;\r\n            let cleanHTML = '';\r\n            for (let i = 0, len = domTree.length; i < len; i++) {\r\n                cleanHTML += this._makeLine(domTree[i], true);\r\n            }\r\n\r\n            if (cleanHTML.length === 0) return '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n\r\n            cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\r\n            return this._tagConvertor(cleanHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Converts wysiwyg area element into a format that can be placed in an editor of code view mode\r\n         * @param {Element|String} html WYSIWYG element (context.element.wysiwyg) or HTML string.\r\n         * @returns {String}\r\n         */\r\n        convertHTMLForCodeView: function (html) {\r\n            let returnHTML = '';\r\n            const wRegExp = _w.RegExp;\r\n            const brReg = new wRegExp('^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$', 'i');\r\n            const wDoc = typeof html === 'string' ? _d.createRange().createContextualFragment(html) : html;\r\n            const isFormat = function (current) { return this.isFormatElement(current) || this.isComponent(current); }.bind(util);\r\n\r\n            let indentSize = this._variable.codeIndent * 1;\r\n            indentSize = indentSize > 0 ? new _w.Array(indentSize + 1).join(' ') : '';\r\n\r\n            (function recursionFunc (element, indent, lineBR) {\r\n                const children = element.childNodes;\r\n                const elementRegTest = brReg.test(element.nodeName);\r\n                const elementIndent = (elementRegTest ? indent : '');\r\n\r\n                for (let i = 0, len = children.length, node, br, nodeRegTest, tag, tagIndent; i < len; i++) {\r\n                    node = children[i];\r\n                    nodeRegTest = brReg.test(node.nodeName);\r\n                    br = nodeRegTest ? '\\n' : '';\r\n                    lineBR = isFormat(node) && !elementRegTest && !/^(TH|TD)$/i.test(element.nodeName) ? '\\n' : '';\r\n\r\n                    if (node.nodeType === 8) {\r\n                        returnHTML += '\\n<!-- ' + node.textContent.trim() + ' -->' + br;\r\n                        continue;\r\n                    }\r\n                    if (node.nodeType === 3) {\r\n                        if (!util.isList(node.parentElement)) returnHTML += util._HTMLConvertor(/^\\n+$/.test(node.data) ? '' : node.data);\r\n                        continue;\r\n                    }\r\n                    if (node.childNodes.length === 0) {\r\n                        returnHTML += (/^HR$/i.test(node.nodeName) ? '\\n' : '') + (/^PRE$/i.test(node.parentElement.nodeName) && /^BR$/i.test(node.nodeName) ? '' : elementIndent) + node.outerHTML + br;\r\n                        continue;\r\n                    }\r\n\r\n                    if (!node.outerHTML) { // IE\r\n                        returnHTML += new _w.XMLSerializer().serializeToString(node);\r\n                    } else {\r\n                        tag = node.nodeName.toLowerCase();\r\n                        tagIndent = elementIndent || nodeRegTest ? indent : '';\r\n                        returnHTML += (lineBR || (elementRegTest ? '' : br)) + tagIndent + node.outerHTML.match(wRegExp('<' + tag + '[^>]*>', 'i'))[0] + br;\r\n                        recursionFunc(node, indent + indentSize, '');\r\n                        returnHTML += (/\\n$/.test(returnHTML) ? tagIndent : '') + '</' + tag + '>' + (lineBR || br || elementRegTest ? '\\n' : '' || /^(TH|TD)$/i.test(node.nodeName) ? '\\n' : '');\r\n                    }\r\n                }\r\n            }(wDoc, '', '\\n'));\r\n\r\n            return returnHTML.trim() + '\\n';\r\n        },\r\n\r\n        /**\r\n         * @description Add an event to document.\r\n         * When created as an Iframe, the same event is added to the document in the Iframe.\r\n         * @param {String} type Event type\r\n         * @param {Function} listener Event listener\r\n         * @param {Boolean} useCapture Use event capture\r\n         */\r\n        addDocEvent: function (type, listener, useCapture) {\r\n            _d.addEventListener(type, listener, useCapture);\r\n            if (options.iframe) {\r\n                this._wd.addEventListener(type, listener);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Remove events from document.\r\n        * When created as an Iframe, the event of the document inside the Iframe is also removed.\r\n         * @param {String} type Event type\r\n         * @param {Function} listener Event listener\r\n         */\r\n        removeDocEvent: function (type, listener) {\r\n            _d.removeEventListener(type, listener);\r\n            if (options.iframe) {\r\n                this._wd.removeEventListener(type, listener);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description The current number of characters is counted and displayed.\r\n         * @param {String} inputText Text added.\r\n         * @returns {Boolean}\r\n         * @private\r\n         */\r\n        _charCount: function (inputText) {\r\n            const maxCharCount = options.maxCharCount;\r\n            const countType = options.charCounterType;\r\n            let nextCharCount = 0;\r\n            if (!!inputText) nextCharCount = this.getCharLength(inputText, countType);\r\n\r\n            this._setCharCount();\r\n\r\n            if (maxCharCount > 0) {\r\n                let over = false;\r\n                const count = functions.getCharCount(countType);\r\n                \r\n                if (count > maxCharCount) {\r\n                    over = true;\r\n                    if (nextCharCount > 0) {\r\n                        this._editorRange();\r\n                        const range = this.getRange();\r\n                        const endOff = range.endOffset - 1;\r\n                        const text = this.getSelectionNode().textContent;\r\n                        const slicePosition = range.endOffset - (count - maxCharCount);\r\n    \r\n                        this.getSelectionNode().textContent = text.slice(0, slicePosition < 0 ? 0 : slicePosition) + text.slice(range.endOffset, text.length);\r\n                        this.setRange(range.endContainer, endOff, range.endContainer, endOff);\r\n                    }\r\n                } else if ((count + nextCharCount) > maxCharCount) {\r\n                    over = true;\r\n                }\r\n\r\n                if (over) {\r\n                    this._callCounterBlink();\r\n                    if (nextCharCount > 0) return false;\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description When \"element\" is added, if it is greater than \"options.maxCharCount\", false is returned.\r\n         * @param {Node|String} element Element node or String.\r\n         * @param {String|null} charCounterType charCounterType. If it is null, the options.charCounterType\r\n         * @returns {Boolean}\r\n         */\r\n        checkCharCount: function (element, charCounterType) {\r\n            if (options.maxCharCount) {\r\n                const countType = charCounterType || options.charCounterType;\r\n                const length = this.getCharLength((typeof element === 'string' ? element : (this._charTypeHTML && element.nodeType === 1) ? element.outerHTML : element.textContent), countType);\r\n                if (length > 0 && length + functions.getCharCount(countType) > options.maxCharCount) {\r\n                    this._callCounterBlink();\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description Get the length of the content.\r\n         * Depending on the option, the length of the character is taken. (charCounterType)\r\n         * @param {String} content Content to count\r\n         * @param {String} charCounterType options.charCounterType\r\n         * @returns {Number}\r\n         */\r\n        getCharLength: function (content, charCounterType) {\r\n            return /byte/.test(charCounterType) ? util.getByteLength(content) : content.length;\r\n        },\r\n\r\n        /**\r\n         * @description Set the char count to charCounter element textContent.\r\n         * @private\r\n         */\r\n        _setCharCount: function () {\r\n            if (context.element.charCounter) {\r\n                _w.setTimeout(function () { context.element.charCounter.textContent = functions.getCharCount(options.charCounterType); });\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description The character counter blinks.\r\n         * @private\r\n         */\r\n        _callCounterBlink: function () {\r\n            const charWrapper = context.element.charWrapper;\r\n            if (charWrapper && !util.hasClass(charWrapper, 'se-blink')) {\r\n                util.addClass(charWrapper, 'se-blink');\r\n                _w.setTimeout(function () {\r\n                    util.removeClass(charWrapper, 'se-blink');\r\n                }, 600);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Check the components such as image and video and modify them according to the format.\r\n         * @private\r\n         */\r\n        _checkComponents: function () {\r\n            for (let i = 0, len = this._fileInfoPluginsCheck.length; i < len; i++) {\r\n                this._fileInfoPluginsCheck[i]();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Initialize the information of the components.\r\n         * @private\r\n         */\r\n        _resetComponents: function () {\r\n            for (let i = 0, len = this._fileInfoPluginsReset.length; i < len; i++) {\r\n                this._fileInfoPluginsReset[i]();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set method in the code view area\r\n         * @param {String} value HTML string\r\n         * @private\r\n         */\r\n        _setCodeView: function (value) {\r\n            if (options.codeMirrorEditor) {\r\n                options.codeMirrorEditor.getDoc().setValue(value);\r\n            } else {\r\n                context.element.code.value = value;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Get method in the code view area\r\n         * @private\r\n         */\r\n        _getCodeView: function () {\r\n            return options.codeMirrorEditor ? options.codeMirrorEditor.getDoc().getValue() : context.element.code.value;\r\n        },\r\n\r\n        /**\r\n         * @description Initializ core variable\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _init: function (reload, _initHTML) {\r\n            const wRegExp = _w.RegExp;\r\n            this._ww = options.iframe ? context.element.wysiwygFrame.contentWindow : _w;\r\n            this._wd = _d;\r\n            this._charTypeHTML = options.charCounterType === 'byte-html';\r\n\r\n            if (!options.iframe && typeof _w.ShadowRoot === 'function') {\r\n                let child = context.element.wysiwygFrame;\r\n                while (child) {\r\n                    if (child.shadowRoot) {\r\n                        this._shadowRoot = child.shadowRoot;\r\n                        break;\r\n                    } else if (child instanceof _w.ShadowRoot) {\r\n                        this._shadowRoot = child;\r\n                        break;\r\n                    }\r\n                    child = child.parentNode;\r\n                }\r\n                if (this._shadowRoot) this._shadowRootControllerEventTarget = [];\r\n            }\r\n\r\n            // set disallow text nodes\r\n            const disallowTextTags = _w.Object.keys(options._textTagsMap);\r\n            const allowTextTags = !options.addTagsWhitelist ? [] : options.addTagsWhitelist.split('|').filter(function (v) { return /b|i|ins|s|strike/i.test(v); });\r\n            for (let i = 0; i < allowTextTags.length; i++) {\r\n                disallowTextTags.splice(disallowTextTags.indexOf(allowTextTags[i].toLowerCase()), 1);\r\n            }\r\n            this._disallowedTextTagsRegExp = disallowTextTags.length === 0 ? null : new wRegExp('(<\\\\/?)(' + disallowTextTags.join('|') + ')\\\\b\\\\s*(?:[^>^<]+)?\\\\s*(?=>)', 'gi');\r\n\r\n            // set whitelist\r\n            const defaultAttr = 'contenteditable|id|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|origin-size|data-exp|data-font-size';\r\n            this._allowHTMLComments = options._editorTagsWhitelist.indexOf('//') > -1;\r\n            this._htmlCheckWhitelistRegExp = new wRegExp('^(' + options._editorTagsWhitelist.replace('|//', '') + ')$', 'i');\r\n            this.editorTagsWhitelistRegExp = util.createTagsWhitelist(options._editorTagsWhitelist.replace('|//', '|<!--|-->'));\r\n            this.pasteTagsWhitelistRegExp = util.createTagsWhitelist(options.pasteTagsWhitelist);\r\n\r\n            const regEndStr = '\\\\s*=\\\\s*(\\\")[^\\\"]*\\\\1';\r\n            const _attr = options.attributesWhitelist;\r\n            const tagsAttr = {};\r\n            let allAttr = '';\r\n            if (!!_attr) {\r\n                for (let k in _attr) {\r\n                    if (!util.hasOwn(_attr, k)) continue;\r\n                    if (k === 'all') {\r\n                        allAttr = _attr[k] + '|';\r\n                    } else {\r\n                        tagsAttr[k] = new wRegExp('(?:' + _attr[k] + '|' + defaultAttr + ')' + regEndStr, 'ig');\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._attributesWhitelistRegExp = new wRegExp('(?:' + allAttr + defaultAttr + ')' + regEndStr, 'ig');\r\n            this._attributesTagsWhitelist = tagsAttr;\r\n\r\n            // set modes\r\n            this._isInline = /inline/i.test(options.mode);\r\n            this._isBalloon = /balloon|balloon-always/i.test(options.mode);\r\n            this._isBalloonAlways = /balloon-always/i.test(options.mode);\r\n\r\n            // caching buttons\r\n            this._cachingButtons();\r\n\r\n            // file components\r\n            this._fileInfoPluginsCheck = [];\r\n            this._fileInfoPluginsReset = [];\r\n\r\n            // text components\r\n            this.managedTagsInfo = { query: '', map: {} };\r\n            const managedClass = [];\r\n\r\n            // Command and file plugins registration\r\n            this.activePlugins = [];\r\n            this._fileManager.tags = [];\r\n            this._fileManager.pluginMap = {};\r\n\r\n            let filePluginRegExp = [];\r\n            let plugin, button;\r\n            for (let key in plugins) {\r\n                if (!util.hasOwn(plugins, key)) continue;\r\n                plugin = plugins[key];\r\n                button = pluginCallButtons[key];\r\n                if (plugin.active && button) {\r\n                    this.callPlugin(key, null, button);\r\n                }\r\n                if (typeof plugin.checkFileInfo === 'function' && typeof plugin.resetFileInfo === 'function') {\r\n                    this.callPlugin(key, null, button);\r\n                    this._fileInfoPluginsCheck.push(plugin.checkFileInfo.bind(this));\r\n                    this._fileInfoPluginsReset.push(plugin.resetFileInfo.bind(this));\r\n                }\r\n                if (_w.Array.isArray(plugin.fileTags)) {\r\n                    const fileTags = plugin.fileTags;\r\n                    this.callPlugin(key, null, button);\r\n                    this._fileManager.tags = this._fileManager.tags.concat(fileTags);\r\n                    filePluginRegExp.push(key);\r\n                    for (let tag = 0, tLen = fileTags.length; tag < tLen; tag++) {\r\n                        this._fileManager.pluginMap[fileTags[tag].toLowerCase()] = key;\r\n                    }\r\n                }\r\n                if (plugin.managedTags) {\r\n                    const info = plugin.managedTags();\r\n                    managedClass.push('.' + info.className);\r\n                    this.managedTagsInfo.map[info.className] = info.method.bind(this);\r\n                }\r\n            }\r\n\r\n            this.managedTagsInfo.query = managedClass.toString();\r\n            this._fileManager.queryString = this._fileManager.tags.join(',');\r\n            this._fileManager.regExp = new wRegExp('^(' +  this._fileManager.tags.join('|') + ')$', 'i');\r\n            this._fileManager.pluginRegExp = new wRegExp('^(' +  (filePluginRegExp.length === 0 ? 'undefined' : filePluginRegExp.join('|')) + ')$', 'i');\r\n            \r\n            // cache editor's element\r\n            this._variable._originCssText = context.element.topArea.style.cssText;\r\n            this._placeholder = context.element.placeholder;\r\n            this._lineBreaker = context.element.lineBreaker;\r\n            this._lineBreakerButton = this._lineBreaker.querySelector('button');\r\n\r\n            // Excute history function\r\n            this.history = _history(this, this._onChange_historyStack.bind(this));\r\n\r\n            // register notice module\r\n            this.addModule([_notice]);\r\n\r\n            // Init, validate\r\n            if (options.iframe) {\r\n                this._wd = context.element.wysiwygFrame.contentDocument;\r\n                context.element.wysiwyg = this._wd.body;\r\n                if (options._editorStyles.editor) context.element.wysiwyg.style.cssText = options._editorStyles.editor;\r\n                if (options.height === 'auto') this._iframeAuto = this._wd.body;\r\n            }\r\n            \r\n            this._initWysiwygArea(reload, _initHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Caching basic buttons to use\r\n         * @private\r\n         */\r\n        _cachingButtons: function () {\r\n            _w.setTimeout(function () {\r\n                this.codeViewDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-code-view-enabled\"])');\r\n                this.resizingDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-resizing-enabled\"]):not([data-display=\"MORE\"])');\r\n            }.bind(this));\r\n\r\n            const tool = context.tool;\r\n            this.commandMap = {\r\n                SUB: tool.subscript,\r\n                SUP: tool.superscript,\r\n                OUTDENT: tool.outdent,\r\n                INDENT: tool.indent\r\n            };\r\n            this.commandMap[options.textTags.bold.toUpperCase()] = tool.bold;\r\n            this.commandMap[options.textTags.underline.toUpperCase()] = tool.underline;\r\n            this.commandMap[options.textTags.italic.toUpperCase()] = tool.italic;\r\n            this.commandMap[options.textTags.strike.toUpperCase()] = tool.strike;\r\n            \r\n            this._styleCommandMap = {\r\n                fullScreen: tool.fullScreen,\r\n                showBlocks: tool.showBlocks,\r\n                codeView: tool.codeView\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Initializ wysiwyg area (Only called from core._init)\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _initWysiwygArea: function (reload, _initHTML) {\r\n            context.element.wysiwyg.innerHTML = reload ? _initHTML : this.convertContentsForEditor(typeof _initHTML === 'string' ? _initHTML : context.element.originElement.value);\r\n        },\r\n\r\n        /**\r\n         * @description Called when there are changes to tags in the wysiwyg region.\r\n         * @private\r\n         */\r\n        _resourcesStateChange: function () {\r\n            this._iframeAutoHeight();\r\n            this._checkPlaceholder();\r\n        },\r\n\r\n        /**\r\n         * @description Called when after execute \"history.push\"\r\n         * @private\r\n         */\r\n        _onChange_historyStack: function () {\r\n            if (this.hasFocus) event._applyTagEffects();\r\n            this._variable.isChanged = true;\r\n            if (context.tool.save) context.tool.save.removeAttribute('disabled');\r\n            // user event\r\n            if (functions.onChange) functions.onChange(this.getContents(true), this);\r\n            if (context.element.toolbar.style.display === 'block') event._showToolbarBalloon();\r\n        },\r\n\r\n        /**\r\n         * @description Modify the height value of the iframe when the height of the iframe is automatic.\r\n         * @private\r\n         */\r\n        _iframeAutoHeight: function () {\r\n            if (this._iframeAuto) {\r\n                _w.setTimeout(function () { context.element.wysiwygFrame.style.height = core._iframeAuto.offsetHeight + 'px'; });\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set display property when there is placeholder.\r\n         * @private\r\n         */\r\n        _checkPlaceholder: function () {\r\n            if (this._placeholder) {\r\n                if (this._variable.isCodeView) {\r\n                    this._placeholder.style.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                const wysiwyg = context.element.wysiwyg;\r\n                if (!util.onlyZeroWidthSpace(wysiwyg.textContent) || wysiwyg.querySelector(util._allowedEmptyNodeList) || (wysiwyg.innerText.match(/\\n/g) || '').length > 1) {\r\n                    this._placeholder.style.display = 'none';\r\n                } else {\r\n                    this._placeholder.style.display = 'block';\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If there is no default format, add a format and move \"selection\".\r\n         * @param {String|null} formatName Format tag name (default: 'P')\r\n         * @private\r\n         */\r\n        _setDefaultFormat: function (formatName) {\r\n            if (this._fileManager.pluginRegExp.test(this.currentControllerName)) return;\r\n\r\n            const range = this.getRange();\r\n            const commonCon = range.commonAncestorContainer;\r\n            const startCon = range.startContainer;\r\n            const rangeEl = util.getRangeFormatElement(commonCon, null);\r\n            let focusNode, offset, format;\r\n\r\n            const fileComponent = util.getParentElement(commonCon, util.isComponent);\r\n            if (fileComponent && !util.isTable(fileComponent)) return;\r\n            if((util.isRangeFormatElement(startCon) || util.isWysiwygDiv(startCon)) && (util.isComponent(startCon.children[range.startOffset]) || util.isComponent(startCon.children[range.startOffset - 1]))) return;\r\n\r\n            if (rangeEl) {\r\n                format = util.createElement(formatName || options.defaultTag);\r\n                format.innerHTML = rangeEl.innerHTML;\r\n                if (format.childNodes.length === 0) format.innerHTML = util.zeroWidthSpace;\r\n\r\n                rangeEl.innerHTML = format.outerHTML;\r\n                format = rangeEl.firstChild;\r\n                focusNode = util.getEdgeChildNodes(format, null).sc;\r\n\r\n                if (!focusNode) {\r\n                    focusNode = util.createTextNode(util.zeroWidthSpace);\r\n                    format.insertBefore(focusNode, format.firstChild);\r\n                }\r\n                \r\n                offset = focusNode.textContent.length;\r\n                this.setRange(focusNode, offset, focusNode, offset);\r\n                return;\r\n            }\r\n\r\n            if(util.isRangeFormatElement(commonCon) && (commonCon.childNodes.length <= 1)) {\r\n                let br = null;\r\n                if (commonCon.childNodes.length === 1 && util.isBreak(commonCon.firstChild)) {\r\n                    br = commonCon.firstChild;\r\n                } else {\r\n                    br = util.createTextNode(util.zeroWidthSpace);\r\n                    commonCon.appendChild(br);\r\n                }\r\n\r\n                this.setRange(br, 1, br, 1);\r\n                return;\r\n            }\r\n\r\n            this.execCommand('formatBlock', false, (formatName || options.defaultTag));\r\n            focusNode = util.getEdgeChildNodes(commonCon, commonCon);\r\n            focusNode = focusNode ? focusNode.ec : commonCon;\r\n\r\n            format = util.getFormatElement(focusNode, null);\r\n            if (!format) {\r\n                this.removeRange();\r\n                this._editorRange();\r\n                return;\r\n            }\r\n            \r\n            if (util.isBreak(format.nextSibling)) util.removeItem(format.nextSibling);\r\n            if (util.isBreak(format.previousSibling)) util.removeItem(format.previousSibling);\r\n            if (util.isBreak(focusNode)) {\r\n                const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                focusNode.parentNode.insertBefore(zeroWidth, focusNode);\r\n                focusNode = zeroWidth;\r\n            }\r\n\r\n            this.effectNode = null;\r\n            this.nativeFocus();\r\n        },\r\n\r\n        /**\r\n         * @description Initialization after \"setOptions\"\r\n         * @param {Object} el context.element\r\n         * @param {String} _initHTML Initial html string\r\n         * @private\r\n         */\r\n        _setOptionsInit: function (el, _initHTML) {\r\n            this.context = context = _Context(el.originElement, this._getConstructed(el), options);\r\n            this._componentsInfoReset = true;\r\n            this._editorInit(true, _initHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Initializ editor\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _editorInit: function (reload, _initHTML) {\r\n            // initialize core and add event listeners\r\n            this._init(reload, _initHTML);\r\n            event._addEvent();\r\n            this._setCharCount();\r\n            event._offStickyToolbar();\r\n            event.onResize_window();\r\n\r\n            // toolbar visibility\r\n            context.element.toolbar.style.visibility = '';\r\n\r\n            this._checkComponents();\r\n            this._componentsInfoInit = false;\r\n            this._componentsInfoReset = false;\r\n\r\n            this.history.reset(true);\r\n            this._resourcesStateChange();\r\n\r\n            _w.setTimeout(function () {\r\n                // user event\r\n                if (typeof functions.onload === 'function') functions.onload(core, reload);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * @description Create and return an object to cache the new context.\r\n         * @param {Element} contextEl context.element\r\n         * @returns {Object}\r\n         * @private\r\n         */\r\n        _getConstructed: function (contextEl) {\r\n            return {\r\n                _top: contextEl.topArea,\r\n                _relative: contextEl.relative,\r\n                _toolBar: contextEl.toolbar,\r\n                _menuTray: contextEl._menuTray,\r\n                _editorArea: contextEl.editorArea,\r\n                _wysiwygArea: contextEl.wysiwygFrame,\r\n                _codeArea: contextEl.code,\r\n                _placeholder: contextEl.placeholder,\r\n                _resizingBar: contextEl.resizingBar,\r\n                _navigation: contextEl.navigation,\r\n                _charCounter: contextEl.charCounter,\r\n                _charWrapper: contextEl.charWrapper,\r\n                _loading: contextEl.loading,\r\n                _lineBreaker: contextEl.lineBreaker,\r\n                _lineBreaker_t: contextEl.lineBreaker_t,\r\n                _lineBreaker_b: contextEl.lineBreaker_b,\r\n                _resizeBack: contextEl.resizeBackground,\r\n                _stickyDummy: contextEl._stickyDummy,\r\n                _arrow: contextEl._arrow\r\n            };\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @description event function\r\n     */\r\n    const event = {\r\n        _IEisComposing: false, // In IE, there is no \"e.isComposing\" in the key-up event.\r\n        _lineBreakerBind: null,\r\n        _responsiveCurrentSize: 'default',\r\n        _responsiveButtonSize: null,\r\n        _responsiveButtons: null,\r\n        _directionKeyCode: new _w.RegExp('^(8|13|3[2-9]|40|46)$'),\r\n        _nonTextKeyCode: new _w.RegExp('^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$'),\r\n        _historyIgnoreKeyCode: new _w.RegExp('^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$'),\r\n        _onButtonsCheck: new _w.RegExp('^(' + _w.Object.keys(options._textTagsMap).join('|') + ')$', 'i'),\r\n        _frontZeroWidthReg: new _w.RegExp(util.zeroWidthSpace + '+', ''),\r\n        _keyCodeShortcut: {\r\n            65: 'A',\r\n            66: 'B',\r\n            83: 'S',\r\n            85: 'U',\r\n            73: 'I',\r\n            89: 'Y',\r\n            90: 'Z',\r\n            219: '[',\r\n            221: ']'\r\n        },\r\n\r\n        _shortcutCommand: function (keyCode, shift) {\r\n            let command = null;\r\n            const keyStr = event._keyCodeShortcut[keyCode];\r\n\r\n            switch (keyStr) {\r\n                case 'A':\r\n                    command = 'selectAll';\r\n                    break;\r\n                case 'B':\r\n                    if (options.shortcutsDisable.indexOf('bold') === -1) {\r\n                        command = 'bold';\r\n                    }\r\n                    break;\r\n                case 'S':\r\n                    if (shift && options.shortcutsDisable.indexOf('strike') === -1) {\r\n                        command = 'strike';\r\n                    } else if (!shift && options.shortcutsDisable.indexOf('save') === -1) {\r\n                        command = 'save';\r\n                    }\r\n                    break;\r\n                case 'U':\r\n                    if (options.shortcutsDisable.indexOf('underline') === -1) {\r\n                        command = 'underline';\r\n                    }\r\n                    break;\r\n                case 'I':\r\n                    if (options.shortcutsDisable.indexOf('italic') === -1) {\r\n                        command = 'italic';\r\n                    }\r\n                    break;\r\n                case 'Z':\r\n                    if (options.shortcutsDisable.indexOf('undo') === -1) {\r\n                        if (shift) {\r\n                            command = 'redo';\r\n                        } else {\r\n                            command = 'undo';\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'Y':\r\n                    if (options.shortcutsDisable.indexOf('undo') === -1) {\r\n                        command = 'redo';\r\n                    }\r\n                    break;\r\n                case '[':\r\n                    if (options.shortcutsDisable.indexOf('indent') === -1) {\r\n                        command = options.rtl ? 'indent' : 'outdent';\r\n                    }\r\n                    break;\r\n                case ']':\r\n                    if (options.shortcutsDisable.indexOf('indent') === -1) {\r\n                        command = options.rtl ? 'outdent' : 'indent';\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (!command) return false;\r\n\r\n            core.commandHandler(core.commandMap[command], command);\r\n            return true;\r\n        },\r\n\r\n        _applyTagEffects: function () {\r\n            let selectionNode = core.getSelectionNode();\r\n            if (selectionNode === core.effectNode) return;\r\n            core.effectNode = selectionNode;\r\n\r\n            const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\r\n            const commandMap = core.commandMap;\r\n            const classOnCheck = this._onButtonsCheck;\r\n            const commandMapNodes = [];\r\n            const currentNodes = [];\r\n\r\n            const activePlugins = core.activePlugins;\r\n            const cLen = activePlugins.length;\r\n            let nodeName = '';\r\n\r\n            while (selectionNode.firstChild) {\r\n                selectionNode = selectionNode.firstChild;\r\n            }\r\n\r\n            for (let element = selectionNode; !util.isWysiwygDiv(element); element = element.parentNode) {\r\n                if (!element) break;\r\n                if (element.nodeType !== 1 || util.isBreak(element)) continue;\r\n                nodeName = element.nodeName.toUpperCase();\r\n                currentNodes.push(nodeName);\r\n\r\n                /* Active plugins */\r\n                for (let c = 0, name; c < cLen; c++) {\r\n                    name = activePlugins[c];\r\n                    if (commandMapNodes.indexOf(name) === -1 && plugins[name].active.call(core, element)) {\r\n                        commandMapNodes.push(name);\r\n                    }\r\n                }\r\n\r\n                if (util.isFormatElement(element)) {\r\n                    /* Outdent */\r\n                    if (commandMapNodes.indexOf('OUTDENT') === -1 && commandMap.OUTDENT) {\r\n                        if (util.isListCell(element) || (element.style[marginDir] && util.getNumber(element.style[marginDir], 0) > 0)) {\r\n                            commandMapNodes.push('OUTDENT');\r\n                            commandMap.OUTDENT.removeAttribute('disabled');\r\n                        }\r\n                    }\r\n\r\n                    /* Indent */\r\n                    if (commandMapNodes.indexOf('INDENT') === -1 && commandMap.INDENT) {\r\n                        commandMapNodes.push('INDENT');\r\n                        if (util.isListCell(element) && !element.previousElementSibling) {\r\n                            commandMap.INDENT.setAttribute('disabled', true);\r\n                        } else {\r\n                            commandMap.INDENT.removeAttribute('disabled');\r\n                        }\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                /** default active buttons [strong, ins, em, del, sub, sup] */\r\n                if (classOnCheck.test(nodeName)) {\r\n                    commandMapNodes.push(nodeName);\r\n                    util.addClass(commandMap[nodeName], 'active');\r\n                }\r\n            }\r\n\r\n            /** remove class, display text */\r\n            for (let key in commandMap) {\r\n                if (commandMapNodes.indexOf(key) > -1 || !util.hasOwn(commandMap, key)) continue;\r\n                if (activePlugins.indexOf(key) > -1) {\r\n                    plugins[key].active.call(core, null);\r\n                } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\r\n                    commandMap.OUTDENT.setAttribute('disabled', true);\r\n                } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\r\n                    commandMap.INDENT.removeAttribute('disabled');\r\n                } else {\r\n                    util.removeClass(commandMap[key], 'active');\r\n                }\r\n            }\r\n\r\n            /** save current nodes */\r\n            core._variable.currentNodes = currentNodes.reverse();\r\n            core._variable.currentNodesMap = commandMapNodes;\r\n\r\n            /**  Displays the current node structure to resizingBar */\r\n            if (options.showPathLabel) context.element.navigation.textContent = core._variable.currentNodes.join(' > ');\r\n        },\r\n\r\n        _cancelCaptionEdit: function () {\r\n            this.setAttribute('contenteditable', false);\r\n            this.removeEventListener('blur', event._cancelCaptionEdit);\r\n        },\r\n\r\n        _buttonsEventHandler: function (e) {\r\n            let target = e.target;\r\n            if (core._bindControllersOff) e.stopPropagation();\r\n\r\n            if (/^(input|textarea|select|option)$/i.test(target.nodeName)) {\r\n                core._antiBlur = false;\r\n            } else {\r\n                e.preventDefault();\r\n            }\r\n\r\n            if (util.getParentElement(target, '.se-submenu')) {\r\n                e.stopPropagation();\r\n                core._notHideToolbar = true;\r\n            } else {\r\n                let command = target.getAttribute('data-command');\r\n                let className = target.className;\r\n    \r\n                while (!command && !/se-menu-list/.test(className) && !/sun-editor-common/.test(className)) {\r\n                    target = target.parentNode;\r\n                    command = target.getAttribute('data-command');\r\n                    className = target.className;\r\n                }\r\n    \r\n                if (command === core._submenuName || command === core._containerName) {\r\n                    e.stopPropagation();\r\n                }\r\n            }\r\n        },\r\n\r\n        onClick_toolbar: function (e) {\r\n            let target = e.target;\r\n            let display = target.getAttribute('data-display');\r\n            let command = target.getAttribute('data-command');\r\n            let className = target.className;\r\n            core.controllersOff();\r\n\r\n            while (target.parentNode && !command && !/se-menu-list/.test(className) && !/se-toolbar/.test(className)) {\r\n                target = target.parentNode;\r\n                command = target.getAttribute('data-command');\r\n                display = target.getAttribute('data-display');\r\n                className = target.className;\r\n            }\r\n\r\n            if (!command && !display) return;\r\n            if (target.disabled) return;\r\n            if (!core.hasFocus) core.nativeFocus();\r\n            if (!core._variable.isCodeView) core._editorRange();\r\n\r\n            core.actionCall(command, display, target);\r\n        },\r\n\r\n        onMouseDown_wysiwyg: function (e) {\r\n            if (util.isNonEditable(context.element.wysiwyg)) return;\r\n\r\n            // user event\r\n            if (typeof functions.onMouseDown === 'function' && functions.onMouseDown(e, core) === false) return;\r\n            \r\n            const tableCell = util.getParentElement(e.target, util.isCell);\r\n            if (tableCell) {\r\n                const tablePlugin = core.plugins.table;\r\n                if (tablePlugin && tableCell !== tablePlugin._fixedCell && !tablePlugin._shift) {\r\n                    core.callPlugin('table', function () {\r\n                        tablePlugin.onTableCellMultiSelect.call(core, tableCell, false);\r\n                    }, null);\r\n                }\r\n            }\r\n\r\n            if (core._isBalloon) {\r\n                event._hideToolbar();\r\n            }\r\n\r\n            if (/FIGURE/i.test(e.target.nodeName)) e.preventDefault();\r\n        },\r\n\r\n        onClick_wysiwyg: function (e) {\r\n            const targetElement = e.target;\r\n            if (util.isNonEditable(context.element.wysiwyg)) return;\r\n\r\n            // user event\r\n            if (typeof functions.onClick === 'function' && functions.onClick(e, core) === false) return;\r\n\r\n            const fileComponentInfo = core.getFileComponent(targetElement);\r\n            if (fileComponentInfo) {\r\n                e.preventDefault();\r\n                core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n                return;\r\n            }\r\n\r\n            const figcaption = util.getParentElement(targetElement, 'FIGCAPTION');\r\n            if (util.isNonEditable(figcaption)) {\r\n                e.preventDefault();\r\n                figcaption.setAttribute('contenteditable', true);\r\n                figcaption.focus();\r\n\r\n                if (core._isInline && !core._inlineToolbarAttr.isShow) {\r\n                    event._showToolbarInline();\r\n\r\n                    const hideToolbar = function () {\r\n                        event._hideToolbar();\r\n                        figcaption.removeEventListener('blur', hideToolbar);\r\n                    };\r\n\r\n                    figcaption.addEventListener('blur', hideToolbar);\r\n                }\r\n            }\r\n\r\n            _w.setTimeout(core._editorRange.bind(core));\r\n            core._editorRange();\r\n\r\n            const selectionNode = core.getSelectionNode();\r\n            const formatEl = util.getFormatElement(selectionNode, null);\r\n            const rangeEl = util.getRangeFormatElement(selectionNode, null);\r\n            if ((!formatEl || formatEl === rangeEl) && !util.isNonEditable(targetElement) && !util.isList(rangeEl)) {\r\n                const range = core.getRange();\r\n                if (util.getFormatElement(range.startContainer) === util.getFormatElement(range.endContainer)) {\r\n                    if (util.isList(rangeEl)) {\r\n                        e.preventDefault();\r\n                        const oLi = util.createElement('LI');\r\n                        const prevLi = selectionNode.nextElementSibling;\r\n                        oLi.appendChild(selectionNode);\r\n                        rangeEl.insertBefore(oLi, prevLi);\r\n                        core.focus();\r\n                    } else if (!util.isWysiwygDiv(selectionNode) && !util.isComponent(selectionNode) && (!util.isTable(selectionNode) || util.isCell(selectionNode))) {\r\n                        e.preventDefault();\r\n                        core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag);\r\n                        core.focus();\r\n                    } else {\r\n                        event._applyTagEffects();\r\n                    }\r\n                }\r\n            } else {\r\n                event._applyTagEffects();\r\n            }\r\n\r\n            if (core._isBalloon) _w.setTimeout(event._toggleToolbarBalloon);\r\n        },\r\n\r\n        _balloonDelay: null,\r\n        _showToolbarBalloonDelay: function () {\r\n            if (event._balloonDelay) {\r\n                _w.clearTimeout(event._balloonDelay);\r\n            }\r\n\r\n            event._balloonDelay = _w.setTimeout(function () {\r\n                _w.clearTimeout(this._balloonDelay);\r\n                this._balloonDelay = null;\r\n                this._showToolbarBalloon();\r\n            }.bind(event), 350);\r\n        },\r\n\r\n        _toggleToolbarBalloon: function () {\r\n            core._editorRange();\r\n            const range = core.getRange();\r\n            if (core._bindControllersOff || (!core._isBalloonAlways && range.collapsed)) event._hideToolbar();\r\n            else event._showToolbarBalloon(range);\r\n        },\r\n\r\n        _showToolbarBalloon: function (rangeObj) {\r\n            if (!core._isBalloon) return;\r\n\r\n            const range = rangeObj || core.getRange();\r\n            const toolbar = context.element.toolbar;\r\n            const topArea = context.element.topArea;\r\n            const selection = core.getSelection();\r\n\r\n            let isDirTop;\r\n            if (core._isBalloonAlways && range.collapsed) {\r\n                isDirTop = true;\r\n            } else if (selection.focusNode === selection.anchorNode) {\r\n                isDirTop = selection.focusOffset < selection.anchorOffset;\r\n            } else {\r\n                const childNodes = util.getListChildNodes(range.commonAncestorContainer, null);\r\n                isDirTop = util.getArrayIndex(childNodes, selection.focusNode) < util.getArrayIndex(childNodes, selection.anchorNode);\r\n            }\r\n\r\n            let rects = range.getClientRects();\r\n            rects = rects[isDirTop ? 0 : rects.length - 1];\r\n\r\n            const globalScroll = core.getGlobalScrollOffset();\r\n            let scrollLeft = globalScroll.left;\r\n            let scrollTop = globalScroll.top;\r\n\r\n            const editorWidth = topArea.offsetWidth;\r\n            const offsets = event._getEditorOffsets(null);\r\n            const stickyTop = offsets.top;\r\n            const editorLeft = offsets.left;\r\n            \r\n            toolbar.style.top = '-10000px';\r\n            toolbar.style.visibility = 'hidden';\r\n            toolbar.style.display = 'block';\r\n\r\n            if (!rects) {\r\n                const node = core.getSelectionNode();\r\n                if (util.isFormatElement(node)) {\r\n                    const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                    core.insertNode(zeroWidth, null, false);\r\n                    core.setRange(zeroWidth, 1, zeroWidth, 1);\r\n                    core._editorRange();\r\n                    rects = core.getRange().getClientRects();\r\n                    rects = rects[isDirTop ? 0 : rects.length - 1];\r\n                }\r\n\r\n                if (!rects) {\r\n                    const nodeOffset = util.getOffset(node, context.element.wysiwygFrame);\r\n                    rects = {\r\n                        left: nodeOffset.left,\r\n                        top: nodeOffset.top,\r\n                        right: nodeOffset.left,\r\n                        bottom: nodeOffset.top + node.offsetHeight,\r\n                        noText: true\r\n                    };\r\n                    scrollLeft = 0;\r\n                    scrollTop = 0;\r\n                }\r\n\r\n                isDirTop = true;\r\n            }\r\n\r\n            const arrowMargin = _w.Math.round(context.element._arrow.offsetWidth / 2);\r\n            const toolbarWidth = toolbar.offsetWidth;\r\n            const toolbarHeight = toolbar.offsetHeight;\r\n            const iframeRects = /iframe/i.test(context.element.wysiwygFrame.nodeName) ? context.element.wysiwygFrame.getClientRects()[0] : null;\r\n            if (iframeRects) {\r\n                rects = {\r\n                    left: rects.left + iframeRects.left,\r\n                    top: rects.top + iframeRects.top,\r\n                    right: rects.right + iframeRects.right - iframeRects.width,\r\n                    bottom: rects.bottom + iframeRects.bottom - iframeRects.height\r\n                };\r\n            }\r\n            \r\n            event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\r\n            if (toolbarWidth !== toolbar.offsetWidth || toolbarHeight !== toolbar.offsetHeight) {\r\n                event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\r\n            }\r\n\r\n            if (options.toolbarContainer) {\r\n                const editorParent = topArea.parentElement;\r\n\r\n                let container = options.toolbarContainer;\r\n                let left = container.offsetLeft;\r\n                let top = container.offsetTop;\r\n\r\n                while(!container.parentElement.contains(editorParent) || !/^(BODY|HTML)$/i.test(container.parentElement.nodeName)) {\r\n                    container = container.offsetParent;\r\n                    left += container.offsetLeft;\r\n                    top += container.offsetTop;\r\n                }\r\n\r\n                toolbar.style.left = (toolbar.offsetLeft - left + topArea.offsetLeft) + 'px';\r\n                toolbar.style.top = (toolbar.offsetTop - top + topArea.offsetTop) + 'px';\r\n            }\r\n\r\n            toolbar.style.visibility = '';\r\n        },\r\n\r\n        _setToolbarOffset: function (isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin) {\r\n            const padding = 1;\r\n            const toolbarWidth = toolbar.offsetWidth;\r\n            const toolbarHeight = rects.noText && !isDirTop ? 0 : toolbar.offsetHeight;\r\n\r\n            const absoluteLeft = (isDirTop ? rects.left : rects.right) - editorLeft - (toolbarWidth / 2) + scrollLeft;\r\n            const overRight = absoluteLeft + toolbarWidth - editorWidth;\r\n            \r\n            let t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\r\n            let l = absoluteLeft < 0 ? padding : overRight < 0 ? absoluteLeft : absoluteLeft - overRight - padding - 1;\r\n\r\n            let resetTop = false;\r\n            const space = t + (isDirTop ? (event._getEditorOffsets(null).top) : (toolbar.offsetHeight - context.element.wysiwyg.offsetHeight));\r\n            if (!isDirTop && space > 0 && event._getPageBottomSpace() < space) {\r\n                isDirTop = true;\r\n                resetTop = true;\r\n            } else if (isDirTop && _d.documentElement.offsetTop > space) {\r\n                isDirTop = false;\r\n                resetTop = true;\r\n            }\r\n\r\n            if (resetTop) t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\r\n\r\n            toolbar.style.left = _w.Math.floor(l) + 'px';\r\n            toolbar.style.top = _w.Math.floor(t) + 'px';\r\n\r\n            if (isDirTop) {\r\n                util.removeClass(context.element._arrow, 'se-arrow-up');\r\n                util.addClass(context.element._arrow, 'se-arrow-down');\r\n                context.element._arrow.style.top = toolbarHeight + 'px';\r\n            } else {\r\n                util.removeClass(context.element._arrow, 'se-arrow-down');\r\n                util.addClass(context.element._arrow, 'se-arrow-up');\r\n                context.element._arrow.style.top = -arrowMargin + 'px';\r\n            }\r\n\r\n            const arrow_left = _w.Math.floor((toolbarWidth / 2) + (absoluteLeft - l));\r\n            context.element._arrow.style.left = (arrow_left + arrowMargin > toolbar.offsetWidth ? toolbar.offsetWidth - arrowMargin : arrow_left < arrowMargin ? arrowMargin : arrow_left) + 'px';\r\n        },\r\n\r\n        _showToolbarInline: function () {\r\n            if (!core._isInline) return;\r\n\r\n            const toolbar = context.element.toolbar;\r\n            if (options.toolbarContainer) toolbar.style.position = 'relative';\r\n            else toolbar.style.position = 'absolute';\r\n            \r\n            toolbar.style.visibility = 'hidden';\r\n            toolbar.style.display = 'block';\r\n            core._inlineToolbarAttr.width = toolbar.style.width = options.toolbarWidth;\r\n            core._inlineToolbarAttr.top = toolbar.style.top = (options.toolbarContainer ? 0 : (-1 - toolbar.offsetHeight)) + 'px';\r\n            \r\n            if (typeof functions.showInline === 'function') functions.showInline(toolbar, context, core);\r\n\r\n            event.onScroll_window();\r\n            core._inlineToolbarAttr.isShow = true;\r\n            toolbar.style.visibility = '';\r\n        },\r\n\r\n        _hideToolbar: function () {\r\n            if (!core._notHideToolbar && !core._variable.isFullScreen) {\r\n                context.element.toolbar.style.display = 'none';\r\n                core._inlineToolbarAttr.isShow = false;\r\n            }\r\n        },\r\n\r\n        onInput_wysiwyg: function (e) {\r\n            core._editorRange();\r\n\r\n            // user event\r\n            if (typeof functions.onInput === 'function' && functions.onInput(e, core) === false) return;\r\n\r\n            const data = (e.data === null ? '' : e.data === undefined ? ' ' : e.data) || '';       \r\n            if (!core._charCount(data)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n            }\r\n\r\n            // history stack\r\n            core.history.push(true);\r\n        },\r\n\r\n        _isUneditableNode: function (range, isFront) {\r\n            const container = isFront ? range.startContainer : range.endContainer;\r\n            const offset = isFront ? range.startOffset : range.endOffset;\r\n            const siblingKey = isFront ? 'previousSibling' : 'nextSibling';\r\n            const isElement = container.nodeType === 1;\r\n            let siblingNode;\r\n\r\n            if (isElement) {\r\n                siblingNode = event._isUneditableNode_getSibling(container.childNodes[offset], siblingKey, container);\r\n                return siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\r\n            } else {\r\n                siblingNode = event._isUneditableNode_getSibling(container, siblingKey, container);\r\n                return core.isEdgePoint(container, offset, isFront ? 'front' : 'end') && (siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false');\r\n            }\r\n        },\r\n\r\n        _isUneditableNode_getSibling: function (selectNode, siblingKey, container) {\r\n            if (!selectNode) return null;\r\n            let siblingNode = selectNode[siblingKey];\r\n\r\n            if (!siblingNode) {\r\n                siblingNode = util.getFormatElement(container);\r\n                siblingNode = siblingNode ? siblingNode[siblingKey] : null;\r\n                if (siblingNode && !util.isComponent(siblingNode)) siblingNode = siblingKey === 'previousSibling' ? siblingNode.firstElementChild : siblingNode.lastElementChild;\r\n                else return null;\r\n            }\r\n\r\n            return siblingNode;\r\n        },\r\n\r\n        _onShortcutKey: false,\r\n        onKeyDown_wysiwyg: function (e) {\r\n            const keyCode = e.keyCode;\r\n            const shift = e.shiftKey;\r\n            const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\r\n            const alt = e.altKey;\r\n            event._IEisComposing = keyCode === 229;\r\n\r\n            core.submenuOff();\r\n\r\n            if (core._isBalloon) {\r\n                event._hideToolbar();\r\n            }\r\n\r\n            // user event\r\n            if (typeof functions.onKeyDown === 'function' && functions.onKeyDown(e, core) === false) return;\r\n\r\n            /** Shortcuts */\r\n            if (ctrl && event._shortcutCommand(keyCode, shift)) {\r\n                event._onShortcutKey = true;\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            } else if (event._onShortcutKey) {\r\n                event._onShortcutKey = false;\r\n            }\r\n\r\n            /** default key action */\r\n            let selectionNode = core.getSelectionNode();\r\n            const range = core.getRange();\r\n            const selectRange = !range.collapsed || range.startContainer !== range.endContainer;\r\n            const fileComponentName = core._fileManager.pluginRegExp.test(core.currentControllerName) ? core.currentControllerName : '';\r\n            let formatEl = util.getFormatElement(selectionNode, null) || selectionNode;\r\n            let rangeEl = util.getRangeFormatElement(formatEl, null);\r\n\r\n            switch (keyCode) {\r\n                case 8: /** backspace key */\r\n                    if (!selectRange) {\r\n                        if (fileComponentName) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            core.plugins[fileComponentName].destroy.call(core);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (selectRange && event._hardDelete()) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    if (!util.isFormatElement(formatEl) && !context.element.wysiwyg.firstElementChild && !util.isComponent(selectionNode)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        core._setDefaultFormat(options.defaultTag);\r\n                        return false;\r\n                    }\r\n\r\n                    if (!selectRange && !formatEl.previousElementSibling && (range.startOffset === 0 && !selectionNode.previousSibling && !util.isListCell(formatEl) && \r\n                     (util.isFormatElement(formatEl) && (!util.isFreeFormatElement(formatEl) || util.isClosureFreeFormatElement(formatEl))))) {\r\n                        // closure range\r\n                        if (util.isClosureRangeFormatElement(formatEl.parentNode)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            return false;\r\n                        }\r\n                        // maintain default format\r\n                        if (util.isWysiwygDiv(formatEl.parentNode) && formatEl.childNodes.length <= 1 && (!formatEl.firstChild || util.onlyZeroWidthSpace(formatEl.textContent))) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n\r\n                            if (formatEl.nodeName.toUpperCase() === options.defaultTag.toUpperCase()) {\r\n                                formatEl.innerHTML = '<br>';\r\n                                const attrs = formatEl.attributes;\r\n                                while (attrs[0]) {\r\n                                    formatEl.removeAttribute(attrs[0].name);\r\n                                }\r\n                            } else {\r\n                                const defaultFormat = util.createElement(options.defaultTag);\r\n                                defaultFormat.innerHTML = '<br>';\r\n                                formatEl.parentElement.replaceChild(defaultFormat, formatEl);\r\n                            }\r\n\r\n                            core.nativeFocus();\r\n                            return false;\r\n                        }\r\n                    }\r\n\r\n                    // clean remove tag\r\n                    if (formatEl && range.startContainer === range.endContainer && selectionNode.nodeType === 3 && !util.isFormatElement(selectionNode.parentNode)) {\r\n                        if (range.collapsed ? selectionNode.textContent.length === 1 : (range.endOffset - range.startOffset) === selectionNode.textContent.length) {\r\n                            e.preventDefault();\r\n\r\n                            let offset = null;\r\n                            let prev = selectionNode.parentNode.previousSibling;\r\n                            const next = selectionNode.parentNode.nextSibling;\r\n                            if (!prev) {\r\n                                if (!next) {\r\n                                    prev = util.createElement('BR');\r\n                                    formatEl.appendChild(prev);\r\n                                } else {\r\n                                    prev = next;\r\n                                    offset = 0;\r\n                                }\r\n                            }\r\n\r\n                            selectionNode.textContent = '';\r\n                            util.removeItemAllParents(selectionNode, null, formatEl);\r\n                            offset = typeof offset === 'number' ? offset : prev.nodeType === 3 ? prev.textContent.length : 1;\r\n                            core.setRange(prev, offset, prev, offset);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    // tag[contenteditable=\"false\"]\r\n                    if (event._isUneditableNode(range, true)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // nested list\r\n                    const commonCon = range.commonAncestorContainer;\r\n                    formatEl = util.getFormatElement(range.startContainer, null);\r\n                    rangeEl = util.getRangeFormatElement(formatEl, null);\r\n                    if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\r\n                        if (util.isListCell(formatEl) && util.isList(rangeEl) && (util.isListCell(rangeEl.parentNode) || formatEl.previousElementSibling) && (selectionNode === formatEl || (selectionNode.nodeType === 3 && (!selectionNode.previousSibling || util.isList(selectionNode.previousSibling)))) &&\r\n                         (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.startContainer) : (range.startOffset === 0  && range.collapsed))) {\r\n                            if (range.startContainer !== range.endContainer) {\r\n                                e.preventDefault();\r\n\r\n                                core.removeNode();\r\n                                if (range.startContainer.nodeType === 3) {\r\n                                    core.setRange(range.startContainer, range.startContainer.textContent.length, range.startContainer, range.startContainer.textContent.length);\r\n                                }\r\n                                // history stack\r\n                                core.history.push(true);\r\n                            } else {\r\n                                let prev = formatEl.previousElementSibling || rangeEl.parentNode;\r\n                                if (util.isListCell(prev)) {\r\n                                    e.preventDefault();\r\n\r\n                                    let prevLast = prev;\r\n                                    if (!prev.contains(formatEl) && util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\r\n                                        prevLast = prevLast.lastElementChild.lastElementChild;\r\n                                        while (util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\r\n                                            prevLast = prevLast.lastElementChild && prevLast.lastElementChild.lastElementChild;\r\n                                        }\r\n                                        prev = prevLast;\r\n                                    }\r\n\r\n                                    let con = prev === rangeEl.parentNode ? rangeEl.previousSibling : prev.lastChild;\r\n                                    if (!con) {\r\n                                        con = util.createTextNode(util.zeroWidthSpace);\r\n                                        rangeEl.parentNode.insertBefore(con, rangeEl.parentNode.firstChild);\r\n                                    }\r\n                                    const offset = con.nodeType === 3 ? con.textContent.length : 1;\r\n                                    const children = formatEl.childNodes;\r\n                                    let after = con;\r\n                                    let child = children[0];\r\n                                    while ((child = children[0])) {\r\n                                        prev.insertBefore(child, after.nextSibling);\r\n                                        after = child;\r\n                                    }\r\n\r\n                                    util.removeItem(formatEl);\r\n                                    if (rangeEl.children.length === 0) util.removeItem(rangeEl);\r\n\r\n                                    core.setRange(con, offset, con, offset);\r\n                                    // history stack\r\n                                    core.history.push(true);\r\n                                }\r\n                            }\r\n                            \r\n                            break;\r\n                        }\r\n\r\n                        // detach range\r\n                        if (!selectRange && range.startOffset === 0) {\r\n                            let detach = true;\r\n                            let comm = commonCon;\r\n                            while (comm && comm !== rangeEl && !util.isWysiwygDiv(comm)) {\r\n                                if (comm.previousSibling) {\r\n                                    if (comm.previousSibling.nodeType === 1 || !util.onlyZeroWidthSpace(comm.previousSibling.textContent.trim())) {\r\n                                        detach = false;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                                comm = comm.parentNode;\r\n                            }\r\n    \r\n                            if (detach && rangeEl.parentNode) {\r\n                                e.preventDefault();\r\n                                core.detachRangeFormatElement(rangeEl, (util.isListCell(formatEl) ? [formatEl] : null), null, false, false);\r\n                                // history stack\r\n                                core.history.push(true);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // component\r\n                    if (!selectRange && formatEl && (range.startOffset === 0 || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\r\n                        const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode;\r\n                        const prev = formatEl.previousSibling;\r\n                        // select file component\r\n                        const ignoreZWS = (commonCon.nodeType === 3 || util.isBreak(commonCon)) && !commonCon.previousSibling && range.startOffset === 0;\r\n                        if (!sel.previousSibling && (util.isComponent(commonCon.previousSibling) || (ignoreZWS && util.isComponent(prev)))) {\r\n                            const fileComponentInfo = core.getFileComponent(prev);\r\n                            if (fileComponentInfo) {\r\n                                e.preventDefault();\r\n                                e.stopPropagation();\r\n                                if (formatEl.textContent.length === 0) util.removeItem(formatEl);\r\n                                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\r\n                            } else if (util.isComponent(prev)) {\r\n                                e.preventDefault();\r\n                                e.stopPropagation();\r\n                                util.removeItem(prev);\r\n                            }\r\n                            break;\r\n                        }\r\n                        // delete nonEditable\r\n                        if (util.isNonEditable(sel.previousSibling)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel.previousSibling);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    break;\r\n                case 46: /** delete key */\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        core.plugins[fileComponentName].destroy.call(core);\r\n                        break;\r\n                    }\r\n\r\n                    if (selectRange && event._hardDelete()) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // tag[contenteditable=\"false\"]\r\n                    if (event._isUneditableNode(range, false)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // component\r\n                    if ((util.isFormatElement(selectionNode) || selectionNode.nextSibling === null || (util.onlyZeroWidthSpace(selectionNode.nextSibling) && selectionNode.nextSibling.nextSibling === null)) && range.startOffset === selectionNode.textContent.length) {\r\n                        let nextEl = formatEl.nextElementSibling;\r\n                        if (!nextEl) {\r\n                            e.preventDefault();\r\n                            break;\r\n                        }\r\n\r\n                        if (util.isComponent(nextEl)) {\r\n                            e.preventDefault();\r\n\r\n                            if (util.onlyZeroWidthSpace(formatEl)) {\r\n                                util.removeItem(formatEl);\r\n                                // table component\r\n                                if (util.isTable(nextEl)) {\r\n                                    let cell = util.getChildElement(nextEl, util.isCell, false);\r\n                                    cell = cell.firstElementChild || cell;\r\n                                    core.setRange(cell, 0, cell, 0);\r\n                                    break;\r\n                                }\r\n                            }\r\n\r\n                            // select file component\r\n                            const fileComponentInfo = core.getFileComponent(nextEl);\r\n                            if (fileComponentInfo) {\r\n                                e.stopPropagation();\r\n                                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\r\n                            } else if (util.isComponent(nextEl)) {\r\n                                e.stopPropagation();\r\n                                util.removeItem(nextEl);\r\n                            }\r\n\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (!selectRange && (core.isEdgePoint(range.endContainer, range.endOffset) || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\r\n                        const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode;\r\n                        // delete nonEditable\r\n                        if (util.isNonEditable(sel.nextSibling)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel.nextSibling);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    // nested list\r\n                    formatEl = util.getFormatElement(range.startContainer, null);\r\n                    rangeEl = util.getRangeFormatElement(formatEl, null);\r\n                    if (util.isListCell(formatEl) && util.isList(rangeEl) && (selectionNode === formatEl || (selectionNode.nodeType === 3 && (!selectionNode.nextSibling || util.isList(selectionNode.nextSibling)) &&\r\n                     (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.endContainer) : (range.endOffset === selectionNode.textContent.length && range.collapsed))))) {\r\n                        if (range.startContainer !== range.endContainer) core.removeNode();\r\n                        \r\n                        let next = util.getArrayItem(formatEl.children, util.isList, false);\r\n                        next = next || formatEl.nextElementSibling || rangeEl.parentNode.nextElementSibling;\r\n                        if (next && (util.isList(next) || util.getArrayItem(next.children, util.isList, false))) {\r\n                            e.preventDefault();\r\n\r\n                            let con, children;\r\n                            if (util.isList(next)) {\r\n                                const child = next.firstElementChild;\r\n                                children = child.childNodes;\r\n                                con = children[0];\r\n                                while (children[0]) {\r\n                                    formatEl.insertBefore(children[0], next);\r\n                                }\r\n                                util.removeItem(child);\r\n                            } else {\r\n                                con = next.firstChild;\r\n                                children = next.childNodes;\r\n                                while (children[0]) {\r\n                                    formatEl.appendChild(children[0]);\r\n                                }\r\n                                util.removeItem(next);\r\n                            }\r\n                            core.setRange(con, 0, con, 0);\r\n                            // history stack\r\n                            core.history.push(true);\r\n                        }\r\n                        break;\r\n                    }\r\n\r\n                    break;\r\n                case 9: /** tab key */\r\n                    if (fileComponentName || options.tabDisable) break;\r\n                    e.preventDefault();\r\n                    if (ctrl || alt || util.isWysiwygDiv(selectionNode)) break;\r\n\r\n                    const isEdge = (!range.collapsed || core.isEdgePoint(range.startContainer, range.startOffset));            \r\n                    const selectedFormats = core.getSelectedElements(null);\r\n                    selectionNode = core.getSelectionNode();\r\n                    const cells = [];\r\n                    let lines = [];\r\n                    let fc = util.isListCell(selectedFormats[0]), lc = util.isListCell(selectedFormats[selectedFormats.length - 1]);\r\n                    let r = {sc: range.startContainer, so: range.startOffset, ec: range.endContainer, eo: range.endOffset};\r\n                    for (let i = 0, len = selectedFormats.length, f; i < len; i++) {\r\n                        f = selectedFormats[i];\r\n                        if (util.isListCell(f)) {\r\n                            if (!f.previousElementSibling && !shift) {\r\n                                continue;\r\n                            } else {\r\n                                cells.push(f);\r\n                            }\r\n                        } else {\r\n                            lines.push(f);\r\n                        }\r\n                    }\r\n                    \r\n                    // Nested list\r\n                    if (cells.length > 0 && isEdge && core.plugins.list) {\r\n                        r = core.plugins.list.editInsideList.call(core, shift, cells);\r\n                    } else {\r\n                        // table\r\n                        const tableCell = util.getParentElement(selectionNode, util.isCell);\r\n                        if (tableCell && isEdge) {\r\n                            const table = util.getParentElement(tableCell, 'table');\r\n                            const cells = util.getListChildren(table, util.isCell);\r\n                            let idx = shift ? util.prevIdx(cells, tableCell) : util.nextIdx(cells, tableCell);\r\n\r\n                            if (idx === cells.length && !shift) idx = 0;\r\n                            if (idx === -1 && shift) idx = cells.length - 1;\r\n\r\n                            let moveCell = cells[idx];\r\n                            if (!moveCell) break;\r\n                            moveCell = moveCell.firstElementChild || moveCell;\r\n                            core.setRange(moveCell, 0, moveCell, 0);\r\n                            break;\r\n                        }\r\n\r\n                        lines = lines.concat(cells);\r\n                        fc = lc = null;\r\n                    }\r\n\r\n                    // Lines tab(4)\r\n                    if (lines.length > 0) {\r\n                        if (!shift) {\r\n                            const tabText = util.createTextNode(new _w.Array(core._variable.tabSize + 1).join('\\u00A0'));\r\n                            if (lines.length === 1) {\r\n                                const textRange = core.insertNode(tabText, null, true);\r\n                                if (!textRange) return false;\r\n                                if (!fc) {\r\n                                    r.sc = tabText;\r\n                                    r.so = textRange.endOffset;\r\n                                }\r\n                                if (!lc) {\r\n                                    r.ec = tabText;\r\n                                    r.eo = textRange.endOffset;\r\n                                }\r\n                            } else {\r\n                                const len = lines.length - 1;\r\n                                for (let i = 0, child; i <= len; i++) {\r\n                                    child = lines[i].firstChild;\r\n                                    if (!child) continue;\r\n    \r\n                                    if (util.isBreak(child)) {\r\n                                        lines[i].insertBefore(tabText.cloneNode(false), child);\r\n                                    } else {\r\n                                        child.textContent = tabText.textContent + child.textContent;\r\n                                    }\r\n                                }\r\n    \r\n                                const firstChild = util.getChildElement(lines[0], 'text', false);\r\n                                const endChild = util.getChildElement(lines[len], 'text', true);\r\n                                if (!fc && firstChild) {\r\n                                    r.sc = firstChild;\r\n                                    r.so = 0;\r\n                                }\r\n                                if (!lc && endChild) {\r\n                                    r.ec = endChild;\r\n                                    r.eo = endChild.textContent.length;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            const len = lines.length - 1;\r\n                            for (let i = 0, line; i <= len; i++) {\r\n                                line = lines[i].childNodes;\r\n                                for (let c = 0, cLen = line.length, child; c < cLen; c++) {\r\n                                    child = line[c];\r\n                                    if (!child) break;\r\n                                    if (util.onlyZeroWidthSpace(child)) continue;\r\n        \r\n                                    if (/^\\s{1,4}$/.test(child.textContent)) {\r\n                                        util.removeItem(child);\r\n                                    } else if (/^\\s{1,4}/.test(child.textContent)) {\r\n                                        child.textContent = child.textContent.replace(/^\\s{1,4}/, '');\r\n                                    }\r\n                                    \r\n                                    break;\r\n                                }\r\n                            }\r\n    \r\n                            const firstChild = util.getChildElement(lines[0], 'text', false);\r\n                            const endChild = util.getChildElement(lines[len], 'text', true);\r\n                            if (!fc && firstChild) {\r\n                                r.sc = firstChild;\r\n                                r.so = 0;\r\n                            }\r\n                            if (!lc && endChild) {\r\n                                r.ec = endChild;\r\n                                r.eo = endChild.textContent.length;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    core.setRange(r.sc, r.so, r.ec, r.eo);\r\n                    // history stack\r\n                    core.history.push(false);\r\n                    \r\n                    break;\r\n                case 13: /** enter key */\r\n                    const freeFormatEl = util.getFreeFormatElement(selectionNode, null);\r\n\r\n                    if (core._charTypeHTML) {\r\n                        let enterHTML = '';\r\n                        if ((!shift && freeFormatEl) || shift) {\r\n                            enterHTML = '<br>';\r\n                        } else {\r\n                            enterHTML = '<' + formatEl.nodeName + '><br></' + formatEl.nodeName + '>';\r\n                        }\r\n\r\n                        if (!core.checkCharCount(enterHTML, 'byte-html')) {\r\n                            e.preventDefault();\r\n                            return false;\r\n                        }\r\n                    }\r\n\r\n                    if (!shift) {\r\n                        const formatInners = core._isEdgeFormat(range.endContainer, range.endOffset, 'end');\r\n                        if ((formatInners && /^H[1-6]$/i.test(formatEl.nodeName)) || /^HR$/i.test(formatEl.nodeName)) {\r\n                            e.preventDefault();\r\n                            let temp = null;\r\n                            const newFormat = core.appendFormatTag(formatEl, options.defaultTag);\r\n\r\n                            if (formatInners && formatInners.length > 0) {\r\n                                temp = formatInners.pop();\r\n                                const innerNode = temp;\r\n                                while(formatInners.length > 0) {\r\n                                    temp = temp.appendChild(formatInners.pop());\r\n                                }\r\n                                newFormat.appendChild(innerNode);\r\n                            }\r\n\r\n                            temp = !temp ? newFormat.firstChild : temp.appendChild(newFormat.firstChild);\r\n                            core.setRange(temp, 0, temp, 0);\r\n                            break;\r\n                        }\r\n\r\n                        if (freeFormatEl) {\r\n                            e.preventDefault();\r\n                            const selectionFormat = selectionNode === freeFormatEl;\r\n                            const wSelection = core.getSelection();\r\n                            const children = selectionNode.childNodes, offset = wSelection.focusOffset, prev = selectionNode.previousElementSibling, next = selectionNode.nextSibling;\r\n    \r\n                            if (!util.isClosureFreeFormatElement(freeFormatEl) && !!children && ((selectionFormat && range.collapsed && children.length - 1 <= offset + 1 && util.isBreak(children[offset]) && (!children[offset + 1] || ((!children[offset + 2] || util.onlyZeroWidthSpace(children[offset + 2].textContent)) && children[offset + 1].nodeType === 3 && util.onlyZeroWidthSpace(children[offset + 1].textContent))) &&  offset > 0 && util.isBreak(children[offset - 1])) ||\r\n                              (!selectionFormat && util.onlyZeroWidthSpace(selectionNode.textContent) && util.isBreak(prev) && (util.isBreak(prev.previousSibling) || !util.onlyZeroWidthSpace(prev.previousSibling.textContent)) && (!next || (!util.isBreak(next) && util.onlyZeroWidthSpace(next.textContent)))))) {\r\n                                if (selectionFormat) util.removeItem(children[offset - 1]);\r\n                                else util.removeItem(selectionNode);\r\n                                const newEl = core.appendFormatTag(freeFormatEl, util.isFormatElement(freeFormatEl.nextElementSibling) ? freeFormatEl.nextElementSibling : null);\r\n                                util.copyFormatAttributes(newEl, freeFormatEl);\r\n                                core.setRange(newEl, 1, newEl, 1);\r\n                                break;\r\n                            }\r\n                            \r\n                            if (selectionFormat) {\r\n                                functions.insertHTML(((range.collapsed && util.isBreak(range.startContainer.childNodes[range.startOffset - 1])) ? '<br>' : '<br><br>'), true, false);\r\n    \r\n                                let focusNode = wSelection.focusNode;\r\n                                const wOffset = wSelection.focusOffset;\r\n                                if (freeFormatEl === focusNode) {\r\n                                    focusNode = focusNode.childNodes[wOffset - offset > 1 ? wOffset - 1 : wOffset];\r\n                                }\r\n    \r\n                                core.setRange(focusNode, 1, focusNode, 1);\r\n                            } else {\r\n                                const focusNext = wSelection.focusNode.nextSibling;\r\n                                const br = util.createElement('BR');\r\n                                core.insertNode(br, null, false);\r\n    \r\n                                const brPrev = br.previousSibling, brNext = br.nextSibling;\r\n                                if (!util.isBreak(focusNext) && !util.isBreak(brPrev) && (!brNext || util.onlyZeroWidthSpace(brNext))) {\r\n                                    br.parentNode.insertBefore(br.cloneNode(false), br);\r\n                                    core.setRange(br, 1, br, 1);\r\n                                } else {\r\n                                    core.setRange(brNext, 0, brNext, 0);\r\n                                }\r\n                            }\r\n    \r\n                            event._onShortcutKey = true;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (selectRange) break;\r\n                    \r\n                    if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\r\n                        const range = core.getRange();\r\n                        if(core.isEdgePoint(range.endContainer, range.endOffset) && util.isList(selectionNode.nextSibling)) {\r\n                            e.preventDefault();\r\n                            const newEl = util.createElement('LI');\r\n                            const br = util.createElement('BR');\r\n                            newEl.appendChild(br);\r\n\r\n                            formatEl.parentNode.insertBefore(newEl, formatEl.nextElementSibling);\r\n                            newEl.appendChild(selectionNode.nextSibling);\r\n                            \r\n                            core.setRange(br, 1, br, 1);\r\n                            break;\r\n                        }\r\n\r\n                        if ((range.commonAncestorContainer.nodeType === 3 ? !range.commonAncestorContainer.nextElementSibling : true) && util.onlyZeroWidthSpace(formatEl.innerText.trim())) {\r\n                            e.preventDefault();\r\n                            let newEl = null;\r\n\r\n                            if (util.isListCell(rangeEl.parentNode)) {\r\n                                rangeEl = formatEl.parentNode.parentNode.parentNode;\r\n                                newEl = util.splitElement(formatEl, null, util.getElementDepth(formatEl) - 2);\r\n                                if (!newEl) {\r\n                                    const newListCell = util.createElement('LI');\r\n                                    newListCell.innerHTML = '<br>';\r\n                                    rangeEl.insertBefore(newListCell, newEl);\r\n                                    newEl = newListCell;\r\n                                }\r\n                            } else {\r\n                                const newFormat = util.isCell(rangeEl.parentNode) ? 'DIV' : util.isList(rangeEl.parentNode) ? 'LI' : util.isFormatElement(rangeEl.nextElementSibling) ? rangeEl.nextElementSibling.nodeName : util.isFormatElement(rangeEl.previousElementSibling) ? rangeEl.previousElementSibling.nodeName : options.defaultTag;\r\n                                newEl = util.createElement(newFormat);\r\n                                const edge = core.detachRangeFormatElement(rangeEl, [formatEl], null, true, true);\r\n                                edge.cc.insertBefore(newEl, edge.ec);\r\n                            }\r\n                            \r\n                            newEl.innerHTML = '<br>';\r\n                            util.copyFormatAttributes(newEl, formatEl);\r\n                            util.removeItemAllParents(formatEl, null, null);\r\n                            core.setRange(newEl, 1, newEl, 1);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (rangeEl && util.getParentElement(rangeEl, 'FIGCAPTION') && util.getParentElement(rangeEl, util.isList)) {\r\n                        e.preventDefault();\r\n                        formatEl = core.appendFormatTag(formatEl, null);\r\n                        core.setRange(formatEl, 0, formatEl, 0);\r\n                    }\r\n\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        const compContext = context[fileComponentName];\r\n                        const container = compContext._container;\r\n                        const sibling = container.previousElementSibling || container.nextElementSibling;\r\n\r\n                        let newEl = null;\r\n                        if (util.isListCell(container.parentNode)) {\r\n                            newEl = util.createElement('BR');\r\n                        } else {\r\n                            newEl = util.createElement(util.isFormatElement(sibling) ? sibling.nodeName : options.defaultTag);\r\n                            newEl.innerHTML = '<br>';\r\n                        }\r\n\r\n                        container.parentNode.insertBefore(newEl, container);\r\n                        \r\n                        core.callPlugin(fileComponentName, function () {\r\n                            if (core.selectComponent(compContext._element, fileComponentName) === false) core.blur();\r\n                        }, null);\r\n                    }\r\n                    \r\n                    break;\r\n                case 27:\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        core.controllersOff();\r\n                        return false;\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (shift && keyCode === 16) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const tablePlugin = core.plugins.table;\r\n                if (tablePlugin && !tablePlugin._shift && !tablePlugin._ref) {\r\n                    const cell = util.getParentElement(formatEl, util.isCell);\r\n                    if (cell) {\r\n                        tablePlugin.onTableCellMultiSelect.call(core, cell, true);\r\n                        return;\r\n                    }\r\n                }\r\n            } else if (shift && (util.isOSX_IOS ? alt : ctrl) && keyCode === 32) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const nbsp = core.insertNode(util.createTextNode('\\u00a0'));\r\n                if (nbsp && nbsp.container) {\r\n                    core.setRange(nbsp.container, nbsp.endOffset, nbsp.container, nbsp.endOffset);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            const textKey = !ctrl && !alt && !selectRange && !event._nonTextKeyCode.test(keyCode);\r\n            if (textKey && range.collapsed && range.startContainer === range.endContainer && util.isBreak(range.commonAncestorContainer)) {\r\n                const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                core.insertNode(zeroWidth, null, false);\r\n                core.setRange(zeroWidth, 1, zeroWidth, 1);\r\n            }\r\n        },\r\n\r\n        onKeyUp_wysiwyg: function (e) {\r\n            if (event._onShortcutKey) return;\r\n            core._editorRange();\r\n\r\n            const range = core.getRange();\r\n            const keyCode = e.keyCode;\r\n            const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\r\n            const alt = e.altKey;\r\n            let selectionNode = core.getSelectionNode();\r\n\r\n            if (core._isBalloon && ((core._isBalloonAlways && keyCode !== 27) || !range.collapsed)) {\r\n                if (core._isBalloonAlways) {\r\n                    if (keyCode !== 27) event._showToolbarBalloonDelay();\r\n                } else {\r\n                    event._showToolbarBalloon();\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // user event\r\n            if (typeof functions.onKeyUp === 'function' && functions.onKeyUp(e, core) === false) return;\r\n\r\n            /** when format tag deleted */\r\n            if (keyCode === 8 && util.isWysiwygDiv(selectionNode) && selectionNode.textContent === '' && selectionNode.children.length === 0) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n\r\n                selectionNode.innerHTML = '';\r\n\r\n                const oFormatTag = util.createElement(util.isFormatElement(core._variable.currentNodes[0]) ? core._variable.currentNodes[0] : options.defaultTag);\r\n                oFormatTag.innerHTML = '<br>';\r\n\r\n                selectionNode.appendChild(oFormatTag);\r\n                core.setRange(oFormatTag, 0, oFormatTag, 0);\r\n                event._applyTagEffects();\r\n\r\n                core.history.push(false);\r\n                return;\r\n            }\r\n\r\n            const formatEl = util.getFormatElement(selectionNode, null);\r\n            const rangeEl = util.getRangeFormatElement(selectionNode, null);\r\n            if (((!formatEl && range.collapsed) || formatEl === rangeEl) && !util.isComponent(selectionNode) && !util.isList(selectionNode)) {\r\n                core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag);\r\n                selectionNode = core.getSelectionNode();\r\n            }\r\n\r\n            if (event._directionKeyCode.test(keyCode)) {\r\n                event._applyTagEffects();\r\n            }\r\n\r\n            const textKey = !ctrl && !alt && !event._nonTextKeyCode.test(keyCode);\r\n            if (textKey && selectionNode.nodeType === 3 && util.zeroWidthRegExp.test(selectionNode.textContent) && !(e.isComposing !== undefined ? e.isComposing : event._IEisComposing)) {\r\n                let so = range.startOffset, eo = range.endOffset;\r\n                const frontZeroWidthCnt = (selectionNode.textContent.substring(0, eo).match(event._frontZeroWidthReg) || '').length;\r\n                so = range.startOffset - frontZeroWidthCnt;\r\n                eo = range.endOffset - frontZeroWidthCnt;\r\n                selectionNode.textContent = selectionNode.textContent.replace(util.zeroWidthRegExp, '');\r\n                core.setRange(selectionNode, so < 0 ? 0 : so, selectionNode, eo < 0 ? 0 : eo);\r\n            }\r\n\r\n            core._charCount('');\r\n\r\n            // history stack\r\n            core.history.push(true);\r\n        },\r\n\r\n        onScroll_wysiwyg: function (e) {\r\n            core.controllersOff();\r\n            if (core._isBalloon) event._hideToolbar();\r\n\r\n            // user event\r\n            if (typeof functions.onScroll === 'function') functions.onScroll(e, core);\r\n        },\r\n\r\n        onFocus_wysiwyg: function (e) {\r\n            if (core._antiBlur) return;\r\n            core.hasFocus = true;\r\n            event._applyTagEffects();\r\n            \r\n            if (core._isInline) event._showToolbarInline();\r\n\r\n            // user event\r\n            if (typeof functions.onFocus === 'function') functions.onFocus(e, core);\r\n        },\r\n\r\n        onBlur_wysiwyg: function (e) {\r\n            if (core._antiBlur || core._variable.isCodeView) return;\r\n            core.hasFocus = false;\r\n            core.controllersOff();\r\n            if (core._isInline || core._isBalloon) event._hideToolbar();\r\n\r\n            // user event\r\n            if (typeof functions.onBlur === 'function') functions.onBlur(e, core);\r\n\r\n            // active class reset of buttons\r\n            const commandMap = core.commandMap;\r\n            const activePlugins = core.activePlugins;\r\n            for (let key in commandMap) {\r\n                if (!util.hasOwn(commandMap, key)) continue;\r\n                if (activePlugins.indexOf(key) > -1) {\r\n                    plugins[key].active.call(core, null);\r\n                } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\r\n                    commandMap.OUTDENT.setAttribute('disabled', true);\r\n                } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\r\n                    commandMap.INDENT.removeAttribute('disabled');\r\n                } else {\r\n                    util.removeClass(commandMap[key], 'active');\r\n                }\r\n            }\r\n\r\n            core._variable.currentNodes = [];\r\n            core._variable.currentNodesMap = [];\r\n            if (options.showPathLabel) context.element.navigation.textContent = '';\r\n        },\r\n\r\n        onMouseDown_resizingBar: function (e) {\r\n            e.stopPropagation();\r\n\r\n            core.submenuOff();\r\n            core.controllersOff();\r\n\r\n            const prevHeight = util.getNumber(context.element.wysiwygFrame.style.height, 0);\r\n            core._variable.resizeClientY = e.clientY;\r\n            context.element.resizeBackground.style.display = 'block';\r\n\r\n            function closureFunc() {\r\n                context.element.resizeBackground.style.display = 'none';\r\n                _d.removeEventListener('mousemove', event._resize_editor);\r\n                _d.removeEventListener('mouseup', closureFunc);\r\n                if (typeof functions.onResizeEditor === 'function') functions.onResizeEditor(util.getNumber(context.element.wysiwygFrame.style.height, 0), prevHeight, core);\r\n            }\r\n\r\n            _d.addEventListener('mousemove', event._resize_editor);\r\n            _d.addEventListener('mouseup', closureFunc);\r\n        },\r\n\r\n        _resize_editor: function (e) {\r\n            const resizeInterval = context.element.editorArea.offsetHeight + (e.clientY - core._variable.resizeClientY);\r\n            context.element.wysiwygFrame.style.height = context.element.code.style.height = (resizeInterval < core._variable.minResizingSize ? core._variable.minResizingSize : resizeInterval) + 'px';\r\n            core._variable.resizeClientY = e.clientY;\r\n        },\r\n\r\n        onResize_window: function () {\r\n            core.controllersOff();\r\n\r\n            const responsiveSize = event._responsiveButtonSize;\r\n            if (responsiveSize) {\r\n                let w = 0;\r\n                if ((core._isBalloon || core._isInline) && options.toolbarWidth === 'auto') {\r\n                    w = context.element.topArea.offsetWidth;\r\n                } else {\r\n                    w = context.element.toolbar.offsetWidth;\r\n                }\r\n\r\n                let responsiveWidth = 'default';\r\n                for (let i = 1, len = responsiveSize.length; i < len; i++) {\r\n                    if (w < responsiveSize[i]) {\r\n                        responsiveWidth = responsiveSize[i] + '';\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (event._responsiveCurrentSize !== responsiveWidth) {\r\n                    event._responsiveCurrentSize = responsiveWidth;\r\n                    functions.setToolbarButtons(event._responsiveButtons[responsiveWidth]);\r\n                }\r\n            }\r\n\r\n            if (context.element.toolbar.offsetWidth === 0) return;\r\n\r\n            if (context.fileBrowser && context.fileBrowser.area.style.display === 'block') {\r\n                context.fileBrowser.body.style.maxHeight = (_w.innerHeight - context.fileBrowser.header.offsetHeight - 50) + 'px';\r\n            }\r\n\r\n            if (core.submenuActiveButton && core.submenu) {\r\n                core._setMenuPosition(core.submenuActiveButton, core.submenu);\r\n            }\r\n\r\n            if (core._variable.isFullScreen) {\r\n                core._variable.innerHeight_fullScreen += (_w.innerHeight - context.element.toolbar.offsetHeight) - core._variable.innerHeight_fullScreen;\r\n                context.element.editorArea.style.height = core._variable.innerHeight_fullScreen + 'px';\r\n                return;\r\n            }\r\n\r\n            if (core._variable.isCodeView && core._isInline) {\r\n                event._showToolbarInline();\r\n                return;\r\n            }\r\n            \r\n            core._iframeAutoHeight();\r\n\r\n            if (core._sticky) {\r\n                context.element.toolbar.style.width = (context.element.topArea.offsetWidth - 2) + 'px';\r\n                event.onScroll_window();\r\n            }\r\n        },\r\n\r\n        onScroll_window: function () {\r\n            if (core._variable.isFullScreen || context.element.toolbar.offsetWidth === 0 || options.stickyToolbar < 0) return;\r\n\r\n            const element = context.element;\r\n            const editorHeight = element.editorArea.offsetHeight;\r\n            const y = (this.scrollY || _d.documentElement.scrollTop) + options.stickyToolbar;\r\n            const editorTop = event._getEditorOffsets(options.toolbarContainer).top - (core._isInline ? element.toolbar.offsetHeight : 0);\r\n            \r\n            if (y < editorTop) {\r\n                event._offStickyToolbar();\r\n            }\r\n            else if (y + core._variable.minResizingSize >= editorHeight + editorTop) {\r\n                if (!core._sticky) event._onStickyToolbar();\r\n                element.toolbar.style.top = (editorHeight + editorTop + options.stickyToolbar -y - core._variable.minResizingSize) + 'px';\r\n            }\r\n            else if (y >= editorTop) {\r\n                event._onStickyToolbar();\r\n            }\r\n        },\r\n\r\n        _getEditorOffsets: function (container) {\r\n            let offsetEl = container || context.element.topArea;\r\n            let t = 0, l = 0, s = 0;\r\n\r\n            while (offsetEl) {\r\n                t += offsetEl.offsetTop;\r\n                l += offsetEl.offsetLeft;\r\n                s += offsetEl.scrollTop;\r\n                offsetEl = offsetEl.offsetParent;\r\n            }\r\n\r\n            return {\r\n                top: t,\r\n                left: l,\r\n                scroll: s\r\n            };\r\n        },\r\n\r\n        _getPageBottomSpace: function () {\r\n            return _d.documentElement.scrollHeight - (event._getEditorOffsets(null).top + context.element.topArea.offsetHeight);\r\n        },\r\n\r\n        _onStickyToolbar: function () {\r\n            const element = context.element;\r\n\r\n            if (!core._isInline && !options.toolbarContainer) {\r\n                element._stickyDummy.style.height = element.toolbar.offsetHeight + 'px';\r\n                element._stickyDummy.style.display = 'block';\r\n            }\r\n\r\n            element.toolbar.style.top = options.stickyToolbar + 'px';\r\n            element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : element.toolbar.offsetWidth + 'px';\r\n            util.addClass(element.toolbar, 'se-toolbar-sticky');\r\n            core._sticky = true;\r\n        },\r\n\r\n        _offStickyToolbar: function () {\r\n            const element = context.element;\r\n\r\n            element._stickyDummy.style.display = 'none';\r\n            element.toolbar.style.top = core._isInline ? core._inlineToolbarAttr.top : '';\r\n            element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : '';\r\n            element.editorArea.style.marginTop = '';\r\n\r\n            util.removeClass(element.toolbar, 'se-toolbar-sticky');\r\n            core._sticky = false;\r\n        },\r\n\r\n        _codeViewAutoHeight: function () {\r\n            context.element.code.style.height = context.element.code.scrollHeight + 'px';\r\n        },\r\n\r\n        // FireFox - table delete, Chrome - image, video, audio\r\n        _hardDelete: function () {\r\n            const range = core.getRange();\r\n            const sc = range.startContainer;\r\n            const ec = range.endContainer;\r\n            \r\n            // table\r\n            const sCell = util.getRangeFormatElement(sc);\r\n            const eCell = util.getRangeFormatElement(ec);\r\n            const sIsCell = util.isCell(sCell);\r\n            const eIsCell = util.isCell(eCell);\r\n            if (((sIsCell && !sCell.previousElementSibling && !sCell.parentElement.previousElementSibling) || (eIsCell && !eCell.nextElementSibling && !eCell.parentElement.nextElementSibling)) && sCell !== eCell) {\r\n                if (!sIsCell) {\r\n                    util.removeItem(util.getParentElement(eCell, util.isComponent));\r\n                } else if (!eIsCell) {\r\n                    util.removeItem(util.getParentElement(sCell, util.isComponent));\r\n                } else {\r\n                    util.removeItem(util.getParentElement(sCell, util.isComponent));\r\n                    core.nativeFocus();\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            // component\r\n            const sComp = sc.nodeType === 1 ? util.getParentElement(sc, '.se-component') : null;\r\n            const eComp = ec.nodeType === 1 ? util.getParentElement(ec, '.se-component') : null;\r\n            if (sComp) util.removeItem(sComp);\r\n            if (eComp) util.removeItem(eComp);\r\n\r\n            return false;\r\n        },\r\n\r\n        onPaste_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n            if (!clipboardData) return true;\r\n            return event._dataTransferAction('paste', e, clipboardData);\r\n        },\r\n\r\n        _setClipboardComponent: function (e, info, clipboardData) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            clipboardData.setData('text/html', info.component.outerHTML);\r\n        },\r\n\r\n        onCopy_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n            \r\n            // user event\r\n            if (typeof functions.onCopy === 'function' && !functions.onCopy(e, clipboardData, core)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const info = core.currentFileComponentInfo;\r\n            if (info && !util.isIE) {\r\n                event._setClipboardComponent(e, info, clipboardData);\r\n                util.addClass(info.component, 'se-component-copy');\r\n                // copy effect\r\n                _w.setTimeout(function () {\r\n                    util.removeClass(info.component, 'se-component-copy');\r\n                }, 150);\r\n            }\r\n        },\r\n\r\n        onCut_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n\r\n            // user event\r\n            if (typeof functions.onCut === 'function' && !functions.onCut(e, clipboardData, core)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const info = core.currentFileComponentInfo;\r\n            if (info && !util.isIE) {\r\n                event._setClipboardComponent(e, info, clipboardData);\r\n                util.removeItem(info.component);\r\n                core.controllersOff();\r\n            }\r\n\r\n            _w.setTimeout(function () {\r\n                // history stack\r\n                core.history.push(false);\r\n            });\r\n        },\r\n\r\n        onDrop_wysiwyg: function (e) {\r\n            const dataTransfer = e.dataTransfer;\r\n            if (!dataTransfer) return true;\r\n            if (util.isIE) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            core.removeNode();\r\n            event._setDropLocationSelection(e);\r\n            return event._dataTransferAction('drop', e, dataTransfer);\r\n        },\r\n\r\n        _setDropLocationSelection: function (e) {\r\n            if (e.rangeParent) {\r\n                core.setRange(e.rangeParent, e.rangeOffset, e.rangeParent, e.rangeOffset);\r\n            } else if (core._wd.caretRangeFromPoint) {\r\n                const r = core._wd.caretRangeFromPoint(e.clientX, e.clientY);\r\n                core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\r\n            } else {\r\n                const r = core.getRange();\r\n                core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\r\n            }\r\n        },\r\n\r\n        _dataTransferAction: function (type, e, data) {\r\n            let plainText, cleanData;\r\n            if (util.isIE) {\r\n                plainText = data.getData('Text');\r\n                \r\n                const range = core.getRange();\r\n                const tempDiv = util.createElement('DIV');\r\n                const tempRange = {\r\n                    sc: range.startContainer,\r\n                    so: range.startOffset,\r\n                    ec: range.endContainer,\r\n                    eo: range.endOffset\r\n                };\r\n\r\n                tempDiv.setAttribute('contenteditable', true);\r\n                tempDiv.style.cssText = 'position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;';\r\n                \r\n                context.element.relative.appendChild(tempDiv);\r\n                tempDiv.focus();\r\n\r\n                _w.setTimeout(function () {\r\n                    cleanData = tempDiv.innerHTML;\r\n                    util.removeItem(tempDiv);\r\n                    core.setRange(tempRange.sc, tempRange.so, tempRange.ec, tempRange.eo);\r\n                    event._setClipboardData(type, e, plainText, cleanData, data);\r\n                });\r\n\r\n                return true;\r\n            } else {\r\n                plainText = data.getData('text/plain');\r\n                cleanData = data.getData('text/html');\r\n                if (event._setClipboardData(type, e, plainText, cleanData, data) === false) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    return false;\r\n                }\r\n            }\r\n        },\r\n\r\n        _setClipboardData: function (type, e, plainText, cleanData, data) {\r\n            // MS word, OneNode, Excel\r\n            const MSData = /class=[\"']*Mso(Normal|List)/i.test(cleanData) || /content=[\"']*Word.Document/i.test(cleanData) || /content=[\"']*OneNote.File/i.test(cleanData) || /content=[\"']*Excel.Sheet/i.test(cleanData);\r\n            const onlyText = !cleanData;\r\n\r\n            if (!onlyText) {\r\n                if (MSData) {\r\n                    cleanData = cleanData.replace(/\\n/g, ' ');\r\n                    plainText = plainText.replace(/\\n/g, ' ');\r\n                } else {\r\n                    cleanData = (plainText === cleanData ? plainText : cleanData).replace(/\\n/g, '<br>');\r\n                }\r\n                cleanData = core.cleanHTML(cleanData, core.pasteTagsWhitelistRegExp);\r\n            } else {\r\n                cleanData = util._HTMLConvertor(plainText).replace(/\\n/g, '<br>');\r\n            }\r\n\r\n            const maxCharCount = core._charCount(core._charTypeHTML ? cleanData : plainText);\r\n            // user event - paste\r\n            if (type === 'paste' && typeof functions.onPaste === 'function') {\r\n                const value = functions.onPaste(e, cleanData, maxCharCount, core);\r\n                if (!value) return false;\r\n                if (typeof value === 'string') cleanData = value;\r\n            }\r\n            // user event - drop\r\n            if (type === 'drop' && typeof functions.onDrop === 'function') {\r\n                const value = functions.onDrop(e, cleanData, maxCharCount, core);\r\n                if (!value) return false;\r\n                if (typeof value === 'string') cleanData = value;\r\n            }\r\n\r\n            // files\r\n            const files = data.files;\r\n            if (files.length > 0 && !MSData) {\r\n                if (/^image/.test(files[0].type) && core.plugins.image) {\r\n                    functions.insertImage(files);\r\n                }\r\n                return false;\r\n            }\r\n\r\n            if (!maxCharCount) {\r\n                return false;\r\n            }\r\n\r\n            if (cleanData) {\r\n                functions.insertHTML(cleanData, true, false);\r\n                return false;\r\n            }\r\n        },\r\n\r\n        onMouseMove_wysiwyg: function (e) {\r\n            if (core.isDisabled) return;\r\n            const component = util.getParentElement(e.target, util.isComponent);\r\n            const lineBreakerStyle = core._lineBreaker.style;\r\n            \r\n            if (component && !core.currentControllerName) {\r\n                const ctxEl = context.element;\r\n                let scrollTop = 0;\r\n                let el = ctxEl.wysiwyg;\r\n                do {\r\n                    scrollTop += el.scrollTop;\r\n                    el = el.parentElement;\r\n                } while (el && !/^(BODY|HTML)$/i.test(el.nodeName));\r\n\r\n                const wScroll = ctxEl.wysiwyg.scrollTop;\r\n                const offsets = event._getEditorOffsets(null);\r\n                const componentTop = util.getOffset(component, ctxEl.wysiwygFrame).top + wScroll;\r\n                const y = e.pageY + scrollTop + (options.iframe && !options.toolbarContainer ? ctxEl.toolbar.offsetHeight : 0);\r\n                const c = componentTop + (options.iframe ? scrollTop : offsets.top);\r\n\r\n                const isList = util.isListCell(component.parentNode);\r\n                let dir = '', top = '';\r\n                if ((isList ? !component.previousSibling : !util.isFormatElement(component.previousElementSibling)) && y < (c + 20)) {\r\n                    top = componentTop;\r\n                    dir = 't';\r\n                } else if ((isList ? !component.nextSibling : !util.isFormatElement(component.nextElementSibling)) && y > (c + component.offsetHeight - 20)) {\r\n                    top = componentTop + component.offsetHeight;\r\n                    dir = 'b';\r\n                } else {\r\n                    lineBreakerStyle.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                core._variable._lineBreakComp = component;\r\n                core._variable._lineBreakDir = dir;\r\n                lineBreakerStyle.top = (top - wScroll) + 'px';\r\n                core._lineBreakerButton.style.left = (util.getOffset(component).left + (component.offsetWidth / 2) - 15) + 'px';\r\n                lineBreakerStyle.display = 'block';\r\n            } // off line breaker\r\n            else if (lineBreakerStyle.display !== 'none') {\r\n                lineBreakerStyle.display = 'none';\r\n            }\r\n        },\r\n\r\n        _onMouseDown_lineBreak: function (e) {\r\n            e.preventDefault();\r\n        },\r\n\r\n        _onLineBreak: function (e) {\r\n            e.preventDefault();\r\n            \r\n            const component = core._variable._lineBreakComp;\r\n            const dir = !this ? core._variable._lineBreakDir : this;\r\n            const isList = util.isListCell(component.parentNode);\r\n\r\n            const format = util.createElement(isList ? 'BR' : util.isCell(component.parentNode) ? 'DIV' : options.defaultTag);\r\n            if (!isList) format.innerHTML = '<br>';\r\n\r\n            if (core._charTypeHTML && !core.checkCharCount(format.outerHTML, 'byte-html')) return;\r\n\r\n            component.parentNode.insertBefore(format, dir === 't' ? component : component.nextSibling);\r\n            core._lineBreaker.style.display = 'none';\r\n            core._variable._lineBreakComp = null;\r\n\r\n            const focusEl = isList ? format : format.firstChild;\r\n            core.setRange(focusEl, 1, focusEl, 1);\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        _addEvent: function () {\r\n            const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\r\n\r\n            /** toolbar event */\r\n            context.element.toolbar.addEventListener('mousedown', event._buttonsEventHandler, false);\r\n            context.element._menuTray.addEventListener('mousedown', event._buttonsEventHandler, false);\r\n            context.element.toolbar.addEventListener('click', event.onClick_toolbar, false);\r\n            /** editor area */\r\n            eventWysiwyg.addEventListener('mousedown', event.onMouseDown_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('click', event.onClick_wysiwyg, false);\r\n            eventWysiwyg.addEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('keydown', event.onKeyDown_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('keyup', event.onKeyUp_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('paste', event.onPaste_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('copy', event.onCopy_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('cut', event.onCut_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('drop', event.onDrop_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('scroll', event.onScroll_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('focus', event.onFocus_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('blur', event.onBlur_wysiwyg, false);\r\n\r\n            /** line breaker */\r\n            event._lineBreakerBind = { a: event._onLineBreak.bind(''), t: event._onLineBreak.bind('t'), b: event._onLineBreak.bind('b') };\r\n            eventWysiwyg.addEventListener('mousemove', event.onMouseMove_wysiwyg, false);\r\n            core._lineBreakerButton.addEventListener('mousedown', event._onMouseDown_lineBreak, false);\r\n            core._lineBreakerButton.addEventListener('click', event._lineBreakerBind.a, false);\r\n            context.element.lineBreaker_t.addEventListener('mousedown', event._lineBreakerBind.t, false);\r\n            context.element.lineBreaker_b.addEventListener('mousedown', event._lineBreakerBind.b, false);\r\n\r\n            /** Events are registered only when there is a table plugin.  */\r\n            if (core.plugins.table) {\r\n                eventWysiwyg.addEventListener('touchstart', event.onMouseDown_wysiwyg, {passive: true, useCapture: false});\r\n            }\r\n            \r\n            /** code view area auto line */\r\n            if (options.height === 'auto' && !options.codeMirrorEditor) {\r\n                context.element.code.addEventListener('keydown', event._codeViewAutoHeight, false);\r\n                context.element.code.addEventListener('keyup', event._codeViewAutoHeight, false);\r\n                context.element.code.addEventListener('paste', event._codeViewAutoHeight, false);\r\n            }\r\n\r\n            /** resizingBar */\r\n            if (context.element.resizingBar) {\r\n                if (/\\d+/.test(options.height)) {\r\n                    context.element.resizingBar.addEventListener('mousedown', event.onMouseDown_resizingBar, false);\r\n                } else {\r\n                    util.addClass(context.element.resizingBar, 'se-resizing-none');\r\n                }\r\n            }\r\n            \r\n            /** window event */\r\n            event._setResponsiveToolbar();\r\n            _w.removeEventListener('resize', event.onResize_window);\r\n            _w.removeEventListener('scroll', event.onScroll_window);\r\n\r\n            _w.addEventListener('resize', event.onResize_window, false);\r\n            if (options.stickyToolbar > -1) {\r\n                _w.addEventListener('scroll', event.onScroll_window, false);\r\n            }\r\n        },\r\n\r\n        _removeEvent: function () {\r\n            const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\r\n\r\n            context.element.toolbar.removeEventListener('mousedown', event._buttonsEventHandler);\r\n            context.element._menuTray.removeEventListener('mousedown', event._buttonsEventHandler);\r\n            context.element.toolbar.removeEventListener('click', event.onClick_toolbar);\r\n\r\n            eventWysiwyg.removeEventListener('mousedown', event.onMouseDown_wysiwyg);\r\n            eventWysiwyg.removeEventListener('click', event.onClick_wysiwyg);\r\n            eventWysiwyg.removeEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg);\r\n            eventWysiwyg.removeEventListener('keydown', event.onKeyDown_wysiwyg);\r\n            eventWysiwyg.removeEventListener('keyup', event.onKeyUp_wysiwyg);\r\n            eventWysiwyg.removeEventListener('paste', event.onPaste_wysiwyg);\r\n            eventWysiwyg.removeEventListener('copy', event.onCopy_wysiwyg);\r\n            eventWysiwyg.removeEventListener('cut', event.onCut_wysiwyg);\r\n            eventWysiwyg.removeEventListener('drop', event.onDrop_wysiwyg);\r\n            eventWysiwyg.removeEventListener('scroll', event.onScroll_wysiwyg);\r\n\r\n            eventWysiwyg.removeEventListener('mousemove', event.onMouseMove_wysiwyg);\r\n            core._lineBreakerButton.removeEventListener('mousedown', event._onMouseDown_lineBreak);\r\n            core._lineBreakerButton.removeEventListener('click', event._lineBreakerBind.a);\r\n            context.element.lineBreaker_t.removeEventListener('mousedown', event._lineBreakerBind.t);\r\n            context.element.lineBreaker_b.removeEventListener('mousedown', event._lineBreakerBind.b);\r\n            event._lineBreakerBind = null;\r\n            \r\n            eventWysiwyg.removeEventListener('touchstart', event.onMouseDown_wysiwyg, {passive: true, useCapture: false});\r\n            \r\n            eventWysiwyg.removeEventListener('focus', event.onFocus_wysiwyg);\r\n            eventWysiwyg.removeEventListener('blur', event.onBlur_wysiwyg);\r\n\r\n            context.element.code.removeEventListener('keydown', event._codeViewAutoHeight);\r\n            context.element.code.removeEventListener('keyup', event._codeViewAutoHeight);\r\n            context.element.code.removeEventListener('paste', event._codeViewAutoHeight);\r\n            \r\n            if (context.element.resizingBar) {\r\n                context.element.resizingBar.removeEventListener('mousedown', event.onMouseDown_resizingBar);\r\n            }\r\n            \r\n            _w.removeEventListener('resize', event.onResize_window);\r\n            _w.removeEventListener('scroll', event.onScroll_window);\r\n        },\r\n\r\n        _setResponsiveToolbar: function () {\r\n            if (_responsiveButtons.length === 0) {\r\n                _responsiveButtons = null;\r\n                return;\r\n            }\r\n\r\n            event._responsiveCurrentSize = 'default';\r\n            const sizeArray = event._responsiveButtonSize = [];\r\n            const buttonsObj = event._responsiveButtons = {default: _responsiveButtons[0]};\r\n            for (let i = 1, len = _responsiveButtons.length, size, buttonGroup; i < len; i++) {\r\n                buttonGroup = _responsiveButtons[i];\r\n                size = buttonGroup[0] * 1;\r\n                sizeArray.push(size);\r\n                buttonsObj[size] = buttonGroup[1];\r\n            }\r\n\r\n            sizeArray.sort(function (a, b) { return a - b; }).unshift('default');\r\n        }\r\n    };\r\n\r\n    /** functions */\r\n    const functions = {\r\n        /**\r\n         * @description Core, Util object\r\n         */\r\n        core: core,\r\n        util: util,\r\n\r\n        /**\r\n         * @description Event functions\r\n         * @param {Object} e Event Object\r\n         * @param {Object} core Core object\r\n         */\r\n        onload: null,\r\n        onScroll: null,\r\n        onMouseDown: null,\r\n        onClick: null,\r\n        onInput: null,\r\n        onKeyDown: null,\r\n        onKeyUp: null,\r\n        onCopy: null,\r\n        onCut: null,\r\n        onFocus: null,\r\n        onBlur: null,\r\n\r\n        /**\r\n         * @description Event functions\r\n         * @param {String} contents Current contents\r\n         * @param {Object} core Core object\r\n         */\r\n        onChange: null,\r\n\r\n        /**\r\n         * @description Event functions (drop, paste)\r\n         * When false is returned, the default behavior is stopped.\r\n         * If the string is returned, the cleanData value is modified to the return value.\r\n         * @param {Object} e Event object.\r\n         * @param {String} cleanData HTML string modified for editor format.\r\n         * @param {Boolean} maxChartCount option (true if max character is exceeded)\r\n         * @param {Object} core Core object\r\n         * @returns {Boolean|String}\r\n         */\r\n        onDrop: null,\r\n        onPaste: null,\r\n\r\n        /**\r\n         * @description Called just before the inline toolbar is positioned and displayed on the screen.\r\n         * @param {Element} toolbar Toolbar Element\r\n         * @param {Object} context The editor's context object (editor.getContext())\r\n         * @param {Object} core Core object\r\n         */\r\n        showInline: null,\r\n\r\n        /**\r\n         * @description Called just after the controller is positioned and displayed on the screen.\r\n         * controller - editing elements displayed on the screen [image resizing, table editor, link editor..]]\r\n         * @param {String} name The name of the plugin that called the controller\r\n         * @param {Array} controllers Array of Controller elements\r\n         * @param {Object} core Core object\r\n         */\r\n        showController: null,\r\n\r\n        /**\r\n         * @description An event when toggling between code view and wysiwyg view.\r\n         * @param {Boolean} isCodeView Whether the current code view mode\r\n         * @param {Object} core Core object\r\n         */\r\n        toggleCodeView: null,\r\n\r\n        /**\r\n         * @description An event when toggling full screen.\r\n         * @param {Boolean} isFullScreen Whether the current full screen mode\r\n         * @param {Object} core Core object\r\n         */\r\n        toggleFullScreen: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the image upload\r\n         * @param {Object} response Response object\r\n         * @param {Object} info Input information\r\n         * - linkValue: Link url value\r\n         * - linkNewWindow: Open in new window Check Value\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update image if true, create image if false\r\n         * - element: If isUpdate is true, the currently selected image.\r\n         * @param {Object} core Core object\r\n         */\r\n        imageUploadHandler: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the video upload\r\n         * @param xmlHttp xmlHttpRequest object\r\n         * @param info Input information\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update video if true, create video if false\r\n         * - element: If isUpdate is true, the currently selected video.\r\n         * @param core Core object\r\n         */\r\n        videoUploadHandler: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the audio upload\r\n         * @param xmlHttp xmlHttpRequest object\r\n         * @param info Input information\r\n         * - isUpdate: Update audio if true, create audio if false\r\n         * - element: If isUpdate is true, the currently selected audio.\r\n         * @param core Core object\r\n         */\r\n        audioUploadHandler: null,\r\n\r\n        /**\r\n         * @description Called before the image is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no image upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - linkValue: Link url value\r\n         * - linkNewWindow: Open in new window Check Value\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update image if true, create image if false\r\n         * - element: If isUpdate is true, the currently selected image.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"imageUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onImageUploadBefore: null,\r\n        /**\r\n         * @description Called before the video is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no video(iframe, video) upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update video if true, create video if false\r\n         * - element: If isUpdate is true, the currently selected video.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"videoUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onVideoUploadBefore: null,\r\n        /**\r\n         * @description Called before the audio is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no audio upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - isUpdate: Update audio if true, create audio if false\r\n         * - element: If isUpdate is true, the currently selected audio.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"audioUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onAudioUploadBefore: null,\r\n\r\n        /**\r\n         * @description Called when the image is uploaded, updated, deleted\r\n         * @param {Element} targetElement Target element\r\n         * @param {Number} index Uploaded index\r\n         * @param {String} state Upload status ('create', 'update', 'delete')\r\n         * @param {Object} info Image info object\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @param {Number} remainingFilesCount Count of remaining files to upload (0 when added as a url)\r\n         * @param {Object} core Core object\r\n         */\r\n        onImageUpload: null,\r\n         /**\r\n         * @description Called when the video(iframe, video) is is uploaded, updated, deleted\r\n         * -- arguments is same \"onImageUpload\" --\r\n         */\r\n        onVideoUpload: null,\r\n         /**\r\n         * @description Called when the audio is is uploaded, updated, deleted\r\n         * -- arguments is same \"onImageUpload\" --\r\n         */\r\n        onAudioUpload: null,\r\n\r\n        /**\r\n         * @description Called when the image is upload failed\r\n         * @param {String} errorMessage Error message\r\n         * @param {Object} result Response Object\r\n         * @param {Object} core Core object\r\n         * @returns {Boolean}\r\n         */\r\n        onImageUploadError: null,\r\n        /**\r\n         * @description Called when the video(iframe, video) upload failed\r\n         * -- arguments is same \"onImageUploadError\" --\r\n         */\r\n        onVideoUploadError: null,\r\n        /**\r\n         * @description Called when the audio upload failed\r\n         * -- arguments is same \"onImageUploadError\" --\r\n         */\r\n        onAudioUploadError: null,\r\n\r\n        /**\r\n         * @description Called when the editor is resized using the bottom bar\r\n         */\r\n        onResizeEditor: null,\r\n\r\n        /**\r\n         * @description Reset the buttons on the toolbar. (Editor is not reloaded)\r\n         * You cannot set a new plugin for the button.\r\n         * @param {Array} buttonList Button list \r\n         */\r\n        setToolbarButtons: function (buttonList) {\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            \r\n            const newToolbar = _Constructor._createToolBar(_d, buttonList, core.plugins, options);\r\n            _responsiveButtons = newToolbar.responsiveButtons;\r\n            core._moreLayerActiveButton = null;\r\n            event._setResponsiveToolbar();\r\n\r\n            context.element.toolbar.replaceChild(newToolbar._buttonTray, context.element._buttonTray);\r\n            const newContext = _Context(context.element.originElement, core._getConstructed(context.element), options);\r\n\r\n            context.element = newContext.element;\r\n            context.tool = newContext.tool;\r\n            if (options.iframe) context.element.wysiwyg = core._wd.body;\r\n            core._cachingButtons();\r\n            core.history._resetCachingButton();\r\n\r\n            core.activePlugins = [];\r\n            const oldCallButtons = pluginCallButtons;\r\n            pluginCallButtons = newToolbar.pluginCallButtons;\r\n            let plugin, button, oldButton;\r\n            for (let key in pluginCallButtons) {\r\n                if (!util.hasOwn(pluginCallButtons, key)) continue;\r\n                plugin = plugins[key];\r\n                button = pluginCallButtons[key];\r\n                if (plugin.active && button) {\r\n                    oldButton = oldCallButtons[key];\r\n                    core.callPlugin(key, null, oldButton || button);\r\n                    if (oldButton) {\r\n                        button.parentElement.replaceChild(oldButton, button);\r\n                        pluginCallButtons[key] = oldButton;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (core.hasFocus) event._applyTagEffects();\r\n\r\n            if (core._variable.isCodeView) util.addClass(core._styleCommandMap.codeView, 'active');\r\n            if (core._variable.isFullScreen) util.addClass(core._styleCommandMap.fullScreen, 'active');\r\n            if (util.hasClass(context.element.wysiwyg, 'se-show-block')) util.addClass(core._styleCommandMap.showBlocks, 'active');\r\n        },\r\n\r\n        /**\r\n         * @description Add or reset option property (Editor is reloaded)\r\n         * @param {Object} _options Options\r\n         */\r\n        setOptions: function (_options) {\r\n            event._removeEvent();\r\n            core._resetComponents();\r\n            \r\n            util.removeClass(core._styleCommandMap.showBlocks, 'active');\r\n            util.removeClass(core._styleCommandMap.codeView, 'active');\r\n            core._variable.isCodeView = false;\r\n            core._iframeAuto = null;\r\n\r\n            core.plugins = _options.plugins || core.plugins;\r\n            const mergeOptions = [options, _options].reduce(function (init, option) {\r\n                for (let key in option) {\r\n                    if (!util.hasOwn(option, key)) continue;\r\n                    if (key === 'plugins' && option[key] && init[key]) {\r\n                        let i = init[key], o = option[key];\r\n                        i = i.length ? i : _w.Object.keys(i).map(function(name) { return i[name]; });\r\n                        o = o.length ? o : _w.Object.keys(o).map(function(name) { return o[name]; });\r\n                        init[key] = (o.filter(function(val) { return i.indexOf(val) === -1; })).concat(i);\r\n                    } else {\r\n                        init[key] = option[key];\r\n                    }\r\n                }\r\n                return init;\r\n            }, {});\r\n\r\n            const el = context.element;\r\n            const _initHTML = el.wysiwyg.innerHTML;\r\n\r\n            // set option\r\n            const cons = _Constructor._setOptions(mergeOptions, context, options);        \r\n\r\n            if (cons.callButtons) {\r\n                pluginCallButtons = cons.callButtons;\r\n                core.initPlugins = {};\r\n            }\r\n\r\n            if (cons.plugins) {\r\n                core.plugins = plugins = cons.plugins;\r\n            }\r\n\r\n            // reset context\r\n            if (el._menuTray.children.length === 0) this._menuTray = {};\r\n            _responsiveButtons = cons.toolbar.responsiveButtons;\r\n            core.options = options = mergeOptions;\r\n            core.lang = lang = options.lang;\r\n\r\n            if (options.iframe) {\r\n                el.wysiwygFrame.addEventListener('load', function () {\r\n                    util._setIframeDocument(this, options);\r\n                    core._setOptionsInit(el, _initHTML);\r\n                });\r\n            }\r\n\r\n            el.editorArea.appendChild(el.wysiwygFrame);\r\n\r\n            if (!options.iframe) {\r\n                core._setOptionsInit(el, _initHTML);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set \"options.defaultStyle\" style.\r\n         * Define the style of the edit area\r\n         * It can also be defined with the \"setOptions\" method, but the \"setDefaultStyle\" method does not render the editor again.\r\n         * @param {String} style Style string\r\n         */\r\n        setDefaultStyle: function (style) {\r\n            const newStyles = options._editorStyles = util._setDefaultOptionStyle(options, style);\r\n            const el = context.element;\r\n\r\n            // top area\r\n            el.topArea.style.cssText = newStyles.top;\r\n            // code view\r\n            el.code.style.cssText = options._editorStyles.frame;\r\n            el.code.style.display = 'none';\r\n            if (options.height === 'auto') {\r\n                el.code.style.overflow = 'hidden';\r\n            } else {\r\n                el.code.style.overflow = '';\r\n            }\r\n            // wysiwyg frame\r\n            if (!options.iframe) {\r\n                el.wysiwygFrame.style.cssText = newStyles.frame + newStyles.editor;\r\n            } else {\r\n                el.wysiwygFrame.style.cssText = newStyles.frame;\r\n                el.wysiwyg.style.cssText = newStyles.editor;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Open a notice area\r\n         * @param {String} message Notice message\r\n         */\r\n        noticeOpen: function (message) {\r\n            core.notice.open.call(core, message);\r\n        },\r\n\r\n        /**\r\n         * @description Close a notice area\r\n         */\r\n        noticeClose: function () {\r\n            core.notice.close.call(core);\r\n        },\r\n\r\n        /**\r\n         * @description Copying the contents of the editor to the original textarea\r\n         */\r\n        save: function () {\r\n            context.element.originElement.value = core.getContents(false);\r\n        },\r\n\r\n        /**\r\n         * @description Gets the suneditor's context object. Contains settings, plugins, and cached element objects\r\n         * @returns {Object}\r\n         */\r\n        getContext: function () {\r\n            return context;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the contents of the suneditor\r\n         * @param {Boolean} onlyContents - Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {String}\r\n         */\r\n        getContents: function (onlyContents) {\r\n            return core.getContents(onlyContents);\r\n        },\r\n\r\n        /**\r\n         * @description Gets only the text of the suneditor contents\r\n         * @returns {String}\r\n         */\r\n        getText: function () {\r\n            return context.element.wysiwyg.textContent;\r\n        },\r\n\r\n        /**\r\n         * @description Get the editor's number of characters or binary data size.\r\n         * You can use the \"charCounterType\" option format.\r\n         * @param {String|null} charCounterType options - charCounterType ('char', 'byte', 'byte-html')\r\n         * If argument is no value, the currently set \"charCounterType\" option is used.\r\n         * @returns {Number}\r\n         */\r\n        getCharCount: function (charCounterType) {\r\n            charCounterType = typeof charCounterType === 'string' ? charCounterType : options.charCounterType;\r\n            return core.getCharLength((core._charTypeHTML ? context.element.wysiwyg.innerHTML : context.element.wysiwyg.textContent), charCounterType);\r\n        },\r\n\r\n        /**\r\n         * @description Gets uploaded images informations\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @returns {Array}\r\n         */\r\n        getImagesInfo: function () {\r\n            return context.image ? context.image._infoList : [];\r\n        },\r\n        \r\n        /**\r\n         * @description Gets uploaded files(plugin using fileManager) information list.\r\n         * image: [img], video: [video, iframe], audio: [audio]\r\n         * When the argument value is 'image', it is the same function as \"getImagesInfo\".\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @param {String} pluginName Plugin name (image, video, audio)\r\n         * @returns {Array}\r\n         */\r\n        getFilesInfo: function (pluginName) {\r\n            return context[pluginName] ? context[pluginName]._infoList : [];\r\n        },\r\n\r\n        /**\r\n         * @description Upload images using image plugin\r\n         * @param {FileList} files FileList\r\n         */\r\n        insertImage: function (files) {\r\n            if (!core.plugins.image || !files) return;\r\n\r\n            if (!core.initPlugins.image) core.callPlugin('image', core.plugins.image.submitAction.bind(core, files), null);\r\n            else core.plugins.image.submitAction.call(core, files);\r\n            core.focus();\r\n        },\r\n\r\n        /**\r\n         * @description Inserts an HTML element or HTML string or plain string at the current cursor position\r\n         * @param {Element|String} html HTML Element or HTML string or plain string\r\n         * @param {Boolean} notCleaningData If true, inserts the HTML string without refining it with core.cleanHTML.\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @param {Boolean} rangeSelection If true, range select the inserted node.\r\n         */\r\n        insertHTML: function (html, notCleaningData, checkCharCount, rangeSelection) {\r\n            if (typeof html === 'string') {\r\n                if (!notCleaningData) html = core.cleanHTML(html, null);\r\n                try {\r\n                    const dom = _d.createRange().createContextualFragment(html);\r\n                    const domTree = dom.childNodes;\r\n\r\n                    if (checkCharCount) {\r\n                        const type = core._charTypeHTML ? 'outerHTML' : 'textContent';\r\n                        let checkHTML = '';\r\n                        for (let i = 0, len = domTree.length; i < len; i++) {\r\n                            checkHTML += domTree[i][type];\r\n                        }\r\n                        if (!core.checkCharCount(checkHTML, null)) return;\r\n                    }\r\n\r\n                    let c, a, t, prev, firstCon;\r\n                    while ((c = domTree[0])) {\r\n                        if (prev && prev.nodeType === 3 && a && a.nodeType === 1 && util.isBreak(c)) {\r\n                            prev = c;\r\n                            util.removeItem(c);\r\n                            continue;\r\n                        }\r\n                        t = core.insertNode(c, a, false);\r\n                        a = t.container || t;\r\n                        if (!firstCon) firstCon = t;\r\n                        prev = c;\r\n                    }\r\n\r\n                    if (prev.nodeType === 3 && a.nodeType === 1) a = prev;\r\n                    const offset = a.nodeType === 3 ? (t.endOffset || a.textContent.length): a.childNodes.length;\r\n                    if (rangeSelection) core.setRange(firstCon.container || firstCon, firstCon.startOffset || 0, a, offset);\r\n                    else core.setRange(a, offset, a, offset);\r\n                } catch (error) {\r\n                    console.warn('[SUNEDITOR.insertHTML.fail] ' + error);\r\n                    core.execCommand('insertHTML', false, html);\r\n                }\r\n            } else {\r\n                if (util.isComponent(html)) {\r\n                    core.insertComponent(html, false, checkCharCount, false);\r\n                } else {\r\n                    let afterNode = null;\r\n                    if (util.isFormatElement(html) || util.isMedia(html)) {\r\n                        afterNode = util.getFormatElement(core.getSelectionNode(), null);\t\r\n                    }\r\n                    core.insertNode(html, afterNode, checkCharCount);\r\n                }\r\n            }\r\n            \r\n            core.effectNode = null;\r\n            core.focus();\r\n\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Change the contents of the suneditor\r\n         * @param {String|undefined} contents Contents to Input\r\n         */\r\n        setContents: function (contents) {\r\n            core.setContents(contents);\r\n        },\r\n\r\n        /**\r\n         * @description Add contents to the suneditor\r\n         * @param {String} contents Contents to Input\r\n         */\r\n        appendContents: function (contents) {\r\n            const convertValue = core.convertContentsForEditor(contents);\r\n            \r\n            if (!core._variable.isCodeView) {\r\n                const temp = util.createElement('DIV');\r\n                temp.innerHTML = convertValue;\r\n\r\n                const wysiwyg = context.element.wysiwyg;\r\n                const children = temp.children;\r\n                for (let i = 0, len = children.length; i < len; i++) {\r\n                    wysiwyg.appendChild(children[i]);\r\n                }\r\n            } else {\r\n                core._setCodeView(core._getCodeView() + '\\n' + core.convertHTMLForCodeView(convertValue));\r\n            }\r\n\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Disable the suneditor\r\n         */\r\n        disabled: function () {\r\n            context.tool.cover.style.display = 'block';\r\n            context.element.wysiwyg.setAttribute('contenteditable', false);\r\n            core.isDisabled = true;\r\n\r\n            if (options.codeMirrorEditor) {\r\n                options.codeMirrorEditor.setOption('readOnly', true);\r\n            } else {\r\n                context.element.code.setAttribute('disabled', 'disabled');\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Enable the suneditor\r\n         */\r\n        enabled: function () {\r\n            context.tool.cover.style.display = 'none';\r\n            context.element.wysiwyg.setAttribute('contenteditable', true);\r\n            core.isDisabled = false;\r\n\r\n            if (options.codeMirrorEditor) {\r\n                options.codeMirrorEditor.setOption('readOnly', false);\r\n            } else {\r\n                context.element.code.removeAttribute('disabled');\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Show the suneditor\r\n         */\r\n        show: function () {\r\n            const topAreaStyle = context.element.topArea.style;\r\n            if (topAreaStyle.display === 'none') topAreaStyle.display = options.display;\r\n        },\r\n\r\n        /**\r\n         * @description Hide the suneditor\r\n         */\r\n        hide: function () {\r\n            context.element.topArea.style.display = 'none';\r\n        },\r\n\r\n        /**\r\n         * @description Destroy the suneditor\r\n         */\r\n        destroy: function () {\r\n            /** off menus */\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.controllersOff();\r\n            if (core.notice) core.notice.close.call(core);\r\n            if (core.modalForm) core.plugins.dialog.close.call(core);\r\n\r\n            /** remove history */\r\n            core.history._destroy();\r\n\r\n            /** remove event listeners */\r\n            event._removeEvent();\r\n            \r\n            /** remove element */\r\n            util.removeItem(context.element.toolbar);\r\n            util.removeItem(context.element.topArea);\r\n\r\n            /** remove object reference */\r\n            for (let k in core.functions) { if (util.hasOwn(core, k)) delete core.functions[k]; }\r\n            for (let k in core) { if (util.hasOwn(core, k)) delete core[k]; }\r\n            for (let k in event) { if (util.hasOwn(event, k)) delete event[k]; }\r\n            for (let k in context) { if (util.hasOwn(context, k)) delete context[k]; }\r\n            for (let k in pluginCallButtons) { if (util.hasOwn(pluginCallButtons, k)) delete pluginCallButtons[k]; }\r\n            \r\n            /** remove user object */\r\n            for (let k in this) { if (util.hasOwn(this, k)) delete this[k]; }\r\n        },\r\n\r\n        /**\r\n         * @description Toolbar methods\r\n         */\r\n        toolbar: {\r\n            /**\r\n             * @description Disable the toolbar\r\n             */\r\n            disabled: function () {\r\n                context.tool.cover.style.display = 'block';\r\n            },\r\n\r\n            /**\r\n             * @description Enable the toolbar\r\n             */\r\n            enabled: function () {\r\n                context.tool.cover.style.display = 'none';\r\n            },\r\n\r\n            /**\r\n             * @description Show the toolbar\r\n             */\r\n            show: function () {\r\n                if (core._isInline) {\r\n                    event._showToolbarInline();\r\n                } else {\r\n                    context.element.toolbar.style.display = '';\r\n                    context.element._stickyDummy.style.display = '';\r\n                }\r\n            },\r\n\r\n            /**\r\n             * @description Hide the toolbar\r\n             */\r\n            hide: function () {\r\n                if (core._isInline) {\r\n                    event._hideToolbar();\r\n                } else {\r\n                    context.element.toolbar.style.display = 'none';\r\n                    context.element._stickyDummy.style.display = 'none';\r\n                }\r\n            },\r\n        }\r\n    };\r\n\r\n    /************ Core init ************/\r\n    // functions\r\n    core.functions = functions;\r\n    core.options = options;\r\n\r\n    // Create to sibling node\r\n    let contextEl = context.element;\r\n    let originEl = contextEl.originElement;\r\n    let topEl = contextEl.topArea;\r\n    originEl.style.display = 'none';\r\n    topEl.style.display = 'block';\r\n\r\n    // init\r\n    if (options.iframe) {\r\n        contextEl.wysiwygFrame.addEventListener('load', function () {\r\n            util._setIframeDocument(this, options);\r\n            core._editorInit(false, options.value);\r\n            options.value = null;\r\n        });\r\n    }\r\n\r\n    // insert editor element\r\n    if (typeof originEl.nextElementSibling === 'object') {\r\n        originEl.parentNode.insertBefore(topEl, originEl.nextElementSibling);\r\n    } else {\r\n        originEl.parentNode.appendChild(topEl);\r\n    }\r\n\r\n    contextEl.editorArea.appendChild(contextEl.wysiwygFrame);\r\n    contextEl = originEl = topEl = null;\r\n\r\n    // init\r\n    if (!options.iframe) {\r\n        core._editorInit(false, options.value);\r\n        options.value = null;\r\n    }\r\n\r\n    return functions;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}